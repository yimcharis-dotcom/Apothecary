# AI HubWatch - Automation Scripts Deployment

## Canonical Reference

- Multi-agent canonical guide: `./AGENTS.md`
- Dashboard-specific guide: `./dashboard/CLAUDE.md`

## Purpose
This folder contains **source versions** of AI HubWatch automation scripts. Edit and version scripts here, then deploy to runtime location.

## Architecture

### Canonical Locations
- **Source (edit here):** `C:\Vault\Apothecary\30_Automation\303_AI_HubWatch - Automation\`
  - Production-ready versions with `!` prefix
  - Version controlled in Obsidian vault
  - Documentation and changelog
  - Edit scripts here, then deploy to runtime

- **Runtime (deployed to):** `C:\Users\YC\AI_hub\`
  - Where scripts actively run
  - Files copied here via Obsidian QuickAdd deployment
  - Do NOT edit runtime versions - edit source in Vault instead

- **Logs:** `C:\Users\YC\AI_hub\_Change_log\`
  - Installation/deletion logs with `_add` and `_del` suffixes

## Scripts

### Deployed Scripts (with ! prefix)
- `!WatchHub_Realtime.ps1` - Real-time AI tools & skills monitoring v2
- `!SyncSkills.ps1` - Skills symlink manager v2
- `!TrackInstallation.ps1` - Before/after installation tracker
- `!Hub.ps1` - Main hub control center v2
- `!ExportToObsidian.ps1` - Obsidian inventory exporter

## Workflow

### Automated Detection & Sync
```
AI Tool Installed
  â†“ WatchHub detects
  â†“ Creates junction
  â†“ Logs to _Change_log
  â†“ Updates Obsidian

Skill Installed to Claude
  â†“ WatchHub detects
  â†“ Triggers SyncSkills
  â†“ Symlinks to all agents
  â†“ Logs to _Change_log
  â†“ Updates Obsidian
```

### Deployment Process
1. Edit scripts here in Vault with `!` prefix (e.g., `!WatchHub_Realtime.ps1`)
2. Use Obsidian QuickAdd: `Ctrl+P` â†’ `ğŸš€ Deploy Script to Running`
3. Enter script name with `!` prefix
4. Script copied to `C:\Users\YC\AI_hub\` (without `!` prefix for runtime)
5. Update `_CHANGELOG.md` with version and changes

## Key Features

### WatchHub_Realtime.ps1 v2
- Monitors 6 locations for AI tool installations
- Monitors `Claude_User_Dot/skills/` for skill changes
- Auto-triggers SyncSkills on skill add/delete
- Logs format: `foldername_category_add.txt` and `foldername_category_del.txt`

### SyncSkills.ps1 v2
- Changed from copy to symlink (`mklink /D`)
- Added `-Delete` flag for cleanup
- Syncs skills from Claude to all AI agents

### TrackInstallation.ps1
- Before/after snapshot comparison
- Predicts installation locations
- Interactive menu interface

### Hub.ps1 v2
- Menu option 9: WatchHub v2
- Menu option 10: Track Installation
- CLI: `.\Hub.ps1 watch` and `.\Hub.ps1 track`

## Documentation
- `QuickAdd Setup Guide.md` - Obsidian deployment workflow setup
- `_CHANGELOG.md` - Version history and deployment log

## Important Notes
- The `!` prefix indicates version-controlled source files in Vault
- Source files live here, runtime copies in `AI_hub\` (without `!` prefix)
- Always edit here in Vault, then deploy to `AI_hub\` via QuickAdd
- Update changelog with each deployment
- Skills use symlinks (not copies) for real-time sync
- Deletion detection automatically cleans up broken links

---

# UPDATED WORKFLOW - 2026-02-02

**Last Updated:** 2026-02-02

## Purpose
Three-tier workflow for developing, staging, and deploying AI HubWatch automation scripts with version control and safe separation from running production scripts.

## Architecture - 3-Tier Workflow

### TIER 1: DRAFT (Active Development)
- **Location:** `C:\Vault\Apothecary\40_*/90_Inbox\`
- **Purpose:** Active development, experimentation, testing
- **Files:** Raw `.ps1` scripts (NOT .md files)
- **Why:** AI won't overwrite your work-in-progress here

### TIER 2: STAGING (Source of Truth)
- **Location:** `C:\Vault\Apothecary\30_Automation\303_AI_HubWatch - Automation\src\`
- **Purpose:** Approved, production-ready versions
- **Files:** `.ps1` scripts ready to deploy
- **Documentation:** `.md` files in parent folder (not in `src/`)
- **Transition:** Manual move from Tier 1 when ready (drag-drop in Obsidian)

### TIER 3A: PRODUCTION (Running Scripts)
- **Location:** `C:\Vault\Apothecary\00_System\000_Scripts - running\0001_AI_HubWatch scripts - running\`
- **Files:** `!{scriptName}` (with `!` prefix)
- **Purpose:** Live production scripts
- **Deployment:** Automated via QuickAdd script from Tier 2

### TIER 3B: AI WORKING COPY
- **Location:** `C:\Users\YC\AI_hub\`
- **Files:** `{scriptName}` (normal name)
- **Purpose:** Where AI can safely work without affecting production
- **Deployment:** Automated via QuickAdd script from Tier 2
- **Logs:** `_Change_log/` - Installation/deletion logs

### Symlink Status
- `C:\Users\YC\AI_hub\.claude.md` â†’ symlinked to this file
- Both locations share the same documentation

## Development to Production Flow
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TIER 1: DRAFT (40_*/90_Inbox)                              â”‚
â”‚ â†’ Work on .ps1 scripts, iterate, experiment                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
         (Manual move when ready - drag-drop in Obsidian)
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TIER 2: STAGING (30_Automation/303_AI_HubWatch/src)        â”‚
â”‚ â†’ Approved versions, source of truth                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
         (Ctrl+P â†’ QuickAdd â†’ "Deploy to Production")
                         â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TIER 3A: PRODUCTION â”‚      â”‚ TIER 3B: AI WORKING COPY    â”‚
â”‚ !Hub.ps1            â”‚      â”‚ Hub.ps1                     â”‚
â”‚ ğŸ“ 00_System\       â”‚      â”‚ ğŸ“ C:\Users\YC\AI_hub       â”‚
â”‚    0001_AI_HubWatch â”‚      â”‚ (AI uses these)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Deployment Process (NEW - 2026-02-02)
1. **Draft:** Work on scripts in `40_*/90_Inbox/` (safe from AI overwrites)
2. **Promote:** When ready, manually move to `30_Automation/303_AI_HubWatch/src/`
3. **Deploy:** Open script in `src/`, run `Ctrl+P` â†’ QuickAdd deploy command
4. **Automated copy to:**
   - `00_System/.../0001_AI_HubWatch scripts - running/!{scriptName}` (production)
   - `C:\Users\YC\AI_hub\{scriptName}` (AI working copy)
5. **Document:** Update `_CHANGELOG.md` with version and changes

## Updated Important Notes
- Work on `.ps1` files directly (NOT markdown with code blocks) for better AI/tooling support
- Separate `.md` files for documentation, link to scripts using `[[src/scriptName.ps1]]`
- The `!` prefix indicates production scripts in running folder
- Three-tier separation prevents AI from overwriting work-in-progress
- Always draft in 40_/90_Inbox, promote to 30_/src, then deploy via QuickAdd
- Update changelog with each deployment
- Skills use symlinks (not copies) for real-time sync
- Deletion detection automatically cleans up broken links

---

## Session Status: 2026-02-02

### Completed
âœ… Analyzed existing deployment workflow (deploy-ai-hub-script.js)
âœ… Identified MD formatting issues (scripts not in code blocks)
âœ… Designed 3-tier workflow (Draft â†’ Staging â†’ Production + AI_hub)
âœ… Cleaned old production scripts (`!*.ps1` deleted from running folder)
âœ… Created symlink: `AI_hub\.claude` â†’ `30_Automation/.claude` (consolidated docs)
âœ… Documented new workflow in this file

### Blueprint Reference
- **Script:** `C:\Vault\Apothecary\00_System\000_Scripts - running\Script - push-to-templates.md`
- **Pattern:** Simple copy operation, no code extraction needed
- **Use for:** Creating the "Deploy to Production" QuickAdd script

### Next Steps (TODO)
1. â³ Create **"Deploy to Production"** QuickAdd script (REQUIRED)
   - Trigger: Ctrl+P when viewing file in `30_Automation/src/`
   - Action: Copy to both Production (`!` prefix) + AI_hub (normal name)
   - Based on push-to-templates.md pattern

2. â³ (Optional) Create **"Promote to Staging"** QuickAdd script
   - Trigger: Ctrl+P when viewing file in `40_/90_Inbox`
   - Action: Copy to `30_Automation/src/`
   - Alternative: Manual drag-drop (simpler)

3. â³ Test deployment with one script (e.g., Hub.ps1)

4. â³ Migrate all 8 scripts to new workflow

5. â³ Update runbook documentation

### Questions for Next Session
- Create deploy script now or later?
- Want optional "Promote to Staging" script, or prefer manual moves?
- Should deploy script validate it's running from correct folder?
- Any additional file naming conventions needed?

---

## Known Issue: Administrator PowerShell Windows Visible in Task View

### Problem
Two Administrator PowerShell windows appear in Windows Task View (Alt+Tab) even though `-WindowStyle Hidden` is specified:
- **Window 1:** WatchHub_Wrapper.ps1 (error handler)
- **Window 2:** WatchHub_Realtime.ps1 (core monitoring)

### Root Cause
The scheduled task is configured with:
```powershell
$Principal = New-ScheduledTaskPrincipal `
    -UserId $env:USERNAME `
    -LogonType Interactive `    # Makes them visible in Task View
    -RunLevel Highest           # Runs as Administrator
```

**Why this happens:**
- `-LogonType Interactive` makes processes visible in UI
- `-RunLevel Highest` elevates to Administrator
- Windows Task View shows all interactive elevated processes, even "hidden" ones
- The processes need to be interactive to show popup notifications

**Why Admin was used:**
- Originally intended for creating junctions
- **However:** Windows junctions in user directories (`C:\Users\YC`) do NOT require Admin privileges
- Admin is unnecessary for this use case

---

## Solutions

### Solution 1: Remove Admin Requirement â­ RECOMMENDED

Junctions in user directories don't need Admin. Update the scheduled task to run as normal user.

**Quick Fix:**
```powershell
# Stop and uninstall current task
Stop-ScheduledTask -TaskName "AI_HubWatch_AutoMonitor"
.\SetupAutoStart_Final.ps1 -Remove

# Manually edit SetupAutoStart_Final.ps1
# Find line ~156:
#   -RunLevel Highest
# Change to:
#   -RunLevel Limited

# Reinstall without Admin
.\SetupAutoStart_Final.ps1
```

**Detailed Fix:** Edit `SetupAutoStart_Final.ps1` at line 156:

```powershell
# BEFORE (line 156):
$Principal = New-ScheduledTaskPrincipal `
    -UserId $env:USERNAME `
    -LogonType Interactive `
    -RunLevel Highest    # â† REMOVE THIS

# AFTER:
$Principal = New-ScheduledTaskPrincipal `
    -UserId $env:USERNAME `
    -LogonType Interactive `
    -RunLevel Limited    # â† CHANGE TO THIS
```

**Benefits:**
- âœ… Removes Admin elevation
- âœ… Windows will still show processes but not as "Administrator"
- âœ… Popup notifications still work
- âœ… All functionality preserved
- âœ… Simple one-line change

---

### Solution 2: Use VBScript Launcher (Most Invisible)

Create a VBScript that launches PowerShell completely hidden (no Task View visibility).

**Step 1:** Create `LaunchWatchHub.vbs`:
```vbscript
' LaunchWatchHub.vbs - Completely hidden launcher
Set objShell = CreateObject("WScript.Shell")
objShell.Run "powershell.exe -WindowStyle Hidden -ExecutionPolicy Bypass -NoProfile -File ""C:\Users\YC\AI_hub\WatchHub_Wrapper.ps1"" -ScriptPath ""C:\Users\YC\AI_hub\WatchHub_Realtime.ps1""", 0, False
```

**Step 2:** Modify scheduled task to run VBScript:
```powershell
# Uninstall current task
.\SetupAutoStart_Final.ps1 -Remove

# Create new task running VBScript
$Action = New-ScheduledTaskAction `
    -Execute "wscript.exe" `
    -Argument """C:\Users\YC\AI_hub\LaunchWatchHub.vbs"""

$Trigger = New-ScheduledTaskTrigger -AtLogOn -User $env:USERNAME

$Principal = New-ScheduledTaskPrincipal `
    -UserId $env:USERNAME `
    -LogonType S4U

$Settings = New-ScheduledTaskSettingsSet `
    -AllowStartIfOnBatteries `
    -DontStopIfGoingOnBatteries `
    -StartWhenAvailable `
    -ExecutionTimeLimit (New-TimeSpan -Days 0)

Register-ScheduledTask `
    -TaskName "AI_HubWatch_AutoMonitor" `
    -Action $Action `
    -Trigger $Trigger `
    -Principal $Principal `
    -Settings $Settings
```

**Benefits:**
- âœ… Completely invisible (no Task View entries)
- âœ… No Admin required
- âœ… Popup notifications still work
- âš ï¸ Harder to debug (can't see console output)

**Note:** Popups will still appear, but no PowerShell windows in Task View.

---

### Solution 3: Disable Popup Notifications (Silent Mode)

Modify `WatchHub_Wrapper.ps1` to skip popup notifications entirely.

**Edit line ~44 in WatchHub_Wrapper.ps1:**
```powershell
# BEFORE:
Show-Popup -Title "AI HubWatch" -Message $startupMsg -Icon "Information"

# AFTER (comment out):
# Show-Popup -Title "AI HubWatch" -Message $startupMsg -Icon "Information"
Write-Host "WatchHub started in silent mode" -ForegroundColor Green
```

**Benefits:**
- âœ… Fewer UI interruptions
- âœ… Still visible in Task View for monitoring
- âš ï¸ No visual confirmation that monitoring started

---

### Solution 4: Disable Auto-Start Entirely

If you don't need automatic monitoring on every login:

```powershell
# Uninstall auto-start
.\SetupAutoStart_Final.ps1 -Remove

# Run manually when needed
.\WatchHub_Realtime.ps1

# Or via Hub menu
.\Hub.ps1 menu
# Choose option 9: Start WatchHub monitor
```

**Benefits:**
- âœ… Complete control over when monitoring runs
- âœ… No background processes
- âš ï¸ Requires manual start after each reboot

---

## Recommended Approach

**For most users: Solution 1 (Remove Admin)**
1. Simple one-line change
2. Preserves all functionality
3. Reduces security risk (no unnecessary elevation)
4. Windows still shows the processes, but not as "Administrator"

**For maximum invisibility: Solution 2 (VBScript)**
1. Completely hidden from Task View
2. Requires creating new VBScript file
3. Slightly harder to debug issues

**Implementation Steps:**
```powershell
# 1. Stop current monitoring
Stop-ScheduledTask -TaskName "AI_HubWatch_AutoMonitor"

# 2. Uninstall
.\SetupAutoStart_Final.ps1 -Remove

# 3. Edit SetupAutoStart_Final.ps1 (line 156)
#    Change: -RunLevel Highest
#    To:     -RunLevel Limited

# 4. Save and reinstall
.\SetupAutoStart_Final.ps1

# 5. Verify it's running without Admin
Get-ScheduledTask -TaskName "AI_HubWatch_AutoMonitor" | Format-List *
Get-Process powershell | Where-Object {$_.Path -like "*WatchHub*"}
```

---

## Future Improvements

### Configuration File
Create `config.json` to make settings easily editable without modifying scripts:
```json
{
  "hubPath": "C:\\Users\\YC\\AI_hub",
  "obsidianVault": "C:\\Vault\\Apothecary\\20_AI tools",
  "debounceMsec": 2000,
  "mutexTimeout": 30000,
  "maxRetries": 5,
  "retryDelay": 10,
  "showPopups": true,
  "runAsAdmin": false,
  "silentMode": false
}
```

### Truly Hidden Mode
Add parameter to suppress all UI:
```powershell
param(
    [string]$HubPath = "$env:USERPROFILE\AI_hub",
    [switch]$Verbose,
    [switch]$Debug,
    [switch]$TrulyHidden  # Suppress all popups and console output
)
```

### Dynamic Admin Check
Only elevate when necessary:
```powershell
function Test-NeedsAdmin {
    param([string]$Path)
    # Check if path requires admin for junction creation
    # Only elevate if creating junctions outside user profile
    return $Path -notlike "$env:USERPROFILE\*"
}
```

---

**Issue Identified:** 2026-02-02
**Status:** âš ï¸ Workaround Available
**Impact:** Cosmetic (visible windows in Task View)
**Severity:** Low (does not affect functionality)
**Fix Complexity:** Trivial (one-line change)

---

_Note: This is a symlinked document. Changes made here may affect other locations where this file is linked._
