/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var MA=Object.create;var Wo=Object.defineProperty;var DA=Object.getOwnPropertyDescriptor;var OA=Object.getOwnPropertyNames;var UA=Object.getPrototypeOf,FA=Object.prototype.hasOwnProperty;var Lm=n=>{throw TypeError(n)};var LA=(n,e,t)=>e in n?Wo(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var Je=(n,e)=>()=>(n&&(e=n(n=0)),e);var Y=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),mc=(n,e)=>{for(var t in e)Wo(n,t,{get:e[t],enumerable:!0})},qm=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of OA(e))!FA.call(n,i)&&i!==t&&Wo(n,i,{get:()=>e[i],enumerable:!(r=DA(e,i))||r.enumerable});return n};var Le=(n,e,t)=>(t=n!=null?MA(UA(n)):{},qm(e||!n||!n.__esModule?Wo(t,"default",{value:n,enumerable:!0}):t,n)),qA=n=>qm(Wo({},"__esModule",{value:!0}),n);var x=(n,e,t)=>LA(n,typeof e!="symbol"?e+"":e,t),gc=(n,e,t)=>e.has(n)||Lm("Cannot "+t);var D=(n,e,t)=>(gc(n,e,"read from private field"),t?t.call(n):e.get(n)),se=(n,e,t)=>e.has(n)?Lm("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),ce=(n,e,t,r)=>(gc(n,e,"write to private field"),r?r.call(n,t):e.set(n,t),t),oe=(n,e,t)=>(gc(n,e,"access private method"),t);var Di=(n,e,t,r)=>({set _(i){ce(n,e,i,t)},get _(){return D(n,e,r)}});var Hm=Y((zF,yc)=>{"use strict";var HA=Object.prototype.hasOwnProperty,ct="~";function zo(){}Object.create&&(zo.prototype=Object.create(null),new zo().__proto__||(ct=!1));function VA(n,e,t){this.fn=n,this.context=e,this.once=t||!1}function Gm(n,e,t,r,i){if(typeof t!="function")throw new TypeError("The listener must be a function");var o=new VA(t,r||n,i),s=ct?ct+e:e;return n._events[s]?n._events[s].fn?n._events[s]=[n._events[s],o]:n._events[s].push(o):(n._events[s]=o,n._eventsCount++),n}function va(n,e){--n._eventsCount===0?n._events=new zo:delete n._events[e]}function tt(){this._events=new zo,this._eventsCount=0}tt.prototype.eventNames=function(){var e=[],t,r;if(this._eventsCount===0)return e;for(r in t=this._events)HA.call(t,r)&&e.push(ct?r.slice(1):r);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};tt.prototype.listeners=function(e){var t=ct?ct+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,o=r.length,s=new Array(o);i<o;i++)s[i]=r[i].fn;return s};tt.prototype.listenerCount=function(e){var t=ct?ct+e:e,r=this._events[t];return r?r.fn?1:r.length:0};tt.prototype.emit=function(e,t,r,i,o,s){var u=ct?ct+e:e;if(!this._events[u])return!1;var f=this._events[u],d=arguments.length,h,m;if(f.fn){switch(f.once&&this.removeListener(e,f.fn,void 0,!0),d){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,t),!0;case 3:return f.fn.call(f.context,t,r),!0;case 4:return f.fn.call(f.context,t,r,i),!0;case 5:return f.fn.call(f.context,t,r,i,o),!0;case 6:return f.fn.call(f.context,t,r,i,o,s),!0}for(m=1,h=new Array(d-1);m<d;m++)h[m-1]=arguments[m];f.fn.apply(f.context,h)}else{var g=f.length,_;for(m=0;m<g;m++)switch(f[m].once&&this.removeListener(e,f[m].fn,void 0,!0),d){case 1:f[m].fn.call(f[m].context);break;case 2:f[m].fn.call(f[m].context,t);break;case 3:f[m].fn.call(f[m].context,t,r);break;case 4:f[m].fn.call(f[m].context,t,r,i);break;default:if(!h)for(_=1,h=new Array(d-1);_<d;_++)h[_-1]=arguments[_];f[m].fn.apply(f[m].context,h)}}return!0};tt.prototype.on=function(e,t,r){return Gm(this,e,t,r,!1)};tt.prototype.once=function(e,t,r){return Gm(this,e,t,r,!0)};tt.prototype.removeListener=function(e,t,r,i){var o=ct?ct+e:e;if(!this._events[o])return this;if(!t)return va(this,o),this;var s=this._events[o];if(s.fn)s.fn===t&&(!i||s.once)&&(!r||s.context===r)&&va(this,o);else{for(var u=0,f=[],d=s.length;u<d;u++)(s[u].fn!==t||i&&!s[u].once||r&&s[u].context!==r)&&f.push(s[u]);f.length?this._events[o]=f.length===1?f[0]:f:va(this,o)}return this};tt.prototype.removeAllListeners=function(e){var t;return e?(t=ct?ct+e:e,this._events[t]&&va(this,t)):(this._events=new zo,this._eventsCount=0),this};tt.prototype.off=tt.prototype.removeListener;tt.prototype.addListener=tt.prototype.on;tt.prefixed=ct;tt.EventEmitter=tt;typeof yc!="undefined"&&(yc.exports=tt)});var Ic=Y((Ra,jm)=>{(function(n,e){typeof Ra=="object"&&typeof jm!="undefined"?e(Ra):typeof define=="function"&&define.amd?define(["exports"],e):e(n.WHATWGFetch={})})(Ra,(function(n){"use strict";var e=typeof globalThis!="undefined"&&globalThis||typeof self!="undefined"&&self||typeof global!="undefined"&&global||{},t={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&(function(){try{return new Blob,!0}catch(T){return!1}})(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};function r(T){return T&&DataView.prototype.isPrototypeOf(T)}if(t.arrayBuffer)var i=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],o=ArrayBuffer.isView||function(T){return T&&i.indexOf(Object.prototype.toString.call(T))>-1};function s(T){if(typeof T!="string"&&(T=String(T)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(T)||T==="")throw new TypeError('Invalid character in header field name: "'+T+'"');return T.toLowerCase()}function u(T){return typeof T!="string"&&(T=String(T)),T}function f(T){var L={next:function(){var X=T.shift();return{done:X===void 0,value:X}}};return t.iterable&&(L[Symbol.iterator]=function(){return L}),L}function d(T){this.map={},T instanceof d?T.forEach(function(L,X){this.append(X,L)},this):Array.isArray(T)?T.forEach(function(L){if(L.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+L.length);this.append(L[0],L[1])},this):T&&Object.getOwnPropertyNames(T).forEach(function(L){this.append(L,T[L])},this)}d.prototype.append=function(T,L){T=s(T),L=u(L);var X=this.map[T];this.map[T]=X?X+", "+L:L},d.prototype.delete=function(T){delete this.map[s(T)]},d.prototype.get=function(T){return T=s(T),this.has(T)?this.map[T]:null},d.prototype.has=function(T){return this.map.hasOwnProperty(s(T))},d.prototype.set=function(T,L){this.map[s(T)]=u(L)},d.prototype.forEach=function(T,L){for(var X in this.map)this.map.hasOwnProperty(X)&&T.call(L,this.map[X],X,this)},d.prototype.keys=function(){var T=[];return this.forEach(function(L,X){T.push(X)}),f(T)},d.prototype.values=function(){var T=[];return this.forEach(function(L){T.push(L)}),f(T)},d.prototype.entries=function(){var T=[];return this.forEach(function(L,X){T.push([X,L])}),f(T)},t.iterable&&(d.prototype[Symbol.iterator]=d.prototype.entries);function h(T){if(!T._noBody){if(T.bodyUsed)return Promise.reject(new TypeError("Already read"));T.bodyUsed=!0}}function m(T){return new Promise(function(L,X){T.onload=function(){L(T.result)},T.onerror=function(){X(T.error)}})}function g(T){var L=new FileReader,X=m(L);return L.readAsArrayBuffer(T),X}function _(T){var L=new FileReader,X=m(L),ee=/charset=([A-Za-z0-9_-]+)/.exec(T.type),Z=ee?ee[1]:"utf-8";return L.readAsText(T,Z),X}function v(T){for(var L=new Uint8Array(T),X=new Array(L.length),ee=0;ee<L.length;ee++)X[ee]=String.fromCharCode(L[ee]);return X.join("")}function C(T){if(T.slice)return T.slice(0);var L=new Uint8Array(T.byteLength);return L.set(new Uint8Array(T)),L.buffer}function R(){return this.bodyUsed=!1,this._initBody=function(T){this.bodyUsed=this.bodyUsed,this._bodyInit=T,T?typeof T=="string"?this._bodyText=T:t.blob&&Blob.prototype.isPrototypeOf(T)?this._bodyBlob=T:t.formData&&FormData.prototype.isPrototypeOf(T)?this._bodyFormData=T:t.searchParams&&URLSearchParams.prototype.isPrototypeOf(T)?this._bodyText=T.toString():t.arrayBuffer&&t.blob&&r(T)?(this._bodyArrayBuffer=C(T.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):t.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(T)||o(T))?this._bodyArrayBuffer=C(T):this._bodyText=T=Object.prototype.toString.call(T):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof T=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):t.searchParams&&URLSearchParams.prototype.isPrototypeOf(T)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},t.blob&&(this.blob=function(){var T=h(this);if(T)return T;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var T=h(this);return T||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(t.blob)return this.blob().then(g);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var T=h(this);if(T)return T;if(this._bodyBlob)return _(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(v(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},t.formData&&(this.formData=function(){return this.text().then(W)}),this.json=function(){return this.text().then(JSON.parse)},this}var I=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function z(T){var L=T.toUpperCase();return I.indexOf(L)>-1?L:T}function $(T,L){if(!(this instanceof $))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');L=L||{};var X=L.body;if(T instanceof $){if(T.bodyUsed)throw new TypeError("Already read");this.url=T.url,this.credentials=T.credentials,L.headers||(this.headers=new d(T.headers)),this.method=T.method,this.mode=T.mode,this.signal=T.signal,!X&&T._bodyInit!=null&&(X=T._bodyInit,T.bodyUsed=!0)}else this.url=String(T);if(this.credentials=L.credentials||this.credentials||"same-origin",(L.headers||!this.headers)&&(this.headers=new d(L.headers)),this.method=z(L.method||this.method||"GET"),this.mode=L.mode||this.mode||null,this.signal=L.signal||this.signal||(function(){if("AbortController"in e){var j=new AbortController;return j.signal}})(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&X)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(X),(this.method==="GET"||this.method==="HEAD")&&(L.cache==="no-store"||L.cache==="no-cache")){var ee=/([?&])_=[^&]*/;if(ee.test(this.url))this.url=this.url.replace(ee,"$1_="+new Date().getTime());else{var Z=/\?/;this.url+=(Z.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}$.prototype.clone=function(){return new $(this,{body:this._bodyInit})};function W(T){var L=new FormData;return T.trim().split("&").forEach(function(X){if(X){var ee=X.split("="),Z=ee.shift().replace(/\+/g," "),j=ee.join("=").replace(/\+/g," ");L.append(decodeURIComponent(Z),decodeURIComponent(j))}}),L}function H(T){var L=new d,X=T.replace(/\r?\n[\t ]+/g," ");return X.split("\r").map(function(ee){return ee.indexOf(`
`)===0?ee.substr(1,ee.length):ee}).forEach(function(ee){var Z=ee.split(":"),j=Z.shift().trim();if(j){var we=Z.join(":").trim();try{L.append(j,we)}catch(_e){console.warn("Response "+_e.message)}}}),L}R.call($.prototype);function G(T,L){if(!(this instanceof G))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(L||(L={}),this.type="default",this.status=L.status===void 0?200:L.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=L.statusText===void 0?"":""+L.statusText,this.headers=new d(L.headers),this.url=L.url||"",this._initBody(T)}R.call(G.prototype),G.prototype.clone=function(){return new G(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new d(this.headers),url:this.url})},G.error=function(){var T=new G(null,{status:200,statusText:""});return T.ok=!1,T.status=0,T.type="error",T};var K=[301,302,303,307,308];G.redirect=function(T,L){if(K.indexOf(L)===-1)throw new RangeError("Invalid status code");return new G(null,{status:L,headers:{location:T}})},n.DOMException=e.DOMException;try{new n.DOMException}catch(T){n.DOMException=function(L,X){this.message=L,this.name=X;var ee=Error(L);this.stack=ee.stack},n.DOMException.prototype=Object.create(Error.prototype),n.DOMException.prototype.constructor=n.DOMException}function te(T,L){return new Promise(function(X,ee){var Z=new $(T,L);if(Z.signal&&Z.signal.aborted)return ee(new n.DOMException("Aborted","AbortError"));var j=new XMLHttpRequest;function we(){j.abort()}j.onload=function(){var Ae={statusText:j.statusText,headers:H(j.getAllResponseHeaders()||"")};Z.url.indexOf("file://")===0&&(j.status<200||j.status>599)?Ae.status=200:Ae.status=j.status,Ae.url="responseURL"in j?j.responseURL:Ae.headers.get("X-Request-URL");var Fe="response"in j?j.response:j.responseText;setTimeout(function(){X(new G(Fe,Ae))},0)},j.onerror=function(){setTimeout(function(){ee(new TypeError("Network request failed"))},0)},j.ontimeout=function(){setTimeout(function(){ee(new TypeError("Network request timed out"))},0)},j.onabort=function(){setTimeout(function(){ee(new n.DOMException("Aborted","AbortError"))},0)};function _e(Ae){try{return Ae===""&&e.location.href?e.location.href:Ae}catch(Fe){return Ae}}if(j.open(Z.method,_e(Z.url),!0),Z.credentials==="include"?j.withCredentials=!0:Z.credentials==="omit"&&(j.withCredentials=!1),"responseType"in j&&(t.blob?j.responseType="blob":t.arrayBuffer&&(j.responseType="arraybuffer")),L&&typeof L.headers=="object"&&!(L.headers instanceof d||e.Headers&&L.headers instanceof e.Headers)){var Re=[];Object.getOwnPropertyNames(L.headers).forEach(function(Ae){Re.push(s(Ae)),j.setRequestHeader(Ae,u(L.headers[Ae]))}),Z.headers.forEach(function(Ae,Fe){Re.indexOf(Fe)===-1&&j.setRequestHeader(Fe,Ae)})}else Z.headers.forEach(function(Ae,Fe){j.setRequestHeader(Fe,Ae)});Z.signal&&(Z.signal.addEventListener("abort",we),j.onreadystatechange=function(){j.readyState===4&&Z.signal.removeEventListener("abort",we)}),j.send(typeof Z._bodyInit=="undefined"?null:Z._bodyInit)})}te.polyfill=!0,e.fetch||(e.fetch=te,e.Headers=d,e.Request=$,e.Response=G),n.Headers=d,n.Request=$,n.Response=G,n.fetch=te,Object.defineProperty(n,"__esModule",{value:!0})}))});var qc=Y((AL,fg)=>{"use strict";var Na=Object.prototype.hasOwnProperty,cg=Object.prototype.toString,ig=Object.defineProperty,og=Object.getOwnPropertyDescriptor,sg=function(e){return typeof Array.isArray=="function"?Array.isArray(e):cg.call(e)==="[object Array]"},ag=function(e){if(!e||cg.call(e)!=="[object Object]")return!1;var t=Na.call(e,"constructor"),r=e.constructor&&e.constructor.prototype&&Na.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!t&&!r)return!1;var i;for(i in e);return typeof i=="undefined"||Na.call(e,i)},lg=function(e,t){ig&&t.name==="__proto__"?ig(e,t.name,{enumerable:!0,configurable:!0,value:t.newValue,writable:!0}):e[t.name]=t.newValue},ug=function(e,t){if(t==="__proto__")if(Na.call(e,t)){if(og)return og(e,t).value}else return;return e[t]};fg.exports=function n(){var e,t,r,i,o,s,u=arguments[0],f=1,d=arguments.length,h=!1;for(typeof u=="boolean"&&(h=u,u=arguments[1]||{},f=2),(u==null||typeof u!="object"&&typeof u!="function")&&(u={});f<d;++f)if(e=arguments[f],e!=null)for(t in e)r=ug(u,t),i=ug(e,t),u!==i&&(h&&i&&(ag(i)||(o=sg(i)))?(o?(o=!1,s=r&&sg(r)?r:[]):s=r&&ag(r)?r:{},lg(u,{name:t,newValue:n(h,s,i)})):typeof i!="undefined"&&lg(u,{name:t,newValue:i}));return u}});var dg=Y((bL,t0)=>{t0.exports={name:"gaxios",version:"7.1.3",description:"A simple common HTTP client specifically for Google APIs and services.",main:"build/cjs/src/index.js",types:"build/cjs/src/index.d.ts",files:["build/"],exports:{".":{import:{types:"./build/esm/src/index.d.ts",default:"./build/esm/src/index.js"},require:{types:"./build/cjs/src/index.d.ts",default:"./build/cjs/src/index.js"}}},scripts:{lint:"gts check --no-inline-config",test:"c8 mocha build/esm/test","presystem-test":"npm run compile","system-test":"mocha build/esm/system-test --timeout 80000",compile:"tsc -b ./tsconfig.json ./tsconfig.cjs.json && node utils/enable-esm.mjs",fix:"gts fix",prepare:"npm run compile",pretest:"npm run compile",webpack:"webpack","prebrowser-test":"npm run compile","browser-test":"node build/browser-test/browser-test-runner.js",docs:"jsdoc -c .jsdoc.js","docs-test":"linkinator docs","predocs-test":"npm run docs","samples-test":"cd samples/ && npm link ../ && npm test && cd ../",prelint:"cd samples; npm link ../; npm install",clean:"gts clean"},repository:{type:"git",directory:"packages/gaxios",url:"https://github.com/googleapis/google-cloud-node-core.git"},keywords:["google"],engines:{node:">=18"},author:"Google, LLC",license:"Apache-2.0",devDependencies:{"@babel/plugin-proposal-private-methods":"^7.18.6","@types/cors":"^2.8.6","@types/express":"^5.0.0","@types/extend":"^3.0.1","@types/mocha":"^10.0.10","@types/multiparty":"4.2.1","@types/mv":"^2.1.0","@types/ncp":"^2.0.1","@types/node":"^22.0.0","@types/sinon":"^17.0.0","@types/tmp":"0.2.6",assert:"^2.0.0",browserify:"^17.0.0",c8:"^10.0.0",cors:"^2.8.5",express:"^5.0.0",gts:"^6.0.0","is-docker":"^3.0.0",jsdoc:"^4.0.0","jsdoc-fresh":"^5.0.0","jsdoc-region-tag":"^4.0.0",karma:"^6.0.0","karma-chrome-launcher":"^3.0.0","karma-coverage":"^2.0.0","karma-firefox-launcher":"^2.0.0","karma-mocha":"^2.0.0","karma-remap-coverage":"^0.1.5","karma-sourcemap-loader":"^0.4.0","karma-webpack":"^5.0.1",linkinator:"^6.1.2",mocha:"^11.1.0",multiparty:"^4.2.1",mv:"^2.1.1",ncp:"^2.0.0",nock:"^14.0.0-beta.13","null-loader":"^4.0.0","pack-n-play":"^4.0.0",puppeteer:"^24.0.0",sinon:"^21.0.0","stream-browserify":"^3.0.0",tmp:"0.2.5","ts-loader":"^9.5.2",typescript:"^5.8.3",webpack:"^5.35.0","webpack-cli":"^6.0.1"},dependencies:{extend:"^3.0.2","https-proxy-agent":"^7.0.1","node-fetch":"^3.3.2",rimraf:"^5.0.1"},homepage:"https://github.com/googleapis/google-cloud-node-core/tree/main/packages/gaxios"}});var pg=Y((RL,hg)=>{"use strict";var n0=dg();hg.exports={pkg:n0}});var Hc=Y(Vt=>{"use strict";var yg=Vt&&Vt.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Vt,"__esModule",{value:!0});Vt.GaxiosError=Vt.GAXIOS_ERROR_SYMBOL=void 0;Vt.defaultErrorRedactor=_g;var mg=yg(qc()),r0=yg(pg()),Bc=r0.default.pkg;Vt.GAXIOS_ERROR_SYMBOL=Symbol.for(`${Bc.name}-gaxios-error`);var gg,Gc=class n extends Error{constructor(t,r,i,o){var s,u;super(t,{cause:o});x(this,"config");x(this,"response");x(this,"code");x(this,"status");x(this,"error");x(this,gg,Bc.version);if(this.config=r,this.response=i,this.error=o instanceof Error?o:void 0,this.config=(0,mg.default)(!0,{},r),this.response&&(this.response.config=(0,mg.default)(!0,{},this.response.config)),this.response){try{this.response.data=i0(this.config.responseType,(s=this.response)!=null&&s.bodyUsed?(u=this.response)==null?void 0:u.data:void 0)}catch(f){}this.status=this.response.status}o instanceof DOMException?this.code=o.name:o&&typeof o=="object"&&"code"in o&&(typeof o.code=="string"||typeof o.code=="number")&&(this.code=o.code)}static[(gg=Vt.GAXIOS_ERROR_SYMBOL,Symbol.hasInstance)](t){return t&&typeof t=="object"&&Vt.GAXIOS_ERROR_SYMBOL in t&&t[Vt.GAXIOS_ERROR_SYMBOL]===Bc.version?!0:Function.prototype[Symbol.hasInstance].call(n,t)}static extractAPIErrorFromResponse(t,r="The request failed"){let i=r;if(typeof t.data=="string"&&(i=t.data),t.data&&typeof t.data=="object"&&"error"in t.data&&t.data.error&&!t.ok){if(typeof t.data.error=="string")return{message:t.data.error,code:t.status,status:t.statusText};if(typeof t.data.error=="object"){i="message"in t.data.error&&typeof t.data.error.message=="string"?t.data.error.message:i;let o="status"in t.data.error&&typeof t.data.error.status=="string"?t.data.error.status:t.statusText,s="code"in t.data.error&&typeof t.data.error.code=="number"?t.data.error.code:t.status;if("errors"in t.data.error&&Array.isArray(t.data.error.errors)){let u=[];for(let f of t.data.error.errors)typeof f=="object"&&"message"in f&&typeof f.message=="string"&&u.push(f.message);return Object.assign({message:u.join(`
`)||i,code:s,status:o},t.data.error)}return Object.assign({message:i,code:s,status:o},t.data.error)}}return{message:i,code:t.status,status:t.statusText}}};Vt.GaxiosError=Gc;function i0(n,e){switch(n){case"stream":return e;case"json":return JSON.parse(JSON.stringify(e));case"arraybuffer":return JSON.parse(Buffer.from(e).toString("utf8"));case"blob":return JSON.parse(e.text());default:return e}}function _g(n){let e="<<REDACTED> - See `errorRedactor` option in `gaxios` for configuration>.";function t(o){o&&o.forEach((s,u)=>{(/^authentication$/i.test(u)||/^authorization$/i.test(u)||/secret/i.test(u))&&o.set(u,e)})}function r(o,s){if(typeof o=="object"&&o!==null&&typeof o[s]=="string"){let u=o[s];(/grant_type=/i.test(u)||/assertion=/i.test(u)||/secret/i.test(u))&&(o[s]=e)}}function i(o){!o||typeof o!="object"||(o instanceof FormData||o instanceof URLSearchParams||"forEach"in o&&"set"in o?o.forEach((s,u)=>{(["grant_type","assertion"].includes(u)||/secret/.test(u))&&o.set(u,e)}):("grant_type"in o&&(o.grant_type=e),"assertion"in o&&(o.assertion=e),"client_secret"in o&&(o.client_secret=e)))}return n.config&&(t(n.config.headers),r(n.config,"data"),i(n.config.data),r(n.config,"body"),i(n.config.body),n.config.url.searchParams.has("token")&&n.config.url.searchParams.set("token",e),n.config.url.searchParams.has("client_secret")&&n.config.url.searchParams.set("client_secret",e)),n.response&&(_g({config:n.response.config}),t(n.response.headers),n.response.bodyUsed&&(r(n.response,"data"),i(n.response.data))),n}});var Sg=Y(Vc=>{"use strict";Object.defineProperty(Vc,"__esModule",{value:!0});Vc.getRetryConfig=o0;async function o0(n){let e=Eg(n);if(!n||!n.config||!e&&!n.config.retry)return{shouldRetry:!1};e=e||{},e.currentRetryAttempt=e.currentRetryAttempt||0,e.retry=e.retry===void 0||e.retry===null?3:e.retry,e.httpMethodsToRetry=e.httpMethodsToRetry||["GET","HEAD","PUT","OPTIONS","DELETE"],e.noResponseRetries=e.noResponseRetries===void 0||e.noResponseRetries===null?2:e.noResponseRetries,e.retryDelayMultiplier=e.retryDelayMultiplier?e.retryDelayMultiplier:2,e.timeOfFirstRequest=e.timeOfFirstRequest?e.timeOfFirstRequest:Date.now(),e.totalTimeout=e.totalTimeout?e.totalTimeout:Number.MAX_SAFE_INTEGER,e.maxRetryDelay=e.maxRetryDelay?e.maxRetryDelay:Number.MAX_SAFE_INTEGER;let t=[[100,199],[408,408],[429,429],[500,599]];if(e.statusCodesToRetry=e.statusCodesToRetry||t,n.config.retryConfig=e,!await(e.shouldRetry||s0)(n))return{shouldRetry:!1,config:n.config};let i=a0(e);n.config.retryConfig.currentRetryAttempt+=1;let o=e.retryBackoff?e.retryBackoff(n,i):new Promise(s=>{setTimeout(s,i)});return e.onRetryAttempt&&await e.onRetryAttempt(n),await o,{shouldRetry:!0,config:n.config}}function s0(n){var t,r;let e=Eg(n);if((t=n.config.signal)!=null&&t.aborted&&n.code!=="TimeoutError"||n.code==="AbortError"||!e||e.retry===0||!n.response&&(e.currentRetryAttempt||0)>=e.noResponseRetries||!e.httpMethodsToRetry||!e.httpMethodsToRetry.includes(((r=n.config.method)==null?void 0:r.toUpperCase())||"GET"))return!1;if(n.response&&n.response.status){let i=!1;for(let[o,s]of e.statusCodesToRetry){let u=n.response.status;if(u>=o&&u<=s){i=!0;break}}if(!i)return!1}return e.currentRetryAttempt=e.currentRetryAttempt||0,!(e.currentRetryAttempt>=e.retry)}function Eg(n){if(n&&n.config&&n.config.retryConfig)return n.config.retryConfig}function a0(n){var i;let t=(n.currentRetryAttempt?0:(i=n.retryDelay)!=null?i:100)+(Math.pow(n.retryDelayMultiplier,n.currentRetryAttempt)-1)/2*1e3,r=n.totalTimeout-(Date.now()-n.timeOfFirstRequest);return Math.min(t,r,n.maxRetryDelay)}});var Wc=Y(ka=>{"use strict";Object.defineProperty(ka,"__esModule",{value:!0});ka.GaxiosInterceptorManager=void 0;var $c=class extends Set{};ka.GaxiosInterceptorManager=$c});var vg=Y((kL,Tg)=>{var Hi=1e3,Vi=Hi*60,$i=Vi*60,Wr=$i*24,l0=Wr*7,u0=Wr*365.25;Tg.exports=function(n,e){e=e||{};var t=typeof n;if(t==="string"&&n.length>0)return c0(n);if(t==="number"&&isFinite(n))return e.long?d0(n):f0(n);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(n))};function c0(n){if(n=String(n),!(n.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(n);if(e){var t=parseFloat(e[1]),r=(e[2]||"ms").toLowerCase();switch(r){case"years":case"year":case"yrs":case"yr":case"y":return t*u0;case"weeks":case"week":case"w":return t*l0;case"days":case"day":case"d":return t*Wr;case"hours":case"hour":case"hrs":case"hr":case"h":return t*$i;case"minutes":case"minute":case"mins":case"min":case"m":return t*Vi;case"seconds":case"second":case"secs":case"sec":case"s":return t*Hi;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function f0(n){var e=Math.abs(n);return e>=Wr?Math.round(n/Wr)+"d":e>=$i?Math.round(n/$i)+"h":e>=Vi?Math.round(n/Vi)+"m":e>=Hi?Math.round(n/Hi)+"s":n+"ms"}function d0(n){var e=Math.abs(n);return e>=Wr?Ma(n,e,Wr,"day"):e>=$i?Ma(n,e,$i,"hour"):e>=Vi?Ma(n,e,Vi,"minute"):e>=Hi?Ma(n,e,Hi,"second"):n+" ms"}function Ma(n,e,t,r){var i=e>=t*1.5;return Math.round(n/t)+" "+r+(i?"s":"")}});var zc=Y((ML,wg)=>{function h0(n){t.debug=t,t.default=t,t.coerce=f,t.disable=s,t.enable=i,t.enabled=u,t.humanize=vg(),t.destroy=d,Object.keys(n).forEach(h=>{t[h]=n[h]}),t.names=[],t.skips=[],t.formatters={};function e(h){let m=0;for(let g=0;g<h.length;g++)m=(m<<5)-m+h.charCodeAt(g),m|=0;return t.colors[Math.abs(m)%t.colors.length]}t.selectColor=e;function t(h){let m,g=null,_,v;function C(...R){if(!C.enabled)return;let I=C,z=Number(new Date),$=z-(m||z);I.diff=$,I.prev=m,I.curr=z,m=z,R[0]=t.coerce(R[0]),typeof R[0]!="string"&&R.unshift("%O");let W=0;R[0]=R[0].replace(/%([a-zA-Z%])/g,(G,K)=>{if(G==="%%")return"%";W++;let te=t.formatters[K];if(typeof te=="function"){let T=R[W];G=te.call(I,T),R.splice(W,1),W--}return G}),t.formatArgs.call(I,R),(I.log||t.log).apply(I,R)}return C.namespace=h,C.useColors=t.useColors(),C.color=t.selectColor(h),C.extend=r,C.destroy=t.destroy,Object.defineProperty(C,"enabled",{enumerable:!0,configurable:!1,get:()=>g!==null?g:(_!==t.namespaces&&(_=t.namespaces,v=t.enabled(h)),v),set:R=>{g=R}}),typeof t.init=="function"&&t.init(C),C}function r(h,m){let g=t(this.namespace+(typeof m=="undefined"?":":m)+h);return g.log=this.log,g}function i(h){t.save(h),t.namespaces=h,t.names=[],t.skips=[];let m=(typeof h=="string"?h:"").trim().replace(" ",",").split(",").filter(Boolean);for(let g of m)g[0]==="-"?t.skips.push(g.slice(1)):t.names.push(g)}function o(h,m){let g=0,_=0,v=-1,C=0;for(;g<h.length;)if(_<m.length&&(m[_]===h[g]||m[_]==="*"))m[_]==="*"?(v=_,C=g,_++):(g++,_++);else if(v!==-1)_=v+1,C++,g=C;else return!1;for(;_<m.length&&m[_]==="*";)_++;return _===m.length}function s(){let h=[...t.names,...t.skips.map(m=>"-"+m)].join(",");return t.enable(""),h}function u(h){for(let m of t.skips)if(o(h,m))return!1;for(let m of t.names)if(o(h,m))return!0;return!1}function f(h){return h instanceof Error?h.stack||h.message:h}function d(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}wg.exports=h0});var Cg=Y((At,Da)=>{At.formatArgs=m0;At.save=g0;At.load=y0;At.useColors=p0;At.storage=_0();At.destroy=(()=>{let n=!1;return()=>{n||(n=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();At.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function p0(){if(typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let n;return typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&(n=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(n[1],10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function m0(n){if(n[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+n[0]+(this.useColors?"%c ":" ")+"+"+Da.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;n.splice(1,0,e,"color: inherit");let t=0,r=0;n[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(t++,i==="%c"&&(r=t))}),n.splice(r,0,e)}At.log=console.debug||console.log||(()=>{});function g0(n){try{n?At.storage.setItem("debug",n):At.storage.removeItem("debug")}catch(e){}}function y0(){let n;try{n=At.storage.getItem("debug")}catch(e){}return!n&&typeof process!="undefined"&&"env"in process&&(n=process.env.DEBUG),n}function _0(){try{return localStorage}catch(n){}}Da.exports=zc()(At);var{formatters:E0}=Da.exports;E0.j=function(n){try{return JSON.stringify(n)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var bg=Y((DL,Ag)=>{"use strict";Ag.exports=(n,e=process.argv)=>{let t=n.startsWith("-")?"":n.length===1?"-":"--",r=e.indexOf(t+n),i=e.indexOf("--");return r!==-1&&(i===-1||r<i)}});var Pg=Y((OL,Ig)=>{"use strict";var S0=require("os"),Rg=require("tty"),$t=bg(),{env:Ke}=process,Er;$t("no-color")||$t("no-colors")||$t("color=false")||$t("color=never")?Er=0:($t("color")||$t("colors")||$t("color=true")||$t("color=always"))&&(Er=1);"FORCE_COLOR"in Ke&&(Ke.FORCE_COLOR==="true"?Er=1:Ke.FORCE_COLOR==="false"?Er=0:Er=Ke.FORCE_COLOR.length===0?1:Math.min(parseInt(Ke.FORCE_COLOR,10),3));function Jc(n){return n===0?!1:{level:n,hasBasic:!0,has256:n>=2,has16m:n>=3}}function Kc(n,e){if(Er===0)return 0;if($t("color=16m")||$t("color=full")||$t("color=truecolor"))return 3;if($t("color=256"))return 2;if(n&&!e&&Er===void 0)return 0;let t=Er||0;if(Ke.TERM==="dumb")return t;if(process.platform==="win32"){let r=S0.release().split(".");return Number(r[0])>=10&&Number(r[2])>=10586?Number(r[2])>=14931?3:2:1}if("CI"in Ke)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI","GITHUB_ACTIONS","BUILDKITE"].some(r=>r in Ke)||Ke.CI_NAME==="codeship"?1:t;if("TEAMCITY_VERSION"in Ke)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(Ke.TEAMCITY_VERSION)?1:0;if(Ke.COLORTERM==="truecolor")return 3;if("TERM_PROGRAM"in Ke){let r=parseInt((Ke.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(Ke.TERM_PROGRAM){case"iTerm.app":return r>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(Ke.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(Ke.TERM)||"COLORTERM"in Ke?1:t}function T0(n){let e=Kc(n,n&&n.isTTY);return Jc(e)}Ig.exports={supportsColor:T0,stdout:Jc(Kc(!0,Rg.isatty(1))),stderr:Jc(Kc(!0,Rg.isatty(2)))}});var Ng=Y((Ye,Ua)=>{var v0=require("tty"),Oa=require("util");Ye.init=P0;Ye.log=b0;Ye.formatArgs=C0;Ye.save=R0;Ye.load=I0;Ye.useColors=w0;Ye.destroy=Oa.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");Ye.colors=[6,2,3,4,5,1];try{let n=Pg();n&&(n.stderr||n).level>=2&&(Ye.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch(n){}Ye.inspectOpts=Object.keys(process.env).filter(n=>/^debug_/i.test(n)).reduce((n,e)=>{let t=e.substring(6).toLowerCase().replace(/_([a-z])/g,(i,o)=>o.toUpperCase()),r=process.env[e];return/^(yes|on|true|enabled)$/i.test(r)?r=!0:/^(no|off|false|disabled)$/i.test(r)?r=!1:r==="null"?r=null:r=Number(r),n[t]=r,n},{});function w0(){return"colors"in Ye.inspectOpts?!!Ye.inspectOpts.colors:v0.isatty(process.stderr.fd)}function C0(n){let{namespace:e,useColors:t}=this;if(t){let r=this.color,i="\x1B[3"+(r<8?r:"8;5;"+r),o=`  ${i};1m${e} \x1B[0m`;n[0]=o+n[0].split(`
`).join(`
`+o),n.push(i+"m+"+Ua.exports.humanize(this.diff)+"\x1B[0m")}else n[0]=A0()+e+" "+n[0]}function A0(){return Ye.inspectOpts.hideDate?"":new Date().toISOString()+" "}function b0(...n){return process.stderr.write(Oa.formatWithOptions(Ye.inspectOpts,...n)+`
`)}function R0(n){n?process.env.DEBUG=n:delete process.env.DEBUG}function I0(){return process.env.DEBUG}function P0(n){n.inspectOpts={};let e=Object.keys(Ye.inspectOpts);for(let t=0;t<e.length;t++)n.inspectOpts[e[t]]=Ye.inspectOpts[e[t]]}Ua.exports=zc()(Ye);var{formatters:xg}=Ua.exports;xg.o=function(n){return this.inspectOpts.colors=this.useColors,Oa.inspect(n,this.inspectOpts).split(`
`).map(e=>e.trim()).join(" ")};xg.O=function(n){return this.inspectOpts.colors=this.useColors,Oa.inspect(n,this.inspectOpts)}});var Xc=Y((UL,Yc)=>{typeof process=="undefined"||process.type==="renderer"||process.browser===!0||process.__nwjs?Yc.exports=Cg():Yc.exports=Ng()});var Dg=Y(St=>{"use strict";var x0=St&&St.__createBinding||(Object.create?(function(n,e,t,r){r===void 0&&(r=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,i)}):(function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]})),N0=St&&St.__setModuleDefault||(Object.create?(function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}):function(n,e){n.default=e}),kg=St&&St.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&x0(e,n,t);return N0(e,n),e};Object.defineProperty(St,"__esModule",{value:!0});St.req=St.json=St.toBuffer=void 0;var k0=kg(require("http")),M0=kg(require("https"));async function Mg(n){let e=0,t=[];for await(let r of n)e+=r.length,t.push(r);return Buffer.concat(t,e)}St.toBuffer=Mg;async function D0(n){let t=(await Mg(n)).toString("utf8");try{return JSON.parse(t)}catch(r){let i=r;throw i.message+=` (input: ${t})`,i}}St.json=D0;function O0(n,e={}){let r=((typeof n=="string"?n:n.href).startsWith("https:")?M0:k0).request(n,e),i=new Promise((o,s)=>{r.once("response",o).once("error",s).end()});return r.then=i.then.bind(i),r}St.req=O0});var Lg=Y(bt=>{"use strict";var Ug=bt&&bt.__createBinding||(Object.create?(function(n,e,t,r){r===void 0&&(r=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,i)}):(function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]})),U0=bt&&bt.__setModuleDefault||(Object.create?(function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}):function(n,e){n.default=e}),Fg=bt&&bt.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&Ug(e,n,t);return U0(e,n),e},F0=bt&&bt.__exportStar||function(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&Ug(e,n,t)};Object.defineProperty(bt,"__esModule",{value:!0});bt.Agent=void 0;var L0=Fg(require("net")),Og=Fg(require("http")),q0=require("https");F0(Dg(),bt);var An=Symbol("AgentBaseInternalState"),Qc=class extends Og.Agent{constructor(e){super(e),this[An]={}}isSecureEndpoint(e){if(e){if(typeof e.secureEndpoint=="boolean")return e.secureEndpoint;if(typeof e.protocol=="string")return e.protocol==="https:"}let{stack:t}=new Error;return typeof t!="string"?!1:t.split(`
`).some(r=>r.indexOf("(https.js:")!==-1||r.indexOf("node:https:")!==-1)}incrementSockets(e){if(this.maxSockets===1/0&&this.maxTotalSockets===1/0)return null;this.sockets[e]||(this.sockets[e]=[]);let t=new L0.Socket({writable:!1});return this.sockets[e].push(t),this.totalSocketCount++,t}decrementSockets(e,t){if(!this.sockets[e]||t===null)return;let r=this.sockets[e],i=r.indexOf(t);i!==-1&&(r.splice(i,1),this.totalSocketCount--,r.length===0&&delete this.sockets[e])}getName(e){return this.isSecureEndpoint(e)?q0.Agent.prototype.getName.call(this,e):super.getName(e)}createSocket(e,t,r){let i={...t,secureEndpoint:this.isSecureEndpoint(t)},o=this.getName(i),s=this.incrementSockets(o);Promise.resolve().then(()=>this.connect(e,i)).then(u=>{if(this.decrementSockets(o,s),u instanceof Og.Agent)try{return u.addRequest(e,i)}catch(f){return r(f)}this[An].currentSocket=u,super.createSocket(e,t,r)},u=>{this.decrementSockets(o,s),r(u)})}createConnection(){let e=this[An].currentSocket;if(this[An].currentSocket=void 0,!e)throw new Error("No socket was returned in the `connect()` function");return e}get defaultPort(){var e;return(e=this[An].defaultPort)!=null?e:this.protocol==="https:"?443:80}set defaultPort(e){this[An]&&(this[An].defaultPort=e)}get protocol(){var e;return(e=this[An].protocol)!=null?e:this.isSecureEndpoint()?"https:":"http:"}set protocol(e){this[An]&&(this[An].protocol=e)}};bt.Agent=Qc});var qg=Y(Wi=>{"use strict";var B0=Wi&&Wi.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Wi,"__esModule",{value:!0});Wi.parseProxyResponse=void 0;var G0=B0(Xc()),Fa=(0,G0.default)("https-proxy-agent:parse-proxy-response");function H0(n){return new Promise((e,t)=>{let r=0,i=[];function o(){let h=n.read();h?d(h):n.once("readable",o)}function s(){n.removeListener("end",u),n.removeListener("error",f),n.removeListener("readable",o)}function u(){s(),Fa("onend"),t(new Error("Proxy connection ended before receiving CONNECT response"))}function f(h){s(),Fa("onerror %o",h),t(h)}function d(h){i.push(h),r+=h.length;let m=Buffer.concat(i,r),g=m.indexOf(`\r
\r
`);if(g===-1){Fa("have not received end of HTTP headers yet..."),o();return}let _=m.slice(0,g).toString("ascii").split(`\r
`),v=_.shift();if(!v)return n.destroy(),t(new Error("No header received from proxy CONNECT response"));let C=v.split(" "),R=+C[1],I=C.slice(2).join(" "),z={};for(let $ of _){if(!$)continue;let W=$.indexOf(":");if(W===-1)return n.destroy(),t(new Error(`Invalid header from proxy CONNECT response: "${$}"`));let H=$.slice(0,W).toLowerCase(),G=$.slice(W+1).trimStart(),K=z[H];typeof K=="string"?z[H]=[K,G]:Array.isArray(K)?K.push(G):z[H]=G}Fa("got proxy server response: %o %o",v,z),s(),e({connect:{statusCode:R,statusText:I,headers:z},buffered:m})}n.on("error",f),n.on("end",u),o()})}Wi.parseProxyResponse=H0});var Wg=Y(Wt=>{"use strict";var V0=Wt&&Wt.__createBinding||(Object.create?(function(n,e,t,r){r===void 0&&(r=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,i)}):(function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]})),$0=Wt&&Wt.__setModuleDefault||(Object.create?(function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}):function(n,e){n.default=e}),Vg=Wt&&Wt.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&V0(e,n,t);return $0(e,n),e},$g=Wt&&Wt.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Wt,"__esModule",{value:!0});Wt.HttpsProxyAgent=void 0;var La=Vg(require("net")),Bg=Vg(require("tls")),W0=$g(require("assert")),z0=$g(Xc()),J0=Lg(),K0=require("url"),Y0=qg(),es=(0,z0.default)("https-proxy-agent"),Gg=n=>n.servername===void 0&&n.host&&!La.isIP(n.host)?{...n,servername:n.host}:n,qa=class extends J0.Agent{constructor(e,t){var o;super(t),this.options={path:void 0},this.proxy=typeof e=="string"?new K0.URL(e):e,this.proxyHeaders=(o=t==null?void 0:t.headers)!=null?o:{},es("Creating new HttpsProxyAgent instance: %o",this.proxy.href);let r=(this.proxy.hostname||this.proxy.host).replace(/^\[|\]$/g,""),i=this.proxy.port?parseInt(this.proxy.port,10):this.proxy.protocol==="https:"?443:80;this.connectOpts={ALPNProtocols:["http/1.1"],...t?Hg(t,"headers"):null,host:r,port:i}}async connect(e,t){let{proxy:r}=this;if(!t.host)throw new TypeError('No "host" provided');let i;r.protocol==="https:"?(es("Creating `tls.Socket`: %o",this.connectOpts),i=Bg.connect(Gg(this.connectOpts))):(es("Creating `net.Socket`: %o",this.connectOpts),i=La.connect(this.connectOpts));let o=typeof this.proxyHeaders=="function"?this.proxyHeaders():{...this.proxyHeaders},s=La.isIPv6(t.host)?`[${t.host}]`:t.host,u=`CONNECT ${s}:${t.port} HTTP/1.1\r
`;if(r.username||r.password){let g=`${decodeURIComponent(r.username)}:${decodeURIComponent(r.password)}`;o["Proxy-Authorization"]=`Basic ${Buffer.from(g).toString("base64")}`}o.Host=`${s}:${t.port}`,o["Proxy-Connection"]||(o["Proxy-Connection"]=this.keepAlive?"Keep-Alive":"close");for(let g of Object.keys(o))u+=`${g}: ${o[g]}\r
`;let f=(0,Y0.parseProxyResponse)(i);i.write(`${u}\r
`);let{connect:d,buffered:h}=await f;if(e.emit("proxyConnect",d),this.emit("proxyConnect",d,e),d.statusCode===200)return e.once("socket",X0),t.secureEndpoint?(es("Upgrading socket connection to TLS"),Bg.connect({...Hg(Gg(t),"host","path","port"),socket:i})):i;i.destroy();let m=new La.Socket({writable:!1});return m.readable=!0,e.once("socket",g=>{es("Replaying proxy buffer for failed request"),(0,W0.default)(g.listenerCount("data")>0),g.push(h),g.push(null)}),m}};qa.protocols=["http","https"];Wt.HttpsProxyAgent=qa;function X0(n){n.resume()}function Hg(n,...e){let t={},r;for(r in n)e.includes(r)||(t[r]=n[r]);return t}});function Q0(n){if(!/^data:/i.test(n))throw new TypeError('`uri` does not appear to be a Data URI (must begin with "data:")');n=n.replace(/\r?\n/g,"");let e=n.indexOf(",");if(e===-1||e<=4)throw new TypeError("malformed data: URI");let t=n.substring(5,e).split(";"),r="",i=!1,o=t[0]||"text/plain",s=o;for(let h=1;h<t.length;h++)t[h]==="base64"?i=!0:t[h]&&(s+=`;${t[h]}`,t[h].indexOf("charset=")===0&&(r=t[h].substring(8)));!t[0]&&!r.length&&(s+=";charset=US-ASCII",r="US-ASCII");let u=i?"base64":"ascii",f=unescape(n.substring(e+1)),d=Buffer.from(f,u);return d.type=o,d.typeFull=s,d.charset=r,d}var zg,Jg=Je(()=>{zg=Q0});var Yg=Y((Ba,Kg)=>{(function(n,e){typeof Ba=="object"&&typeof Kg!="undefined"?e(Ba):typeof define=="function"&&define.amd?define(["exports"],e):(n=typeof globalThis!="undefined"?globalThis:n||self,e(n.WebStreamsPolyfill={}))})(Ba,(function(n){"use strict";function e(){}function t(c){return typeof c=="object"&&c!==null||typeof c=="function"}let r=e;function i(c,p){try{Object.defineProperty(c,"name",{value:p,configurable:!0})}catch(y){}}let o=Promise,s=Promise.prototype.then,u=Promise.reject.bind(o);function f(c){return new o(c)}function d(c){return f(p=>p(c))}function h(c){return u(c)}function m(c,p,y){return s.call(c,p,y)}function g(c,p,y){m(m(c,p,y),void 0,r)}function _(c,p){g(c,p)}function v(c,p){g(c,void 0,p)}function C(c,p,y){return m(c,p,y)}function R(c){m(c,void 0,r)}let I=c=>{if(typeof queueMicrotask=="function")I=queueMicrotask;else{let p=d(void 0);I=y=>m(p,y)}return I(c)};function z(c,p,y){if(typeof c!="function")throw new TypeError("Argument is not a function");return Function.prototype.apply.call(c,p,y)}function $(c,p,y){try{return d(z(c,p,y))}catch(S){return h(S)}}let W=16384;class H{constructor(){this._cursor=0,this._size=0,this._front={_elements:[],_next:void 0},this._back=this._front,this._cursor=0,this._size=0}get length(){return this._size}push(p){let y=this._back,S=y;y._elements.length===W-1&&(S={_elements:[],_next:void 0}),y._elements.push(p),S!==y&&(this._back=S,y._next=S),++this._size}shift(){let p=this._front,y=p,S=this._cursor,b=S+1,q=p._elements,V=q[S];return b===W&&(y=p._next,b=0),--this._size,this._cursor=b,p!==y&&(this._front=y),q[S]=void 0,V}forEach(p){let y=this._cursor,S=this._front,b=S._elements;for(;(y!==b.length||S._next!==void 0)&&!(y===b.length&&(S=S._next,b=S._elements,y=0,b.length===0));)p(b[y]),++y}peek(){let p=this._front,y=this._cursor;return p._elements[y]}}let G=Symbol("[[AbortSteps]]"),K=Symbol("[[ErrorSteps]]"),te=Symbol("[[CancelSteps]]"),T=Symbol("[[PullSteps]]"),L=Symbol("[[ReleaseSteps]]");function X(c,p){c._ownerReadableStream=p,p._reader=c,p._state==="readable"?we(c):p._state==="closed"?Re(c):_e(c,p._storedError)}function ee(c,p){let y=c._ownerReadableStream;return rn(y,p)}function Z(c){let p=c._ownerReadableStream;p._state==="readable"?Ae(c,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")):Fe(c,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")),p._readableStreamController[L](),p._reader=void 0,c._ownerReadableStream=void 0}function j(c){return new TypeError("Cannot "+c+" a stream using a released reader")}function we(c){c._closedPromise=f((p,y)=>{c._closedPromise_resolve=p,c._closedPromise_reject=y})}function _e(c,p){we(c),Ae(c,p)}function Re(c){we(c),Ei(c)}function Ae(c,p){c._closedPromise_reject!==void 0&&(R(c._closedPromise),c._closedPromise_reject(p),c._closedPromise_resolve=void 0,c._closedPromise_reject=void 0)}function Fe(c,p){_e(c,p)}function Ei(c){c._closedPromise_resolve!==void 0&&(c._closedPromise_resolve(void 0),c._closedPromise_resolve=void 0,c._closedPromise_reject=void 0)}let Sn=Number.isFinite||function(c){return typeof c=="number"&&isFinite(c)},Oo=Math.trunc||function(c){return c<0?Math.ceil(c):Math.floor(c)};function Q(c){return typeof c=="object"||typeof c=="function"}function yt(c,p){if(c!==void 0&&!Q(c))throw new TypeError(`${p} is not an object.`)}function at(c,p){if(typeof c!="function")throw new TypeError(`${p} is not a function.`)}function Uo(c){return typeof c=="object"&&c!==null||typeof c=="function"}function lt(c,p){if(!Uo(c))throw new TypeError(`${p} is not an object.`)}function $e(c,p,y){if(c===void 0)throw new TypeError(`Parameter ${p} is required in '${y}'.`)}function E(c,p,y){if(c===void 0)throw new TypeError(`${p} is required in '${y}'.`)}function w(c){return Number(c)}function A(c){return c===0?0:c}function U(c){return A(Oo(c))}function N(c,p){let S=Number.MAX_SAFE_INTEGER,b=Number(c);if(b=A(b),!Sn(b))throw new TypeError(`${p} is not a finite number`);if(b=U(b),b<0||b>S)throw new TypeError(`${p} is outside the accepted range of 0 to ${S}, inclusive`);return!Sn(b)||b===0?0:b}function M(c,p){if(!hr(c))throw new TypeError(`${p} is not a ReadableStream.`)}function B(c){return new J(c)}function P(c,p){c._reader._readRequests.push(p)}function k(c,p,y){let b=c._reader._readRequests.shift();y?b._closeSteps():b._chunkSteps(p)}function F(c){return c._reader._readRequests.length}function O(c){let p=c._reader;return!(p===void 0||!ie(p))}class J{constructor(p){if($e(p,1,"ReadableStreamDefaultReader"),M(p,"First parameter"),pr(p))throw new TypeError("This stream has already been locked for exclusive reading by another reader");X(this,p),this._readRequests=new H}get closed(){return ie(this)?this._closedPromise:h(Oe("closed"))}cancel(p=void 0){return ie(this)?this._ownerReadableStream===void 0?h(j("cancel")):ee(this,p):h(Oe("cancel"))}read(){if(!ie(this))return h(Oe("read"));if(this._ownerReadableStream===void 0)return h(j("read from"));let p,y,S=f((q,V)=>{p=q,y=V});return le(this,{_chunkSteps:q=>p({value:q,done:!1}),_closeSteps:()=>p({value:void 0,done:!0}),_errorSteps:q=>y(q)}),S}releaseLock(){if(!ie(this))throw Oe("releaseLock");this._ownerReadableStream!==void 0&&ve(this)}}Object.defineProperties(J.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),i(J.prototype.cancel,"cancel"),i(J.prototype.read,"read"),i(J.prototype.releaseLock,"releaseLock"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(J.prototype,Symbol.toStringTag,{value:"ReadableStreamDefaultReader",configurable:!0});function ie(c){return!t(c)||!Object.prototype.hasOwnProperty.call(c,"_readRequests")?!1:c instanceof J}function le(c,p){let y=c._ownerReadableStream;y._disturbed=!0,y._state==="closed"?p._closeSteps():y._state==="errored"?p._errorSteps(y._storedError):y._readableStreamController[T](p)}function ve(c){Z(c);let p=new TypeError("Reader was released");Me(c,p)}function Me(c,p){let y=c._readRequests;c._readRequests=new H,y.forEach(S=>{S._errorSteps(p)})}function Oe(c){return new TypeError(`ReadableStreamDefaultReader.prototype.${c} can only be used on a ReadableStreamDefaultReader`)}let Te=Object.getPrototypeOf(Object.getPrototypeOf(async function*(){}).prototype);class be{constructor(p,y){this._ongoingPromise=void 0,this._isFinished=!1,this._reader=p,this._preventCancel=y}next(){let p=()=>this._nextSteps();return this._ongoingPromise=this._ongoingPromise?C(this._ongoingPromise,p,p):p(),this._ongoingPromise}return(p){let y=()=>this._returnSteps(p);return this._ongoingPromise?C(this._ongoingPromise,y,y):y()}_nextSteps(){if(this._isFinished)return Promise.resolve({value:void 0,done:!0});let p=this._reader,y,S,b=f((V,re)=>{y=V,S=re});return le(p,{_chunkSteps:V=>{this._ongoingPromise=void 0,I(()=>y({value:V,done:!1}))},_closeSteps:()=>{this._ongoingPromise=void 0,this._isFinished=!0,Z(p),y({value:void 0,done:!0})},_errorSteps:V=>{this._ongoingPromise=void 0,this._isFinished=!0,Z(p),S(V)}}),b}_returnSteps(p){if(this._isFinished)return Promise.resolve({value:p,done:!0});this._isFinished=!0;let y=this._reader;if(!this._preventCancel){let S=ee(y,p);return Z(y),C(S,()=>({value:p,done:!0}))}return Z(y),d({value:p,done:!0})}}let We={next(){return Ti(this)?this._asyncIteratorImpl.next():h(vi("next"))},return(c){return Ti(this)?this._asyncIteratorImpl.return(c):h(vi("return"))}};Object.setPrototypeOf(We,Te);function Si(c,p){let y=B(c),S=new be(y,p),b=Object.create(We);return b._asyncIteratorImpl=S,b}function Ti(c){if(!t(c)||!Object.prototype.hasOwnProperty.call(c,"_asyncIteratorImpl"))return!1;try{return c._asyncIteratorImpl instanceof be}catch(p){return!1}}function vi(c){return new TypeError(`ReadableStreamAsyncIterator.${c} can only be used on a ReadableSteamAsyncIterator`)}let wt=Number.isNaN||function(c){return c!==c};var Bn,je,ze;function Ie(c){return c.slice()}function Up(c,p,y,S,b){new Uint8Array(c).set(new Uint8Array(y,S,b),p)}let Gn=c=>(typeof c.transfer=="function"?Gn=p=>p.transfer():typeof structuredClone=="function"?Gn=p=>structuredClone(p,{transfer:[p]}):Gn=p=>p,Gn(c)),ur=c=>(typeof c.detached=="boolean"?ur=p=>p.detached:ur=p=>p.byteLength===0,ur(c));function Fp(c,p,y){if(c.slice)return c.slice(p,y);let S=y-p,b=new ArrayBuffer(S);return Up(b,0,c,p,S),b}function Ys(c,p){let y=c[p];if(y!=null){if(typeof y!="function")throw new TypeError(`${String(p)} is not a function`);return y}}function Zw(c){let p={[Symbol.iterator]:()=>c.iterator},y=(async function*(){return yield*p})(),S=y.next;return{iterator:y,nextMethod:S,done:!1}}let Hu=(ze=(Bn=Symbol.asyncIterator)!==null&&Bn!==void 0?Bn:(je=Symbol.for)===null||je===void 0?void 0:je.call(Symbol,"Symbol.asyncIterator"))!==null&&ze!==void 0?ze:"@@asyncIterator";function Lp(c,p="sync",y){if(y===void 0)if(p==="async"){if(y=Ys(c,Hu),y===void 0){let q=Ys(c,Symbol.iterator),V=Lp(c,"sync",q);return Zw(V)}}else y=Ys(c,Symbol.iterator);if(y===void 0)throw new TypeError("The object is not iterable");let S=z(y,c,[]);if(!t(S))throw new TypeError("The iterator method must return an object");let b=S.next;return{iterator:S,nextMethod:b,done:!1}}function jw(c){let p=z(c.nextMethod,c.iterator,[]);if(!t(p))throw new TypeError("The iterator.next() method must return an object");return p}function eC(c){return!!c.done}function tC(c){return c.value}function nC(c){return!(typeof c!="number"||wt(c)||c<0)}function qp(c){let p=Fp(c.buffer,c.byteOffset,c.byteOffset+c.byteLength);return new Uint8Array(p)}function Vu(c){let p=c._queue.shift();return c._queueTotalSize-=p.size,c._queueTotalSize<0&&(c._queueTotalSize=0),p.value}function $u(c,p,y){if(!nC(y)||y===1/0)throw new RangeError("Size must be a finite, non-NaN, non-negative number.");c._queue.push({value:p,size:y}),c._queueTotalSize+=y}function rC(c){return c._queue.peek().value}function cr(c){c._queue=new H,c._queueTotalSize=0}function Bp(c){return c===DataView}function iC(c){return Bp(c.constructor)}function oC(c){return Bp(c)?1:c.BYTES_PER_ELEMENT}class Dr{constructor(){throw new TypeError("Illegal constructor")}get view(){if(!Wu(this))throw Xu("view");return this._view}respond(p){if(!Wu(this))throw Xu("respond");if($e(p,1,"respond"),p=N(p,"First parameter"),this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");if(ur(this._view.buffer))throw new TypeError("The BYOB request's buffer has been detached and so cannot be used as a response");js(this._associatedReadableByteStreamController,p)}respondWithNewView(p){if(!Wu(this))throw Xu("respondWithNewView");if($e(p,1,"respondWithNewView"),!ArrayBuffer.isView(p))throw new TypeError("You can only respond with array buffer views");if(this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");if(ur(p.buffer))throw new TypeError("The given view's buffer has been detached and so cannot be used as a response");ea(this._associatedReadableByteStreamController,p)}}Object.defineProperties(Dr.prototype,{respond:{enumerable:!0},respondWithNewView:{enumerable:!0},view:{enumerable:!0}}),i(Dr.prototype.respond,"respond"),i(Dr.prototype.respondWithNewView,"respondWithNewView"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Dr.prototype,Symbol.toStringTag,{value:"ReadableStreamBYOBRequest",configurable:!0});class Hn{constructor(){throw new TypeError("Illegal constructor")}get byobRequest(){if(!Or(this))throw Lo("byobRequest");return Yu(this)}get desiredSize(){if(!Or(this))throw Lo("desiredSize");return Xp(this)}close(){if(!Or(this))throw Lo("close");if(this._closeRequested)throw new TypeError("The stream has already been closed; do not close it again!");let p=this._controlledReadableByteStream._state;if(p!=="readable")throw new TypeError(`The stream (in ${p} state) is not in the readable state and cannot be closed`);Fo(this)}enqueue(p){if(!Or(this))throw Lo("enqueue");if($e(p,1,"enqueue"),!ArrayBuffer.isView(p))throw new TypeError("chunk must be an array buffer view");if(p.byteLength===0)throw new TypeError("chunk must have non-zero byteLength");if(p.buffer.byteLength===0)throw new TypeError("chunk's buffer must have non-zero byteLength");if(this._closeRequested)throw new TypeError("stream is closed or draining");let y=this._controlledReadableByteStream._state;if(y!=="readable")throw new TypeError(`The stream (in ${y} state) is not in the readable state and cannot be enqueued to`);Zs(this,p)}error(p=void 0){if(!Or(this))throw Lo("error");qt(this,p)}[te](p){Gp(this),cr(this);let y=this._cancelAlgorithm(p);return Qs(this),y}[T](p){let y=this._controlledReadableByteStream;if(this._queueTotalSize>0){Yp(this,p);return}let S=this._autoAllocateChunkSize;if(S!==void 0){let b;try{b=new ArrayBuffer(S)}catch(V){p._errorSteps(V);return}let q={buffer:b,bufferByteLength:S,byteOffset:0,byteLength:S,bytesFilled:0,minimumFill:1,elementSize:1,viewConstructor:Uint8Array,readerType:"default"};this._pendingPullIntos.push(q)}P(y,p),Ur(this)}[L](){if(this._pendingPullIntos.length>0){let p=this._pendingPullIntos.peek();p.readerType="none",this._pendingPullIntos=new H,this._pendingPullIntos.push(p)}}}Object.defineProperties(Hn.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},byobRequest:{enumerable:!0},desiredSize:{enumerable:!0}}),i(Hn.prototype.close,"close"),i(Hn.prototype.enqueue,"enqueue"),i(Hn.prototype.error,"error"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Hn.prototype,Symbol.toStringTag,{value:"ReadableByteStreamController",configurable:!0});function Or(c){return!t(c)||!Object.prototype.hasOwnProperty.call(c,"_controlledReadableByteStream")?!1:c instanceof Hn}function Wu(c){return!t(c)||!Object.prototype.hasOwnProperty.call(c,"_associatedReadableByteStreamController")?!1:c instanceof Dr}function Ur(c){if(!cC(c))return;if(c._pulling){c._pullAgain=!0;return}c._pulling=!0;let y=c._pullAlgorithm();g(y,()=>(c._pulling=!1,c._pullAgain&&(c._pullAgain=!1,Ur(c)),null),S=>(qt(c,S),null))}function Gp(c){Ju(c),c._pendingPullIntos=new H}function zu(c,p){let y=!1;c._state==="closed"&&(y=!0);let S=Hp(p);p.readerType==="default"?k(c,S,y):gC(c,S,y)}function Hp(c){let p=c.bytesFilled,y=c.elementSize;return new c.viewConstructor(c.buffer,c.byteOffset,p/y)}function Xs(c,p,y,S){c._queue.push({buffer:p,byteOffset:y,byteLength:S}),c._queueTotalSize+=S}function Vp(c,p,y,S){let b;try{b=Fp(p,y,y+S)}catch(q){throw qt(c,q),q}Xs(c,b,0,S)}function $p(c,p){p.bytesFilled>0&&Vp(c,p.buffer,p.byteOffset,p.bytesFilled),wi(c)}function Wp(c,p){let y=Math.min(c._queueTotalSize,p.byteLength-p.bytesFilled),S=p.bytesFilled+y,b=y,q=!1,V=S%p.elementSize,re=S-V;re>=p.minimumFill&&(b=re-p.bytesFilled,q=!0);let ge=c._queue;for(;b>0;){let de=ge.peek(),ye=Math.min(b,de.byteLength),Ee=p.byteOffset+p.bytesFilled;Up(p.buffer,Ee,de.buffer,de.byteOffset,ye),de.byteLength===ye?ge.shift():(de.byteOffset+=ye,de.byteLength-=ye),c._queueTotalSize-=ye,zp(c,ye,p),b-=ye}return q}function zp(c,p,y){y.bytesFilled+=p}function Jp(c){c._queueTotalSize===0&&c._closeRequested?(Qs(c),$o(c._controlledReadableByteStream)):Ur(c)}function Ju(c){c._byobRequest!==null&&(c._byobRequest._associatedReadableByteStreamController=void 0,c._byobRequest._view=null,c._byobRequest=null)}function Ku(c){for(;c._pendingPullIntos.length>0;){if(c._queueTotalSize===0)return;let p=c._pendingPullIntos.peek();Wp(c,p)&&(wi(c),zu(c._controlledReadableByteStream,p))}}function sC(c){let p=c._controlledReadableByteStream._reader;for(;p._readRequests.length>0;){if(c._queueTotalSize===0)return;let y=p._readRequests.shift();Yp(c,y)}}function aC(c,p,y,S){let b=c._controlledReadableByteStream,q=p.constructor,V=oC(q),{byteOffset:re,byteLength:ge}=p,de=y*V,ye;try{ye=Gn(p.buffer)}catch(xe){S._errorSteps(xe);return}let Ee={buffer:ye,bufferByteLength:ye.byteLength,byteOffset:re,byteLength:ge,bytesFilled:0,minimumFill:de,elementSize:V,viewConstructor:q,readerType:"byob"};if(c._pendingPullIntos.length>0){c._pendingPullIntos.push(Ee),jp(b,S);return}if(b._state==="closed"){let xe=new q(Ee.buffer,Ee.byteOffset,0);S._closeSteps(xe);return}if(c._queueTotalSize>0){if(Wp(c,Ee)){let xe=Hp(Ee);Jp(c),S._chunkSteps(xe);return}if(c._closeRequested){let xe=new TypeError("Insufficient bytes to fill elements in the given buffer");qt(c,xe),S._errorSteps(xe);return}}c._pendingPullIntos.push(Ee),jp(b,S),Ur(c)}function lC(c,p){p.readerType==="none"&&wi(c);let y=c._controlledReadableByteStream;if(Qu(y))for(;em(y)>0;){let S=wi(c);zu(y,S)}}function uC(c,p,y){if(zp(c,p,y),y.readerType==="none"){$p(c,y),Ku(c);return}if(y.bytesFilled<y.minimumFill)return;wi(c);let S=y.bytesFilled%y.elementSize;if(S>0){let b=y.byteOffset+y.bytesFilled;Vp(c,y.buffer,b-S,S)}y.bytesFilled-=S,zu(c._controlledReadableByteStream,y),Ku(c)}function Kp(c,p){let y=c._pendingPullIntos.peek();Ju(c),c._controlledReadableByteStream._state==="closed"?lC(c,y):uC(c,p,y),Ur(c)}function wi(c){return c._pendingPullIntos.shift()}function cC(c){let p=c._controlledReadableByteStream;return p._state!=="readable"||c._closeRequested||!c._started?!1:!!(O(p)&&F(p)>0||Qu(p)&&em(p)>0||Xp(c)>0)}function Qs(c){c._pullAlgorithm=void 0,c._cancelAlgorithm=void 0}function Fo(c){let p=c._controlledReadableByteStream;if(!(c._closeRequested||p._state!=="readable")){if(c._queueTotalSize>0){c._closeRequested=!0;return}if(c._pendingPullIntos.length>0){let y=c._pendingPullIntos.peek();if(y.bytesFilled%y.elementSize!==0){let S=new TypeError("Insufficient bytes to fill elements in the given buffer");throw qt(c,S),S}}Qs(c),$o(p)}}function Zs(c,p){let y=c._controlledReadableByteStream;if(c._closeRequested||y._state!=="readable")return;let{buffer:S,byteOffset:b,byteLength:q}=p;if(ur(S))throw new TypeError("chunk's buffer is detached and so cannot be enqueued");let V=Gn(S);if(c._pendingPullIntos.length>0){let re=c._pendingPullIntos.peek();if(ur(re.buffer))throw new TypeError("The BYOB request's buffer has been detached and so cannot be filled with an enqueued chunk");Ju(c),re.buffer=Gn(re.buffer),re.readerType==="none"&&$p(c,re)}if(O(y))if(sC(c),F(y)===0)Xs(c,V,b,q);else{c._pendingPullIntos.length>0&&wi(c);let re=new Uint8Array(V,b,q);k(y,re,!1)}else Qu(y)?(Xs(c,V,b,q),Ku(c)):Xs(c,V,b,q);Ur(c)}function qt(c,p){let y=c._controlledReadableByteStream;y._state==="readable"&&(Gp(c),cr(c),Qs(c),Cm(y,p))}function Yp(c,p){let y=c._queue.shift();c._queueTotalSize-=y.byteLength,Jp(c);let S=new Uint8Array(y.buffer,y.byteOffset,y.byteLength);p._chunkSteps(S)}function Yu(c){if(c._byobRequest===null&&c._pendingPullIntos.length>0){let p=c._pendingPullIntos.peek(),y=new Uint8Array(p.buffer,p.byteOffset+p.bytesFilled,p.byteLength-p.bytesFilled),S=Object.create(Dr.prototype);dC(S,c,y),c._byobRequest=S}return c._byobRequest}function Xp(c){let p=c._controlledReadableByteStream._state;return p==="errored"?null:p==="closed"?0:c._strategyHWM-c._queueTotalSize}function js(c,p){let y=c._pendingPullIntos.peek();if(c._controlledReadableByteStream._state==="closed"){if(p!==0)throw new TypeError("bytesWritten must be 0 when calling respond() on a closed stream")}else{if(p===0)throw new TypeError("bytesWritten must be greater than 0 when calling respond() on a readable stream");if(y.bytesFilled+p>y.byteLength)throw new RangeError("bytesWritten out of range")}y.buffer=Gn(y.buffer),Kp(c,p)}function ea(c,p){let y=c._pendingPullIntos.peek();if(c._controlledReadableByteStream._state==="closed"){if(p.byteLength!==0)throw new TypeError("The view's length must be 0 when calling respondWithNewView() on a closed stream")}else if(p.byteLength===0)throw new TypeError("The view's length must be greater than 0 when calling respondWithNewView() on a readable stream");if(y.byteOffset+y.bytesFilled!==p.byteOffset)throw new RangeError("The region specified by view does not match byobRequest");if(y.bufferByteLength!==p.buffer.byteLength)throw new RangeError("The buffer of view has different capacity than byobRequest");if(y.bytesFilled+p.byteLength>y.byteLength)throw new RangeError("The region specified by view is larger than byobRequest");let b=p.byteLength;y.buffer=Gn(p.buffer),Kp(c,b)}function Qp(c,p,y,S,b,q,V){p._controlledReadableByteStream=c,p._pullAgain=!1,p._pulling=!1,p._byobRequest=null,p._queue=p._queueTotalSize=void 0,cr(p),p._closeRequested=!1,p._started=!1,p._strategyHWM=q,p._pullAlgorithm=S,p._cancelAlgorithm=b,p._autoAllocateChunkSize=V,p._pendingPullIntos=new H,c._readableStreamController=p;let re=y();g(d(re),()=>(p._started=!0,Ur(p),null),ge=>(qt(p,ge),null))}function fC(c,p,y){let S=Object.create(Hn.prototype),b,q,V;p.start!==void 0?b=()=>p.start(S):b=()=>{},p.pull!==void 0?q=()=>p.pull(S):q=()=>d(void 0),p.cancel!==void 0?V=ge=>p.cancel(ge):V=()=>d(void 0);let re=p.autoAllocateChunkSize;if(re===0)throw new TypeError("autoAllocateChunkSize must be greater than 0");Qp(c,S,b,q,V,y,re)}function dC(c,p,y){c._associatedReadableByteStreamController=p,c._view=y}function Xu(c){return new TypeError(`ReadableStreamBYOBRequest.prototype.${c} can only be used on a ReadableStreamBYOBRequest`)}function Lo(c){return new TypeError(`ReadableByteStreamController.prototype.${c} can only be used on a ReadableByteStreamController`)}function hC(c,p){yt(c,p);let y=c==null?void 0:c.mode;return{mode:y===void 0?void 0:pC(y,`${p} has member 'mode' that`)}}function pC(c,p){if(c=`${c}`,c!=="byob")throw new TypeError(`${p} '${c}' is not a valid enumeration value for ReadableStreamReaderMode`);return c}function mC(c,p){var y;yt(c,p);let S=(y=c==null?void 0:c.min)!==null&&y!==void 0?y:1;return{min:N(S,`${p} has member 'min' that`)}}function Zp(c){return new fr(c)}function jp(c,p){c._reader._readIntoRequests.push(p)}function gC(c,p,y){let b=c._reader._readIntoRequests.shift();y?b._closeSteps(p):b._chunkSteps(p)}function em(c){return c._reader._readIntoRequests.length}function Qu(c){let p=c._reader;return!(p===void 0||!Fr(p))}class fr{constructor(p){if($e(p,1,"ReadableStreamBYOBReader"),M(p,"First parameter"),pr(p))throw new TypeError("This stream has already been locked for exclusive reading by another reader");if(!Or(p._readableStreamController))throw new TypeError("Cannot construct a ReadableStreamBYOBReader for a stream not constructed with a byte source");X(this,p),this._readIntoRequests=new H}get closed(){return Fr(this)?this._closedPromise:h(ta("closed"))}cancel(p=void 0){return Fr(this)?this._ownerReadableStream===void 0?h(j("cancel")):ee(this,p):h(ta("cancel"))}read(p,y={}){if(!Fr(this))return h(ta("read"));if(!ArrayBuffer.isView(p))return h(new TypeError("view must be an array buffer view"));if(p.byteLength===0)return h(new TypeError("view must have non-zero byteLength"));if(p.buffer.byteLength===0)return h(new TypeError("view's buffer must have non-zero byteLength"));if(ur(p.buffer))return h(new TypeError("view's buffer has been detached"));let S;try{S=mC(y,"options")}catch(de){return h(de)}let b=S.min;if(b===0)return h(new TypeError("options.min must be greater than 0"));if(iC(p)){if(b>p.byteLength)return h(new RangeError("options.min must be less than or equal to view's byteLength"))}else if(b>p.length)return h(new RangeError("options.min must be less than or equal to view's length"));if(this._ownerReadableStream===void 0)return h(j("read from"));let q,V,re=f((de,ye)=>{q=de,V=ye});return tm(this,p,b,{_chunkSteps:de=>q({value:de,done:!1}),_closeSteps:de=>q({value:de,done:!0}),_errorSteps:de=>V(de)}),re}releaseLock(){if(!Fr(this))throw ta("releaseLock");this._ownerReadableStream!==void 0&&yC(this)}}Object.defineProperties(fr.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),i(fr.prototype.cancel,"cancel"),i(fr.prototype.read,"read"),i(fr.prototype.releaseLock,"releaseLock"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(fr.prototype,Symbol.toStringTag,{value:"ReadableStreamBYOBReader",configurable:!0});function Fr(c){return!t(c)||!Object.prototype.hasOwnProperty.call(c,"_readIntoRequests")?!1:c instanceof fr}function tm(c,p,y,S){let b=c._ownerReadableStream;b._disturbed=!0,b._state==="errored"?S._errorSteps(b._storedError):aC(b._readableStreamController,p,y,S)}function yC(c){Z(c);let p=new TypeError("Reader was released");nm(c,p)}function nm(c,p){let y=c._readIntoRequests;c._readIntoRequests=new H,y.forEach(S=>{S._errorSteps(p)})}function ta(c){return new TypeError(`ReadableStreamBYOBReader.prototype.${c} can only be used on a ReadableStreamBYOBReader`)}function qo(c,p){let{highWaterMark:y}=c;if(y===void 0)return p;if(wt(y)||y<0)throw new RangeError("Invalid highWaterMark");return y}function na(c){let{size:p}=c;return p||(()=>1)}function ra(c,p){yt(c,p);let y=c==null?void 0:c.highWaterMark,S=c==null?void 0:c.size;return{highWaterMark:y===void 0?void 0:w(y),size:S===void 0?void 0:_C(S,`${p} has member 'size' that`)}}function _C(c,p){return at(c,p),y=>w(c(y))}function EC(c,p){yt(c,p);let y=c==null?void 0:c.abort,S=c==null?void 0:c.close,b=c==null?void 0:c.start,q=c==null?void 0:c.type,V=c==null?void 0:c.write;return{abort:y===void 0?void 0:SC(y,c,`${p} has member 'abort' that`),close:S===void 0?void 0:TC(S,c,`${p} has member 'close' that`),start:b===void 0?void 0:vC(b,c,`${p} has member 'start' that`),write:V===void 0?void 0:wC(V,c,`${p} has member 'write' that`),type:q}}function SC(c,p,y){return at(c,y),S=>$(c,p,[S])}function TC(c,p,y){return at(c,y),()=>$(c,p,[])}function vC(c,p,y){return at(c,y),S=>z(c,p,[S])}function wC(c,p,y){return at(c,y),(S,b)=>$(c,p,[S,b])}function rm(c,p){if(!Ci(c))throw new TypeError(`${p} is not a WritableStream.`)}function CC(c){if(typeof c!="object"||c===null)return!1;try{return typeof c.aborted=="boolean"}catch(p){return!1}}let AC=typeof AbortController=="function";function bC(){if(AC)return new AbortController}class dr{constructor(p={},y={}){p===void 0?p=null:lt(p,"First parameter");let S=ra(y,"Second parameter"),b=EC(p,"First parameter");if(om(this),b.type!==void 0)throw new RangeError("Invalid type is specified");let V=na(S),re=qo(S,1);BC(this,b,re,V)}get locked(){if(!Ci(this))throw la("locked");return Ai(this)}abort(p=void 0){return Ci(this)?Ai(this)?h(new TypeError("Cannot abort a stream that already has a writer")):ia(this,p):h(la("abort"))}close(){return Ci(this)?Ai(this)?h(new TypeError("Cannot close a stream that already has a writer")):Tn(this)?h(new TypeError("Cannot close an already-closing stream")):sm(this):h(la("close"))}getWriter(){if(!Ci(this))throw la("getWriter");return im(this)}}Object.defineProperties(dr.prototype,{abort:{enumerable:!0},close:{enumerable:!0},getWriter:{enumerable:!0},locked:{enumerable:!0}}),i(dr.prototype.abort,"abort"),i(dr.prototype.close,"close"),i(dr.prototype.getWriter,"getWriter"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(dr.prototype,Symbol.toStringTag,{value:"WritableStream",configurable:!0});function im(c){return new Vn(c)}function RC(c,p,y,S,b=1,q=()=>1){let V=Object.create(dr.prototype);om(V);let re=Object.create(bi.prototype);return dm(V,re,c,p,y,S,b,q),V}function om(c){c._state="writable",c._storedError=void 0,c._writer=void 0,c._writableStreamController=void 0,c._writeRequests=new H,c._inFlightWriteRequest=void 0,c._closeRequest=void 0,c._inFlightCloseRequest=void 0,c._pendingAbortRequest=void 0,c._backpressure=!1}function Ci(c){return!t(c)||!Object.prototype.hasOwnProperty.call(c,"_writableStreamController")?!1:c instanceof dr}function Ai(c){return c._writer!==void 0}function ia(c,p){var y;if(c._state==="closed"||c._state==="errored")return d(void 0);c._writableStreamController._abortReason=p,(y=c._writableStreamController._abortController)===null||y===void 0||y.abort(p);let S=c._state;if(S==="closed"||S==="errored")return d(void 0);if(c._pendingAbortRequest!==void 0)return c._pendingAbortRequest._promise;let b=!1;S==="erroring"&&(b=!0,p=void 0);let q=f((V,re)=>{c._pendingAbortRequest={_promise:void 0,_resolve:V,_reject:re,_reason:p,_wasAlreadyErroring:b}});return c._pendingAbortRequest._promise=q,b||ju(c,p),q}function sm(c){let p=c._state;if(p==="closed"||p==="errored")return h(new TypeError(`The stream (in ${p} state) is not in the writable state and cannot be closed`));let y=f((b,q)=>{let V={_resolve:b,_reject:q};c._closeRequest=V}),S=c._writer;return S!==void 0&&c._backpressure&&p==="writable"&&ac(S),GC(c._writableStreamController),y}function IC(c){return f((y,S)=>{let b={_resolve:y,_reject:S};c._writeRequests.push(b)})}function Zu(c,p){if(c._state==="writable"){ju(c,p);return}ec(c)}function ju(c,p){let y=c._writableStreamController;c._state="erroring",c._storedError=p;let S=c._writer;S!==void 0&&lm(S,p),!MC(c)&&y._started&&ec(c)}function ec(c){c._state="errored",c._writableStreamController[K]();let p=c._storedError;if(c._writeRequests.forEach(b=>{b._reject(p)}),c._writeRequests=new H,c._pendingAbortRequest===void 0){oa(c);return}let y=c._pendingAbortRequest;if(c._pendingAbortRequest=void 0,y._wasAlreadyErroring){y._reject(p),oa(c);return}let S=c._writableStreamController[G](y._reason);g(S,()=>(y._resolve(),oa(c),null),b=>(y._reject(b),oa(c),null))}function PC(c){c._inFlightWriteRequest._resolve(void 0),c._inFlightWriteRequest=void 0}function xC(c,p){c._inFlightWriteRequest._reject(p),c._inFlightWriteRequest=void 0,Zu(c,p)}function NC(c){c._inFlightCloseRequest._resolve(void 0),c._inFlightCloseRequest=void 0,c._state==="erroring"&&(c._storedError=void 0,c._pendingAbortRequest!==void 0&&(c._pendingAbortRequest._resolve(),c._pendingAbortRequest=void 0)),c._state="closed";let y=c._writer;y!==void 0&&gm(y)}function kC(c,p){c._inFlightCloseRequest._reject(p),c._inFlightCloseRequest=void 0,c._pendingAbortRequest!==void 0&&(c._pendingAbortRequest._reject(p),c._pendingAbortRequest=void 0),Zu(c,p)}function Tn(c){return!(c._closeRequest===void 0&&c._inFlightCloseRequest===void 0)}function MC(c){return!(c._inFlightWriteRequest===void 0&&c._inFlightCloseRequest===void 0)}function DC(c){c._inFlightCloseRequest=c._closeRequest,c._closeRequest=void 0}function OC(c){c._inFlightWriteRequest=c._writeRequests.shift()}function oa(c){c._closeRequest!==void 0&&(c._closeRequest._reject(c._storedError),c._closeRequest=void 0);let p=c._writer;p!==void 0&&oc(p,c._storedError)}function tc(c,p){let y=c._writer;y!==void 0&&p!==c._backpressure&&(p?KC(y):ac(y)),c._backpressure=p}class Vn{constructor(p){if($e(p,1,"WritableStreamDefaultWriter"),rm(p,"First parameter"),Ai(p))throw new TypeError("This stream has already been locked for exclusive writing by another writer");this._ownerWritableStream=p,p._writer=this;let y=p._state;if(y==="writable")!Tn(p)&&p._backpressure?ca(this):ym(this),ua(this);else if(y==="erroring")sc(this,p._storedError),ua(this);else if(y==="closed")ym(this),zC(this);else{let S=p._storedError;sc(this,S),mm(this,S)}}get closed(){return Lr(this)?this._closedPromise:h(qr("closed"))}get desiredSize(){if(!Lr(this))throw qr("desiredSize");if(this._ownerWritableStream===void 0)throw Go("desiredSize");return qC(this)}get ready(){return Lr(this)?this._readyPromise:h(qr("ready"))}abort(p=void 0){return Lr(this)?this._ownerWritableStream===void 0?h(Go("abort")):UC(this,p):h(qr("abort"))}close(){if(!Lr(this))return h(qr("close"));let p=this._ownerWritableStream;return p===void 0?h(Go("close")):Tn(p)?h(new TypeError("Cannot close an already-closing stream")):am(this)}releaseLock(){if(!Lr(this))throw qr("releaseLock");this._ownerWritableStream!==void 0&&um(this)}write(p=void 0){return Lr(this)?this._ownerWritableStream===void 0?h(Go("write to")):cm(this,p):h(qr("write"))}}Object.defineProperties(Vn.prototype,{abort:{enumerable:!0},close:{enumerable:!0},releaseLock:{enumerable:!0},write:{enumerable:!0},closed:{enumerable:!0},desiredSize:{enumerable:!0},ready:{enumerable:!0}}),i(Vn.prototype.abort,"abort"),i(Vn.prototype.close,"close"),i(Vn.prototype.releaseLock,"releaseLock"),i(Vn.prototype.write,"write"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Vn.prototype,Symbol.toStringTag,{value:"WritableStreamDefaultWriter",configurable:!0});function Lr(c){return!t(c)||!Object.prototype.hasOwnProperty.call(c,"_ownerWritableStream")?!1:c instanceof Vn}function UC(c,p){let y=c._ownerWritableStream;return ia(y,p)}function am(c){let p=c._ownerWritableStream;return sm(p)}function FC(c){let p=c._ownerWritableStream,y=p._state;return Tn(p)||y==="closed"?d(void 0):y==="errored"?h(p._storedError):am(c)}function LC(c,p){c._closedPromiseState==="pending"?oc(c,p):JC(c,p)}function lm(c,p){c._readyPromiseState==="pending"?_m(c,p):YC(c,p)}function qC(c){let p=c._ownerWritableStream,y=p._state;return y==="errored"||y==="erroring"?null:y==="closed"?0:hm(p._writableStreamController)}function um(c){let p=c._ownerWritableStream,y=new TypeError("Writer was released and can no longer be used to monitor the stream's closedness");lm(c,y),LC(c,y),p._writer=void 0,c._ownerWritableStream=void 0}function cm(c,p){let y=c._ownerWritableStream,S=y._writableStreamController,b=HC(S,p);if(y!==c._ownerWritableStream)return h(Go("write to"));let q=y._state;if(q==="errored")return h(y._storedError);if(Tn(y)||q==="closed")return h(new TypeError("The stream is closing or closed and cannot be written to"));if(q==="erroring")return h(y._storedError);let V=IC(y);return VC(S,p,b),V}let fm={};class bi{constructor(){throw new TypeError("Illegal constructor")}get abortReason(){if(!nc(this))throw ic("abortReason");return this._abortReason}get signal(){if(!nc(this))throw ic("signal");if(this._abortController===void 0)throw new TypeError("WritableStreamDefaultController.prototype.signal is not supported");return this._abortController.signal}error(p=void 0){if(!nc(this))throw ic("error");this._controlledWritableStream._state==="writable"&&pm(this,p)}[G](p){let y=this._abortAlgorithm(p);return sa(this),y}[K](){cr(this)}}Object.defineProperties(bi.prototype,{abortReason:{enumerable:!0},signal:{enumerable:!0},error:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(bi.prototype,Symbol.toStringTag,{value:"WritableStreamDefaultController",configurable:!0});function nc(c){return!t(c)||!Object.prototype.hasOwnProperty.call(c,"_controlledWritableStream")?!1:c instanceof bi}function dm(c,p,y,S,b,q,V,re){p._controlledWritableStream=c,c._writableStreamController=p,p._queue=void 0,p._queueTotalSize=void 0,cr(p),p._abortReason=void 0,p._abortController=bC(),p._started=!1,p._strategySizeAlgorithm=re,p._strategyHWM=V,p._writeAlgorithm=S,p._closeAlgorithm=b,p._abortAlgorithm=q;let ge=rc(p);tc(c,ge);let de=y(),ye=d(de);g(ye,()=>(p._started=!0,aa(p),null),Ee=>(p._started=!0,Zu(c,Ee),null))}function BC(c,p,y,S){let b=Object.create(bi.prototype),q,V,re,ge;p.start!==void 0?q=()=>p.start(b):q=()=>{},p.write!==void 0?V=de=>p.write(de,b):V=()=>d(void 0),p.close!==void 0?re=()=>p.close():re=()=>d(void 0),p.abort!==void 0?ge=de=>p.abort(de):ge=()=>d(void 0),dm(c,b,q,V,re,ge,y,S)}function sa(c){c._writeAlgorithm=void 0,c._closeAlgorithm=void 0,c._abortAlgorithm=void 0,c._strategySizeAlgorithm=void 0}function GC(c){$u(c,fm,0),aa(c)}function HC(c,p){try{return c._strategySizeAlgorithm(p)}catch(y){return Bo(c,y),1}}function hm(c){return c._strategyHWM-c._queueTotalSize}function VC(c,p,y){try{$u(c,p,y)}catch(b){Bo(c,b);return}let S=c._controlledWritableStream;if(!Tn(S)&&S._state==="writable"){let b=rc(c);tc(S,b)}aa(c)}function aa(c){let p=c._controlledWritableStream;if(!c._started||p._inFlightWriteRequest!==void 0)return;if(p._state==="erroring"){ec(p);return}if(c._queue.length===0)return;let S=rC(c);S===fm?$C(c):WC(c,S)}function Bo(c,p){c._controlledWritableStream._state==="writable"&&pm(c,p)}function $C(c){let p=c._controlledWritableStream;DC(p),Vu(c);let y=c._closeAlgorithm();sa(c),g(y,()=>(NC(p),null),S=>(kC(p,S),null))}function WC(c,p){let y=c._controlledWritableStream;OC(y);let S=c._writeAlgorithm(p);g(S,()=>{PC(y);let b=y._state;if(Vu(c),!Tn(y)&&b==="writable"){let q=rc(c);tc(y,q)}return aa(c),null},b=>(y._state==="writable"&&sa(c),xC(y,b),null))}function rc(c){return hm(c)<=0}function pm(c,p){let y=c._controlledWritableStream;sa(c),ju(y,p)}function la(c){return new TypeError(`WritableStream.prototype.${c} can only be used on a WritableStream`)}function ic(c){return new TypeError(`WritableStreamDefaultController.prototype.${c} can only be used on a WritableStreamDefaultController`)}function qr(c){return new TypeError(`WritableStreamDefaultWriter.prototype.${c} can only be used on a WritableStreamDefaultWriter`)}function Go(c){return new TypeError("Cannot "+c+" a stream using a released writer")}function ua(c){c._closedPromise=f((p,y)=>{c._closedPromise_resolve=p,c._closedPromise_reject=y,c._closedPromiseState="pending"})}function mm(c,p){ua(c),oc(c,p)}function zC(c){ua(c),gm(c)}function oc(c,p){c._closedPromise_reject!==void 0&&(R(c._closedPromise),c._closedPromise_reject(p),c._closedPromise_resolve=void 0,c._closedPromise_reject=void 0,c._closedPromiseState="rejected")}function JC(c,p){mm(c,p)}function gm(c){c._closedPromise_resolve!==void 0&&(c._closedPromise_resolve(void 0),c._closedPromise_resolve=void 0,c._closedPromise_reject=void 0,c._closedPromiseState="resolved")}function ca(c){c._readyPromise=f((p,y)=>{c._readyPromise_resolve=p,c._readyPromise_reject=y}),c._readyPromiseState="pending"}function sc(c,p){ca(c),_m(c,p)}function ym(c){ca(c),ac(c)}function _m(c,p){c._readyPromise_reject!==void 0&&(R(c._readyPromise),c._readyPromise_reject(p),c._readyPromise_resolve=void 0,c._readyPromise_reject=void 0,c._readyPromiseState="rejected")}function KC(c){ca(c)}function YC(c,p){sc(c,p)}function ac(c){c._readyPromise_resolve!==void 0&&(c._readyPromise_resolve(void 0),c._readyPromise_resolve=void 0,c._readyPromise_reject=void 0,c._readyPromiseState="fulfilled")}function XC(){if(typeof globalThis!="undefined")return globalThis;if(typeof self!="undefined")return self;if(typeof global!="undefined")return global}let lc=XC();function QC(c){if(!(typeof c=="function"||typeof c=="object")||c.name!=="DOMException")return!1;try{return new c,!0}catch(p){return!1}}function ZC(){let c=lc==null?void 0:lc.DOMException;return QC(c)?c:void 0}function jC(){let c=function(y,S){this.message=y||"",this.name=S||"Error",Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)};return i(c,"DOMException"),c.prototype=Object.create(Error.prototype),Object.defineProperty(c.prototype,"constructor",{value:c,writable:!0,configurable:!0}),c}let eA=ZC()||jC();function Em(c,p,y,S,b,q){let V=B(c),re=im(p);c._disturbed=!0;let ge=!1,de=d(void 0);return f((ye,Ee)=>{let xe;if(q!==void 0){if(xe=()=>{let he=q.reason!==void 0?q.reason:new eA("Aborted","AbortError"),Se=[];S||Se.push(()=>p._state==="writable"?ia(p,he):d(void 0)),b||Se.push(()=>c._state==="readable"?rn(c,he):d(void 0)),_t(()=>Promise.all(Se.map(Ne=>Ne())),!0,he)},q.aborted){xe();return}q.addEventListener("abort",xe)}function on(){return f((he,Se)=>{function Ne(Ct){Ct?he():m(xi(),Ne,Se)}Ne(!1)})}function xi(){return ge?d(!0):m(re._readyPromise,()=>f((he,Se)=>{le(V,{_chunkSteps:Ne=>{de=m(cm(re,Ne),void 0,e),he(!1)},_closeSteps:()=>he(!0),_errorSteps:Se})}))}if(Wn(c,V._closedPromise,he=>(S?Bt(!0,he):_t(()=>ia(p,he),!0,he),null)),Wn(p,re._closedPromise,he=>(b?Bt(!0,he):_t(()=>rn(c,he),!0,he),null)),ut(c,V._closedPromise,()=>(y?Bt():_t(()=>FC(re)),null)),Tn(p)||p._state==="closed"){let he=new TypeError("the destination writable stream closed before all data could be piped to it");b?Bt(!0,he):_t(()=>rn(c,he),!0,he)}R(on());function gr(){let he=de;return m(de,()=>he!==de?gr():void 0)}function Wn(he,Se,Ne){he._state==="errored"?Ne(he._storedError):v(Se,Ne)}function ut(he,Se,Ne){he._state==="closed"?Ne():_(Se,Ne)}function _t(he,Se,Ne){if(ge)return;ge=!0,p._state==="writable"&&!Tn(p)?_(gr(),Ct):Ct();function Ct(){return g(he(),()=>zn(Se,Ne),Ni=>zn(!0,Ni)),null}}function Bt(he,Se){ge||(ge=!0,p._state==="writable"&&!Tn(p)?_(gr(),()=>zn(he,Se)):zn(he,Se))}function zn(he,Se){return um(re),Z(V),q!==void 0&&q.removeEventListener("abort",xe),he?Ee(Se):ye(void 0),null}})}class $n{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!fa(this))throw ha("desiredSize");return uc(this)}close(){if(!fa(this))throw ha("close");if(!Ii(this))throw new TypeError("The stream is not in a state that permits close");Br(this)}enqueue(p=void 0){if(!fa(this))throw ha("enqueue");if(!Ii(this))throw new TypeError("The stream is not in a state that permits enqueue");return Ri(this,p)}error(p=void 0){if(!fa(this))throw ha("error");nn(this,p)}[te](p){cr(this);let y=this._cancelAlgorithm(p);return da(this),y}[T](p){let y=this._controlledReadableStream;if(this._queue.length>0){let S=Vu(this);this._closeRequested&&this._queue.length===0?(da(this),$o(y)):Ho(this),p._chunkSteps(S)}else P(y,p),Ho(this)}[L](){}}Object.defineProperties($n.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},desiredSize:{enumerable:!0}}),i($n.prototype.close,"close"),i($n.prototype.enqueue,"enqueue"),i($n.prototype.error,"error"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty($n.prototype,Symbol.toStringTag,{value:"ReadableStreamDefaultController",configurable:!0});function fa(c){return!t(c)||!Object.prototype.hasOwnProperty.call(c,"_controlledReadableStream")?!1:c instanceof $n}function Ho(c){if(!Sm(c))return;if(c._pulling){c._pullAgain=!0;return}c._pulling=!0;let y=c._pullAlgorithm();g(y,()=>(c._pulling=!1,c._pullAgain&&(c._pullAgain=!1,Ho(c)),null),S=>(nn(c,S),null))}function Sm(c){let p=c._controlledReadableStream;return!Ii(c)||!c._started?!1:!!(pr(p)&&F(p)>0||uc(c)>0)}function da(c){c._pullAlgorithm=void 0,c._cancelAlgorithm=void 0,c._strategySizeAlgorithm=void 0}function Br(c){if(!Ii(c))return;let p=c._controlledReadableStream;c._closeRequested=!0,c._queue.length===0&&(da(c),$o(p))}function Ri(c,p){if(!Ii(c))return;let y=c._controlledReadableStream;if(pr(y)&&F(y)>0)k(y,p,!1);else{let S;try{S=c._strategySizeAlgorithm(p)}catch(b){throw nn(c,b),b}try{$u(c,p,S)}catch(b){throw nn(c,b),b}}Ho(c)}function nn(c,p){let y=c._controlledReadableStream;y._state==="readable"&&(cr(c),da(c),Cm(y,p))}function uc(c){let p=c._controlledReadableStream._state;return p==="errored"?null:p==="closed"?0:c._strategyHWM-c._queueTotalSize}function tA(c){return!Sm(c)}function Ii(c){let p=c._controlledReadableStream._state;return!c._closeRequested&&p==="readable"}function Tm(c,p,y,S,b,q,V){p._controlledReadableStream=c,p._queue=void 0,p._queueTotalSize=void 0,cr(p),p._started=!1,p._closeRequested=!1,p._pullAgain=!1,p._pulling=!1,p._strategySizeAlgorithm=V,p._strategyHWM=q,p._pullAlgorithm=S,p._cancelAlgorithm=b,c._readableStreamController=p;let re=y();g(d(re),()=>(p._started=!0,Ho(p),null),ge=>(nn(p,ge),null))}function nA(c,p,y,S){let b=Object.create($n.prototype),q,V,re;p.start!==void 0?q=()=>p.start(b):q=()=>{},p.pull!==void 0?V=()=>p.pull(b):V=()=>d(void 0),p.cancel!==void 0?re=ge=>p.cancel(ge):re=()=>d(void 0),Tm(c,b,q,V,re,y,S)}function ha(c){return new TypeError(`ReadableStreamDefaultController.prototype.${c} can only be used on a ReadableStreamDefaultController`)}function rA(c,p){return Or(c._readableStreamController)?oA(c):iA(c)}function iA(c,p){let y=B(c),S=!1,b=!1,q=!1,V=!1,re,ge,de,ye,Ee,xe=f(ut=>{Ee=ut});function on(){return S?(b=!0,d(void 0)):(S=!0,le(y,{_chunkSteps:_t=>{I(()=>{b=!1;let Bt=_t,zn=_t;q||Ri(de._readableStreamController,Bt),V||Ri(ye._readableStreamController,zn),S=!1,b&&on()})},_closeSteps:()=>{S=!1,q||Br(de._readableStreamController),V||Br(ye._readableStreamController),(!q||!V)&&Ee(void 0)},_errorSteps:()=>{S=!1}}),d(void 0))}function xi(ut){if(q=!0,re=ut,V){let _t=Ie([re,ge]),Bt=rn(c,_t);Ee(Bt)}return xe}function gr(ut){if(V=!0,ge=ut,q){let _t=Ie([re,ge]),Bt=rn(c,_t);Ee(Bt)}return xe}function Wn(){}return de=Vo(Wn,on,xi),ye=Vo(Wn,on,gr),v(y._closedPromise,ut=>(nn(de._readableStreamController,ut),nn(ye._readableStreamController,ut),(!q||!V)&&Ee(void 0),null)),[de,ye]}function oA(c){let p=B(c),y=!1,S=!1,b=!1,q=!1,V=!1,re,ge,de,ye,Ee,xe=f(he=>{Ee=he});function on(he){v(he._closedPromise,Se=>(he!==p||(qt(de._readableStreamController,Se),qt(ye._readableStreamController,Se),(!q||!V)&&Ee(void 0)),null))}function xi(){Fr(p)&&(Z(p),p=B(c),on(p)),le(p,{_chunkSteps:Se=>{I(()=>{S=!1,b=!1;let Ne=Se,Ct=Se;if(!q&&!V)try{Ct=qp(Se)}catch(Ni){qt(de._readableStreamController,Ni),qt(ye._readableStreamController,Ni),Ee(rn(c,Ni));return}q||Zs(de._readableStreamController,Ne),V||Zs(ye._readableStreamController,Ct),y=!1,S?Wn():b&&ut()})},_closeSteps:()=>{y=!1,q||Fo(de._readableStreamController),V||Fo(ye._readableStreamController),de._readableStreamController._pendingPullIntos.length>0&&js(de._readableStreamController,0),ye._readableStreamController._pendingPullIntos.length>0&&js(ye._readableStreamController,0),(!q||!V)&&Ee(void 0)},_errorSteps:()=>{y=!1}})}function gr(he,Se){ie(p)&&(Z(p),p=Zp(c),on(p));let Ne=Se?ye:de,Ct=Se?de:ye;tm(p,he,1,{_chunkSteps:ki=>{I(()=>{S=!1,b=!1;let Mi=Se?V:q;if(Se?q:V)Mi||ea(Ne._readableStreamController,ki);else{let Fm;try{Fm=qp(ki)}catch(pc){qt(Ne._readableStreamController,pc),qt(Ct._readableStreamController,pc),Ee(rn(c,pc));return}Mi||ea(Ne._readableStreamController,ki),Zs(Ct._readableStreamController,Fm)}y=!1,S?Wn():b&&ut()})},_closeSteps:ki=>{y=!1;let Mi=Se?V:q,Ta=Se?q:V;Mi||Fo(Ne._readableStreamController),Ta||Fo(Ct._readableStreamController),ki!==void 0&&(Mi||ea(Ne._readableStreamController,ki),!Ta&&Ct._readableStreamController._pendingPullIntos.length>0&&js(Ct._readableStreamController,0)),(!Mi||!Ta)&&Ee(void 0)},_errorSteps:()=>{y=!1}})}function Wn(){if(y)return S=!0,d(void 0);y=!0;let he=Yu(de._readableStreamController);return he===null?xi():gr(he._view,!1),d(void 0)}function ut(){if(y)return b=!0,d(void 0);y=!0;let he=Yu(ye._readableStreamController);return he===null?xi():gr(he._view,!0),d(void 0)}function _t(he){if(q=!0,re=he,V){let Se=Ie([re,ge]),Ne=rn(c,Se);Ee(Ne)}return xe}function Bt(he){if(V=!0,ge=he,q){let Se=Ie([re,ge]),Ne=rn(c,Se);Ee(Ne)}return xe}function zn(){}return de=wm(zn,Wn,_t),ye=wm(zn,ut,Bt),on(p),[de,ye]}function sA(c){return t(c)&&typeof c.getReader!="undefined"}function aA(c){return sA(c)?uA(c.getReader()):lA(c)}function lA(c){let p,y=Lp(c,"async"),S=e;function b(){let V;try{V=jw(y)}catch(ge){return h(ge)}let re=d(V);return C(re,ge=>{if(!t(ge))throw new TypeError("The promise returned by the iterator.next() method must fulfill with an object");if(eC(ge))Br(p._readableStreamController);else{let ye=tC(ge);Ri(p._readableStreamController,ye)}})}function q(V){let re=y.iterator,ge;try{ge=Ys(re,"return")}catch(Ee){return h(Ee)}if(ge===void 0)return d(void 0);let de;try{de=z(ge,re,[V])}catch(Ee){return h(Ee)}let ye=d(de);return C(ye,Ee=>{if(!t(Ee))throw new TypeError("The promise returned by the iterator.return() method must fulfill with an object")})}return p=Vo(S,b,q,0),p}function uA(c){let p,y=e;function S(){let q;try{q=c.read()}catch(V){return h(V)}return C(q,V=>{if(!t(V))throw new TypeError("The promise returned by the reader.read() method must fulfill with an object");if(V.done)Br(p._readableStreamController);else{let re=V.value;Ri(p._readableStreamController,re)}})}function b(q){try{return d(c.cancel(q))}catch(V){return h(V)}}return p=Vo(y,S,b,0),p}function cA(c,p){yt(c,p);let y=c,S=y==null?void 0:y.autoAllocateChunkSize,b=y==null?void 0:y.cancel,q=y==null?void 0:y.pull,V=y==null?void 0:y.start,re=y==null?void 0:y.type;return{autoAllocateChunkSize:S===void 0?void 0:N(S,`${p} has member 'autoAllocateChunkSize' that`),cancel:b===void 0?void 0:fA(b,y,`${p} has member 'cancel' that`),pull:q===void 0?void 0:dA(q,y,`${p} has member 'pull' that`),start:V===void 0?void 0:hA(V,y,`${p} has member 'start' that`),type:re===void 0?void 0:pA(re,`${p} has member 'type' that`)}}function fA(c,p,y){return at(c,y),S=>$(c,p,[S])}function dA(c,p,y){return at(c,y),S=>$(c,p,[S])}function hA(c,p,y){return at(c,y),S=>z(c,p,[S])}function pA(c,p){if(c=`${c}`,c!=="bytes")throw new TypeError(`${p} '${c}' is not a valid enumeration value for ReadableStreamType`);return c}function mA(c,p){return yt(c,p),{preventCancel:!!(c==null?void 0:c.preventCancel)}}function vm(c,p){yt(c,p);let y=c==null?void 0:c.preventAbort,S=c==null?void 0:c.preventCancel,b=c==null?void 0:c.preventClose,q=c==null?void 0:c.signal;return q!==void 0&&gA(q,`${p} has member 'signal' that`),{preventAbort:!!y,preventCancel:!!S,preventClose:!!b,signal:q}}function gA(c,p){if(!CC(c))throw new TypeError(`${p} is not an AbortSignal.`)}function yA(c,p){yt(c,p);let y=c==null?void 0:c.readable;E(y,"readable","ReadableWritablePair"),M(y,`${p} has member 'readable' that`);let S=c==null?void 0:c.writable;return E(S,"writable","ReadableWritablePair"),rm(S,`${p} has member 'writable' that`),{readable:y,writable:S}}class et{constructor(p={},y={}){p===void 0?p=null:lt(p,"First parameter");let S=ra(y,"Second parameter"),b=cA(p,"First parameter");if(cc(this),b.type==="bytes"){if(S.size!==void 0)throw new RangeError("The strategy for a byte stream cannot have a size function");let q=qo(S,0);fC(this,b,q)}else{let q=na(S),V=qo(S,1);nA(this,b,V,q)}}get locked(){if(!hr(this))throw Gr("locked");return pr(this)}cancel(p=void 0){return hr(this)?pr(this)?h(new TypeError("Cannot cancel a stream that already has a reader")):rn(this,p):h(Gr("cancel"))}getReader(p=void 0){if(!hr(this))throw Gr("getReader");return hC(p,"First parameter").mode===void 0?B(this):Zp(this)}pipeThrough(p,y={}){if(!hr(this))throw Gr("pipeThrough");$e(p,1,"pipeThrough");let S=yA(p,"First parameter"),b=vm(y,"Second parameter");if(pr(this))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked ReadableStream");if(Ai(S.writable))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked WritableStream");let q=Em(this,S.writable,b.preventClose,b.preventAbort,b.preventCancel,b.signal);return R(q),S.readable}pipeTo(p,y={}){if(!hr(this))return h(Gr("pipeTo"));if(p===void 0)return h("Parameter 1 is required in 'pipeTo'.");if(!Ci(p))return h(new TypeError("ReadableStream.prototype.pipeTo's first argument must be a WritableStream"));let S;try{S=vm(y,"Second parameter")}catch(b){return h(b)}return pr(this)?h(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked ReadableStream")):Ai(p)?h(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked WritableStream")):Em(this,p,S.preventClose,S.preventAbort,S.preventCancel,S.signal)}tee(){if(!hr(this))throw Gr("tee");let p=rA(this);return Ie(p)}values(p=void 0){if(!hr(this))throw Gr("values");let y=mA(p,"First parameter");return Si(this,y.preventCancel)}[Hu](p){return this.values(p)}static from(p){return aA(p)}}Object.defineProperties(et,{from:{enumerable:!0}}),Object.defineProperties(et.prototype,{cancel:{enumerable:!0},getReader:{enumerable:!0},pipeThrough:{enumerable:!0},pipeTo:{enumerable:!0},tee:{enumerable:!0},values:{enumerable:!0},locked:{enumerable:!0}}),i(et.from,"from"),i(et.prototype.cancel,"cancel"),i(et.prototype.getReader,"getReader"),i(et.prototype.pipeThrough,"pipeThrough"),i(et.prototype.pipeTo,"pipeTo"),i(et.prototype.tee,"tee"),i(et.prototype.values,"values"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(et.prototype,Symbol.toStringTag,{value:"ReadableStream",configurable:!0}),Object.defineProperty(et.prototype,Hu,{value:et.prototype.values,writable:!0,configurable:!0});function Vo(c,p,y,S=1,b=()=>1){let q=Object.create(et.prototype);cc(q);let V=Object.create($n.prototype);return Tm(q,V,c,p,y,S,b),q}function wm(c,p,y){let S=Object.create(et.prototype);cc(S);let b=Object.create(Hn.prototype);return Qp(S,b,c,p,y,0,void 0),S}function cc(c){c._state="readable",c._reader=void 0,c._storedError=void 0,c._disturbed=!1}function hr(c){return!t(c)||!Object.prototype.hasOwnProperty.call(c,"_readableStreamController")?!1:c instanceof et}function pr(c){return c._reader!==void 0}function rn(c,p){if(c._disturbed=!0,c._state==="closed")return d(void 0);if(c._state==="errored")return h(c._storedError);$o(c);let y=c._reader;if(y!==void 0&&Fr(y)){let b=y._readIntoRequests;y._readIntoRequests=new H,b.forEach(q=>{q._closeSteps(void 0)})}let S=c._readableStreamController[te](p);return C(S,e)}function $o(c){c._state="closed";let p=c._reader;if(p!==void 0&&(Ei(p),ie(p))){let y=p._readRequests;p._readRequests=new H,y.forEach(S=>{S._closeSteps()})}}function Cm(c,p){c._state="errored",c._storedError=p;let y=c._reader;y!==void 0&&(Ae(y,p),ie(y)?Me(y,p):nm(y,p))}function Gr(c){return new TypeError(`ReadableStream.prototype.${c} can only be used on a ReadableStream`)}function Am(c,p){yt(c,p);let y=c==null?void 0:c.highWaterMark;return E(y,"highWaterMark","QueuingStrategyInit"),{highWaterMark:w(y)}}let bm=c=>c.byteLength;i(bm,"size");class pa{constructor(p){$e(p,1,"ByteLengthQueuingStrategy"),p=Am(p,"First parameter"),this._byteLengthQueuingStrategyHighWaterMark=p.highWaterMark}get highWaterMark(){if(!Im(this))throw Rm("highWaterMark");return this._byteLengthQueuingStrategyHighWaterMark}get size(){if(!Im(this))throw Rm("size");return bm}}Object.defineProperties(pa.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(pa.prototype,Symbol.toStringTag,{value:"ByteLengthQueuingStrategy",configurable:!0});function Rm(c){return new TypeError(`ByteLengthQueuingStrategy.prototype.${c} can only be used on a ByteLengthQueuingStrategy`)}function Im(c){return!t(c)||!Object.prototype.hasOwnProperty.call(c,"_byteLengthQueuingStrategyHighWaterMark")?!1:c instanceof pa}let Pm=()=>1;i(Pm,"size");class ma{constructor(p){$e(p,1,"CountQueuingStrategy"),p=Am(p,"First parameter"),this._countQueuingStrategyHighWaterMark=p.highWaterMark}get highWaterMark(){if(!Nm(this))throw xm("highWaterMark");return this._countQueuingStrategyHighWaterMark}get size(){if(!Nm(this))throw xm("size");return Pm}}Object.defineProperties(ma.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(ma.prototype,Symbol.toStringTag,{value:"CountQueuingStrategy",configurable:!0});function xm(c){return new TypeError(`CountQueuingStrategy.prototype.${c} can only be used on a CountQueuingStrategy`)}function Nm(c){return!t(c)||!Object.prototype.hasOwnProperty.call(c,"_countQueuingStrategyHighWaterMark")?!1:c instanceof ma}function _A(c,p){yt(c,p);let y=c==null?void 0:c.cancel,S=c==null?void 0:c.flush,b=c==null?void 0:c.readableType,q=c==null?void 0:c.start,V=c==null?void 0:c.transform,re=c==null?void 0:c.writableType;return{cancel:y===void 0?void 0:vA(y,c,`${p} has member 'cancel' that`),flush:S===void 0?void 0:EA(S,c,`${p} has member 'flush' that`),readableType:b,start:q===void 0?void 0:SA(q,c,`${p} has member 'start' that`),transform:V===void 0?void 0:TA(V,c,`${p} has member 'transform' that`),writableType:re}}function EA(c,p,y){return at(c,y),S=>$(c,p,[S])}function SA(c,p,y){return at(c,y),S=>z(c,p,[S])}function TA(c,p,y){return at(c,y),(S,b)=>$(c,p,[S,b])}function vA(c,p,y){return at(c,y),S=>$(c,p,[S])}class ga{constructor(p={},y={},S={}){p===void 0&&(p=null);let b=ra(y,"Second parameter"),q=ra(S,"Third parameter"),V=_A(p,"First parameter");if(V.readableType!==void 0)throw new RangeError("Invalid readableType specified");if(V.writableType!==void 0)throw new RangeError("Invalid writableType specified");let re=qo(q,0),ge=na(q),de=qo(b,1),ye=na(b),Ee,xe=f(on=>{Ee=on});wA(this,xe,de,ye,re,ge),AA(this,V),V.start!==void 0?Ee(V.start(this._transformStreamController)):Ee(void 0)}get readable(){if(!km(this))throw Um("readable");return this._readable}get writable(){if(!km(this))throw Um("writable");return this._writable}}Object.defineProperties(ga.prototype,{readable:{enumerable:!0},writable:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(ga.prototype,Symbol.toStringTag,{value:"TransformStream",configurable:!0});function wA(c,p,y,S,b,q){function V(){return p}function re(xe){return IA(c,xe)}function ge(xe){return PA(c,xe)}function de(){return xA(c)}c._writable=RC(V,re,de,ge,y,S);function ye(){return NA(c)}function Ee(xe){return kA(c,xe)}c._readable=Vo(V,ye,Ee,b,q),c._backpressure=void 0,c._backpressureChangePromise=void 0,c._backpressureChangePromise_resolve=void 0,ya(c,!0),c._transformStreamController=void 0}function km(c){return!t(c)||!Object.prototype.hasOwnProperty.call(c,"_transformStreamController")?!1:c instanceof ga}function Mm(c,p){nn(c._readable._readableStreamController,p),fc(c,p)}function fc(c,p){Ea(c._transformStreamController),Bo(c._writable._writableStreamController,p),dc(c)}function dc(c){c._backpressure&&ya(c,!1)}function ya(c,p){c._backpressureChangePromise!==void 0&&c._backpressureChangePromise_resolve(),c._backpressureChangePromise=f(y=>{c._backpressureChangePromise_resolve=y}),c._backpressure=p}class mr{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!_a(this))throw Sa("desiredSize");let p=this._controlledTransformStream._readable._readableStreamController;return uc(p)}enqueue(p=void 0){if(!_a(this))throw Sa("enqueue");Dm(this,p)}error(p=void 0){if(!_a(this))throw Sa("error");bA(this,p)}terminate(){if(!_a(this))throw Sa("terminate");RA(this)}}Object.defineProperties(mr.prototype,{enqueue:{enumerable:!0},error:{enumerable:!0},terminate:{enumerable:!0},desiredSize:{enumerable:!0}}),i(mr.prototype.enqueue,"enqueue"),i(mr.prototype.error,"error"),i(mr.prototype.terminate,"terminate"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(mr.prototype,Symbol.toStringTag,{value:"TransformStreamDefaultController",configurable:!0});function _a(c){return!t(c)||!Object.prototype.hasOwnProperty.call(c,"_controlledTransformStream")?!1:c instanceof mr}function CA(c,p,y,S,b){p._controlledTransformStream=c,c._transformStreamController=p,p._transformAlgorithm=y,p._flushAlgorithm=S,p._cancelAlgorithm=b,p._finishPromise=void 0,p._finishPromise_resolve=void 0,p._finishPromise_reject=void 0}function AA(c,p){let y=Object.create(mr.prototype),S,b,q;p.transform!==void 0?S=V=>p.transform(V,y):S=V=>{try{return Dm(y,V),d(void 0)}catch(re){return h(re)}},p.flush!==void 0?b=()=>p.flush(y):b=()=>d(void 0),p.cancel!==void 0?q=V=>p.cancel(V):q=()=>d(void 0),CA(c,y,S,b,q)}function Ea(c){c._transformAlgorithm=void 0,c._flushAlgorithm=void 0,c._cancelAlgorithm=void 0}function Dm(c,p){let y=c._controlledTransformStream,S=y._readable._readableStreamController;if(!Ii(S))throw new TypeError("Readable side is not in a state that permits enqueue");try{Ri(S,p)}catch(q){throw fc(y,q),y._readable._storedError}tA(S)!==y._backpressure&&ya(y,!0)}function bA(c,p){Mm(c._controlledTransformStream,p)}function Om(c,p){let y=c._transformAlgorithm(p);return C(y,void 0,S=>{throw Mm(c._controlledTransformStream,S),S})}function RA(c){let p=c._controlledTransformStream,y=p._readable._readableStreamController;Br(y);let S=new TypeError("TransformStream terminated");fc(p,S)}function IA(c,p){let y=c._transformStreamController;if(c._backpressure){let S=c._backpressureChangePromise;return C(S,()=>{let b=c._writable;if(b._state==="erroring")throw b._storedError;return Om(y,p)})}return Om(y,p)}function PA(c,p){let y=c._transformStreamController;if(y._finishPromise!==void 0)return y._finishPromise;let S=c._readable;y._finishPromise=f((q,V)=>{y._finishPromise_resolve=q,y._finishPromise_reject=V});let b=y._cancelAlgorithm(p);return Ea(y),g(b,()=>(S._state==="errored"?Pi(y,S._storedError):(nn(S._readableStreamController,p),hc(y)),null),q=>(nn(S._readableStreamController,q),Pi(y,q),null)),y._finishPromise}function xA(c){let p=c._transformStreamController;if(p._finishPromise!==void 0)return p._finishPromise;let y=c._readable;p._finishPromise=f((b,q)=>{p._finishPromise_resolve=b,p._finishPromise_reject=q});let S=p._flushAlgorithm();return Ea(p),g(S,()=>(y._state==="errored"?Pi(p,y._storedError):(Br(y._readableStreamController),hc(p)),null),b=>(nn(y._readableStreamController,b),Pi(p,b),null)),p._finishPromise}function NA(c){return ya(c,!1),c._backpressureChangePromise}function kA(c,p){let y=c._transformStreamController;if(y._finishPromise!==void 0)return y._finishPromise;let S=c._writable;y._finishPromise=f((q,V)=>{y._finishPromise_resolve=q,y._finishPromise_reject=V});let b=y._cancelAlgorithm(p);return Ea(y),g(b,()=>(S._state==="errored"?Pi(y,S._storedError):(Bo(S._writableStreamController,p),dc(c),hc(y)),null),q=>(Bo(S._writableStreamController,q),dc(c),Pi(y,q),null)),y._finishPromise}function Sa(c){return new TypeError(`TransformStreamDefaultController.prototype.${c} can only be used on a TransformStreamDefaultController`)}function hc(c){c._finishPromise_resolve!==void 0&&(c._finishPromise_resolve(),c._finishPromise_resolve=void 0,c._finishPromise_reject=void 0)}function Pi(c,p){c._finishPromise_reject!==void 0&&(R(c._finishPromise),c._finishPromise_reject(p),c._finishPromise_resolve=void 0,c._finishPromise_reject=void 0)}function Um(c){return new TypeError(`TransformStream.prototype.${c} can only be used on a TransformStream`)}n.ByteLengthQueuingStrategy=pa,n.CountQueuingStrategy=ma,n.ReadableByteStreamController=Hn,n.ReadableStream=et,n.ReadableStreamBYOBReader=fr,n.ReadableStreamBYOBRequest=Dr,n.ReadableStreamDefaultController=$n,n.ReadableStreamDefaultReader=J,n.TransformStream=ga,n.TransformStreamDefaultController=mr,n.WritableStream=dr,n.WritableStreamDefaultController=bi,n.WritableStreamDefaultWriter=Vn}))});var Xg=Y(()=>{if(!globalThis.ReadableStream)try{let n=require("node:process"),{emitWarning:e}=n;try{n.emitWarning=()=>{},Object.assign(globalThis,require("node:stream/web")),n.emitWarning=e}catch(t){throw n.emitWarning=e,t}}catch(n){Object.assign(globalThis,Yg())}try{let{Blob:n}=require("buffer");n&&!n.prototype.stream&&(n.prototype.stream=function(t){let r=0,i=this;return new ReadableStream({type:"bytes",async pull(o){let u=await i.slice(r,Math.min(i.size,r+65536)).arrayBuffer();r+=u.byteLength,o.enqueue(new Uint8Array(u)),r===i.size&&o.close()}})})}catch(n){}});async function*Zc(n,e=!0){for(let t of n)if("stream"in t)yield*t.stream();else if(ArrayBuffer.isView(t))if(e){let r=t.byteOffset,i=t.byteOffset+t.byteLength;for(;r!==i;){let o=Math.min(i-r,Qg),s=t.buffer.slice(r,r+o);r+=s.byteLength,yield new Uint8Array(s)}}else yield t;else{let r=0,i=t;for(;r!==i.size;){let s=await i.slice(r,Math.min(i.size,r+Qg)).arrayBuffer();r+=s.byteLength,yield new Uint8Array(s)}}}var $L,Qg,Yn,ts,zi,Ga,zr,Zg,Z0,ln,ns=Je(()=>{$L=Le(Xg(),1);Qg=65536;Zg=(zr=class{constructor(e=[],t={}){se(this,Yn,[]);se(this,ts,"");se(this,zi,0);se(this,Ga,"transparent");if(typeof e!="object"||e===null)throw new TypeError("Failed to construct 'Blob': The provided value cannot be converted to a sequence.");if(typeof e[Symbol.iterator]!="function")throw new TypeError("Failed to construct 'Blob': The object must have a callable @@iterator property.");if(typeof t!="object"&&typeof t!="function")throw new TypeError("Failed to construct 'Blob': parameter 2 cannot convert to dictionary.");t===null&&(t={});let r=new TextEncoder;for(let o of e){let s;ArrayBuffer.isView(o)?s=new Uint8Array(o.buffer.slice(o.byteOffset,o.byteOffset+o.byteLength)):o instanceof ArrayBuffer?s=new Uint8Array(o.slice(0)):o instanceof zr?s=o:s=r.encode(`${o}`),ce(this,zi,D(this,zi)+(ArrayBuffer.isView(s)?s.byteLength:s.size)),D(this,Yn).push(s)}ce(this,Ga,`${t.endings===void 0?"transparent":t.endings}`);let i=t.type===void 0?"":String(t.type);ce(this,ts,/^[\x20-\x7E]*$/.test(i)?i:"")}get size(){return D(this,zi)}get type(){return D(this,ts)}async text(){let e=new TextDecoder,t="";for await(let r of Zc(D(this,Yn),!1))t+=e.decode(r,{stream:!0});return t+=e.decode(),t}async arrayBuffer(){let e=new Uint8Array(this.size),t=0;for await(let r of Zc(D(this,Yn),!1))e.set(r,t),t+=r.length;return e.buffer}stream(){let e=Zc(D(this,Yn),!0);return new globalThis.ReadableStream({type:"bytes",async pull(t){let r=await e.next();r.done?t.close():t.enqueue(r.value)},async cancel(){await e.return()}})}slice(e=0,t=this.size,r=""){let{size:i}=this,o=e<0?Math.max(i+e,0):Math.min(e,i),s=t<0?Math.max(i+t,0):Math.min(t,i),u=Math.max(s-o,0),f=D(this,Yn),d=[],h=0;for(let g of f){if(h>=u)break;let _=ArrayBuffer.isView(g)?g.byteLength:g.size;if(o&&_<=o)o-=_,s-=_;else{let v;ArrayBuffer.isView(g)?(v=g.subarray(o,Math.min(_,s)),h+=v.byteLength):(v=g.slice(o,Math.min(_,s)),h+=v.size),s-=_,d.push(v),o=0}}let m=new zr([],{type:String(r).toLowerCase()});return ce(m,zi,u),ce(m,Yn,d),m}get[Symbol.toStringTag](){return"Blob"}static[Symbol.hasInstance](e){return e&&typeof e=="object"&&typeof e.constructor=="function"&&(typeof e.stream=="function"||typeof e.arrayBuffer=="function")&&/^(Blob|File)$/.test(e[Symbol.toStringTag])}},Yn=new WeakMap,ts=new WeakMap,zi=new WeakMap,Ga=new WeakMap,zr);Object.defineProperties(Zg.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}});Z0=Zg,ln=Z0});var rs,is,jg,j0,eb,Sr,jc=Je(()=>{ns();j0=(jg=class extends ln{constructor(t,r,i={}){if(arguments.length<2)throw new TypeError(`Failed to construct 'File': 2 arguments required, but only ${arguments.length} present.`);super(t,i);se(this,rs,0);se(this,is,"");i===null&&(i={});let o=i.lastModified===void 0?Date.now():Number(i.lastModified);Number.isNaN(o)||ce(this,rs,o),ce(this,is,String(r))}get name(){return D(this,is)}get lastModified(){return D(this,rs)}get[Symbol.toStringTag](){return"File"}static[Symbol.hasInstance](t){return!!t&&t instanceof ln&&/^(File)$/.test(t[Symbol.toStringTag])}},rs=new WeakMap,is=new WeakMap,jg),eb=j0,Sr=eb});function ry(n,e=ln){var t=`${ey()}${ey()}`.replace(/\./g,"").slice(-28).padStart(32,"-"),r=[],i=`--${t}\r
Content-Disposition: form-data; name="`;return n.forEach((o,s)=>typeof o=="string"?r.push(i+ef(s)+`"\r
\r
${o.replace(/\r(?!\n)|(?<!\r)\n/g,`\r
`)}\r
`):r.push(i+ef(s)+`"; filename="${ef(o.name,1)}"\r
Content-Type: ${o.type||"application/octet-stream"}\r
\r
`,o,`\r
`)),r.push(`--${t}--`),new e(r,{type:"multipart/form-data; boundary="+t})}var os,tb,nb,ey,rb,ty,ef,Jr,zt,ny,Tr,Ha=Je(()=>{ns();jc();({toStringTag:os,iterator:tb,hasInstance:nb}=Symbol),ey=Math.random,rb="append,set,get,getAll,delete,keys,values,entries,forEach,constructor".split(","),ty=(n,e,t)=>(n+="",/^(Blob|File)$/.test(e&&e[os])?[(t=t!==void 0?t+"":e[os]=="File"?e.name:"blob",n),e.name!==t||e[os]=="blob"?new Sr([e],t,e):e]:[n,e+""]),ef=(n,e)=>(e?n:n.replace(/\r?\n|\r/g,`\r
`)).replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22"),Jr=(n,e,t)=>{if(e.length<t)throw new TypeError(`Failed to execute '${n}' on 'FormData': ${t} arguments required, but only ${e.length} present.`)},Tr=(ny=class{constructor(...e){se(this,zt,[]);if(e.length)throw new TypeError("Failed to construct 'FormData': parameter 1 is not of type 'HTMLFormElement'.")}get[os](){return"FormData"}[tb](){return this.entries()}static[nb](e){return e&&typeof e=="object"&&e[os]==="FormData"&&!rb.some(t=>typeof e[t]!="function")}append(...e){Jr("append",arguments,2),D(this,zt).push(ty(...e))}delete(e){Jr("delete",arguments,1),e+="",ce(this,zt,D(this,zt).filter(([t])=>t!==e))}get(e){Jr("get",arguments,1),e+="";for(var t=D(this,zt),r=t.length,i=0;i<r;i++)if(t[i][0]===e)return t[i][1];return null}getAll(e,t){return Jr("getAll",arguments,1),t=[],e+="",D(this,zt).forEach(r=>r[0]===e&&t.push(r[1])),t}has(e){return Jr("has",arguments,1),e+="",D(this,zt).some(t=>t[0]===e)}forEach(e,t){Jr("forEach",arguments,1);for(var[r,i]of this)e.call(t,i,r,this)}set(...e){Jr("set",arguments,2);var t=[],r=!0;e=ty(...e),D(this,zt).forEach(i=>{i[0]===e[0]?r&&(r=!t.push(e)):t.push(i)}),r&&t.push(e),ce(this,zt,t)}*entries(){yield*D(this,zt)}*keys(){for(var[e]of this)yield e}*values(){for(var[,e]of this)yield e}},zt=new WeakMap,ny)});var Xn,Va=Je(()=>{Xn=class extends Error{constructor(e,t){super(e),Error.captureStackTrace(this,this.constructor),this.type=t}get name(){return this.constructor.name}get[Symbol.toStringTag](){return this.constructor.name}}});var ht,tf=Je(()=>{Va();ht=class extends Xn{constructor(e,t,r){super(e,t),r&&(this.code=this.errno=r.code,this.erroredSysCall=r.syscall)}}});var $a,nf,ss,iy,oy,sy,Wa=Je(()=>{$a=Symbol.toStringTag,nf=n=>typeof n=="object"&&typeof n.append=="function"&&typeof n.delete=="function"&&typeof n.get=="function"&&typeof n.getAll=="function"&&typeof n.has=="function"&&typeof n.set=="function"&&typeof n.sort=="function"&&n[$a]==="URLSearchParams",ss=n=>n&&typeof n=="object"&&typeof n.arrayBuffer=="function"&&typeof n.type=="string"&&typeof n.stream=="function"&&typeof n.constructor=="function"&&/^(Blob|File)$/.test(n[$a]),iy=n=>typeof n=="object"&&(n[$a]==="AbortSignal"||n[$a]==="EventTarget"),oy=(n,e)=>{let t=new URL(e).hostname,r=new URL(n).hostname;return t===r||t.endsWith(`.${r}`)},sy=(n,e)=>{let t=new URL(e).protocol,r=new URL(n).protocol;return t===r}});var ly=Y((s1,ay)=>{if(!globalThis.DOMException)try{let{MessageChannel:n}=require("worker_threads"),e=new n().port1,t=new ArrayBuffer;e.postMessage(t,[t,t])}catch(n){n.constructor.name==="DOMException"&&(globalThis.DOMException=n.constructor)}ay.exports=globalThis.DOMException});var Xr,uy,cy,rf,fy,dy,hy,py,my,gy,Kr,Yr,of,za,sf=Je(()=>{Xr=require("node:fs"),uy=require("node:path"),cy=Le(ly(),1);jc();ns();({stat:rf}=Xr.promises),fy=(n,e)=>my((0,Xr.statSync)(n),n,e),dy=(n,e)=>rf(n).then(t=>my(t,n,e)),hy=(n,e)=>rf(n).then(t=>gy(t,n,e)),py=(n,e)=>gy((0,Xr.statSync)(n),n,e),my=(n,e,t="")=>new ln([new za({path:e,size:n.size,lastModified:n.mtimeMs,start:0})],{type:t}),gy=(n,e,t="")=>new Sr([new za({path:e,size:n.size,lastModified:n.mtimeMs,start:0})],(0,uy.basename)(e),{type:t,lastModified:n.mtimeMs}),of=class of{constructor(e){se(this,Kr);se(this,Yr);ce(this,Kr,e.path),ce(this,Yr,e.start),this.size=e.size,this.lastModified=e.lastModified}slice(e,t){return new of({path:D(this,Kr),lastModified:this.lastModified,size:t-e,start:D(this,Yr)+e})}async*stream(){let{mtimeMs:e}=await rf(D(this,Kr));if(e>this.lastModified)throw new cy.default("The requested file could not be read, typically due to permission problems that have occurred after a reference to a file was acquired.","NotReadableError");yield*(0,Xr.createReadStream)(D(this,Kr),{start:D(this,Yr),end:D(this,Yr)+this.size-1})}get[Symbol.toStringTag](){return"Blob"}};Kr=new WeakMap,Yr=new WeakMap;za=of});var _y={};mc(_y,{toFormData:()=>cb});function ub(n){let e=n.match(/\bfilename=("(.*?)"|([^()<>@,;:\\"/[\]?={}\s\t]+))($|;\s)/i);if(!e)return;let t=e[2]||e[3]||"",r=t.slice(t.lastIndexOf("\\")+1);return r=r.replace(/%22/g,'"'),r=r.replace(/&#(\d{4});/g,(i,o)=>String.fromCharCode(o)),r}async function cb(n,e){if(!/multipart/i.test(e))throw new TypeError("Failed to fetch");let t=e.match(/boundary=(?:"([^"]+)"|([^;]+))/i);if(!t)throw new TypeError("no or bad content-type header, no multipart boundary");let r=new af(t[1]||t[2]),i,o,s,u,f,d,h=[],m=new Tr,g=I=>{s+=R.decode(I,{stream:!0})},_=I=>{h.push(I)},v=()=>{let I=new Sr(h,d,{type:f});m.append(u,I)},C=()=>{m.append(u,s)},R=new TextDecoder("utf-8");R.decode(),r.onPartBegin=function(){r.onPartData=g,r.onPartEnd=C,i="",o="",s="",u="",f="",d=null,h.length=0},r.onHeaderField=function(I){i+=R.decode(I,{stream:!0})},r.onHeaderValue=function(I){o+=R.decode(I,{stream:!0})},r.onHeaderEnd=function(){if(o+=R.decode(),i=i.toLowerCase(),i==="content-disposition"){let I=o.match(/\bname=("([^"]*)"|([^()<>@,;:\\"/[\]?={}\s\t]+))/i);I&&(u=I[2]||I[3]||""),d=ub(o),d&&(r.onPartData=_,r.onPartEnd=v)}else i==="content-type"&&(f=o);o="",i=""};for await(let I of n)r.write(I);return r.end(),m}var bn,ke,yy,vr,Ja,Ka,ib,as,ob,sb,ab,lb,Qr,af,Ey=Je(()=>{sf();Ha();bn=0,ke={START_BOUNDARY:bn++,HEADER_FIELD_START:bn++,HEADER_FIELD:bn++,HEADER_VALUE_START:bn++,HEADER_VALUE:bn++,HEADER_VALUE_ALMOST_DONE:bn++,HEADERS_ALMOST_DONE:bn++,PART_DATA_START:bn++,PART_DATA:bn++,END:bn++},yy=1,vr={PART_BOUNDARY:yy,LAST_BOUNDARY:yy*=2},Ja=10,Ka=13,ib=32,as=45,ob=58,sb=97,ab=122,lb=n=>n|32,Qr=()=>{},af=class{constructor(e){this.index=0,this.flags=0,this.onHeaderEnd=Qr,this.onHeaderField=Qr,this.onHeadersEnd=Qr,this.onHeaderValue=Qr,this.onPartBegin=Qr,this.onPartData=Qr,this.onPartEnd=Qr,this.boundaryChars={},e=`\r
--`+e;let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r),this.boundaryChars[t[r]]=!0;this.boundary=t,this.lookbehind=new Uint8Array(this.boundary.length+8),this.state=ke.START_BOUNDARY}write(e){let t=0,r=e.length,i=this.index,{lookbehind:o,boundary:s,boundaryChars:u,index:f,state:d,flags:h}=this,m=this.boundary.length,g=m-1,_=e.length,v,C,R=W=>{this[W+"Mark"]=t},I=W=>{delete this[W+"Mark"]},z=(W,H,G,K)=>{(H===void 0||H!==G)&&this[W](K&&K.subarray(H,G))},$=(W,H)=>{let G=W+"Mark";G in this&&(H?(z(W,this[G],t,e),delete this[G]):(z(W,this[G],e.length,e),this[G]=0))};for(t=0;t<r;t++)switch(v=e[t],d){case ke.START_BOUNDARY:if(f===s.length-2){if(v===as)h|=vr.LAST_BOUNDARY;else if(v!==Ka)return;f++;break}else if(f-1===s.length-2){if(h&vr.LAST_BOUNDARY&&v===as)d=ke.END,h=0;else if(!(h&vr.LAST_BOUNDARY)&&v===Ja)f=0,z("onPartBegin"),d=ke.HEADER_FIELD_START;else return;break}v!==s[f+2]&&(f=-2),v===s[f+2]&&f++;break;case ke.HEADER_FIELD_START:d=ke.HEADER_FIELD,R("onHeaderField"),f=0;case ke.HEADER_FIELD:if(v===Ka){I("onHeaderField"),d=ke.HEADERS_ALMOST_DONE;break}if(f++,v===as)break;if(v===ob){if(f===1)return;$("onHeaderField",!0),d=ke.HEADER_VALUE_START;break}if(C=lb(v),C<sb||C>ab)return;break;case ke.HEADER_VALUE_START:if(v===ib)break;R("onHeaderValue"),d=ke.HEADER_VALUE;case ke.HEADER_VALUE:v===Ka&&($("onHeaderValue",!0),z("onHeaderEnd"),d=ke.HEADER_VALUE_ALMOST_DONE);break;case ke.HEADER_VALUE_ALMOST_DONE:if(v!==Ja)return;d=ke.HEADER_FIELD_START;break;case ke.HEADERS_ALMOST_DONE:if(v!==Ja)return;z("onHeadersEnd"),d=ke.PART_DATA_START;break;case ke.PART_DATA_START:d=ke.PART_DATA,R("onPartData");case ke.PART_DATA:if(i=f,f===0){for(t+=g;t<_&&!(e[t]in u);)t+=m;t-=g,v=e[t]}if(f<s.length)s[f]===v?(f===0&&$("onPartData",!0),f++):f=0;else if(f===s.length)f++,v===Ka?h|=vr.PART_BOUNDARY:v===as?h|=vr.LAST_BOUNDARY:f=0;else if(f-1===s.length)if(h&vr.PART_BOUNDARY){if(f=0,v===Ja){h&=~vr.PART_BOUNDARY,z("onPartEnd"),z("onPartBegin"),d=ke.HEADER_FIELD_START;break}}else h&vr.LAST_BOUNDARY&&v===as?(z("onPartEnd"),d=ke.END,h=0):f=0;if(f>0)o[f-1]=v;else if(i>0){let W=new Uint8Array(o.buffer,o.byteOffset,o.byteLength);z("onPartData",0,i,W),i=0,R("onPartData"),t--}break;case ke.END:break;default:throw new Error(`Unexpected state entered: ${d}`)}$("onHeaderField"),$("onHeaderValue"),$("onPartData"),this.index=f,this.state=d,this.flags=h}end(){if(this.state===ke.HEADER_FIELD_START&&this.index===0||this.state===ke.PART_DATA&&this.index===this.boundary.length)this.onPartEnd();else if(this.state!==ke.END)throw new Error("MultipartParser.end(): stream ended unexpectedly")}}});async function lf(n){if(n[Tt].disturbed)throw new TypeError(`body used already for: ${n.url}`);if(n[Tt].disturbed=!0,n[Tt].error)throw n[Tt].error;let{body:e}=n;if(e===null)return Rt.Buffer.alloc(0);if(!(e instanceof Jt.default))return Rt.Buffer.alloc(0);let t=[],r=0;try{for await(let i of e){if(n.size>0&&r+i.length>n.size){let o=new ht(`content size at ${n.url} over limit: ${n.size}`,"max-size");throw e.destroy(o),o}r+=i.length,t.push(i)}}catch(i){throw i instanceof Xn?i:new ht(`Invalid response body while trying to fetch ${n.url}: ${i.message}`,"system",i)}if(e.readableEnded===!0||e._readableState.ended===!0)try{return t.every(i=>typeof i=="string")?Rt.Buffer.from(t.join("")):Rt.Buffer.concat(t,r)}catch(i){throw new ht(`Could not create Buffer from response body for ${n.url}: ${i.message}`,"system",i)}else throw new ht(`Premature close of server response while trying to fetch ${n.url}`)}var Jt,Qn,Rt,fb,Tt,Rn,Ji,db,Ya,Sy,Ty,Xa=Je(()=>{Jt=Le(require("node:stream"),1),Qn=require("node:util"),Rt=require("node:buffer");ns();Ha();tf();Va();Wa();fb=(0,Qn.promisify)(Jt.default.pipeline),Tt=Symbol("Body internals"),Rn=class{constructor(e,{size:t=0}={}){let r=null;e===null?e=null:nf(e)?e=Rt.Buffer.from(e.toString()):ss(e)||Rt.Buffer.isBuffer(e)||(Qn.types.isAnyArrayBuffer(e)?e=Rt.Buffer.from(e):ArrayBuffer.isView(e)?e=Rt.Buffer.from(e.buffer,e.byteOffset,e.byteLength):e instanceof Jt.default||(e instanceof Tr?(e=ry(e),r=e.type.split("=")[1]):e=Rt.Buffer.from(String(e))));let i=e;Rt.Buffer.isBuffer(e)?i=Jt.default.Readable.from(e):ss(e)&&(i=Jt.default.Readable.from(e.stream())),this[Tt]={body:e,stream:i,boundary:r,disturbed:!1,error:null},this.size=t,e instanceof Jt.default&&e.on("error",o=>{let s=o instanceof Xn?o:new ht(`Invalid response body while trying to fetch ${this.url}: ${o.message}`,"system",o);this[Tt].error=s})}get body(){return this[Tt].stream}get bodyUsed(){return this[Tt].disturbed}async arrayBuffer(){let{buffer:e,byteOffset:t,byteLength:r}=await lf(this);return e.slice(t,t+r)}async formData(){let e=this.headers.get("content-type");if(e.startsWith("application/x-www-form-urlencoded")){let r=new Tr,i=new URLSearchParams(await this.text());for(let[o,s]of i)r.append(o,s);return r}let{toFormData:t}=await Promise.resolve().then(()=>(Ey(),_y));return t(this.body,e)}async blob(){let e=this.headers&&this.headers.get("content-type")||this[Tt].body&&this[Tt].body.type||"",t=await this.arrayBuffer();return new ln([t],{type:e})}async json(){let e=await this.text();return JSON.parse(e)}async text(){let e=await lf(this);return new TextDecoder().decode(e)}buffer(){return lf(this)}};Rn.prototype.buffer=(0,Qn.deprecate)(Rn.prototype.buffer,"Please use 'response.arrayBuffer()' instead of 'response.buffer()'","node-fetch#buffer");Object.defineProperties(Rn.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0},data:{get:(0,Qn.deprecate)(()=>{},"data doesn't exist, use json(), text(), arrayBuffer(), or body instead","https://github.com/node-fetch/node-fetch/issues/1000 (response)")}});Ji=(n,e)=>{let t,r,{body:i}=n[Tt];if(n.bodyUsed)throw new Error("cannot clone body after it is used");return i instanceof Jt.default&&typeof i.getBoundary!="function"&&(t=new Jt.PassThrough({highWaterMark:e}),r=new Jt.PassThrough({highWaterMark:e}),i.pipe(t),i.pipe(r),n[Tt].stream=t,i=r),i},db=(0,Qn.deprecate)(n=>n.getBoundary(),"form-data doesn't follow the spec and requires special treatment. Use alternative package","https://github.com/node-fetch/node-fetch/issues/1167"),Ya=(n,e)=>n===null?null:typeof n=="string"?"text/plain;charset=UTF-8":nf(n)?"application/x-www-form-urlencoded;charset=UTF-8":ss(n)?n.type||null:Rt.Buffer.isBuffer(n)||Qn.types.isAnyArrayBuffer(n)||ArrayBuffer.isView(n)?null:n instanceof Tr?`multipart/form-data; boundary=${e[Tt].boundary}`:n&&typeof n.getBoundary=="function"?`multipart/form-data;boundary=${db(n)}`:n instanceof Jt.default?null:"text/plain;charset=UTF-8",Sy=n=>{let{body:e}=n[Tt];return e===null?0:ss(e)?e.size:Rt.Buffer.isBuffer(e)?e.length:e&&typeof e.getLengthSync=="function"&&e.hasKnownLength&&e.hasKnownLength()?e.getLengthSync():null},Ty=async(n,{body:e})=>{e===null?n.end():await fb(e,n)}});function vy(n=[]){return new vt(n.reduce((e,t,r,i)=>(r%2===0&&e.push(i.slice(r,r+2)),e),[]).filter(([e,t])=>{try{return Qa(e),cf(e,String(t)),!0}catch(r){return!1}}))}var uf,ls,Qa,cf,vt,Za=Je(()=>{uf=require("node:util"),ls=Le(require("node:http"),1),Qa=typeof ls.default.validateHeaderName=="function"?ls.default.validateHeaderName:n=>{if(!/^[\^`\-\w!#$%&'*+.|~]+$/.test(n)){let e=new TypeError(`Header name must be a valid HTTP token [${n}]`);throw Object.defineProperty(e,"code",{value:"ERR_INVALID_HTTP_TOKEN"}),e}},cf=typeof ls.default.validateHeaderValue=="function"?ls.default.validateHeaderValue:(n,e)=>{if(/[^\t\u0020-\u007E\u0080-\u00FF]/.test(e)){let t=new TypeError(`Invalid character in header content ["${n}"]`);throw Object.defineProperty(t,"code",{value:"ERR_INVALID_CHAR"}),t}},vt=class n extends URLSearchParams{constructor(e){let t=[];if(e instanceof n){let r=e.raw();for(let[i,o]of Object.entries(r))t.push(...o.map(s=>[i,s]))}else if(e!=null)if(typeof e=="object"&&!uf.types.isBoxedPrimitive(e)){let r=e[Symbol.iterator];if(r==null)t.push(...Object.entries(e));else{if(typeof r!="function")throw new TypeError("Header pairs must be iterable");t=[...e].map(i=>{if(typeof i!="object"||uf.types.isBoxedPrimitive(i))throw new TypeError("Each header pair must be an iterable object");return[...i]}).map(i=>{if(i.length!==2)throw new TypeError("Each header pair must be a name/value tuple");return[...i]})}}else throw new TypeError("Failed to construct 'Headers': The provided value is not of type '(sequence<sequence<ByteString>> or record<ByteString, ByteString>)");return t=t.length>0?t.map(([r,i])=>(Qa(r),cf(r,String(i)),[String(r).toLowerCase(),String(i)])):void 0,super(t),new Proxy(this,{get(r,i,o){switch(i){case"append":case"set":return(s,u)=>(Qa(s),cf(s,String(u)),URLSearchParams.prototype[i].call(r,String(s).toLowerCase(),String(u)));case"delete":case"has":case"getAll":return s=>(Qa(s),URLSearchParams.prototype[i].call(r,String(s).toLowerCase()));case"keys":return()=>(r.sort(),new Set(URLSearchParams.prototype.keys.call(r)).keys());default:return Reflect.get(r,i,o)}}})}get[Symbol.toStringTag](){return this.constructor.name}toString(){return Object.prototype.toString.call(this)}get(e){let t=this.getAll(e);if(t.length===0)return null;let r=t.join(", ");return/^content-encoding$/i.test(e)&&(r=r.toLowerCase()),r}forEach(e,t=void 0){for(let r of this.keys())Reflect.apply(e,t,[this.get(r),r,this])}*values(){for(let e of this.keys())yield this.get(e)}*entries(){for(let e of this.keys())yield[e,this.get(e)]}[Symbol.iterator](){return this.entries()}raw(){return[...this.keys()].reduce((e,t)=>(e[t]=this.getAll(t),e),{})}[Symbol.for("nodejs.util.inspect.custom")](){return[...this.keys()].reduce((e,t)=>{let r=this.getAll(t);return t==="host"?e[t]=r[0]:e[t]=r.length>1?r:r[0],e},{})}};Object.defineProperties(vt.prototype,["get","entries","forEach","values"].reduce((n,e)=>(n[e]={enumerable:!0},n),{}))});var hb,us,ff=Je(()=>{hb=new Set([301,302,303,307,308]),us=n=>hb.has(n)});var un,It,wy=Je(()=>{Za();Xa();ff();un=Symbol("Response internals"),It=class n extends Rn{constructor(e=null,t={}){super(e,t);let r=t.status!=null?t.status:200,i=new vt(t.headers);if(e!==null&&!i.has("Content-Type")){let o=Ya(e,this);o&&i.append("Content-Type",o)}this[un]={type:"default",url:t.url,status:r,statusText:t.statusText||"",headers:i,counter:t.counter,highWaterMark:t.highWaterMark}}get type(){return this[un].type}get url(){return this[un].url||""}get status(){return this[un].status}get ok(){return this[un].status>=200&&this[un].status<300}get redirected(){return this[un].counter>0}get statusText(){return this[un].statusText}get headers(){return this[un].headers}get highWaterMark(){return this[un].highWaterMark}clone(){return new n(Ji(this,this.highWaterMark),{type:this.type,url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected,size:this.size,highWaterMark:this.highWaterMark})}static redirect(e,t=302){if(!us(t))throw new RangeError('Failed to execute "redirect" on "response": Invalid status code');return new n(null,{headers:{location:new URL(e).toString()},status:t})}static error(){let e=new n(null,{status:0,statusText:""});return e[un].type="error",e}static json(e=void 0,t={}){let r=JSON.stringify(e);if(r===void 0)throw new TypeError("data is not JSON serializable");let i=new vt(t&&t.headers);return i.has("content-type")||i.set("content-type","application/json"),new n(r,{...t,headers:i})}get[Symbol.toStringTag](){return"Response"}};Object.defineProperties(It.prototype,{type:{enumerable:!0},url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}})});var Cy,Ay=Je(()=>{Cy=n=>{if(n.search)return n.search;let e=n.href.length-1,t=n.hash||(n.href[e]==="#"?"#":"");return n.href[e-t.length]==="?"?"?":""}});function by(n,e=!1){return n==null||(n=new URL(n),/^(about|blob|data):$/.test(n.protocol))?"no-referrer":(n.username="",n.password="",n.hash="",e&&(n.pathname="",n.search=""),n)}function xy(n){if(!Iy.has(n))throw new TypeError(`Invalid referrerPolicy: ${n}`);return n}function pb(n){if(/^(http|ws)s:$/.test(n.protocol))return!0;let e=n.host.replace(/(^\[)|(]$)/g,""),t=(0,Ry.isIP)(e);return t===4&&/^127\./.test(e)||t===6&&/^(((0+:){7})|(::(0+:){0,6}))0*1$/.test(e)?!0:n.host==="localhost"||n.host.endsWith(".localhost")?!1:n.protocol==="file:"}function Ki(n){return/^about:(blank|srcdoc)$/.test(n)||n.protocol==="data:"||/^(blob|filesystem):$/.test(n.protocol)?!0:pb(n)}function Ny(n,{referrerURLCallback:e,referrerOriginCallback:t}={}){if(n.referrer==="no-referrer"||n.referrerPolicy==="")return null;let r=n.referrerPolicy;if(n.referrer==="about:client")return"no-referrer";let i=n.referrer,o=by(i),s=by(i,!0);o.toString().length>4096&&(o=s),e&&(o=e(o)),t&&(s=t(s));let u=new URL(n.url);switch(r){case"no-referrer":return"no-referrer";case"origin":return s;case"unsafe-url":return o;case"strict-origin":return Ki(o)&&!Ki(u)?"no-referrer":s.toString();case"strict-origin-when-cross-origin":return o.origin===u.origin?o:Ki(o)&&!Ki(u)?"no-referrer":s;case"same-origin":return o.origin===u.origin?o:"no-referrer";case"origin-when-cross-origin":return o.origin===u.origin?o:s;case"no-referrer-when-downgrade":return Ki(o)&&!Ki(u)?"no-referrer":o;default:throw new TypeError(`Invalid referrerPolicy: ${r}`)}}function ky(n){let e=(n.get("referrer-policy")||"").split(/[,\s]+/),t="";for(let r of e)r&&Iy.has(r)&&(t=r);return t}var Ry,Iy,Py,df=Je(()=>{Ry=require("node:net");Iy=new Set(["","no-referrer","no-referrer-when-downgrade","same-origin","origin","strict-origin","origin-when-cross-origin","strict-origin-when-cross-origin","unsafe-url"]),Py="strict-origin-when-cross-origin"});var My,Dy,Xe,cs,mb,wr,Oy,Uy=Je(()=>{My=require("node:url"),Dy=require("node:util");Za();Xa();Wa();Ay();df();Xe=Symbol("Request internals"),cs=n=>typeof n=="object"&&typeof n[Xe]=="object",mb=(0,Dy.deprecate)(()=>{},".data is not a valid RequestInit property, use .body instead","https://github.com/node-fetch/node-fetch/issues/1000 (request)"),wr=class n extends Rn{constructor(e,t={}){let r;if(cs(e)?r=new URL(e.url):(r=new URL(e),e={}),r.username!==""||r.password!=="")throw new TypeError(`${r} is an url with embedded credentials.`);let i=t.method||e.method||"GET";if(/^(delete|get|head|options|post|put)$/i.test(i)&&(i=i.toUpperCase()),!cs(t)&&"data"in t&&mb(),(t.body!=null||cs(e)&&e.body!==null)&&(i==="GET"||i==="HEAD"))throw new TypeError("Request with GET/HEAD method cannot have body");let o=t.body?t.body:cs(e)&&e.body!==null?Ji(e):null;super(o,{size:t.size||e.size||0});let s=new vt(t.headers||e.headers||{});if(o!==null&&!s.has("Content-Type")){let d=Ya(o,this);d&&s.set("Content-Type",d)}let u=cs(e)?e.signal:null;if("signal"in t&&(u=t.signal),u!=null&&!iy(u))throw new TypeError("Expected signal to be an instanceof AbortSignal or EventTarget");let f=t.referrer==null?e.referrer:t.referrer;if(f==="")f="no-referrer";else if(f){let d=new URL(f);f=/^about:(\/\/)?client$/.test(d)?"client":d}else f=void 0;this[Xe]={method:i,redirect:t.redirect||e.redirect||"follow",headers:s,parsedURL:r,signal:u,referrer:f},this.follow=t.follow===void 0?e.follow===void 0?20:e.follow:t.follow,this.compress=t.compress===void 0?e.compress===void 0?!0:e.compress:t.compress,this.counter=t.counter||e.counter||0,this.agent=t.agent||e.agent,this.highWaterMark=t.highWaterMark||e.highWaterMark||16384,this.insecureHTTPParser=t.insecureHTTPParser||e.insecureHTTPParser||!1,this.referrerPolicy=t.referrerPolicy||e.referrerPolicy||""}get method(){return this[Xe].method}get url(){return(0,My.format)(this[Xe].parsedURL)}get headers(){return this[Xe].headers}get redirect(){return this[Xe].redirect}get signal(){return this[Xe].signal}get referrer(){if(this[Xe].referrer==="no-referrer")return"";if(this[Xe].referrer==="client")return"about:client";if(this[Xe].referrer)return this[Xe].referrer.toString()}get referrerPolicy(){return this[Xe].referrerPolicy}set referrerPolicy(e){this[Xe].referrerPolicy=xy(e)}clone(){return new n(this)}get[Symbol.toStringTag](){return"Request"}};Object.defineProperties(wr.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0},referrer:{enumerable:!0},referrerPolicy:{enumerable:!0}});Oy=n=>{let{parsedURL:e}=n[Xe],t=new vt(n[Xe].headers);t.has("Accept")||t.set("Accept","*/*");let r=null;if(n.body===null&&/^(post|put)$/i.test(n.method)&&(r="0"),n.body!==null){let u=Sy(n);typeof u=="number"&&!Number.isNaN(u)&&(r=String(u))}r&&t.set("Content-Length",r),n.referrerPolicy===""&&(n.referrerPolicy=Py),n.referrer&&n.referrer!=="no-referrer"?n[Xe].referrer=Ny(n):n[Xe].referrer="no-referrer",n[Xe].referrer instanceof URL&&t.set("Referer",n.referrer),t.has("User-Agent")||t.set("User-Agent","node-fetch"),n.compress&&!t.has("Accept-Encoding")&&t.set("Accept-Encoding","gzip, deflate, br");let{agent:i}=n;typeof i=="function"&&(i=i(e));let o=Cy(e),s={path:e.pathname+o,method:n.method,headers:t[Symbol.for("nodejs.util.inspect.custom")](),insecureHTTPParser:n.insecureHTTPParser,agent:i};return{parsedURL:e,options:s}}});var fs,Fy=Je(()=>{Va();fs=class extends Xn{constructor(e,t="aborted"){super(e,t)}}});var By={};mc(By,{AbortError:()=>fs,Blob:()=>ln,FetchError:()=>ht,File:()=>Sr,FormData:()=>Tr,Headers:()=>vt,Request:()=>wr,Response:()=>It,blobFrom:()=>dy,blobFromSync:()=>fy,default:()=>hf,fileFrom:()=>hy,fileFromSync:()=>py,isRedirect:()=>us});async function hf(n,e){return new Promise((t,r)=>{let i=new wr(n,e),{parsedURL:o,options:s}=Oy(i);if(!gb.has(o.protocol))throw new TypeError(`node-fetch cannot load ${n}. URL scheme "${o.protocol.replace(/:$/,"")}" is not supported.`);if(o.protocol==="data:"){let v=zg(i.url),C=new It(v,{headers:{"Content-Type":v.typeFull}});t(C);return}let u=(o.protocol==="https:"?qy.default:Ly.default).request,{signal:f}=i,d=null,h=()=>{let v=new fs("The operation was aborted.");r(v),i.body&&i.body instanceof Pt.default.Readable&&i.body.destroy(v),!(!d||!d.body)&&d.body.emit("error",v)};if(f&&f.aborted){h();return}let m=()=>{h(),_()},g=u(o.toString(),s);f&&f.addEventListener("abort",m);let _=()=>{g.abort(),f&&f.removeEventListener("abort",m)};g.on("error",v=>{r(new ht(`request to ${i.url} failed, reason: ${v.message}`,"system",v)),_()}),yb(g,v=>{d&&d.body&&d.body.destroy(v)}),process.version<"v14"&&g.on("socket",v=>{let C;v.prependListener("end",()=>{C=v._eventsCount}),v.prependListener("close",R=>{if(d&&C<v._eventsCount&&!R){let I=new Error("Premature close");I.code="ERR_STREAM_PREMATURE_CLOSE",d.body.emit("error",I)}})}),g.on("response",v=>{g.setTimeout(0);let C=vy(v.rawHeaders);if(us(v.statusCode)){let W=C.get("Location"),H=null;try{H=W===null?null:new URL(W,i.url)}catch(G){if(i.redirect!=="manual"){r(new ht(`uri requested responds with an invalid redirect URL: ${W}`,"invalid-redirect")),_();return}}switch(i.redirect){case"error":r(new ht(`uri requested responds with a redirect, redirect mode is set to error: ${i.url}`,"no-redirect")),_();return;case"manual":break;case"follow":{if(H===null)break;if(i.counter>=i.follow){r(new ht(`maximum redirect reached at: ${i.url}`,"max-redirect")),_();return}let G={headers:new vt(i.headers),follow:i.follow,counter:i.counter+1,agent:i.agent,compress:i.compress,method:i.method,body:Ji(i),signal:i.signal,size:i.size,referrer:i.referrer,referrerPolicy:i.referrerPolicy};if(!oy(i.url,H)||!sy(i.url,H))for(let te of["authorization","www-authenticate","cookie","cookie2"])G.headers.delete(te);if(v.statusCode!==303&&i.body&&e.body instanceof Pt.default.Readable){r(new ht("Cannot follow redirect with body being a readable stream","unsupported-redirect")),_();return}(v.statusCode===303||(v.statusCode===301||v.statusCode===302)&&i.method==="POST")&&(G.method="GET",G.body=void 0,G.headers.delete("content-length"));let K=ky(C);K&&(G.referrerPolicy=K),t(hf(new wr(H,G))),_();return}default:return r(new TypeError(`Redirect option '${i.redirect}' is not a valid value of RequestRedirect`))}}f&&v.once("end",()=>{f.removeEventListener("abort",m)});let R=(0,Pt.pipeline)(v,new Pt.PassThrough,W=>{W&&r(W)});process.version<"v12.10"&&v.on("aborted",m);let I={url:i.url,status:v.statusCode,statusText:v.statusMessage,headers:C,size:i.size,counter:i.counter,highWaterMark:i.highWaterMark},z=C.get("Content-Encoding");if(!i.compress||i.method==="HEAD"||z===null||v.statusCode===204||v.statusCode===304){d=new It(R,I),t(d);return}let $={flush:Zr.default.Z_SYNC_FLUSH,finishFlush:Zr.default.Z_SYNC_FLUSH};if(z==="gzip"||z==="x-gzip"){R=(0,Pt.pipeline)(R,Zr.default.createGunzip($),W=>{W&&r(W)}),d=new It(R,I),t(d);return}if(z==="deflate"||z==="x-deflate"){let W=(0,Pt.pipeline)(v,new Pt.PassThrough,H=>{H&&r(H)});W.once("data",H=>{(H[0]&15)===8?R=(0,Pt.pipeline)(R,Zr.default.createInflate(),G=>{G&&r(G)}):R=(0,Pt.pipeline)(R,Zr.default.createInflateRaw(),G=>{G&&r(G)}),d=new It(R,I),t(d)}),W.once("end",()=>{d||(d=new It(R,I),t(d))});return}if(z==="br"){R=(0,Pt.pipeline)(R,Zr.default.createBrotliDecompress(),W=>{W&&r(W)}),d=new It(R,I),t(d);return}d=new It(R,I),t(d)}),Ty(g,i).catch(r)})}function yb(n,e){let t=ds.Buffer.from(`0\r
\r
`),r=!1,i=!1,o;n.on("response",s=>{let{headers:u}=s;r=u["transfer-encoding"]==="chunked"&&!u["content-length"]}),n.on("socket",s=>{let u=()=>{if(r&&!i){let d=new Error("Premature close");d.code="ERR_STREAM_PREMATURE_CLOSE",e(d)}},f=d=>{i=ds.Buffer.compare(d.slice(-5),t)===0,!i&&o&&(i=ds.Buffer.compare(o.slice(-3),t.slice(0,3))===0&&ds.Buffer.compare(d.slice(-2),t.slice(3))===0),o=d};s.prependListener("close",u),s.on("data",f),n.on("close",()=>{s.removeListener("close",u),s.removeListener("data",f)})})}var Ly,qy,Zr,Pt,ds,gb,Gy=Je(()=>{Ly=Le(require("node:http"),1),qy=Le(require("node:https"),1),Zr=Le(require("node:zlib"),1),Pt=Le(require("node:stream"),1),ds=require("node:buffer");Jg();Xa();wy();Za();Uy();tf();Fy();ff();Ha();Wa();df();sf();gb=new Set(["data:","http:","https:"])});var Xy=Y(Xi=>{"use strict";var _b=Xi&&Xi.__importDefault||function(n){return n&&n.__esModule?n:{default:n}},Yi;Object.defineProperty(Xi,"__esModule",{value:!0});Xi.Gaxios=void 0;var Eb=_b(qc()),Sb=require("https"),jr=Hc(),Tb=Sg(),Hy=require("stream"),Vy=Wc(),vb=async()=>{var n;return((n=globalThis.crypto)==null?void 0:n.randomUUID())||(await import("crypto")).randomUUID()},wb=204,xt,$y,Wy,zy,Jy,pf,hs,ps,Qi,Ky,Yy,ei=class{constructor(e){se(this,xt);x(this,"agentCache",new Map);x(this,"defaults");x(this,"interceptors");this.defaults=e||{},this.interceptors={request:new Vy.GaxiosInterceptorManager,response:new Vy.GaxiosInterceptorManager}}fetch(...e){let t=e[0],r=e[1],i,o=new Headers;return typeof t=="string"?i=new URL(t):t instanceof URL?i=t:t&&t.url&&(i=new URL(t.url)),t&&typeof t=="object"&&"headers"in t&&Yi.mergeHeaders(o,t.headers),r&&Yi.mergeHeaders(o,new Headers(r.headers)),typeof t=="object"&&!(t instanceof URL)?this.request({...r,...t,headers:o,url:i}):this.request({...r,headers:o,url:i})}async request(e={}){let t=await oe(this,xt,Jy).call(this,e);return t=await oe(this,xt,Wy).call(this,t),oe(this,xt,zy).call(this,this._request(t))}async _defaultAdapter(e){var s,u;let t=e.fetchImplementation||this.defaults.fetchImplementation||await oe(s=Yi,Qi,Yy).call(s),r={...e};delete r.data;let i=await t(e.url,r),o=await this.getResponseData(e,i);return(u=Object.getOwnPropertyDescriptor(i,"data"))!=null&&u.configurable||Object.defineProperties(i,{data:{configurable:!0,writable:!0,enumerable:!0,value:o}}),Object.assign(i,{config:e,data:o})}async _request(e){var t;try{let r;if(e.adapter?r=await e.adapter(e,this._defaultAdapter.bind(this)):r=await this._defaultAdapter(e),!e.validateStatus(r.status)){if(e.responseType==="stream"){let o=[];for await(let s of r.data)o.push(s);r.data=o.toString()}let i=jr.GaxiosError.extractAPIErrorFromResponse(r,`Request failed with status code ${r.status}`);throw new jr.GaxiosError(i==null?void 0:i.message,e,r,i)}return r}catch(r){let i;r instanceof jr.GaxiosError?i=r:r instanceof Error?i=new jr.GaxiosError(r.message,e,void 0,r):i=new jr.GaxiosError("Unexpected Gaxios Error",e,void 0,r);let{shouldRetry:o,config:s}=await(0,Tb.getRetryConfig)(i);if(o&&s)return i.config.retryConfig.currentRetryAttempt=s.retryConfig.currentRetryAttempt,e.retryConfig=(t=i.config)==null?void 0:t.retryConfig,oe(this,xt,pf).call(this,e),this._request(e);throw e.errorRedactor&&e.errorRedactor(i),i}}async getResponseData(e,t){var r;if(t.status===wb)return"";if(e.maxContentLength&&t.headers.has("content-length")&&e.maxContentLength<Number.parseInt(((r=t.headers)==null?void 0:r.get("content-length"))||""))throw new jr.GaxiosError("Response's `Content-Length` is over the limit.",e,Object.assign(t,{config:e}));switch(e.responseType){case"stream":return t.body;case"json":{let i=await t.text();try{return JSON.parse(i)}catch(o){return i}}case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"text":return t.text();default:return this.getResponseDataFromContentType(t)}}validateStatus(e){return e>=200&&e<300}async getResponseDataFromContentType(e){let t=e.headers.get("Content-Type");if(t===null)return e.text();if(t=t.toLowerCase(),t.includes("application/json")){let r=await e.text();try{r=JSON.parse(r)}catch(i){}return r}else return t.match(/^text\//)?e.text():e.blob()}async*getMultipartRequest(e,t){let r=`--${t}--`;for(let i of e){let o=i.headers.get("Content-Type")||"application/octet-stream";yield`--${t}\r
Content-Type: ${o}\r
\r
`,typeof i.content=="string"?yield i.content:yield*i.content,yield`\r
`}yield r}static mergeHeaders(e,...t){e=e instanceof Headers?e:new Headers(e);for(let r of t)(r instanceof Headers?r:new Headers(r)).forEach((o,s)=>{s==="set-cookie"?e.append(s,o):e.set(s,o)});return e}};xt=new WeakSet,$y=function(e,t=[]){var s,u;let r=new URL(e),i=[...t],o=((u=(s=process.env.NO_PROXY)!=null?s:process.env.no_proxy)==null?void 0:u.split(","))||[];for(let f of o)i.push(f.trim());for(let f of i)if(f instanceof RegExp){if(f.test(r.toString()))return!1}else if(f instanceof URL){if(f.origin===r.origin)return!1}else if(f.startsWith("*.")||f.startsWith(".")){let d=f.replace(/^\*\./,".");if(r.hostname.endsWith(d))return!1}else if(f===r.origin||f===r.hostname||f===r.href)return!1;return!0},Wy=async function(e){let t=Promise.resolve(e);for(let r of this.interceptors.request.values())r&&(t=t.then(r.resolved,r.rejected));return t},zy=async function(e){let t=Promise.resolve(e);for(let r of this.interceptors.response.values())r&&(t=t.then(r.resolved,r.rejected));return t},Jy=async function(e){var s,u,f,d,h,m,g,_;let t=new Headers(this.defaults.headers);Yi.mergeHeaders(t,e.headers);let r=(0,Eb.default)(!0,{},this.defaults,e);if(!r.url)throw new Error("URL is required.");if(r.baseURL&&(r.url=new URL(r.url,r.baseURL)),r.url=new URL(r.url),r.params)if(r.paramsSerializer){let v=r.paramsSerializer(r.params);v.startsWith("?")&&(v=v.slice(1));let C=r.url.toString().includes("?")?"&":"?";r.url=r.url+C+v}else{let v=r.url instanceof URL?r.url:new URL(r.url);for(let[C,R]of new URLSearchParams(r.params))v.searchParams.append(C,R);r.url=v}typeof e.maxContentLength=="number"&&(r.size=e.maxContentLength),typeof e.maxRedirects=="number"&&(r.follow=e.maxRedirects);let i=typeof r.data=="string"||r.data instanceof ArrayBuffer||r.data instanceof Blob||globalThis.File&&r.data instanceof File||r.data instanceof FormData||r.data instanceof Hy.Readable||r.data instanceof ReadableStream||r.data instanceof String||r.data instanceof URLSearchParams||ArrayBuffer.isView(r.data)||["Blob","File","FormData"].includes(((u=(s=r.data)==null?void 0:s.constructor)==null?void 0:u.name)||"");if((f=r.multipart)!=null&&f.length){let v=await vb();t.set("content-type",`multipart/related; boundary=${v}`),r.body=Hy.Readable.from(this.getMultipartRequest(r.multipart,v))}else i?r.body=r.data:typeof r.data=="object"?t.get("Content-Type")==="application/x-www-form-urlencoded"?r.body=r.paramsSerializer?r.paramsSerializer(r.data):new URLSearchParams(r.data):(t.has("content-type")||t.set("content-type","application/json"),r.body=JSON.stringify(r.data)):r.data&&(r.body=r.data);r.validateStatus=r.validateStatus||this.validateStatus,r.responseType=r.responseType||"unknown",!t.has("accept")&&r.responseType==="json"&&t.set("accept","application/json");let o=r.proxy||((d=process==null?void 0:process.env)==null?void 0:d.HTTPS_PROXY)||((h=process==null?void 0:process.env)==null?void 0:h.https_proxy)||((m=process==null?void 0:process.env)==null?void 0:m.HTTP_PROXY)||((g=process==null?void 0:process.env)==null?void 0:g.http_proxy);if(!r.agent)if(o&&oe(this,xt,$y).call(this,r.url,r.noProxy)){let v=await oe(_=Yi,Qi,Ky).call(_);this.agentCache.has(o)?r.agent=this.agentCache.get(o):(r.agent=new v(o,{cert:r.cert,key:r.key}),this.agentCache.set(o,r.agent))}else r.cert&&r.key&&(this.agentCache.has(r.key)?r.agent=this.agentCache.get(r.key):(r.agent=new Sb.Agent({cert:r.cert,key:r.key}),this.agentCache.set(r.key,r.agent)));return typeof r.errorRedactor!="function"&&r.errorRedactor!==!1&&(r.errorRedactor=jr.defaultErrorRedactor),r.body&&!("duplex"in r)&&(r.duplex="half"),oe(this,xt,pf).call(this,r),Object.assign(r,{headers:t,url:r.url instanceof URL?r.url:new URL(r.url)})},pf=function(e){if(e.timeout){let t=AbortSignal.timeout(e.timeout);e.signal&&!e.signal.aborted?e.signal=AbortSignal.any([e.signal,t]):e.signal=t}},hs=new WeakMap,ps=new WeakMap,Qi=new WeakSet,Ky=async function(){return D(this,hs)||ce(this,hs,(await Promise.resolve().then(()=>Le(Wg()))).HttpsProxyAgent),D(this,hs)},Yy=async function(){let e=typeof window!="undefined"&&!!window;return D(this,ps)||ce(this,ps,e?window.fetch:(await Promise.resolve().then(()=>(Gy(),By))).default),D(this,ps)},se(ei,Qi),se(ei,hs),se(ei,ps);Xi.Gaxios=ei;Yi=ei});var Ze=Y(pt=>{"use strict";var Cb=pt&&pt.__createBinding||(Object.create?(function(n,e,t,r){r===void 0&&(r=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,i)}):(function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]})),Ab=pt&&pt.__exportStar||function(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&Cb(e,n,t)};Object.defineProperty(pt,"__esModule",{value:!0});pt.instance=pt.Gaxios=pt.GaxiosError=void 0;pt.request=Rb;var Qy=Xy();Object.defineProperty(pt,"Gaxios",{enumerable:!0,get:function(){return Qy.Gaxios}});var bb=Hc();Object.defineProperty(pt,"GaxiosError",{enumerable:!0,get:function(){return bb.GaxiosError}});Ab(Wc(),pt);pt.instance=new Qy.Gaxios;async function Rb(n){return pt.instance.request(n)}});var mf=Y((Zy,ja)=>{(function(n){"use strict";var e,t=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,r=Math.ceil,i=Math.floor,o="[BigNumber Error] ",s=o+"Number primitive has more than 15 significant digits: ",u=1e14,f=14,d=9007199254740991,h=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],m=1e7,g=1e9;function _(H){var G,K,te,T=Q.prototype={constructor:Q,toString:null,valueOf:null},L=new Q(1),X=20,ee=4,Z=-7,j=21,we=-1e7,_e=1e7,Re=!1,Ae=1,Fe=0,Ei={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"\xA0",suffix:""},Sn="0123456789abcdefghijklmnopqrstuvwxyz",Oo=!0;function Q(E,w){var A,U,N,M,B,P,k,F,O=this;if(!(O instanceof Q))return new Q(E,w);if(w==null){if(E&&E._isBigNumber===!0){O.s=E.s,!E.c||E.e>_e?O.c=O.e=null:E.e<we?O.c=[O.e=0]:(O.e=E.e,O.c=E.c.slice());return}if((P=typeof E=="number")&&E*0==0){if(O.s=1/E<0?(E=-E,-1):1,E===~~E){for(M=0,B=E;B>=10;B/=10,M++);M>_e?O.c=O.e=null:(O.e=M,O.c=[E]);return}F=String(E)}else{if(!t.test(F=String(E)))return te(O,F,P);O.s=F.charCodeAt(0)==45?(F=F.slice(1),-1):1}(M=F.indexOf("."))>-1&&(F=F.replace(".","")),(B=F.search(/e/i))>0?(M<0&&(M=B),M+=+F.slice(B+1),F=F.substring(0,B)):M<0&&(M=F.length)}else{if(I(w,2,Sn.length,"Base"),w==10&&Oo)return O=new Q(E),lt(O,X+O.e+1,ee);if(F=String(E),P=typeof E=="number"){if(E*0!=0)return te(O,F,P,w);if(O.s=1/E<0?(F=F.slice(1),-1):1,Q.DEBUG&&F.replace(/^0\.0*|\./,"").length>15)throw Error(s+E)}else O.s=F.charCodeAt(0)===45?(F=F.slice(1),-1):1;for(A=Sn.slice(0,w),M=B=0,k=F.length;B<k;B++)if(A.indexOf(U=F.charAt(B))<0){if(U=="."){if(B>M){M=k;continue}}else if(!N&&(F==F.toUpperCase()&&(F=F.toLowerCase())||F==F.toLowerCase()&&(F=F.toUpperCase()))){N=!0,B=-1,M=0;continue}return te(O,String(E),P,w)}P=!1,F=K(F,w,10,O.s),(M=F.indexOf("."))>-1?F=F.replace(".",""):M=F.length}for(B=0;F.charCodeAt(B)===48;B++);for(k=F.length;F.charCodeAt(--k)===48;);if(F=F.slice(B,++k)){if(k-=B,P&&Q.DEBUG&&k>15&&(E>d||E!==i(E)))throw Error(s+O.s*E);if((M=M-B-1)>_e)O.c=O.e=null;else if(M<we)O.c=[O.e=0];else{if(O.e=M,O.c=[],B=(M+1)%f,M<0&&(B+=f),B<k){for(B&&O.c.push(+F.slice(0,B)),k-=f;B<k;)O.c.push(+F.slice(B,B+=f));B=f-(F=F.slice(B)).length}else B-=k;for(;B--;F+="0");O.c.push(+F)}}else O.c=[O.e=0]}Q.clone=_,Q.ROUND_UP=0,Q.ROUND_DOWN=1,Q.ROUND_CEIL=2,Q.ROUND_FLOOR=3,Q.ROUND_HALF_UP=4,Q.ROUND_HALF_DOWN=5,Q.ROUND_HALF_EVEN=6,Q.ROUND_HALF_CEIL=7,Q.ROUND_HALF_FLOOR=8,Q.EUCLID=9,Q.config=Q.set=function(E){var w,A;if(E!=null)if(typeof E=="object"){if(E.hasOwnProperty(w="DECIMAL_PLACES")&&(A=E[w],I(A,0,g,w),X=A),E.hasOwnProperty(w="ROUNDING_MODE")&&(A=E[w],I(A,0,8,w),ee=A),E.hasOwnProperty(w="EXPONENTIAL_AT")&&(A=E[w],A&&A.pop?(I(A[0],-g,0,w),I(A[1],0,g,w),Z=A[0],j=A[1]):(I(A,-g,g,w),Z=-(j=A<0?-A:A))),E.hasOwnProperty(w="RANGE"))if(A=E[w],A&&A.pop)I(A[0],-g,-1,w),I(A[1],1,g,w),we=A[0],_e=A[1];else if(I(A,-g,g,w),A)we=-(_e=A<0?-A:A);else throw Error(o+w+" cannot be zero: "+A);if(E.hasOwnProperty(w="CRYPTO"))if(A=E[w],A===!!A)if(A)if(typeof crypto!="undefined"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))Re=A;else throw Re=!A,Error(o+"crypto unavailable");else Re=A;else throw Error(o+w+" not true or false: "+A);if(E.hasOwnProperty(w="MODULO_MODE")&&(A=E[w],I(A,0,9,w),Ae=A),E.hasOwnProperty(w="POW_PRECISION")&&(A=E[w],I(A,0,g,w),Fe=A),E.hasOwnProperty(w="FORMAT"))if(A=E[w],typeof A=="object")Ei=A;else throw Error(o+w+" not an object: "+A);if(E.hasOwnProperty(w="ALPHABET"))if(A=E[w],typeof A=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(A))Oo=A.slice(0,10)=="0123456789",Sn=A;else throw Error(o+w+" invalid: "+A)}else throw Error(o+"Object expected: "+E);return{DECIMAL_PLACES:X,ROUNDING_MODE:ee,EXPONENTIAL_AT:[Z,j],RANGE:[we,_e],CRYPTO:Re,MODULO_MODE:Ae,POW_PRECISION:Fe,FORMAT:Ei,ALPHABET:Sn}},Q.isBigNumber=function(E){if(!E||E._isBigNumber!==!0)return!1;if(!Q.DEBUG)return!0;var w,A,U=E.c,N=E.e,M=E.s;e:if({}.toString.call(U)=="[object Array]"){if((M===1||M===-1)&&N>=-g&&N<=g&&N===i(N)){if(U[0]===0){if(N===0&&U.length===1)return!0;break e}if(w=(N+1)%f,w<1&&(w+=f),String(U[0]).length==w){for(w=0;w<U.length;w++)if(A=U[w],A<0||A>=u||A!==i(A))break e;if(A!==0)return!0}}}else if(U===null&&N===null&&(M===null||M===1||M===-1))return!0;throw Error(o+"Invalid BigNumber: "+E)},Q.maximum=Q.max=function(){return at(arguments,-1)},Q.minimum=Q.min=function(){return at(arguments,1)},Q.random=(function(){var E=9007199254740992,w=Math.random()*E&2097151?function(){return i(Math.random()*E)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(A){var U,N,M,B,P,k=0,F=[],O=new Q(L);if(A==null?A=X:I(A,0,g),B=r(A/f),Re)if(crypto.getRandomValues){for(U=crypto.getRandomValues(new Uint32Array(B*=2));k<B;)P=U[k]*131072+(U[k+1]>>>11),P>=9e15?(N=crypto.getRandomValues(new Uint32Array(2)),U[k]=N[0],U[k+1]=N[1]):(F.push(P%1e14),k+=2);k=B/2}else if(crypto.randomBytes){for(U=crypto.randomBytes(B*=7);k<B;)P=(U[k]&31)*281474976710656+U[k+1]*1099511627776+U[k+2]*4294967296+U[k+3]*16777216+(U[k+4]<<16)+(U[k+5]<<8)+U[k+6],P>=9e15?crypto.randomBytes(7).copy(U,k):(F.push(P%1e14),k+=7);k=B/7}else throw Re=!1,Error(o+"crypto unavailable");if(!Re)for(;k<B;)P=w(),P<9e15&&(F[k++]=P%1e14);for(B=F[--k],A%=f,B&&A&&(P=h[f-A],F[k]=i(B/P)*P);F[k]===0;F.pop(),k--);if(k<0)F=[M=0];else{for(M=-1;F[0]===0;F.splice(0,1),M-=f);for(k=1,P=F[0];P>=10;P/=10,k++);k<f&&(M-=f-k)}return O.e=M,O.c=F,O}})(),Q.sum=function(){for(var E=1,w=arguments,A=new Q(w[0]);E<w.length;)A=A.plus(w[E++]);return A},K=(function(){var E="0123456789";function w(A,U,N,M){for(var B,P=[0],k,F=0,O=A.length;F<O;){for(k=P.length;k--;P[k]*=U);for(P[0]+=M.indexOf(A.charAt(F++)),B=0;B<P.length;B++)P[B]>N-1&&(P[B+1]==null&&(P[B+1]=0),P[B+1]+=P[B]/N|0,P[B]%=N)}return P.reverse()}return function(A,U,N,M,B){var P,k,F,O,J,ie,le,ve,Me=A.indexOf("."),Oe=X,Te=ee;for(Me>=0&&(O=Fe,Fe=0,A=A.replace(".",""),ve=new Q(U),ie=ve.pow(A.length-Me),Fe=O,ve.c=w(W(C(ie.c),ie.e,"0"),10,N,E),ve.e=ve.c.length),le=w(A,U,N,B?(P=Sn,E):(P=E,Sn)),F=O=le.length;le[--O]==0;le.pop());if(!le[0])return P.charAt(0);if(Me<0?--F:(ie.c=le,ie.e=F,ie.s=M,ie=G(ie,ve,Oe,Te,N),le=ie.c,J=ie.r,F=ie.e),k=F+Oe+1,Me=le[k],O=N/2,J=J||k<0||le[k+1]!=null,J=Te<4?(Me!=null||J)&&(Te==0||Te==(ie.s<0?3:2)):Me>O||Me==O&&(Te==4||J||Te==6&&le[k-1]&1||Te==(ie.s<0?8:7)),k<1||!le[0])A=J?W(P.charAt(1),-Oe,P.charAt(0)):P.charAt(0);else{if(le.length=k,J)for(--N;++le[--k]>N;)le[k]=0,k||(++F,le=[1].concat(le));for(O=le.length;!le[--O];);for(Me=0,A="";Me<=O;A+=P.charAt(le[Me++]));A=W(A,F,P.charAt(0))}return A}})(),G=(function(){function E(U,N,M){var B,P,k,F,O=0,J=U.length,ie=N%m,le=N/m|0;for(U=U.slice();J--;)k=U[J]%m,F=U[J]/m|0,B=le*k+F*ie,P=ie*k+B%m*m+O,O=(P/M|0)+(B/m|0)+le*F,U[J]=P%M;return O&&(U=[O].concat(U)),U}function w(U,N,M,B){var P,k;if(M!=B)k=M>B?1:-1;else for(P=k=0;P<M;P++)if(U[P]!=N[P]){k=U[P]>N[P]?1:-1;break}return k}function A(U,N,M,B){for(var P=0;M--;)U[M]-=P,P=U[M]<N[M]?1:0,U[M]=P*B+U[M]-N[M];for(;!U[0]&&U.length>1;U.splice(0,1));}return function(U,N,M,B,P){var k,F,O,J,ie,le,ve,Me,Oe,Te,be,We,Si,Ti,vi,wt,Bn,je=U.s==N.s?1:-1,ze=U.c,Ie=N.c;if(!ze||!ze[0]||!Ie||!Ie[0])return new Q(!U.s||!N.s||(ze?Ie&&ze[0]==Ie[0]:!Ie)?NaN:ze&&ze[0]==0||!Ie?je*0:je/0);for(Me=new Q(je),Oe=Me.c=[],F=U.e-N.e,je=M+F+1,P||(P=u,F=v(U.e/f)-v(N.e/f),je=je/f|0),O=0;Ie[O]==(ze[O]||0);O++);if(Ie[O]>(ze[O]||0)&&F--,je<0)Oe.push(1),J=!0;else{for(Ti=ze.length,wt=Ie.length,O=0,je+=2,ie=i(P/(Ie[0]+1)),ie>1&&(Ie=E(Ie,ie,P),ze=E(ze,ie,P),wt=Ie.length,Ti=ze.length),Si=wt,Te=ze.slice(0,wt),be=Te.length;be<wt;Te[be++]=0);Bn=Ie.slice(),Bn=[0].concat(Bn),vi=Ie[0],Ie[1]>=P/2&&vi++;do{if(ie=0,k=w(Ie,Te,wt,be),k<0){if(We=Te[0],wt!=be&&(We=We*P+(Te[1]||0)),ie=i(We/vi),ie>1)for(ie>=P&&(ie=P-1),le=E(Ie,ie,P),ve=le.length,be=Te.length;w(le,Te,ve,be)==1;)ie--,A(le,wt<ve?Bn:Ie,ve,P),ve=le.length,k=1;else ie==0&&(k=ie=1),le=Ie.slice(),ve=le.length;if(ve<be&&(le=[0].concat(le)),A(Te,le,be,P),be=Te.length,k==-1)for(;w(Ie,Te,wt,be)<1;)ie++,A(Te,wt<be?Bn:Ie,be,P),be=Te.length}else k===0&&(ie++,Te=[0]);Oe[O++]=ie,Te[0]?Te[be++]=ze[Si]||0:(Te=[ze[Si]],be=1)}while((Si++<Ti||Te[0]!=null)&&je--);J=Te[0]!=null,Oe[0]||Oe.splice(0,1)}if(P==u){for(O=1,je=Oe[0];je>=10;je/=10,O++);lt(Me,M+(Me.e=O+F*f-1)+1,B,J)}else Me.e=F,Me.r=+J;return Me}})();function yt(E,w,A,U){var N,M,B,P,k;if(A==null?A=ee:I(A,0,8),!E.c)return E.toString();if(N=E.c[0],B=E.e,w==null)k=C(E.c),k=U==1||U==2&&(B<=Z||B>=j)?$(k,B):W(k,B,"0");else if(E=lt(new Q(E),w,A),M=E.e,k=C(E.c),P=k.length,U==1||U==2&&(w<=M||M<=Z)){for(;P<w;k+="0",P++);k=$(k,M)}else if(w-=B+(U===2&&M>B),k=W(k,M,"0"),M+1>P){if(--w>0)for(k+=".";w--;k+="0");}else if(w+=M-P,w>0)for(M+1==P&&(k+=".");w--;k+="0");return E.s<0&&N?"-"+k:k}function at(E,w){for(var A,U,N=1,M=new Q(E[0]);N<E.length;N++)U=new Q(E[N]),(!U.s||(A=R(M,U))===w||A===0&&M.s===w)&&(M=U);return M}function Uo(E,w,A){for(var U=1,N=w.length;!w[--N];w.pop());for(N=w[0];N>=10;N/=10,U++);return(A=U+A*f-1)>_e?E.c=E.e=null:A<we?E.c=[E.e=0]:(E.e=A,E.c=w),E}te=(function(){var E=/^(-?)0([xbo])(?=\w[\w.]*$)/i,w=/^([^.]+)\.$/,A=/^\.([^.]+)$/,U=/^-?(Infinity|NaN)$/,N=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(M,B,P,k){var F,O=P?B:B.replace(N,"");if(U.test(O))M.s=isNaN(O)?null:O<0?-1:1;else{if(!P&&(O=O.replace(E,function(J,ie,le){return F=(le=le.toLowerCase())=="x"?16:le=="b"?2:8,!k||k==F?ie:J}),k&&(F=k,O=O.replace(w,"$1").replace(A,"0.$1")),B!=O))return new Q(O,F);if(Q.DEBUG)throw Error(o+"Not a"+(k?" base "+k:"")+" number: "+B);M.s=null}M.c=M.e=null}})();function lt(E,w,A,U){var N,M,B,P,k,F,O,J=E.c,ie=h;if(J){e:{for(N=1,P=J[0];P>=10;P/=10,N++);if(M=w-N,M<0)M+=f,B=w,k=J[F=0],O=i(k/ie[N-B-1]%10);else if(F=r((M+1)/f),F>=J.length)if(U){for(;J.length<=F;J.push(0));k=O=0,N=1,M%=f,B=M-f+1}else break e;else{for(k=P=J[F],N=1;P>=10;P/=10,N++);M%=f,B=M-f+N,O=B<0?0:i(k/ie[N-B-1]%10)}if(U=U||w<0||J[F+1]!=null||(B<0?k:k%ie[N-B-1]),U=A<4?(O||U)&&(A==0||A==(E.s<0?3:2)):O>5||O==5&&(A==4||U||A==6&&(M>0?B>0?k/ie[N-B]:0:J[F-1])%10&1||A==(E.s<0?8:7)),w<1||!J[0])return J.length=0,U?(w-=E.e+1,J[0]=ie[(f-w%f)%f],E.e=-w||0):J[0]=E.e=0,E;if(M==0?(J.length=F,P=1,F--):(J.length=F+1,P=ie[f-M],J[F]=B>0?i(k/ie[N-B]%ie[B])*P:0),U)for(;;)if(F==0){for(M=1,B=J[0];B>=10;B/=10,M++);for(B=J[0]+=P,P=1;B>=10;B/=10,P++);M!=P&&(E.e++,J[0]==u&&(J[0]=1));break}else{if(J[F]+=P,J[F]!=u)break;J[F--]=0,P=1}for(M=J.length;J[--M]===0;J.pop());}E.e>_e?E.c=E.e=null:E.e<we&&(E.c=[E.e=0])}return E}function $e(E){var w,A=E.e;return A===null?E.toString():(w=C(E.c),w=A<=Z||A>=j?$(w,A):W(w,A,"0"),E.s<0?"-"+w:w)}return T.absoluteValue=T.abs=function(){var E=new Q(this);return E.s<0&&(E.s=1),E},T.comparedTo=function(E,w){return R(this,new Q(E,w))},T.decimalPlaces=T.dp=function(E,w){var A,U,N,M=this;if(E!=null)return I(E,0,g),w==null?w=ee:I(w,0,8),lt(new Q(M),E+M.e+1,w);if(!(A=M.c))return null;if(U=((N=A.length-1)-v(this.e/f))*f,N=A[N])for(;N%10==0;N/=10,U--);return U<0&&(U=0),U},T.dividedBy=T.div=function(E,w){return G(this,new Q(E,w),X,ee)},T.dividedToIntegerBy=T.idiv=function(E,w){return G(this,new Q(E,w),0,1)},T.exponentiatedBy=T.pow=function(E,w){var A,U,N,M,B,P,k,F,O,J=this;if(E=new Q(E),E.c&&!E.isInteger())throw Error(o+"Exponent not an integer: "+$e(E));if(w!=null&&(w=new Q(w)),P=E.e>14,!J.c||!J.c[0]||J.c[0]==1&&!J.e&&J.c.length==1||!E.c||!E.c[0])return O=new Q(Math.pow(+$e(J),P?E.s*(2-z(E)):+$e(E))),w?O.mod(w):O;if(k=E.s<0,w){if(w.c?!w.c[0]:!w.s)return new Q(NaN);U=!k&&J.isInteger()&&w.isInteger(),U&&(J=J.mod(w))}else{if(E.e>9&&(J.e>0||J.e<-1||(J.e==0?J.c[0]>1||P&&J.c[1]>=24e7:J.c[0]<8e13||P&&J.c[0]<=9999975e7)))return M=J.s<0&&z(E)?-0:0,J.e>-1&&(M=1/M),new Q(k?1/M:M);Fe&&(M=r(Fe/f+2))}for(P?(A=new Q(.5),k&&(E.s=1),F=z(E)):(N=Math.abs(+$e(E)),F=N%2),O=new Q(L);;){if(F){if(O=O.times(J),!O.c)break;M?O.c.length>M&&(O.c.length=M):U&&(O=O.mod(w))}if(N){if(N=i(N/2),N===0)break;F=N%2}else if(E=E.times(A),lt(E,E.e+1,1),E.e>14)F=z(E);else{if(N=+$e(E),N===0)break;F=N%2}J=J.times(J),M?J.c&&J.c.length>M&&(J.c.length=M):U&&(J=J.mod(w))}return U?O:(k&&(O=L.div(O)),w?O.mod(w):M?lt(O,Fe,ee,B):O)},T.integerValue=function(E){var w=new Q(this);return E==null?E=ee:I(E,0,8),lt(w,w.e+1,E)},T.isEqualTo=T.eq=function(E,w){return R(this,new Q(E,w))===0},T.isFinite=function(){return!!this.c},T.isGreaterThan=T.gt=function(E,w){return R(this,new Q(E,w))>0},T.isGreaterThanOrEqualTo=T.gte=function(E,w){return(w=R(this,new Q(E,w)))===1||w===0},T.isInteger=function(){return!!this.c&&v(this.e/f)>this.c.length-2},T.isLessThan=T.lt=function(E,w){return R(this,new Q(E,w))<0},T.isLessThanOrEqualTo=T.lte=function(E,w){return(w=R(this,new Q(E,w)))===-1||w===0},T.isNaN=function(){return!this.s},T.isNegative=function(){return this.s<0},T.isPositive=function(){return this.s>0},T.isZero=function(){return!!this.c&&this.c[0]==0},T.minus=function(E,w){var A,U,N,M,B=this,P=B.s;if(E=new Q(E,w),w=E.s,!P||!w)return new Q(NaN);if(P!=w)return E.s=-w,B.plus(E);var k=B.e/f,F=E.e/f,O=B.c,J=E.c;if(!k||!F){if(!O||!J)return O?(E.s=-w,E):new Q(J?B:NaN);if(!O[0]||!J[0])return J[0]?(E.s=-w,E):new Q(O[0]?B:ee==3?-0:0)}if(k=v(k),F=v(F),O=O.slice(),P=k-F){for((M=P<0)?(P=-P,N=O):(F=k,N=J),N.reverse(),w=P;w--;N.push(0));N.reverse()}else for(U=(M=(P=O.length)<(w=J.length))?P:w,P=w=0;w<U;w++)if(O[w]!=J[w]){M=O[w]<J[w];break}if(M&&(N=O,O=J,J=N,E.s=-E.s),w=(U=J.length)-(A=O.length),w>0)for(;w--;O[A++]=0);for(w=u-1;U>P;){if(O[--U]<J[U]){for(A=U;A&&!O[--A];O[A]=w);--O[A],O[U]+=u}O[U]-=J[U]}for(;O[0]==0;O.splice(0,1),--F);return O[0]?Uo(E,O,F):(E.s=ee==3?-1:1,E.c=[E.e=0],E)},T.modulo=T.mod=function(E,w){var A,U,N=this;return E=new Q(E,w),!N.c||!E.s||E.c&&!E.c[0]?new Q(NaN):!E.c||N.c&&!N.c[0]?new Q(N):(Ae==9?(U=E.s,E.s=1,A=G(N,E,0,3),E.s=U,A.s*=U):A=G(N,E,0,Ae),E=N.minus(A.times(E)),!E.c[0]&&Ae==1&&(E.s=N.s),E)},T.multipliedBy=T.times=function(E,w){var A,U,N,M,B,P,k,F,O,J,ie,le,ve,Me,Oe,Te=this,be=Te.c,We=(E=new Q(E,w)).c;if(!be||!We||!be[0]||!We[0])return!Te.s||!E.s||be&&!be[0]&&!We||We&&!We[0]&&!be?E.c=E.e=E.s=null:(E.s*=Te.s,!be||!We?E.c=E.e=null:(E.c=[0],E.e=0)),E;for(U=v(Te.e/f)+v(E.e/f),E.s*=Te.s,k=be.length,J=We.length,k<J&&(ve=be,be=We,We=ve,N=k,k=J,J=N),N=k+J,ve=[];N--;ve.push(0));for(Me=u,Oe=m,N=J;--N>=0;){for(A=0,ie=We[N]%Oe,le=We[N]/Oe|0,B=k,M=N+B;M>N;)F=be[--B]%Oe,O=be[B]/Oe|0,P=le*F+O*ie,F=ie*F+P%Oe*Oe+ve[M]+A,A=(F/Me|0)+(P/Oe|0)+le*O,ve[M--]=F%Me;ve[M]=A}return A?++U:ve.splice(0,1),Uo(E,ve,U)},T.negated=function(){var E=new Q(this);return E.s=-E.s||null,E},T.plus=function(E,w){var A,U=this,N=U.s;if(E=new Q(E,w),w=E.s,!N||!w)return new Q(NaN);if(N!=w)return E.s=-w,U.minus(E);var M=U.e/f,B=E.e/f,P=U.c,k=E.c;if(!M||!B){if(!P||!k)return new Q(N/0);if(!P[0]||!k[0])return k[0]?E:new Q(P[0]?U:N*0)}if(M=v(M),B=v(B),P=P.slice(),N=M-B){for(N>0?(B=M,A=k):(N=-N,A=P),A.reverse();N--;A.push(0));A.reverse()}for(N=P.length,w=k.length,N-w<0&&(A=k,k=P,P=A,w=N),N=0;w;)N=(P[--w]=P[w]+k[w]+N)/u|0,P[w]=u===P[w]?0:P[w]%u;return N&&(P=[N].concat(P),++B),Uo(E,P,B)},T.precision=T.sd=function(E,w){var A,U,N,M=this;if(E!=null&&E!==!!E)return I(E,1,g),w==null?w=ee:I(w,0,8),lt(new Q(M),E,w);if(!(A=M.c))return null;if(N=A.length-1,U=N*f+1,N=A[N]){for(;N%10==0;N/=10,U--);for(N=A[0];N>=10;N/=10,U++);}return E&&M.e+1>U&&(U=M.e+1),U},T.shiftedBy=function(E){return I(E,-d,d),this.times("1e"+E)},T.squareRoot=T.sqrt=function(){var E,w,A,U,N,M=this,B=M.c,P=M.s,k=M.e,F=X+4,O=new Q("0.5");if(P!==1||!B||!B[0])return new Q(!P||P<0&&(!B||B[0])?NaN:B?M:1/0);if(P=Math.sqrt(+$e(M)),P==0||P==1/0?(w=C(B),(w.length+k)%2==0&&(w+="0"),P=Math.sqrt(+w),k=v((k+1)/2)-(k<0||k%2),P==1/0?w="5e"+k:(w=P.toExponential(),w=w.slice(0,w.indexOf("e")+1)+k),A=new Q(w)):A=new Q(P+""),A.c[0]){for(k=A.e,P=k+F,P<3&&(P=0);;)if(N=A,A=O.times(N.plus(G(M,N,F,1))),C(N.c).slice(0,P)===(w=C(A.c)).slice(0,P))if(A.e<k&&--P,w=w.slice(P-3,P+1),w=="9999"||!U&&w=="4999"){if(!U&&(lt(N,N.e+X+2,0),N.times(N).eq(M))){A=N;break}F+=4,P+=4,U=1}else{(!+w||!+w.slice(1)&&w.charAt(0)=="5")&&(lt(A,A.e+X+2,1),E=!A.times(A).eq(M));break}}return lt(A,A.e+X+1,ee,E)},T.toExponential=function(E,w){return E!=null&&(I(E,0,g),E++),yt(this,E,w,1)},T.toFixed=function(E,w){return E!=null&&(I(E,0,g),E=E+this.e+1),yt(this,E,w)},T.toFormat=function(E,w,A){var U,N=this;if(A==null)E!=null&&w&&typeof w=="object"?(A=w,w=null):E&&typeof E=="object"?(A=E,E=w=null):A=Ei;else if(typeof A!="object")throw Error(o+"Argument not an object: "+A);if(U=N.toFixed(E,w),N.c){var M,B=U.split("."),P=+A.groupSize,k=+A.secondaryGroupSize,F=A.groupSeparator||"",O=B[0],J=B[1],ie=N.s<0,le=ie?O.slice(1):O,ve=le.length;if(k&&(M=P,P=k,k=M,ve-=M),P>0&&ve>0){for(M=ve%P||P,O=le.substr(0,M);M<ve;M+=P)O+=F+le.substr(M,P);k>0&&(O+=F+le.slice(M)),ie&&(O="-"+O)}U=J?O+(A.decimalSeparator||"")+((k=+A.fractionGroupSize)?J.replace(new RegExp("\\d{"+k+"}\\B","g"),"$&"+(A.fractionGroupSeparator||"")):J):O}return(A.prefix||"")+U+(A.suffix||"")},T.toFraction=function(E){var w,A,U,N,M,B,P,k,F,O,J,ie,le=this,ve=le.c;if(E!=null&&(P=new Q(E),!P.isInteger()&&(P.c||P.s!==1)||P.lt(L)))throw Error(o+"Argument "+(P.isInteger()?"out of range: ":"not an integer: ")+$e(P));if(!ve)return new Q(le);for(w=new Q(L),F=A=new Q(L),U=k=new Q(L),ie=C(ve),M=w.e=ie.length-le.e-1,w.c[0]=h[(B=M%f)<0?f+B:B],E=!E||P.comparedTo(w)>0?M>0?w:F:P,B=_e,_e=1/0,P=new Q(ie),k.c[0]=0;O=G(P,w,0,1),N=A.plus(O.times(U)),N.comparedTo(E)!=1;)A=U,U=N,F=k.plus(O.times(N=F)),k=N,w=P.minus(O.times(N=w)),P=N;return N=G(E.minus(A),U,0,1),k=k.plus(N.times(F)),A=A.plus(N.times(U)),k.s=F.s=le.s,M=M*2,J=G(F,U,M,ee).minus(le).abs().comparedTo(G(k,A,M,ee).minus(le).abs())<1?[F,U]:[k,A],_e=B,J},T.toNumber=function(){return+$e(this)},T.toPrecision=function(E,w){return E!=null&&I(E,1,g),yt(this,E,w,2)},T.toString=function(E){var w,A=this,U=A.s,N=A.e;return N===null?U?(w="Infinity",U<0&&(w="-"+w)):w="NaN":(E==null?w=N<=Z||N>=j?$(C(A.c),N):W(C(A.c),N,"0"):E===10&&Oo?(A=lt(new Q(A),X+N+1,ee),w=W(C(A.c),A.e,"0")):(I(E,2,Sn.length,"Base"),w=K(W(C(A.c),N,"0"),10,E,U,!0)),U<0&&A.c[0]&&(w="-"+w)),w},T.valueOf=T.toJSON=function(){return $e(this)},T._isBigNumber=!0,H!=null&&Q.set(H),Q}function v(H){var G=H|0;return H>0||H===G?G:G-1}function C(H){for(var G,K,te=1,T=H.length,L=H[0]+"";te<T;){for(G=H[te++]+"",K=f-G.length;K--;G="0"+G);L+=G}for(T=L.length;L.charCodeAt(--T)===48;);return L.slice(0,T+1||1)}function R(H,G){var K,te,T=H.c,L=G.c,X=H.s,ee=G.s,Z=H.e,j=G.e;if(!X||!ee)return null;if(K=T&&!T[0],te=L&&!L[0],K||te)return K?te?0:-ee:X;if(X!=ee)return X;if(K=X<0,te=Z==j,!T||!L)return te?0:!T^K?1:-1;if(!te)return Z>j^K?1:-1;for(ee=(Z=T.length)<(j=L.length)?Z:j,X=0;X<ee;X++)if(T[X]!=L[X])return T[X]>L[X]^K?1:-1;return Z==j?0:Z>j^K?1:-1}function I(H,G,K,te){if(H<G||H>K||H!==i(H))throw Error(o+(te||"Argument")+(typeof H=="number"?H<G||H>K?" out of range: ":" not an integer: ":" not a primitive number: ")+String(H))}function z(H){var G=H.c.length-1;return v(H.e/f)==G&&H.c[G]%2!=0}function $(H,G){return(H.length>1?H.charAt(0)+"."+H.slice(1):H)+(G<0?"e":"e+")+G}function W(H,G,K){var te,T;if(G<0){for(T=K+".";++G;T+=K);H=T+H}else if(te=H.length,++G>te){for(T=K,G-=te;--G;T+=K);H+=T}else G<te&&(H=H.slice(0,G)+"."+H.slice(G));return H}e=_(),e.default=e.BigNumber=e,typeof define=="function"&&define.amd?define(function(){return e}):typeof ja!="undefined"&&ja.exports?ja.exports=e:(n||(n=typeof self!="undefined"&&self?self:window),n.BigNumber=e)})(Zy)});var n_=Y((X1,t_)=>{var jy=mf(),e_=t_.exports;(function(){"use strict";function n(d){return d<10?"0"+d:d}var e=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,t=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,r,i,o={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},s;function u(d){return t.lastIndex=0,t.test(d)?'"'+d.replace(t,function(h){var m=o[h];return typeof m=="string"?m:"\\u"+("0000"+h.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+d+'"'}function f(d,h){var m,g,_,v,C=r,R,I=h[d],z=I!=null&&(I instanceof jy||jy.isBigNumber(I));switch(I&&typeof I=="object"&&typeof I.toJSON=="function"&&(I=I.toJSON(d)),typeof s=="function"&&(I=s.call(h,d,I)),typeof I){case"string":return z?I:u(I);case"number":return isFinite(I)?String(I):"null";case"boolean":case"null":case"bigint":return String(I);case"object":if(!I)return"null";if(r+=i,R=[],Object.prototype.toString.apply(I)==="[object Array]"){for(v=I.length,m=0;m<v;m+=1)R[m]=f(m,I)||"null";return _=R.length===0?"[]":r?`[
`+r+R.join(`,
`+r)+`
`+C+"]":"["+R.join(",")+"]",r=C,_}if(s&&typeof s=="object")for(v=s.length,m=0;m<v;m+=1)typeof s[m]=="string"&&(g=s[m],_=f(g,I),_&&R.push(u(g)+(r?": ":":")+_));else Object.keys(I).forEach(function($){var W=f($,I);W&&R.push(u($)+(r?": ":":")+W)});return _=R.length===0?"{}":r?`{
`+r+R.join(`,
`+r)+`
`+C+"}":"{"+R.join(",")+"}",r=C,_}}typeof e_.stringify!="function"&&(e_.stringify=function(d,h,m){var g;if(r="",i="",typeof m=="number")for(g=0;g<m;g+=1)i+=" ";else typeof m=="string"&&(i=m);if(s=h,h&&typeof h!="function"&&(typeof h!="object"||typeof h.length!="number"))throw new Error("JSON.stringify");return f("",{"":d})})})()});var i_=Y((Q1,r_)=>{var el=null,Ib=/(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])/,Pb=/(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)/,xb=function(n){"use strict";var e={strict:!1,storeAsString:!1,alwaysParseAsBig:!1,useNativeBigInt:!1,protoAction:"error",constructorAction:"error"};if(n!=null){if(n.strict===!0&&(e.strict=!0),n.storeAsString===!0&&(e.storeAsString=!0),e.alwaysParseAsBig=n.alwaysParseAsBig===!0?n.alwaysParseAsBig:!1,e.useNativeBigInt=n.useNativeBigInt===!0?n.useNativeBigInt:!1,typeof n.constructorAction!="undefined")if(n.constructorAction==="error"||n.constructorAction==="ignore"||n.constructorAction==="preserve")e.constructorAction=n.constructorAction;else throw new Error(`Incorrect value for constructorAction option, must be "error", "ignore" or undefined but passed ${n.constructorAction}`);if(typeof n.protoAction!="undefined")if(n.protoAction==="error"||n.protoAction==="ignore"||n.protoAction==="preserve")e.protoAction=n.protoAction;else throw new Error(`Incorrect value for protoAction option, must be "error", "ignore" or undefined but passed ${n.protoAction}`)}var t,r,i={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"},o,s=function(C){throw{name:"SyntaxError",message:C,at:t,text:o}},u=function(C){return C&&C!==r&&s("Expected '"+C+"' instead of '"+r+"'"),r=o.charAt(t),t+=1,r},f=function(){var C,R="";for(r==="-"&&(R="-",u("-"));r>="0"&&r<="9";)R+=r,u();if(r===".")for(R+=".";u()&&r>="0"&&r<="9";)R+=r;if(r==="e"||r==="E")for(R+=r,u(),(r==="-"||r==="+")&&(R+=r,u());r>="0"&&r<="9";)R+=r,u();if(C=+R,!isFinite(C))s("Bad number");else return el==null&&(el=mf()),R.length>15?e.storeAsString?R:e.useNativeBigInt?BigInt(R):new el(R):e.alwaysParseAsBig?e.useNativeBigInt?BigInt(C):new el(C):C},d=function(){var C,R,I="",z;if(r==='"')for(var $=t;u();){if(r==='"')return t-1>$&&(I+=o.substring($,t-1)),u(),I;if(r==="\\"){if(t-1>$&&(I+=o.substring($,t-1)),u(),r==="u"){for(z=0,R=0;R<4&&(C=parseInt(u(),16),!!isFinite(C));R+=1)z=z*16+C;I+=String.fromCharCode(z)}else if(typeof i[r]=="string")I+=i[r];else break;$=t}}s("Bad string")},h=function(){for(;r&&r<=" ";)u()},m=function(){switch(r){case"t":return u("t"),u("r"),u("u"),u("e"),!0;case"f":return u("f"),u("a"),u("l"),u("s"),u("e"),!1;case"n":return u("n"),u("u"),u("l"),u("l"),null}s("Unexpected '"+r+"'")},g,_=function(){var C=[];if(r==="["){if(u("["),h(),r==="]")return u("]"),C;for(;r;){if(C.push(g()),h(),r==="]")return u("]"),C;u(","),h()}}s("Bad array")},v=function(){var C,R=Object.create(null);if(r==="{"){if(u("{"),h(),r==="}")return u("}"),R;for(;r;){if(C=d(),h(),u(":"),e.strict===!0&&Object.hasOwnProperty.call(R,C)&&s('Duplicate key "'+C+'"'),Ib.test(C)===!0?e.protoAction==="error"?s("Object contains forbidden prototype property"):e.protoAction==="ignore"?g():R[C]=g():Pb.test(C)===!0?e.constructorAction==="error"?s("Object contains forbidden constructor property"):e.constructorAction==="ignore"?g():R[C]=g():R[C]=g(),h(),r==="}")return u("}"),R;u(","),h()}}s("Bad object")};return g=function(){switch(h(),r){case"{":return v();case"[":return _();case'"':return d();case"-":return f();default:return r>="0"&&r<="9"?f():m()}},function(C,R){var I;return o=C+"",t=0,r=" ",I=g(),h(),r&&s("Syntax error"),typeof R=="function"?(function z($,W){var H,G,K=$[W];return K&&typeof K=="object"&&Object.keys(K).forEach(function(te){G=z(K,te),G!==void 0?K[te]=G:delete K[te]}),R.call($,W,K)})({"":I},""):I}};r_.exports=xb});var a_=Y((Z1,tl)=>{var o_=n_().stringify,s_=i_();tl.exports=function(n){return{parse:s_(n),stringify:o_}};tl.exports.parse=s_();tl.exports.stringify=o_});var gf=Y(cn=>{"use strict";Object.defineProperty(cn,"__esModule",{value:!0});cn.GCE_LINUX_BIOS_PATHS=void 0;cn.isGoogleCloudServerless=c_;cn.isGoogleComputeEngineLinux=f_;cn.isGoogleComputeEngineMACAddress=d_;cn.isGoogleComputeEngine=h_;cn.detectGCPResidency=kb;var l_=require("fs"),u_=require("os");cn.GCE_LINUX_BIOS_PATHS={BIOS_DATE:"/sys/class/dmi/id/bios_date",BIOS_VENDOR:"/sys/class/dmi/id/bios_vendor"};var Nb=/^42:01/;function c_(){return!!(process.env.CLOUD_RUN_JOB||process.env.FUNCTION_NAME||process.env.K_SERVICE)}function f_(){if((0,u_.platform)()!=="linux")return!1;try{(0,l_.statSync)(cn.GCE_LINUX_BIOS_PATHS.BIOS_DATE);let n=(0,l_.readFileSync)(cn.GCE_LINUX_BIOS_PATHS.BIOS_VENDOR,"utf8");return/Google/.test(n)}catch(n){return!1}}function d_(){let n=(0,u_.networkInterfaces)();for(let e of Object.values(n))if(e){for(let{mac:t}of e)if(Nb.test(t))return!0}return!1}function h_(){return f_()||d_()}function kb(){return c_()||h_()}});var p_=Y(nl=>{"use strict";Object.defineProperty(nl,"__esModule",{value:!0});nl.Colours=void 0;var rt=class n{static isEnabled(e){return e&&e.isTTY&&(typeof e.getColorDepth=="function"?e.getColorDepth()>2:!0)}static refresh(){n.enabled=n.isEnabled(process==null?void 0:process.stderr),this.enabled?(n.reset="\x1B[0m",n.bright="\x1B[1m",n.dim="\x1B[2m",n.red="\x1B[31m",n.green="\x1B[32m",n.yellow="\x1B[33m",n.blue="\x1B[34m",n.magenta="\x1B[35m",n.cyan="\x1B[36m",n.white="\x1B[37m",n.grey="\x1B[90m"):(n.reset="",n.bright="",n.dim="",n.red="",n.green="",n.yellow="",n.blue="",n.magenta="",n.cyan="",n.white="",n.grey="")}};nl.Colours=rt;rt.enabled=!1;rt.reset="";rt.bright="";rt.dim="";rt.red="";rt.green="";rt.yellow="";rt.blue="";rt.magenta="";rt.cyan="";rt.white="";rt.grey="";rt.refresh()});var __=Y(Pe=>{"use strict";var Mb=Pe&&Pe.__createBinding||(Object.create?(function(n,e,t,r){r===void 0&&(r=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,i)}):(function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]})),Db=Pe&&Pe.__setModuleDefault||(Object.create?(function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}):function(n,e){n.default=e}),m_=Pe&&Pe.__importStar||(function(){var n=function(e){return n=Object.getOwnPropertyNames||function(t){var r=[];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[r.length]=i);return r},n(e)};return function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r=n(e),i=0;i<r.length;i++)r[i]!=="default"&&Mb(t,e,r[i]);return Db(t,e),t}})();Object.defineProperty(Pe,"__esModule",{value:!0});Pe.env=Pe.DebugLogBackendBase=Pe.placeholder=Pe.AdhocDebugLogger=Pe.LogSeverity=void 0;Pe.getNodeBackend=_f;Pe.getDebugBackend=Ub;Pe.getStructuredBackend=Fb;Pe.setBackend=Lb;Pe.log=y_;var Ob=require("events"),ms=m_(require("process")),g_=m_(require("util")),Nt=p_(),fn;(function(n){n.DEFAULT="DEFAULT",n.DEBUG="DEBUG",n.INFO="INFO",n.WARNING="WARNING",n.ERROR="ERROR"})(fn||(Pe.LogSeverity=fn={}));var gs=class extends Ob.EventEmitter{constructor(e,t){super(),this.namespace=e,this.upstream=t,this.func=Object.assign(this.invoke.bind(this),{instance:this,on:(r,i)=>this.on(r,i)}),this.func.debug=(...r)=>this.invokeSeverity(fn.DEBUG,...r),this.func.info=(...r)=>this.invokeSeverity(fn.INFO,...r),this.func.warn=(...r)=>this.invokeSeverity(fn.WARNING,...r),this.func.error=(...r)=>this.invokeSeverity(fn.ERROR,...r),this.func.sublog=r=>y_(r,this.func)}invoke(e,...t){if(this.upstream)try{this.upstream(e,...t)}catch(r){}try{this.emit("log",e,t)}catch(r){}}invokeSeverity(e,...t){this.invoke({severity:e},...t)}};Pe.AdhocDebugLogger=gs;Pe.placeholder=new gs("",()=>{}).func;var Zi=class{constructor(){var e;this.cached=new Map,this.filters=[],this.filtersSet=!1;let t=(e=ms.env[Pe.env.nodeEnables])!==null&&e!==void 0?e:"*";t==="all"&&(t="*"),this.filters=t.split(",")}log(e,t,...r){try{this.filtersSet||(this.setFilters(),this.filtersSet=!0);let i=this.cached.get(e);i||(i=this.makeLogger(e),this.cached.set(e,i)),i(t,...r)}catch(i){console.error(i)}}};Pe.DebugLogBackendBase=Zi;var yf=class extends Zi{constructor(){super(...arguments),this.enabledRegexp=/.*/g}isEnabled(e){return this.enabledRegexp.test(e)}makeLogger(e){return this.enabledRegexp.test(e)?(t,...r)=>{var i;let o=`${Nt.Colours.green}${e}${Nt.Colours.reset}`,s=`${Nt.Colours.yellow}${ms.pid}${Nt.Colours.reset}`,u;switch(t.severity){case fn.ERROR:u=`${Nt.Colours.red}${t.severity}${Nt.Colours.reset}`;break;case fn.INFO:u=`${Nt.Colours.magenta}${t.severity}${Nt.Colours.reset}`;break;case fn.WARNING:u=`${Nt.Colours.yellow}${t.severity}${Nt.Colours.reset}`;break;default:u=(i=t.severity)!==null&&i!==void 0?i:fn.DEFAULT;break}let f=g_.formatWithOptions({colors:Nt.Colours.enabled},...r),d=Object.assign({},t);delete d.severity;let h=Object.getOwnPropertyNames(d).length?JSON.stringify(d):"",m=h?`${Nt.Colours.grey}${h}${Nt.Colours.reset}`:"";console.error("%s [%s|%s] %s%s",s,o,u,f,h?` ${m}`:"")}:()=>{}}setFilters(){let t=this.filters.join(",").replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^");this.enabledRegexp=new RegExp(`^${t}$`,"i")}};function _f(){return new yf}var Ef=class extends Zi{constructor(e){super(),this.debugPkg=e}makeLogger(e){let t=this.debugPkg(e);return(r,...i)=>{t(i[0],...i.slice(1))}}setFilters(){var e;let t=(e=ms.env.NODE_DEBUG)!==null&&e!==void 0?e:"";ms.env.NODE_DEBUG=`${t}${t?",":""}${this.filters.join(",")}`}};function Ub(n){return new Ef(n)}var Sf=class extends Zi{constructor(e){var t;super(),this.upstream=(t=e)!==null&&t!==void 0?t:void 0}makeLogger(e){var t;let r=(t=this.upstream)===null||t===void 0?void 0:t.makeLogger(e);return(i,...o)=>{var s;let u=(s=i.severity)!==null&&s!==void 0?s:fn.INFO,f=Object.assign({severity:u,message:g_.format(...o)},i),d=JSON.stringify(f);r?r(i,d):console.log("%s",d)}}setFilters(){var e;(e=this.upstream)===null||e===void 0||e.setFilters()}};function Fb(n){return new Sf(n)}Pe.env={nodeEnables:"GOOGLE_SDK_NODE_LOGGING"};var Tf=new Map,kt;function Lb(n){kt=n,Tf.clear()}function y_(n,e){if(!kt&&!ms.env[Pe.env.nodeEnables]||!n)return Pe.placeholder;e&&(n=`${e.instance.namespace}:${n}`);let t=Tf.get(n);if(t)return t.func;if(kt===null)return Pe.placeholder;kt===void 0&&(kt=_f());let r=(()=>{let i;return new gs(n,(s,...u)=>{if(i!==kt){if(kt===null)return;kt===void 0&&(kt=_f()),i=kt}kt==null||kt.log(n,s,...u)})})();return Tf.set(n,r),r.func}});var vf=Y(ti=>{"use strict";var qb=ti&&ti.__createBinding||(Object.create?(function(n,e,t,r){r===void 0&&(r=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,i)}):(function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]})),Bb=ti&&ti.__exportStar||function(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&qb(e,n,t)};Object.defineProperty(ti,"__esModule",{value:!0});Bb(__(),ti)});var _s=Y(me=>{"use strict";var S_=me&&me.__createBinding||(Object.create?(function(n,e,t,r){r===void 0&&(r=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,i)}):(function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]})),Gb=me&&me.__setModuleDefault||(Object.create?(function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}):function(n,e){n.default=e}),Hb=me&&me.__importStar||(function(){var n=function(e){return n=Object.getOwnPropertyNames||function(t){var r=[];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[r.length]=i);return r},n(e)};return function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r=n(e),i=0;i<r.length;i++)r[i]!=="default"&&S_(t,e,r[i]);return Gb(t,e),t}})(),Vb=me&&me.__exportStar||function(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&S_(e,n,t)};Object.defineProperty(me,"__esModule",{value:!0});me.gcpResidencyCache=me.METADATA_SERVER_DETECTION=me.HEADERS=me.HEADER_VALUE=me.HEADER_NAME=me.SECONDARY_HOST_ADDRESS=me.HOST_ADDRESS=me.BASE_PATH=void 0;me.instance=Yb;me.project=Xb;me.universe=Qb;me.bulk=Zb;me.isAvailable=eR;me.resetIsAvailableCache=tR;me.getGCPResidency=Af;me.setGCPResidency=T_;me.requestTimeout=v_;var wf=Ze(),$b=a_(),Wb=gf(),zb=Hb(vf());me.BASE_PATH="/computeMetadata/v1";me.HOST_ADDRESS="http://169.254.169.254";me.SECONDARY_HOST_ADDRESS="http://metadata.google.internal.";me.HEADER_NAME="Metadata-Flavor";me.HEADER_VALUE="Google";me.HEADERS=Object.freeze({[me.HEADER_NAME]:me.HEADER_VALUE});var E_=zb.log("gcp-metadata");me.METADATA_SERVER_DETECTION=Object.freeze({"assume-present":"don't try to ping the metadata server, but assume it's present",none:"don't try to ping the metadata server, but don't try to use it either","bios-only":"treat the result of a BIOS probe as canonical (don't fall back to pinging)","ping-only":"skip the BIOS probe, and go straight to pinging"});function Cf(n){return n||(n=process.env.GCE_METADATA_IP||process.env.GCE_METADATA_HOST||me.HOST_ADDRESS),/^https?:\/\//.test(n)||(n=`http://${n}`),new URL(me.BASE_PATH,n).href}function Jb(n){Object.keys(n).forEach(e=>{switch(e){case"params":case"property":case"headers":break;case"qs":throw new Error("'qs' is not a valid configuration option. Please use 'params' instead.");default:throw new Error(`'${e}' is not a valid configuration option.`)}})}async function ys(n,e={},t=3,r=!1){let i=new Headers(me.HEADERS),o="",s={};if(typeof n=="object"){let m=n;new Headers(m.headers).forEach((g,_)=>i.set(_,g)),o=m.metadataKey,s=m.params||s,t=m.noResponseRetries||t,r=m.fastFail||r}else o=n;typeof e=="string"?o+=`/${e}`:(Jb(e),e.property&&(o+=`/${e.property}`),new Headers(e.headers).forEach((m,g)=>i.set(g,m)),s=e.params||s);let u=r?Kb:wf.request,f={url:`${Cf()}/${o}`,headers:i,retryConfig:{noResponseRetries:t},params:s,responseType:"text",timeout:v_()};E_.info("instance request %j",f);let d=await u(f);E_.info("instance metadata is %s",d.data);let h=d.headers.get(me.HEADER_NAME);if(h!==me.HEADER_VALUE)throw new RangeError(`Invalid response from metadata service: incorrect ${me.HEADER_NAME} header. Expected '${me.HEADER_VALUE}', got ${h?`'${h}'`:"no header"}`);if(typeof d.data=="string")try{return $b.parse(d.data)}catch(m){}return d.data}async function Kb(n){var i;let e={...n,url:(i=n.url)==null?void 0:i.toString().replace(Cf(),Cf(me.SECONDARY_HOST_ADDRESS))},t=(0,wf.request)(n),r=(0,wf.request)(e);return Promise.any([t,r])}function Yb(n){return ys("instance",n)}function Xb(n){return ys("project",n)}function Qb(n){return ys("universe",n)}async function Zb(n){let e={};return await Promise.all(n.map(t=>(async()=>{let r=await ys(t),i=t.metadataKey;e[i]=r})())),e}function jb(){return process.env.DETECT_GCP_RETRIES?Number(process.env.DETECT_GCP_RETRIES):0}var rl;async function eR(){if(process.env.METADATA_SERVER_DETECTION){let n=process.env.METADATA_SERVER_DETECTION.trim().toLocaleLowerCase();if(!(n in me.METADATA_SERVER_DETECTION))throw new RangeError(`Unknown \`METADATA_SERVER_DETECTION\` env variable. Got \`${n}\`, but it should be \`${Object.keys(me.METADATA_SERVER_DETECTION).join("`, `")}\`, or unset`);switch(n){case"assume-present":return!0;case"none":return!1;case"bios-only":return Af();case"ping-only":}}try{return rl===void 0&&(rl=ys("instance",void 0,jb(),!(process.env.GCE_METADATA_IP||process.env.GCE_METADATA_HOST))),await rl,!0}catch(n){let e=n;if(process.env.DEBUG_AUTH&&console.info(e),e.type==="request-timeout"||e.response&&e.response.status===404)return!1;if(!(e.response&&e.response.status===404)&&(!e.code||!["EHOSTDOWN","EHOSTUNREACH","ENETUNREACH","ENOENT","ENOTFOUND","ECONNREFUSED"].includes(e.code.toString()))){let t="UNKNOWN";e.code&&(t=e.code.toString()),process.emitWarning(`received unexpected error = ${e.message} code = ${t}`,"MetadataLookupWarning")}return!1}}function tR(){rl=void 0}me.gcpResidencyCache=null;function Af(){return me.gcpResidencyCache===null&&T_(),me.gcpResidencyCache}function T_(n=null){me.gcpResidencyCache=n!==null?n:(0,Wb.detectGCPResidency)()}function v_(){return Af()?0:3e3}Vb(gf(),me)});var A_=Y(il=>{"use strict";il.byteLength=rR;il.toByteArray=oR;il.fromByteArray=lR;var In=[],Kt=[],nR=typeof Uint8Array!="undefined"?Uint8Array:Array,bf="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(ni=0,w_=bf.length;ni<w_;++ni)In[ni]=bf[ni],Kt[bf.charCodeAt(ni)]=ni;var ni,w_;Kt[45]=62;Kt[95]=63;function C_(n){var e=n.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=n.indexOf("=");t===-1&&(t=e);var r=t===e?0:4-t%4;return[t,r]}function rR(n){var e=C_(n),t=e[0],r=e[1];return(t+r)*3/4-r}function iR(n,e,t){return(e+t)*3/4-t}function oR(n){var e,t=C_(n),r=t[0],i=t[1],o=new nR(iR(n,r,i)),s=0,u=i>0?r-4:r,f;for(f=0;f<u;f+=4)e=Kt[n.charCodeAt(f)]<<18|Kt[n.charCodeAt(f+1)]<<12|Kt[n.charCodeAt(f+2)]<<6|Kt[n.charCodeAt(f+3)],o[s++]=e>>16&255,o[s++]=e>>8&255,o[s++]=e&255;return i===2&&(e=Kt[n.charCodeAt(f)]<<2|Kt[n.charCodeAt(f+1)]>>4,o[s++]=e&255),i===1&&(e=Kt[n.charCodeAt(f)]<<10|Kt[n.charCodeAt(f+1)]<<4|Kt[n.charCodeAt(f+2)]>>2,o[s++]=e>>8&255,o[s++]=e&255),o}function sR(n){return In[n>>18&63]+In[n>>12&63]+In[n>>6&63]+In[n&63]}function aR(n,e,t){for(var r,i=[],o=e;o<t;o+=3)r=(n[o]<<16&16711680)+(n[o+1]<<8&65280)+(n[o+2]&255),i.push(sR(r));return i.join("")}function lR(n){for(var e,t=n.length,r=t%3,i=[],o=16383,s=0,u=t-r;s<u;s+=o)i.push(aR(n,s,s+o>u?u:s+o));return r===1?(e=n[t-1],i.push(In[e>>2]+In[e<<4&63]+"==")):r===2&&(e=(n[t-2]<<8)+n[t-1],i.push(In[e>>10]+In[e>>4&63]+In[e<<2&63]+"=")),i.join("")}});var If=Y(Rf=>{"use strict";Object.defineProperty(Rf,"__esModule",{value:!0});Rf.fromArrayBufferToHex=uR;function uR(n){return Array.from(new Uint8Array(n)).map(t=>t.toString(16).padStart(2,"0")).join("")}});var b_=Y(ol=>{"use strict";Object.defineProperty(ol,"__esModule",{value:!0});ol.BrowserCrypto=void 0;var ji=A_(),cR=If(),Pf=class n{constructor(){if(typeof window=="undefined"||window.crypto===void 0||window.crypto.subtle===void 0)throw new Error("SubtleCrypto not found. Make sure it's an https:// website.")}async sha256DigestBase64(e){let t=new TextEncoder().encode(e),r=await window.crypto.subtle.digest("SHA-256",t);return ji.fromByteArray(new Uint8Array(r))}randomBytesBase64(e){let t=new Uint8Array(e);return window.crypto.getRandomValues(t),ji.fromByteArray(t)}static padBase64(e){for(;e.length%4!==0;)e+="=";return e}async verify(e,t,r){let i={name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},o=new TextEncoder().encode(t),s=ji.toByteArray(n.padBase64(r)),u=await window.crypto.subtle.importKey("jwk",e,i,!0,["verify"]);return await window.crypto.subtle.verify(i,u,s,o)}async sign(e,t){let r={name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},i=new TextEncoder().encode(t),o=await window.crypto.subtle.importKey("jwk",e,r,!0,["sign"]),s=await window.crypto.subtle.sign(r,o,i);return ji.fromByteArray(new Uint8Array(s))}decodeBase64StringUtf8(e){let t=ji.toByteArray(n.padBase64(e));return new TextDecoder().decode(t)}encodeBase64StringUtf8(e){let t=new TextEncoder().encode(e);return ji.fromByteArray(t)}async sha256DigestHex(e){let t=new TextEncoder().encode(e),r=await window.crypto.subtle.digest("SHA-256",t);return(0,cR.fromArrayBufferToHex)(r)}async signWithHmacSha256(e,t){let r=typeof e=="string"?e:String.fromCharCode(...new Uint16Array(e)),i=new TextEncoder,o=await window.crypto.subtle.importKey("raw",i.encode(r),{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);return window.crypto.subtle.sign("HMAC",o,i.encode(t))}};ol.BrowserCrypto=Pf});var R_=Y(sl=>{"use strict";Object.defineProperty(sl,"__esModule",{value:!0});sl.NodeCrypto=void 0;var eo=require("crypto"),xf=class{async sha256DigestBase64(e){return eo.createHash("sha256").update(e).digest("base64")}randomBytesBase64(e){return eo.randomBytes(e).toString("base64")}async verify(e,t,r){let i=eo.createVerify("RSA-SHA256");return i.update(t),i.end(),i.verify(e,r,"base64")}async sign(e,t){let r=eo.createSign("RSA-SHA256");return r.update(t),r.end(),r.sign(e,"base64")}decodeBase64StringUtf8(e){return Buffer.from(e,"base64").toString("utf-8")}encodeBase64StringUtf8(e){return Buffer.from(e,"utf-8").toString("base64")}async sha256DigestHex(e){return eo.createHash("sha256").update(e).digest("hex")}async signWithHmacSha256(e,t){let r=typeof e=="string"?e:dR(e);return fR(eo.createHmac("sha256",r).update(t).digest())}};sl.NodeCrypto=xf;function fR(n){return n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength)}function dR(n){return Buffer.from(n)}});var Es=Y(Zn=>{"use strict";var hR=Zn&&Zn.__createBinding||(Object.create?(function(n,e,t,r){r===void 0&&(r=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,i)}):(function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]})),pR=Zn&&Zn.__exportStar||function(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&hR(e,n,t)};Object.defineProperty(Zn,"__esModule",{value:!0});Zn.createCrypto=yR;Zn.hasBrowserCrypto=I_;var mR=b_(),gR=R_();pR(If(),Zn);function yR(){return I_()?new mR.BrowserCrypto:new gR.NodeCrypto}function I_(){return typeof window!="undefined"&&typeof window.crypto!="undefined"&&typeof window.crypto.subtle!="undefined"}});var to=Y((Nf,x_)=>{var al=require("buffer"),Pn=al.Buffer;function P_(n,e){for(var t in n)e[t]=n[t]}Pn.from&&Pn.alloc&&Pn.allocUnsafe&&Pn.allocUnsafeSlow?x_.exports=al:(P_(al,Nf),Nf.Buffer=ri);function ri(n,e,t){return Pn(n,e,t)}ri.prototype=Object.create(Pn.prototype);P_(Pn,ri);ri.from=function(n,e,t){if(typeof n=="number")throw new TypeError("Argument must not be a number");return Pn(n,e,t)};ri.alloc=function(n,e,t){if(typeof n!="number")throw new TypeError("Argument must be a number");var r=Pn(n);return e!==void 0?typeof t=="string"?r.fill(e,t):r.fill(e):r.fill(0),r};ri.allocUnsafe=function(n){if(typeof n!="number")throw new TypeError("Argument must be a number");return Pn(n)};ri.allocUnsafeSlow=function(n){if(typeof n!="number")throw new TypeError("Argument must be a number");return al.SlowBuffer(n)}});var k_=Y((uq,N_)=>{"use strict";function kf(n){var e=(n/8|0)+(n%8===0?0:1);return e}var _R={ES256:kf(256),ES384:kf(384),ES512:kf(521)};function ER(n){var e=_R[n];if(e)return e;throw new Error('Unknown algorithm "'+n+'"')}N_.exports=ER});var Mf=Y((cq,L_)=>{"use strict";var ll=to().Buffer,D_=k_(),ul=128,O_=0,SR=32,TR=16,vR=2,U_=TR|SR|O_<<6,cl=vR|O_<<6;function wR(n){return n.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function F_(n){if(ll.isBuffer(n))return n;if(typeof n=="string")return ll.from(n,"base64");throw new TypeError("ECDSA signature must be a Base64 string or a Buffer")}function CR(n,e){n=F_(n);var t=D_(e),r=t+1,i=n.length,o=0;if(n[o++]!==U_)throw new Error('Could not find expected "seq"');var s=n[o++];if(s===(ul|1)&&(s=n[o++]),i-o<s)throw new Error('"seq" specified length of "'+s+'", only "'+(i-o)+'" remaining');if(n[o++]!==cl)throw new Error('Could not find expected "int" for "r"');var u=n[o++];if(i-o-2<u)throw new Error('"r" specified length of "'+u+'", only "'+(i-o-2)+'" available');if(r<u)throw new Error('"r" specified length of "'+u+'", max of "'+r+'" is acceptable');var f=o;if(o+=u,n[o++]!==cl)throw new Error('Could not find expected "int" for "s"');var d=n[o++];if(i-o!==d)throw new Error('"s" specified length of "'+d+'", expected "'+(i-o)+'"');if(r<d)throw new Error('"s" specified length of "'+d+'", max of "'+r+'" is acceptable');var h=o;if(o+=d,o!==i)throw new Error('Expected to consume entire buffer, but "'+(i-o)+'" bytes remain');var m=t-u,g=t-d,_=ll.allocUnsafe(m+u+g+d);for(o=0;o<m;++o)_[o]=0;n.copy(_,o,f+Math.max(-m,0),f+u),o=t;for(var v=o;o<v+g;++o)_[o]=0;return n.copy(_,o,h+Math.max(-g,0),h+d),_=_.toString("base64"),_=wR(_),_}function M_(n,e,t){for(var r=0;e+r<t&&n[e+r]===0;)++r;var i=n[e+r]>=ul;return i&&--r,r}function AR(n,e){n=F_(n);var t=D_(e),r=n.length;if(r!==t*2)throw new TypeError('"'+e+'" signatures must be "'+t*2+'" bytes, saw "'+r+'"');var i=M_(n,0,t),o=M_(n,t,n.length),s=t-i,u=t-o,f=2+s+1+1+u,d=f<ul,h=ll.allocUnsafe((d?2:3)+f),m=0;return h[m++]=U_,d?h[m++]=f:(h[m++]=ul|1,h[m++]=f&255),h[m++]=cl,h[m++]=s,i<0?(h[m++]=0,m+=n.copy(h,m,0,t)):m+=n.copy(h,m,i,t),h[m++]=cl,h[m++]=u,o<0?(h[m++]=0,n.copy(h,m,t)):n.copy(h,m,t+o),h}L_.exports={derToJose:CR,joseToDer:AR}});var dn=Y(jn=>{"use strict";Object.defineProperty(jn,"__esModule",{value:!0});jn.LRUCache=void 0;jn.snakeToCamel=B_;jn.originalOrCamelOptions=PR;jn.removeUndefinedValuesInObject=xR;jn.isValidFile=NR;jn.getWellKnownCertificateConfigFileLocation=kR;var bR=require("fs"),RR=require("os"),Df=require("path"),IR="certificate_config.json",q_="gcloud";function B_(n){return n.replace(/([_][^_])/g,e=>e.slice(1).toUpperCase())}function PR(n){function e(t){var i;let r=n||{};return(i=r[t])!=null?i:r[B_(t)]}return{get:e}}var xn,Cr,Uf,Ff,Of=class{constructor(e){se(this,Cr);x(this,"capacity");se(this,xn,new Map);x(this,"maxAge");this.capacity=e.capacity,this.maxAge=e.maxAge}set(e,t){oe(this,Cr,Uf).call(this,e,t),oe(this,Cr,Ff).call(this)}get(e){let t=D(this,xn).get(e);if(t)return oe(this,Cr,Uf).call(this,e,t.value),oe(this,Cr,Ff).call(this),t.value}};xn=new WeakMap,Cr=new WeakSet,Uf=function(e,t){D(this,xn).delete(e),D(this,xn).set(e,{value:t,lastAccessed:Date.now()})},Ff=function(){let e=this.maxAge?Date.now()-this.maxAge:0,t=D(this,xn).entries().next();for(;!t.done&&(D(this,xn).size>this.capacity||t.value[1].lastAccessed<e);)D(this,xn).delete(t.value[0]),t=D(this,xn).entries().next()};jn.LRUCache=Of;function xR(n){return Object.entries(n).forEach(([e,t])=>{(t===void 0||t==="undefined")&&delete n[e]}),n}async function NR(n){try{return(await bR.promises.lstat(n)).isFile()}catch(e){return!1}}function kR(){let n=process.env.CLOUDSDK_CONFIG||(MR()?Df.join(process.env.APPDATA||"",q_):Df.join(process.env.HOME||"",".config",q_));return Df.join(n,IR)}function MR(){return RR.platform().startsWith("win")}});var G_=Y((hq,DR)=>{DR.exports={name:"google-auth-library",version:"10.5.0",author:"Google Inc.",description:"Google APIs Authentication Client Library for Node.js",engines:{node:">=18"},main:"./build/src/index.js",types:"./build/src/index.d.ts",repository:"googleapis/google-auth-library-nodejs.git",keywords:["google","api","google apis","client","client library"],dependencies:{"base64-js":"^1.3.0","ecdsa-sig-formatter":"^1.0.11",gaxios:"^7.0.0","gcp-metadata":"^8.0.0","google-logging-utils":"^1.0.0",gtoken:"^8.0.0",jws:"^4.0.0"},devDependencies:{"@types/base64-js":"^1.2.5","@types/jws":"^3.1.0","@types/mocha":"^10.0.10","@types/mv":"^2.1.0","@types/ncp":"^2.0.1","@types/node":"^22.0.0","@types/sinon":"^17.0.0","assert-rejects":"^1.0.0",c8:"^10.0.0",codecov:"^3.0.2",gts:"^6.0.0","is-docker":"^3.0.0",jsdoc:"^4.0.0","jsdoc-fresh":"^5.0.0","jsdoc-region-tag":"^4.0.0",karma:"^6.0.0","karma-chrome-launcher":"^3.0.0","karma-coverage":"^2.0.0","karma-firefox-launcher":"^2.0.0","karma-mocha":"^2.0.0","karma-sourcemap-loader":"^0.4.0","karma-webpack":"^5.0.1",keypair:"^1.0.4",mocha:"^11.1.0",mv:"^2.1.1",ncp:"^2.0.0",nock:"^14.0.5","null-loader":"^4.0.0",puppeteer:"^24.0.0",sinon:"^21.0.0","ts-loader":"^8.0.0",typescript:"5.8.2",webpack:"^5.21.2","webpack-cli":"^4.0.0"},files:["build/src","!build/src/**/*.map"],scripts:{test:"c8 mocha build/test",clean:"gts clean",prepare:"npm run compile",lint:"gts check --no-inline-config",compile:"tsc -p .",fix:"gts fix",pretest:"npm run compile -- --sourceMap",docs:"jsdoc -c .jsdoc.js","samples-setup":"cd samples/ && npm link ../ && npm run setup && cd ../","samples-test":"cd samples/ && npm link ../ && npm test && cd ../","system-test":"mocha build/system-test --timeout 60000","presystem-test":"npm run compile -- --sourceMap",webpack:"webpack","browser-test":"karma start","docs-test":"echo 'disabled until linkinator is fixed'","predocs-test":"npm run docs",prelint:"cd samples; npm link ../; npm install"},license:"Apache-2.0"}});var Lf=Y(Ar=>{"use strict";Object.defineProperty(Ar,"__esModule",{value:!0});Ar.USER_AGENT=Ar.PRODUCT_NAME=Ar.pkg=void 0;var H_=G_();Ar.pkg=H_;var V_="google-api-nodejs-client";Ar.PRODUCT_NAME=V_;var OR=`${V_}/${H_.version}`;Ar.USER_AGENT=OR});var Mt=Y(hn=>{"use strict";Object.defineProperty(hn,"__esModule",{value:!0});hn.AuthClient=hn.DEFAULT_EAGER_REFRESH_THRESHOLD_MILLIS=hn.DEFAULT_UNIVERSE=void 0;var UR=require("events"),qf=Ze(),FR=dn(),LR=vf(),Bf=Lf();hn.DEFAULT_UNIVERSE="googleapis.com";hn.DEFAULT_EAGER_REFRESH_THRESHOLD_MILLIS=300*1e3;var qe=class qe extends UR.EventEmitter{constructor(t={}){var i,o,s,u,f;super();x(this,"apiKey");x(this,"projectId");x(this,"quotaProjectId");x(this,"transporter");x(this,"credentials",{});x(this,"eagerRefreshThresholdMillis",hn.DEFAULT_EAGER_REFRESH_THRESHOLD_MILLIS);x(this,"forceRefreshOnFailure",!1);x(this,"universeDomain",hn.DEFAULT_UNIVERSE);let r=(0,FR.originalOrCamelOptions)(t);this.apiKey=t.apiKey,this.projectId=(i=r.get("project_id"))!=null?i:null,this.quotaProjectId=r.get("quota_project_id"),this.credentials=(o=r.get("credentials"))!=null?o:{},this.universeDomain=(s=r.get("universe_domain"))!=null?s:hn.DEFAULT_UNIVERSE,this.transporter=(u=t.transporter)!=null?u:new qf.Gaxios(t.transporterOptions),r.get("useAuthRequestParameters")!==!1&&(this.transporter.interceptors.request.add(qe.DEFAULT_REQUEST_INTERCEPTOR),this.transporter.interceptors.response.add(qe.DEFAULT_RESPONSE_INTERCEPTOR)),t.eagerRefreshThresholdMillis&&(this.eagerRefreshThresholdMillis=t.eagerRefreshThresholdMillis),this.forceRefreshOnFailure=(f=t.forceRefreshOnFailure)!=null?f:!1}fetch(...t){let r=t[0],i=t[1],o,s=new Headers;return typeof r=="string"?o=new URL(r):r instanceof URL?o=r:r&&r.url&&(o=new URL(r.url)),r&&typeof r=="object"&&"headers"in r&&qf.Gaxios.mergeHeaders(s,r.headers),i&&qf.Gaxios.mergeHeaders(s,new Headers(i.headers)),typeof r=="object"&&!(r instanceof URL)?this.request({...i,...r,headers:s,url:o}):this.request({...i,headers:s,url:o})}setCredentials(t){this.credentials=t}addSharedMetadataHeaders(t){return!t.has("x-goog-user-project")&&this.quotaProjectId&&t.set("x-goog-user-project",this.quotaProjectId),t}addUserProjectAndAuthHeaders(t,r){let i=r.get("x-goog-user-project"),o=r.get("authorization");return i&&t.set("x-goog-user-project",i),o&&t.set("authorization",o),t}static setMethodName(t,r){try{let i=t;i[qe.RequestMethodNameSymbol]=r}catch(i){}}static get RETRY_CONFIG(){return{retry:!0,retryConfig:{httpMethodsToRetry:["GET","PUT","POST","HEAD","OPTIONS","DELETE"]}}}};x(qe,"RequestMethodNameSymbol",Symbol("request method name")),x(qe,"RequestLogIdSymbol",Symbol("request log id")),x(qe,"log",(0,LR.log)("auth")),x(qe,"DEFAULT_REQUEST_INTERCEPTOR",{resolved:async t=>{if(!t.headers.has("x-goog-api-client")){let i=process.version.replace(/^v/,"");t.headers.set("x-goog-api-client",`gl-node/${i}`)}let r=t.headers.get("User-Agent");r?r.includes(`${Bf.PRODUCT_NAME}/`)||t.headers.set("User-Agent",`${r} ${Bf.USER_AGENT}`):t.headers.set("User-Agent",Bf.USER_AGENT);try{let i=t,o=i[qe.RequestMethodNameSymbol],s=`${Math.floor(Math.random()*1e3)}`;i[qe.RequestLogIdSymbol]=s;let u={url:t.url,headers:t.headers};o?qe.log.info("%s [%s] request %j",o,s,u):qe.log.info("[%s] request %j",s,u)}catch(i){}return t}}),x(qe,"DEFAULT_RESPONSE_INTERCEPTOR",{resolved:async t=>{try{let r=t.config,i=r[qe.RequestMethodNameSymbol],o=r[qe.RequestLogIdSymbol];i?qe.log.info("%s [%s] response %j",i,o,t.data):qe.log.info("[%s] response %j",o,t.data)}catch(r){}return t},rejected:async t=>{var r,i;try{let o=t.config,s=o[qe.RequestMethodNameSymbol],u=o[qe.RequestLogIdSymbol];s?qe.log.info("%s [%s] error %j",s,u,(r=t.response)==null?void 0:r.data):qe.log.error("[%s] error %j",u,(i=t.response)==null?void 0:i.data)}catch(o){}throw t}});var Gf=qe;hn.AuthClient=Gf});var Vf=Y(fl=>{"use strict";Object.defineProperty(fl,"__esModule",{value:!0});fl.LoginTicket=void 0;var Hf=class{constructor(e,t){x(this,"envelope");x(this,"payload");this.envelope=e,this.payload=t}getEnvelope(){return this.envelope}getPayload(){return this.payload}getUserId(){let e=this.getPayload();return e&&e.sub?e.sub:null}getAttributes(){return{envelope:this.getEnvelope(),payload:this.getPayload()}}};fl.LoginTicket=Hf});var ii=Y(Nn=>{"use strict";Object.defineProperty(Nn,"__esModule",{value:!0});Nn.OAuth2Client=Nn.ClientAuthentication=Nn.CertificateFormat=Nn.CodeChallengeMethod=void 0;var $_=Ze(),qR=require("querystring"),BR=require("stream"),GR=Mf(),W_=dn(),$f=Es(),no=Mt(),HR=Vf(),z_;(function(n){n.Plain="plain",n.S256="S256"})(z_||(Nn.CodeChallengeMethod=z_={}));var er;(function(n){n.PEM="PEM",n.JWK="JWK"})(er||(Nn.CertificateFormat=er={}));var Ss;(function(n){n.ClientSecretPost="ClientSecretPost",n.ClientSecretBasic="ClientSecretBasic",n.None="None"})(Ss||(Nn.ClientAuthentication=Ss={}));var mt=class mt extends no.AuthClient{constructor(t={},r,i){var o;super(typeof t=="object"?t:{});x(this,"redirectUri");x(this,"certificateCache",{});x(this,"certificateExpiry",null);x(this,"certificateCacheFormat",er.PEM);x(this,"refreshTokenPromises",new Map);x(this,"endpoints");x(this,"issuers");x(this,"clientAuthentication");x(this,"_clientId");x(this,"_clientSecret");x(this,"refreshHandler");typeof t!="object"&&(t={clientId:t,clientSecret:r,redirectUri:i}),this._clientId=t.clientId||t.client_id,this._clientSecret=t.clientSecret||t.client_secret,this.redirectUri=t.redirectUri||((o=t.redirect_uris)==null?void 0:o[0]),this.endpoints={tokenInfoUrl:"https://oauth2.googleapis.com/tokeninfo",oauth2AuthBaseUrl:"https://accounts.google.com/o/oauth2/v2/auth",oauth2TokenUrl:"https://oauth2.googleapis.com/token",oauth2RevokeUrl:"https://oauth2.googleapis.com/revoke",oauth2FederatedSignonPemCertsUrl:"https://www.googleapis.com/oauth2/v1/certs",oauth2FederatedSignonJwkCertsUrl:"https://www.googleapis.com/oauth2/v3/certs",oauth2IapPublicKeyUrl:"https://www.gstatic.com/iap/verify/public_key",...t.endpoints},this.clientAuthentication=t.clientAuthentication||Ss.ClientSecretPost,this.issuers=t.issuers||["accounts.google.com","https://accounts.google.com",this.universeDomain]}generateAuthUrl(t={}){if(t.code_challenge_method&&!t.code_challenge)throw new Error("If a code_challenge_method is provided, code_challenge must be included.");return t.response_type=t.response_type||"code",t.client_id=t.client_id||this._clientId,t.redirect_uri=t.redirect_uri||this.redirectUri,Array.isArray(t.scope)&&(t.scope=t.scope.join(" ")),this.endpoints.oauth2AuthBaseUrl.toString()+"?"+qR.stringify(t)}generateCodeVerifier(){throw new Error("generateCodeVerifier is removed, please use generateCodeVerifierAsync instead.")}async generateCodeVerifierAsync(){let t=(0,$f.createCrypto)(),i=t.randomBytesBase64(96).replace(/\+/g,"~").replace(/=/g,"_").replace(/\//g,"-"),s=(await t.sha256DigestBase64(i)).split("=")[0].replace(/\+/g,"-").replace(/\//g,"_");return{codeVerifier:i,codeChallenge:s}}getToken(t,r){let i=typeof t=="string"?{code:t}:t;if(r)this.getTokenAsync(i).then(o=>r(null,o.tokens,o.res),o=>r(o,null,o.response));else return this.getTokenAsync(i)}async getTokenAsync(t){let r=this.endpoints.oauth2TokenUrl.toString(),i=new Headers,o={client_id:t.client_id||this._clientId,code_verifier:t.codeVerifier,code:t.code,grant_type:"authorization_code",redirect_uri:t.redirect_uri||this.redirectUri};if(this.clientAuthentication===Ss.ClientSecretBasic){let d=Buffer.from(`${this._clientId}:${this._clientSecret}`);i.set("authorization",`Basic ${d.toString("base64")}`)}this.clientAuthentication===Ss.ClientSecretPost&&(o.client_secret=this._clientSecret);let s={...mt.RETRY_CONFIG,method:"POST",url:r,data:new URLSearchParams((0,W_.removeUndefinedValuesInObject)(o)),headers:i};no.AuthClient.setMethodName(s,"getTokenAsync");let u=await this.transporter.request(s),f=u.data;return u.data&&u.data.expires_in&&(f.expiry_date=new Date().getTime()+u.data.expires_in*1e3,delete f.expires_in),this.emit("tokens",f),{tokens:f,res:u}}async refreshToken(t){if(!t)return this.refreshTokenNoCache(t);if(this.refreshTokenPromises.has(t))return this.refreshTokenPromises.get(t);let r=this.refreshTokenNoCache(t).then(i=>(this.refreshTokenPromises.delete(t),i),i=>{throw this.refreshTokenPromises.delete(t),i});return this.refreshTokenPromises.set(t,r),r}async refreshTokenNoCache(t){var u;if(!t)throw new Error("No refresh token is set.");let r=this.endpoints.oauth2TokenUrl.toString(),i={refresh_token:t,client_id:this._clientId,client_secret:this._clientSecret,grant_type:"refresh_token"},o;try{let f={...mt.RETRY_CONFIG,method:"POST",url:r,data:new URLSearchParams((0,W_.removeUndefinedValuesInObject)(i))};no.AuthClient.setMethodName(f,"refreshTokenNoCache"),o=await this.transporter.request(f)}catch(f){throw f instanceof $_.GaxiosError&&f.message==="invalid_grant"&&((u=f.response)!=null&&u.data)&&/ReAuth/i.test(f.response.data.error_description)&&(f.message=JSON.stringify(f.response.data)),f}let s=o.data;return o.data&&o.data.expires_in&&(s.expiry_date=new Date().getTime()+o.data.expires_in*1e3,delete s.expires_in),this.emit("tokens",s),{tokens:s,res:o}}refreshAccessToken(t){if(t)this.refreshAccessTokenAsync().then(r=>t(null,r.credentials,r.res),t);else return this.refreshAccessTokenAsync()}async refreshAccessTokenAsync(){let t=await this.refreshToken(this.credentials.refresh_token),r=t.tokens;return r.refresh_token=this.credentials.refresh_token,this.credentials=r,{credentials:this.credentials,res:t.res}}getAccessToken(t){if(t)this.getAccessTokenAsync().then(r=>t(null,r.token,r.res),t);else return this.getAccessTokenAsync()}async getAccessTokenAsync(){if(!this.credentials.access_token||this.isTokenExpiring()){if(!this.credentials.refresh_token)if(this.refreshHandler){let i=await this.processAndValidateRefreshHandler();if(i!=null&&i.access_token)return this.setCredentials(i),{token:this.credentials.access_token}}else throw new Error("No refresh token or refresh handler callback is set.");let r=await this.refreshAccessTokenAsync();if(!r.credentials||r.credentials&&!r.credentials.access_token)throw new Error("Could not refresh access token.");return{token:r.credentials.access_token,res:r.res}}else return{token:this.credentials.access_token}}async getRequestHeaders(t){return(await this.getRequestMetadataAsync(t)).headers}async getRequestMetadataAsync(t){let r=this.credentials;if(!r.access_token&&!r.refresh_token&&!this.apiKey&&!this.refreshHandler)throw new Error("No access, refresh token, API key or refresh handler callback is set.");if(r.access_token&&!this.isTokenExpiring()){r.token_type=r.token_type||"Bearer";let f=new Headers({authorization:r.token_type+" "+r.access_token});return{headers:this.addSharedMetadataHeaders(f)}}if(this.refreshHandler){let f=await this.processAndValidateRefreshHandler();if(f!=null&&f.access_token){this.setCredentials(f);let d=new Headers({authorization:"Bearer "+this.credentials.access_token});return{headers:this.addSharedMetadataHeaders(d)}}}if(this.apiKey)return{headers:new Headers({"X-Goog-Api-Key":this.apiKey})};let i=null,o=null;try{i=await this.refreshToken(r.refresh_token),o=i.tokens}catch(f){let d=f;throw d.response&&(d.response.status===403||d.response.status===404)&&(d.message=`Could not refresh access token: ${d.message}`),d}let s=this.credentials;s.token_type=s.token_type||"Bearer",o.refresh_token=s.refresh_token,this.credentials=o;let u=new Headers({authorization:s.token_type+" "+o.access_token});return{headers:this.addSharedMetadataHeaders(u),res:i.res}}static getRevokeTokenUrl(t){return new mt().getRevokeTokenURL(t).toString()}getRevokeTokenURL(t){let r=new URL(this.endpoints.oauth2RevokeUrl);return r.searchParams.append("token",t),r}revokeToken(t,r){let i={...mt.RETRY_CONFIG,url:this.getRevokeTokenURL(t).toString(),method:"POST"};if(no.AuthClient.setMethodName(i,"revokeToken"),r)this.transporter.request(i).then(o=>r(null,o),r);else return this.transporter.request(i)}revokeCredentials(t){if(t)this.revokeCredentialsAsync().then(r=>t(null,r),t);else return this.revokeCredentialsAsync()}async revokeCredentialsAsync(){let t=this.credentials.access_token;if(this.credentials={},t)return this.revokeToken(t);throw new Error("No access token to revoke.")}request(t,r){if(r)this.requestAsync(t).then(i=>r(null,i),i=>r(i,i.response));else return this.requestAsync(t)}async requestAsync(t,r=!1){try{let i=await this.getRequestMetadataAsync();return t.headers=$_.Gaxios.mergeHeaders(t.headers),this.addUserProjectAndAuthHeaders(t.headers,i.headers),this.apiKey&&t.headers.set("X-Goog-Api-Key",this.apiKey),await this.transporter.request(t)}catch(i){let o=i.response;if(o){let s=o.status,u=this.credentials&&this.credentials.access_token&&this.credentials.refresh_token&&(!this.credentials.expiry_date||this.forceRefreshOnFailure),f=this.credentials&&this.credentials.access_token&&!this.credentials.refresh_token&&(!this.credentials.expiry_date||this.forceRefreshOnFailure)&&this.refreshHandler,d=o.config.data instanceof BR.Readable,h=s===401||s===403;if(!r&&h&&!d&&u)return await this.refreshAccessTokenAsync(),this.requestAsync(t,!0);if(!r&&h&&!d&&f){let m=await this.processAndValidateRefreshHandler();return m!=null&&m.access_token&&this.setCredentials(m),this.requestAsync(t,!0)}}throw i}}verifyIdToken(t,r){if(r&&typeof r!="function")throw new Error("This method accepts an options object as the first parameter, which includes the idToken, audience, and maxExpiry.");if(r)this.verifyIdTokenAsync(t).then(i=>r(null,i),r);else return this.verifyIdTokenAsync(t)}async verifyIdTokenAsync(t){if(!t.idToken)throw new Error("The verifyIdToken method requires an ID Token");let r=await this.getFederatedSignonCertsAsync();return await this.verifySignedJwtWithCertsAsync(t.idToken,r.certs,t.audience,this.issuers,t.maxExpiry)}async getTokenInfo(t){let{data:r}=await this.transporter.request({...mt.RETRY_CONFIG,method:"POST",headers:{"content-type":"application/x-www-form-urlencoded;charset=UTF-8",authorization:`Bearer ${t}`},url:this.endpoints.tokenInfoUrl.toString()}),i=Object.assign({expiry_date:new Date().getTime()+r.expires_in*1e3,scopes:r.scope.split(" ")},r);return delete i.expires_in,delete i.scope,i}getFederatedSignonCerts(t){if(t)this.getFederatedSignonCertsAsync().then(r=>t(null,r.certs,r.res),t);else return this.getFederatedSignonCertsAsync()}async getFederatedSignonCertsAsync(){var h,m;let t=new Date().getTime(),r=(0,$f.hasBrowserCrypto)()?er.JWK:er.PEM;if(this.certificateExpiry&&t<this.certificateExpiry.getTime()&&this.certificateCacheFormat===r)return{certs:this.certificateCache,format:r};let i,o;switch(r){case er.PEM:o=this.endpoints.oauth2FederatedSignonPemCertsUrl.toString();break;case er.JWK:o=this.endpoints.oauth2FederatedSignonJwkCertsUrl.toString();break;default:throw new Error(`Unsupported certificate format ${r}`)}try{let g={...mt.RETRY_CONFIG,url:o};no.AuthClient.setMethodName(g,"getFederatedSignonCertsAsync"),i=await this.transporter.request(g)}catch(g){throw g instanceof Error&&(g.message=`Failed to retrieve verification certificates: ${g.message}`),g}let s=i==null?void 0:i.headers.get("cache-control"),u=-1;if(s){let g=(m=(h=/max-age=(?<maxAge>[0-9]+)/.exec(s))==null?void 0:h.groups)==null?void 0:m.maxAge;g&&(u=Number(g)*1e3)}let f={};switch(r){case er.PEM:f=i.data;break;case er.JWK:for(let g of i.data.keys)f[g.kid]=g;break;default:throw new Error(`Unsupported certificate format ${r}`)}let d=new Date;return this.certificateExpiry=u===-1?null:new Date(d.getTime()+u),this.certificateCache=f,this.certificateCacheFormat=r,{certs:f,format:r,res:i}}getIapPublicKeys(t){if(t)this.getIapPublicKeysAsync().then(r=>t(null,r.pubkeys,r.res),t);else return this.getIapPublicKeysAsync()}async getIapPublicKeysAsync(){let t,r=this.endpoints.oauth2IapPublicKeyUrl.toString();try{let i={...mt.RETRY_CONFIG,url:r};no.AuthClient.setMethodName(i,"getIapPublicKeysAsync"),t=await this.transporter.request(i)}catch(i){throw i instanceof Error&&(i.message=`Failed to retrieve verification certificates: ${i.message}`),i}return{pubkeys:t.data,res:t}}verifySignedJwtWithCerts(){throw new Error("verifySignedJwtWithCerts is removed, please use verifySignedJwtWithCertsAsync instead.")}async verifySignedJwtWithCertsAsync(t,r,i,o,s){let u=(0,$f.createCrypto)();s||(s=mt.DEFAULT_MAX_TOKEN_LIFETIME_SECS_);let f=t.split(".");if(f.length!==3)throw new Error("Wrong number of segments in token: "+t);let d=f[0]+"."+f[1],h=f[2],m,g;try{m=JSON.parse(u.decodeBase64StringUtf8(f[0]))}catch(W){throw W instanceof Error&&(W.message=`Can't parse token envelope: ${f[0]}': ${W.message}`),W}if(!m)throw new Error("Can't parse token envelope: "+f[0]);try{g=JSON.parse(u.decodeBase64StringUtf8(f[1]))}catch(W){throw W instanceof Error&&(W.message=`Can't parse token payload '${f[0]}`),W}if(!g)throw new Error("Can't parse token payload: "+f[1]);if(!Object.prototype.hasOwnProperty.call(r,m.kid))throw new Error("No pem found for envelope: "+JSON.stringify(m));let _=r[m.kid];if(m.alg==="ES256"&&(h=GR.joseToDer(h,"ES256").toString("base64")),!await u.verify(_,d,h))throw new Error("Invalid token signature: "+t);if(!g.iat)throw new Error("No issue time in token: "+JSON.stringify(g));if(!g.exp)throw new Error("No expiration time in token: "+JSON.stringify(g));let C=Number(g.iat);if(isNaN(C))throw new Error("iat field using invalid format");let R=Number(g.exp);if(isNaN(R))throw new Error("exp field using invalid format");let I=new Date().getTime()/1e3;if(R>=I+s)throw new Error("Expiration time too far in future: "+JSON.stringify(g));let z=C-mt.CLOCK_SKEW_SECS_,$=R+mt.CLOCK_SKEW_SECS_;if(I<z)throw new Error("Token used too early, "+I+" < "+z+": "+JSON.stringify(g));if(I>$)throw new Error("Token used too late, "+I+" > "+$+": "+JSON.stringify(g));if(o&&o.indexOf(g.iss)<0)throw new Error("Invalid issuer, expected one of ["+o+"], but got "+g.iss);if(typeof i!="undefined"&&i!==null){let W=g.aud,H=!1;if(i.constructor===Array?H=i.indexOf(W)>-1:H=W===i,!H)throw new Error("Wrong recipient, payload audience != requiredAudience")}return new HR.LoginTicket(m,g)}async processAndValidateRefreshHandler(){if(this.refreshHandler){let t=await this.refreshHandler();if(!t.access_token)throw new Error("No access token is returned by the refreshHandler callback.");return t}}isTokenExpiring(){let t=this.credentials.expiry_date;return t?t<=new Date().getTime()+this.eagerRefreshThresholdMillis:!1}};x(mt,"GOOGLE_TOKEN_INFO_URL","https://oauth2.googleapis.com/tokeninfo"),x(mt,"CLOCK_SKEW_SECS_",300),x(mt,"DEFAULT_MAX_TOKEN_LIFETIME_SECS_",86400);var Wf=mt;Nn.OAuth2Client=Wf});var Jf=Y(dl=>{"use strict";Object.defineProperty(dl,"__esModule",{value:!0});dl.Compute=void 0;var VR=Ze(),J_=_s(),$R=ii(),zf=class extends $R.OAuth2Client{constructor(t={}){super(t);x(this,"serviceAccountEmail");x(this,"scopes");this.credentials={expiry_date:1,refresh_token:"compute-placeholder"},this.serviceAccountEmail=t.serviceAccountEmail||"default",this.scopes=Array.isArray(t.scopes)?t.scopes:t.scopes?[t.scopes]:[]}async refreshTokenNoCache(){let t=`service-accounts/${this.serviceAccountEmail}/token`,r;try{let o={property:t};this.scopes.length>0&&(o.params={scopes:this.scopes.join(",")}),r=await J_.instance(o)}catch(o){throw o instanceof VR.GaxiosError&&(o.message=`Could not refresh access token: ${o.message}`,this.wrapError(o)),o}let i=r;return r&&r.expires_in&&(i.expiry_date=new Date().getTime()+r.expires_in*1e3,delete i.expires_in),this.emit("tokens",i),{tokens:i,res:null}}async fetchIdToken(t){let r=`service-accounts/${this.serviceAccountEmail}/identity?format=full&audience=${t}`,i;try{let o={property:r};i=await J_.instance(o)}catch(o){throw o instanceof Error&&(o.message=`Could not fetch ID token: ${o.message}`),o}return i}wrapError(t){let r=t.response;r&&r.status&&(t.status=r.status,r.status===403?t.message="A Forbidden error was returned while attempting to retrieve an access token for the Compute Engine built-in service account. This may be because the Compute Engine instance does not have the correct permission scopes specified: "+t.message:r.status===404&&(t.message="A Not Found error was returned while attempting to retrieve an accesstoken for the Compute Engine built-in service account. This may be because the Compute Engine instance does not have any permission scopes specified: "+t.message))}};dl.Compute=zf});var Yf=Y(hl=>{"use strict";Object.defineProperty(hl,"__esModule",{value:!0});hl.IdTokenClient=void 0;var WR=ii(),Kf=class extends WR.OAuth2Client{constructor(t){super(t);x(this,"targetAudience");x(this,"idTokenProvider");this.targetAudience=t.targetAudience,this.idTokenProvider=t.idTokenProvider}async getRequestMetadataAsync(){if(!this.credentials.id_token||!this.credentials.expiry_date||this.isTokenExpiring()){let r=await this.idTokenProvider.fetchIdToken(this.targetAudience);this.credentials={id_token:r,expiry_date:this.getIdTokenExpiryDate(r)}}return{headers:new Headers({authorization:"Bearer "+this.credentials.id_token})}}getIdTokenExpiryDate(t){let r=t.split(".")[1];if(r)return JSON.parse(Buffer.from(r,"base64").toString("ascii")).exp*1e3}};hl.IdTokenClient=Kf});var Xf=Y(ro=>{"use strict";Object.defineProperty(ro,"__esModule",{value:!0});ro.GCPEnv=void 0;ro.clear=zR;ro.getEnv=JR;var K_=_s(),kn;(function(n){n.APP_ENGINE="APP_ENGINE",n.KUBERNETES_ENGINE="KUBERNETES_ENGINE",n.CLOUD_FUNCTIONS="CLOUD_FUNCTIONS",n.COMPUTE_ENGINE="COMPUTE_ENGINE",n.CLOUD_RUN="CLOUD_RUN",n.CLOUD_RUN_JOBS="CLOUD_RUN_JOBS",n.NONE="NONE"})(kn||(ro.GCPEnv=kn={}));var Ts;function zR(){Ts=void 0}async function JR(){return Ts||(Ts=KR(),Ts)}async function KR(){let n=kn.NONE;return YR()?n=kn.APP_ENGINE:XR()?n=kn.CLOUD_FUNCTIONS:await eI()?await jR()?n=kn.KUBERNETES_ENGINE:QR()?n=kn.CLOUD_RUN:ZR()?n=kn.CLOUD_RUN_JOBS:n=kn.COMPUTE_ENGINE:n=kn.NONE,n}function YR(){return!!(process.env.GAE_SERVICE||process.env.GAE_MODULE_NAME)}function XR(){return!!(process.env.FUNCTION_NAME||process.env.FUNCTION_TARGET)}function QR(){return!!process.env.K_CONFIGURATION}function ZR(){return!!process.env.CLOUD_RUN_JOB}async function jR(){try{return await K_.instance("attributes/cluster-name"),!0}catch(n){return!1}}async function eI(){return K_.isAvailable()}});var Qf=Y((bq,Y_)=>{var pl=to().Buffer,tI=require("stream"),nI=require("util");function ml(n){if(this.buffer=null,this.writable=!0,this.readable=!0,!n)return this.buffer=pl.alloc(0),this;if(typeof n.pipe=="function")return this.buffer=pl.alloc(0),n.pipe(this),this;if(n.length||typeof n=="object")return this.buffer=n,this.writable=!1,process.nextTick(function(){this.emit("end",n),this.readable=!1,this.emit("close")}.bind(this)),this;throw new TypeError("Unexpected data type ("+typeof n+")")}nI.inherits(ml,tI);ml.prototype.write=function(e){this.buffer=pl.concat([this.buffer,pl.from(e)]),this.emit("data",e)};ml.prototype.end=function(e){e&&this.write(e),this.emit("end",e),this.emit("close"),this.writable=!1,this.readable=!1};Y_.exports=ml});var Q_=Y((Rq,X_)=>{"use strict";var vs=require("buffer").Buffer,Zf=require("buffer").SlowBuffer;X_.exports=gl;function gl(n,e){if(!vs.isBuffer(n)||!vs.isBuffer(e)||n.length!==e.length)return!1;for(var t=0,r=0;r<n.length;r++)t|=n[r]^e[r];return t===0}gl.install=function(){vs.prototype.equal=Zf.prototype.equal=function(e){return gl(this,e)}};var rI=vs.prototype.equal,iI=Zf.prototype.equal;gl.restore=function(){vs.prototype.equal=rI,Zf.prototype.equal=iI}});var nd=Y((Iq,sE)=>{var oo=to().Buffer,Yt=require("crypto"),j_=Mf(),Z_=require("util"),oI=`"%s" is not a valid algorithm.
  Supported algorithms are:
  "HS256", "HS384", "HS512", "RS256", "RS384", "RS512", "PS256", "PS384", "PS512", "ES256", "ES384", "ES512" and "none".`,ws="secret must be a string or buffer",io="key must be a string or a buffer",sI="key must be a string, a buffer or an object",ed=typeof Yt.createPublicKey=="function";ed&&(io+=" or a KeyObject",ws+="or a KeyObject");function eE(n){if(!oo.isBuffer(n)&&typeof n!="string"&&(!ed||typeof n!="object"||typeof n.type!="string"||typeof n.asymmetricKeyType!="string"||typeof n.export!="function"))throw pn(io)}function tE(n){if(!oo.isBuffer(n)&&typeof n!="string"&&typeof n!="object")throw pn(sI)}function aI(n){if(!oo.isBuffer(n)){if(typeof n=="string")return n;if(!ed||typeof n!="object"||n.type!=="secret"||typeof n.export!="function")throw pn(ws)}}function td(n){return n.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function nE(n){n=n.toString();var e=4-n.length%4;if(e!==4)for(var t=0;t<e;++t)n+="=";return n.replace(/\-/g,"+").replace(/_/g,"/")}function pn(n){var e=[].slice.call(arguments,1),t=Z_.format.bind(Z_,n).apply(null,e);return new TypeError(t)}function lI(n){return oo.isBuffer(n)||typeof n=="string"}function Cs(n){return lI(n)||(n=JSON.stringify(n)),n}function rE(n){return function(t,r){aI(r),t=Cs(t);var i=Yt.createHmac("sha"+n,r),o=(i.update(t),i.digest("base64"));return td(o)}}var jf,uI="timingSafeEqual"in Yt?function(e,t){return e.byteLength!==t.byteLength?!1:Yt.timingSafeEqual(e,t)}:function(e,t){return jf||(jf=Q_()),jf(e,t)};function cI(n){return function(t,r,i){var o=rE(n)(t,i);return uI(oo.from(r),oo.from(o))}}function iE(n){return function(t,r){tE(r),t=Cs(t);var i=Yt.createSign("RSA-SHA"+n),o=(i.update(t),i.sign(r,"base64"));return td(o)}}function oE(n){return function(t,r,i){eE(i),t=Cs(t),r=nE(r);var o=Yt.createVerify("RSA-SHA"+n);return o.update(t),o.verify(i,r,"base64")}}function fI(n){return function(t,r){tE(r),t=Cs(t);var i=Yt.createSign("RSA-SHA"+n),o=(i.update(t),i.sign({key:r,padding:Yt.constants.RSA_PKCS1_PSS_PADDING,saltLength:Yt.constants.RSA_PSS_SALTLEN_DIGEST},"base64"));return td(o)}}function dI(n){return function(t,r,i){eE(i),t=Cs(t),r=nE(r);var o=Yt.createVerify("RSA-SHA"+n);return o.update(t),o.verify({key:i,padding:Yt.constants.RSA_PKCS1_PSS_PADDING,saltLength:Yt.constants.RSA_PSS_SALTLEN_DIGEST},r,"base64")}}function hI(n){var e=iE(n);return function(){var r=e.apply(null,arguments);return r=j_.derToJose(r,"ES"+n),r}}function pI(n){var e=oE(n);return function(r,i,o){i=j_.joseToDer(i,"ES"+n).toString("base64");var s=e(r,i,o);return s}}function mI(){return function(){return""}}function gI(){return function(e,t){return t===""}}sE.exports=function(e){var t={hs:rE,rs:iE,ps:fI,es:hI,none:mI},r={hs:cI,rs:oE,ps:dI,es:pI,none:gI},i=e.match(/^(RS|PS|ES|HS)(256|384|512)$|^(none)$/);if(!i)throw pn(oI,e);var o=(i[1]||i[3]).toLowerCase(),s=i[2];return{sign:t[o](s),verify:r[o](s)}}});var rd=Y((Pq,aE)=>{var yI=require("buffer").Buffer;aE.exports=function(e){return typeof e=="string"?e:typeof e=="number"||yI.isBuffer(e)?e.toString():JSON.stringify(e)}});var hE=Y((xq,dE)=>{var _I=to().Buffer,lE=Qf(),EI=nd(),SI=require("stream"),uE=rd(),id=require("util");function cE(n,e){return _I.from(n,e).toString("base64").replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function TI(n,e,t){t=t||"utf8";var r=cE(uE(n),"binary"),i=cE(uE(e),t);return id.format("%s.%s",r,i)}function fE(n){var e=n.header,t=n.payload,r=n.secret||n.privateKey,i=n.encoding,o=EI(e.alg),s=TI(e,t,i),u=o.sign(s,r);return id.format("%s.%s",s,u)}function yl(n){var e=n.secret||n.privateKey||n.key,t=new lE(e);this.readable=!0,this.header=n.header,this.encoding=n.encoding,this.secret=this.privateKey=this.key=t,this.payload=new lE(n.payload),this.secret.once("close",function(){!this.payload.writable&&this.readable&&this.sign()}.bind(this)),this.payload.once("close",function(){!this.secret.writable&&this.readable&&this.sign()}.bind(this))}id.inherits(yl,SI);yl.prototype.sign=function(){try{var e=fE({header:this.header,payload:this.payload.buffer,secret:this.secret.buffer,encoding:this.encoding});return this.emit("done",e),this.emit("data",e),this.emit("end"),this.readable=!1,e}catch(t){this.readable=!1,this.emit("error",t),this.emit("close")}};yl.sign=fE;dE.exports=yl});var wE=Y((Nq,vE)=>{var mE=to().Buffer,pE=Qf(),vI=nd(),wI=require("stream"),gE=rd(),CI=require("util"),AI=/^[a-zA-Z0-9\-_]+?\.[a-zA-Z0-9\-_]+?\.([a-zA-Z0-9\-_]+)?$/;function bI(n){return Object.prototype.toString.call(n)==="[object Object]"}function RI(n){if(bI(n))return n;try{return JSON.parse(n)}catch(e){return}}function yE(n){var e=n.split(".",1)[0];return RI(mE.from(e,"base64").toString("binary"))}function II(n){return n.split(".",2).join(".")}function _E(n){return n.split(".")[2]}function PI(n,e){e=e||"utf8";var t=n.split(".")[1];return mE.from(t,"base64").toString(e)}function EE(n){return AI.test(n)&&!!yE(n)}function SE(n,e,t){if(!e){var r=new Error("Missing algorithm parameter for jws.verify");throw r.code="MISSING_ALGORITHM",r}n=gE(n);var i=_E(n),o=II(n),s=vI(e);return s.verify(o,i,t)}function TE(n,e){if(e=e||{},n=gE(n),!EE(n))return null;var t=yE(n);if(!t)return null;var r=PI(n);return(t.typ==="JWT"||e.json)&&(r=JSON.parse(r,e.encoding)),{header:t,payload:r,signature:_E(n)}}function so(n){n=n||{};var e=n.secret||n.publicKey||n.key,t=new pE(e);this.readable=!0,this.algorithm=n.algorithm,this.encoding=n.encoding,this.secret=this.publicKey=this.key=t,this.signature=new pE(n.signature),this.secret.once("close",function(){!this.signature.writable&&this.readable&&this.verify()}.bind(this)),this.signature.once("close",function(){!this.secret.writable&&this.readable&&this.verify()}.bind(this))}CI.inherits(so,wI);so.prototype.verify=function(){try{var e=SE(this.signature.buffer,this.algorithm,this.key.buffer),t=TE(this.signature.buffer,this.encoding);return this.emit("done",e,t),this.emit("data",e),this.emit("end"),this.readable=!1,e}catch(r){this.readable=!1,this.emit("error",r),this.emit("close")}};so.decode=TE;so.isValid=EE;so.verify=SE;vE.exports=so});var od=Y(br=>{var CE=hE(),_l=wE(),xI=["HS256","HS384","HS512","RS256","RS384","RS512","PS256","PS384","PS512","ES256","ES384","ES512"];br.ALGORITHMS=xI;br.sign=CE.sign;br.verify=_l.verify;br.decode=_l.decode;br.isValid=_l.isValid;br.createSign=function(e){return new CE(e)};br.createVerify=function(e){return new _l(e)}});var qE=Y(Sl=>{"use strict";Object.defineProperty(Sl,"__esModule",{value:!0});Sl.GoogleToken=void 0;var AE=El(require("fs")),NI=Ze(),kI=El(od()),MI=El(require("path")),DI=require("util");function El(n,e){if(typeof WeakMap=="function")var t=new WeakMap,r=new WeakMap;return(El=function(o,s){if(!s&&o&&o.__esModule)return o;var u,f,d={__proto__:null,default:o};if(o===null||tr(o)!="object"&&typeof o!="function")return d;if(u=s?r:t){if(u.has(o))return u.get(o);u.set(o,d)}for(var h in o)h!=="default"&&{}.hasOwnProperty.call(o,h)&&((f=(u=Object.defineProperty)&&Object.getOwnPropertyDescriptor(o,h))&&(f.get||f.set)?u(d,h,f):d[h]=o[h]);return d})(n,e)}function tr(n){"@babel/helpers - typeof";return tr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},tr(n)}function OI(n,e){DE(n,e),e.add(n)}function UI(n,e,t){DE(n,e),e.set(n,t)}function DE(n,e){if(e.has(n))throw new TypeError("Cannot initialize the same private elements twice on an object")}function bE(n,e,t){return n.set(mn(n,e),t),t}function RE(n,e){return n.get(mn(n,e))}function mn(n,e,t){if(typeof n=="function"?n===e:n.has(e))return arguments.length<3?e:t;throw new TypeError("Private element is not present on this object")}function IE(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,FE(r.key),r)}}function OE(n,e,t){return e&&IE(n.prototype,e),t&&IE(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n}function UE(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function FI(n,e,t){return e=Is(e),LI(n,fd()?Reflect.construct(e,t||[],Is(n).constructor):e.apply(n,t))}function LI(n,e){if(e&&(tr(e)=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return qI(n)}function qI(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function BI(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&Rs(n,e)}function sd(n){var e=typeof Map=="function"?new Map:void 0;return sd=function(r){if(r===null||!HI(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(e!==void 0){if(e.has(r))return e.get(r);e.set(r,i)}function i(){return GI(r,arguments,Is(this).constructor)}return i.prototype=Object.create(r.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),Rs(i,r)},sd(n)}function GI(n,e,t){if(fd())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,e);var i=new(n.bind.apply(n,r));return t&&Rs(i,t.prototype),i}function fd(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(fd=function(){return!!n})()}function HI(n){try{return Function.toString.call(n).indexOf("[native code]")!==-1}catch(e){return typeof n=="function"}}function Rs(n,e){return Rs=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},Rs(n,e)}function Is(n){return Is=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Is(n)}function Dt(n,e,t){return(e=FE(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function FE(n){var e=VI(n,"string");return tr(e)=="symbol"?e:e+""}function VI(n,e){if(tr(n)!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e||"default");if(tr(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function Ut(){var n,e,t=typeof Symbol=="function"?Symbol:{},r=t.iterator||"@@iterator",i=t.toStringTag||"@@toStringTag";function o(_,v,C,R){var I=v&&v.prototype instanceof u?v:u,z=Object.create(I.prototype);return Ot(z,"_invoke",(function($,W,H){var G,K,te,T=0,L=H||[],X=!1,ee={p:0,n:0,v:n,a:Z,f:Z.bind(n,4),d:function(we,_e){return G=we,K=0,te=n,ee.n=_e,s}};function Z(j,we){for(K=j,te=we,e=0;!X&&T&&!_e&&e<L.length;e++){var _e,Re=L[e],Ae=ee.p,Fe=Re[2];j>3?(_e=Fe===we)&&(te=Re[(K=Re[4])?5:(K=3,3)],Re[4]=Re[5]=n):Re[0]<=Ae&&((_e=j<2&&Ae<Re[1])?(K=0,ee.v=we,ee.n=Re[1]):Ae<Fe&&(_e=j<3||Re[0]>we||we>Fe)&&(Re[4]=j,Re[5]=we,ee.n=Fe,K=0))}if(_e||j>1)return s;throw X=!0,we}return function(j,we,_e){if(T>1)throw TypeError("Generator is already running");for(X&&we===1&&Z(we,_e),K=we,te=_e;(e=K<2?n:te)||!X;){G||(K?K<3?(K>1&&(ee.n=-1),Z(K,te)):ee.n=te:ee.v=te);try{if(T=2,G){if(K||(j="next"),e=G[j]){if(!(e=e.call(G,te)))throw TypeError("iterator result is not an object");if(!e.done)return e;te=e.value,K<2&&(K=0)}else K===1&&(e=G.return)&&e.call(G),K<2&&(te=TypeError("The iterator does not provide a '"+j+"' method"),K=1);G=n}else if((e=(X=ee.n<0)?te:$.call(W,ee))!==s)break}catch(Re){G=n,K=1,te=Re}finally{T=1}}return{value:e,done:X}}})(_,C,R),!0),z}var s={};function u(){}function f(){}function d(){}e=Object.getPrototypeOf;var h=[][r]?e(e([][r]())):(Ot(e={},r,function(){return this}),e),m=d.prototype=u.prototype=Object.create(h);function g(_){return Object.setPrototypeOf?Object.setPrototypeOf(_,d):(_.__proto__=d,Ot(_,i,"GeneratorFunction")),_.prototype=Object.create(m),_}return f.prototype=d,Ot(m,"constructor",d),Ot(d,"constructor",f),f.displayName="GeneratorFunction",Ot(d,i,"GeneratorFunction"),Ot(m),Ot(m,i,"Generator"),Ot(m,r,function(){return this}),Ot(m,"toString",function(){return"[object Generator]"}),(Ut=function(){return{w:o,m:g}})()}function Ot(n,e,t,r){var i=Object.defineProperty;try{i({},"",{})}catch(o){i=0}Ot=function(s,u,f,d){if(u)i?i(s,u,{value:f,enumerable:!d,configurable:!d,writable:!d}):s[u]=f;else{var h=function(g,_){Ot(s,g,function(v){return this._invoke(g,_,v)})};h("next",0),h("throw",1),h("return",2)}},Ot(n,e,t,r)}function PE(n,e,t,r,i,o,s){try{var u=n[o](s),f=u.value}catch(d){return void t(d)}u.done?e(f):Promise.resolve(f).then(r,i)}function ao(n){return function(){var e=this,t=arguments;return new Promise(function(r,i){var o=n.apply(e,t);function s(f){PE(o,r,i,s,u,"next",f)}function u(f){PE(o,r,i,s,u,"throw",f)}s(void 0)})}}var xE=AE.readFile?(0,DI.promisify)(AE.readFile):ao(Ut().m(function n(){return Ut().w(function(e){for(;;)switch(e.n){case 0:throw new bs("use key rather than keyFile.","MISSING_CREDENTIALS");case 1:return e.a(2)}},n)})),NE="https://oauth2.googleapis.com/token",$I="https://oauth2.googleapis.com/revoke?token=",bs=(function(n){function e(t,r){var i;return UE(this,e),i=FI(this,e,[t]),Dt(i,"code",void 0),i.code=r,i}return BI(e,n),OE(e)})(sd(Error)),As=new WeakMap,Mn=new WeakSet,Mq=Sl.GoogleToken=(function(){function n(e){UE(this,n),OI(this,Mn),Dt(this,"expiresAt",void 0),Dt(this,"key",void 0),Dt(this,"keyFile",void 0),Dt(this,"iss",void 0),Dt(this,"sub",void 0),Dt(this,"scope",void 0),Dt(this,"rawToken",void 0),Dt(this,"tokenExpires",void 0),Dt(this,"email",void 0),Dt(this,"additionalClaims",void 0),Dt(this,"eagerRefreshThresholdMillis",void 0),Dt(this,"transporter",{request:function(r){return(0,NI.request)(r)}}),UI(this,As,void 0),mn(Mn,this,LE).call(this,e)}return OE(n,[{key:"accessToken",get:function(){return this.rawToken?this.rawToken.access_token:void 0}},{key:"idToken",get:function(){return this.rawToken?this.rawToken.id_token:void 0}},{key:"tokenType",get:function(){return this.rawToken?this.rawToken.token_type:void 0}},{key:"refreshToken",get:function(){return this.rawToken?this.rawToken.refresh_token:void 0}},{key:"hasExpired",value:function(){var t=new Date().getTime();return this.rawToken&&this.expiresAt?t>=this.expiresAt:!0}},{key:"isTokenExpiring",value:function(){var t,r=new Date().getTime(),i=(t=this.eagerRefreshThresholdMillis)!==null&&t!==void 0?t:0;return this.rawToken&&this.expiresAt?this.expiresAt<=r+i:!0}},{key:"getToken",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(tr(t)==="object"&&(r=t,t=void 0),r=Object.assign({forceRefresh:!1},r),t){var i=t;mn(Mn,this,kE).call(this,r).then(function(o){return i(null,o)},t);return}return mn(Mn,this,kE).call(this,r)}},{key:"getCredentials",value:(function(){var e=ao(Ut().m(function r(i){var o,s,u,f,d,h,m;return Ut().w(function(g){for(;;)switch(g.n){case 0:o=MI.extname(i),m=o,g.n=m===".json"?1:m===".der"||m===".crt"||m===".pem"?4:m===".p12"||m===".pfx"?6:7;break;case 1:return g.n=2,xE(i,"utf8");case 2:if(s=g.v,u=JSON.parse(s),f=u.private_key,d=u.client_email,!(!f||!d)){g.n=3;break}throw new bs("private_key and client_email are required.","MISSING_CREDENTIALS");case 3:return g.a(2,{privateKey:f,clientEmail:d});case 4:return g.n=5,xE(i,"utf8");case 5:return h=g.v,g.a(2,{privateKey:h});case 6:throw new bs("*.p12 certificates are not supported after v6.1.2. Consider utilizing *.json format or converting *.p12 to *.pem using the OpenSSL CLI.","UNKNOWN_CERTIFICATE_TYPE");case 7:throw new bs("Unknown certificate type. Type is determined based on file extension. Current supported extensions are *.json, and *.pem.","UNKNOWN_CERTIFICATE_TYPE");case 8:return g.a(2)}},r)}));function t(r){return e.apply(this,arguments)}return t})()},{key:"revokeToken",value:function(t){if(t){mn(Mn,this,ME).call(this).then(function(){return t()},t);return}return mn(Mn,this,ME).call(this)}}])})();function kE(n){return ad.apply(this,arguments)}function ad(){return ad=ao(Ut().m(function n(e){return Ut().w(function(t){for(;;)switch(t.n){case 0:if(!(RE(As,this)&&!e.forceRefresh)){t.n=1;break}return t.a(2,RE(As,this));case 1:return t.p=1,t.n=2,bE(As,this,mn(Mn,this,WI).call(this,e));case 2:return t.a(2,t.v);case 3:return t.p=3,bE(As,this,void 0),t.f(3);case 4:return t.a(2)}},n,this,[[1,,3,4]])})),ad.apply(this,arguments)}function WI(n){return ld.apply(this,arguments)}function ld(){return ld=ao(Ut().m(function n(e){var t;return Ut().w(function(r){for(;;)switch(r.n){case 0:if(!(this.isTokenExpiring()===!1&&e.forceRefresh===!1)){r.n=1;break}return r.a(2,Promise.resolve(this.rawToken));case 1:if(!(!this.key&&!this.keyFile)){r.n=2;break}throw new Error("No key or keyFile set.");case 2:if(!(!this.key&&this.keyFile)){r.n=4;break}return r.n=3,this.getCredentials(this.keyFile);case 3:t=r.v,this.key=t.privateKey,this.iss=t.clientEmail||this.iss,t.clientEmail||mn(Mn,this,zI).call(this);case 4:return r.a(2,mn(Mn,this,JI).call(this))}},n,this)})),ld.apply(this,arguments)}function zI(){if(!this.iss)throw new bs("email is required.","MISSING_CREDENTIALS")}function ME(){return ud.apply(this,arguments)}function ud(){return ud=ao(Ut().m(function n(){var e;return Ut().w(function(t){for(;;)switch(t.n){case 0:if(this.accessToken){t.n=1;break}throw new Error("No token to revoke.");case 1:return e=$I+this.accessToken,t.n=2,this.transporter.request({url:e,retry:!0});case 2:mn(Mn,this,LE).call(this,{email:this.iss,sub:this.sub,key:this.key,keyFile:this.keyFile,scope:this.scope,additionalClaims:this.additionalClaims});case 3:return t.a(2)}},n,this)})),ud.apply(this,arguments)}function LE(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.keyFile=n.keyFile,this.key=n.key,this.rawToken=void 0,this.iss=n.email||n.iss,this.sub=n.sub,this.additionalClaims=n.additionalClaims,tr(n.scope)==="object"?this.scope=n.scope.join(" "):this.scope=n.scope,this.eagerRefreshThresholdMillis=n.eagerRefreshThresholdMillis,n.transporter&&(this.transporter=n.transporter)}function JI(){return cd.apply(this,arguments)}function cd(){return cd=ao(Ut().m(function n(){var e,t,r,i,o,s,u,f,d,h;return Ut().w(function(m){for(;;)switch(m.n){case 0:return e=Math.floor(new Date().getTime()/1e3),t=this.additionalClaims||{},r=Object.assign({iss:this.iss,scope:this.scope,aud:NE,exp:e+3600,iat:e,sub:this.sub},t),i=kI.sign({header:{alg:"RS256"},payload:r,secret:this.key}),m.p=1,m.n=2,this.transporter.request({method:"POST",url:NE,data:new URLSearchParams({grant_type:"urn:ietf:params:oauth:grant-type:jwt-bearer",assertion:i}),responseType:"json",retryConfig:{httpMethodsToRetry:["POST"]}});case 2:return o=m.v,this.rawToken=o.data,this.expiresAt=o.data.expires_in===null||o.data.expires_in===void 0?void 0:(e+o.data.expires_in)*1e3,m.a(2,this.rawToken);case 3:throw m.p=3,h=m.v,this.rawToken=void 0,this.tokenExpires=void 0,f=h.response&&(s=h.response)!==null&&s!==void 0&&s.data?(u=h.response)===null||u===void 0?void 0:u.data:{},f.error&&(d=f.error_description?": ".concat(f.error_description):"",h.message="".concat(f.error).concat(d)),h;case 4:return m.a(2)}},n,this,[[1,3]])})),cd.apply(this,arguments)}});var hd=Y(Tl=>{"use strict";Object.defineProperty(Tl,"__esModule",{value:!0});Tl.JWTAccess=void 0;var KI=od(),YI=dn(),BE={alg:"RS256",typ:"JWT"},dd=class n{constructor(e,t,r,i){x(this,"email");x(this,"key");x(this,"keyId");x(this,"projectId");x(this,"eagerRefreshThresholdMillis");x(this,"cache",new YI.LRUCache({capacity:500,maxAge:3600*1e3}));this.email=e,this.key=t,this.keyId=r,this.eagerRefreshThresholdMillis=i!=null?i:300*1e3}getCachedKey(e,t){let r=e;if(t&&Array.isArray(t)&&t.length?r=e?`${e}_${t.join("_")}`:`${t.join("_")}`:typeof t=="string"&&(r=e?`${e}_${t}`:t),!r)throw Error("Scopes or url must be provided");return r}getRequestHeaders(e,t,r){let i=this.getCachedKey(e,r),o=this.cache.get(i),s=Date.now();if(o&&o.expiration-s>this.eagerRefreshThresholdMillis)return new Headers(o.headers);let u=Math.floor(Date.now()/1e3),f=n.getExpirationTime(u),d;if(Array.isArray(r)&&(r=r.join(" ")),r?d={iss:this.email,sub:this.email,scope:r,exp:f,iat:u}:d={iss:this.email,sub:this.email,aud:e,exp:f,iat:u},t){for(let v in d)if(t[v])throw new Error(`The '${v}' property is not allowed when passing additionalClaims. This claim is included in the JWT by default.`)}let h=this.keyId?{...BE,kid:this.keyId}:BE,m=Object.assign(d,t),g=KI.sign({header:h,payload:m,secret:this.key}),_=new Headers({authorization:`Bearer ${g}`});return this.cache.set(i,{expiration:f*1e3,headers:_}),_}static getExpirationTime(e){return e+3600}fromJSON(e){if(!e)throw new Error("Must pass in a JSON object containing the service account auth settings.");if(!e.client_email)throw new Error("The incoming JSON object does not contain a client_email field");if(!e.private_key)throw new Error("The incoming JSON object does not contain a private_key field");this.email=e.client_email,this.key=e.private_key,this.keyId=e.private_key_id,this.projectId=e.project_id}fromStream(e,t){if(t)this.fromStreamAsync(e).then(()=>t(),t);else return this.fromStreamAsync(e)}fromStreamAsync(e){return new Promise((t,r)=>{e||r(new Error("Must pass in a stream containing the service account auth settings."));let i="";e.setEncoding("utf8").on("data",o=>i+=o).on("error",r).on("end",()=>{try{let o=JSON.parse(i);this.fromJSON(o),t()}catch(o){r(o)}})})}};Tl.JWTAccess=dd});var md=Y(wl=>{"use strict";Object.defineProperty(wl,"__esModule",{value:!0});wl.JWT=void 0;var GE=qE(),XI=hd(),QI=ii(),vl=Mt(),pd=class n extends QI.OAuth2Client{constructor(t={}){super(t);x(this,"email");x(this,"keyFile");x(this,"key");x(this,"keyId");x(this,"defaultScopes");x(this,"scopes");x(this,"scope");x(this,"subject");x(this,"gtoken");x(this,"additionalClaims");x(this,"useJWTAccessWithScope");x(this,"defaultServicePath");x(this,"access");this.email=t.email,this.keyFile=t.keyFile,this.key=t.key,this.keyId=t.keyId,this.scopes=t.scopes,this.subject=t.subject,this.additionalClaims=t.additionalClaims,this.credentials={refresh_token:"jwt-placeholder",expiry_date:1}}createScoped(t){let r=new n(this);return r.scopes=t,r}async getRequestMetadataAsync(t){t=this.defaultServicePath?`https://${this.defaultServicePath}/`:t;let r=!this.hasUserScopes()&&t||this.useJWTAccessWithScope&&this.hasAnyScopes()||this.universeDomain!==vl.DEFAULT_UNIVERSE;if(this.subject&&this.universeDomain!==vl.DEFAULT_UNIVERSE)throw new RangeError(`Service Account user is configured for the credential. Domain-wide delegation is not supported in universes other than ${vl.DEFAULT_UNIVERSE}`);if(!this.apiKey&&r)if(this.additionalClaims&&this.additionalClaims.target_audience){let{tokens:i}=await this.refreshToken();return{headers:this.addSharedMetadataHeaders(new Headers({authorization:`Bearer ${i.id_token}`}))}}else{this.access||(this.access=new XI.JWTAccess(this.email,this.key,this.keyId,this.eagerRefreshThresholdMillis));let i;this.hasUserScopes()?i=this.scopes:t||(i=this.defaultScopes);let o=this.useJWTAccessWithScope||this.universeDomain!==vl.DEFAULT_UNIVERSE,s=await this.access.getRequestHeaders(t!=null?t:void 0,this.additionalClaims,o?i:void 0);return{headers:this.addSharedMetadataHeaders(s)}}else return this.hasAnyScopes()||this.apiKey?super.getRequestMetadataAsync(t):{headers:new Headers}}async fetchIdToken(t){let r=new GE.GoogleToken({iss:this.email,sub:this.subject,scope:this.scopes||this.defaultScopes,keyFile:this.keyFile,key:this.key,additionalClaims:{target_audience:t},transporter:this.transporter});if(await r.getToken({forceRefresh:!0}),!r.idToken)throw new Error("Unknown error: Failed to fetch ID token");return r.idToken}hasUserScopes(){return this.scopes?this.scopes.length>0:!1}hasAnyScopes(){return!!(this.scopes&&this.scopes.length>0||this.defaultScopes&&this.defaultScopes.length>0)}authorize(t){if(t)this.authorizeAsync().then(r=>t(null,r),t);else return this.authorizeAsync()}async authorizeAsync(){let t=await this.refreshToken();if(!t)throw new Error("No result returned");return this.credentials=t.tokens,this.credentials.refresh_token="jwt-placeholder",this.key=this.gtoken.key,this.email=this.gtoken.iss,t.tokens}async refreshTokenNoCache(){let t=this.createGToken(),i={access_token:(await t.getToken({forceRefresh:this.isTokenExpiring()})).access_token,token_type:"Bearer",expiry_date:t.expiresAt,id_token:t.idToken};return this.emit("tokens",i),{res:null,tokens:i}}createGToken(){return this.gtoken||(this.gtoken=new GE.GoogleToken({iss:this.email,sub:this.subject,scope:this.scopes||this.defaultScopes,keyFile:this.keyFile,key:this.key,additionalClaims:this.additionalClaims,transporter:this.transporter})),this.gtoken}fromJSON(t){if(!t)throw new Error("Must pass in a JSON object containing the service account auth settings.");if(!t.client_email)throw new Error("The incoming JSON object does not contain a client_email field");if(!t.private_key)throw new Error("The incoming JSON object does not contain a private_key field");this.email=t.client_email,this.key=t.private_key,this.keyId=t.private_key_id,this.projectId=t.project_id,this.quotaProjectId=t.quota_project_id,this.universeDomain=t.universe_domain||this.universeDomain}fromStream(t,r){if(r)this.fromStreamAsync(t).then(()=>r(),r);else return this.fromStreamAsync(t)}fromStreamAsync(t){return new Promise((r,i)=>{if(!t)throw new Error("Must pass in a stream containing the service account auth settings.");let o="";t.setEncoding("utf8").on("error",i).on("data",s=>o+=s).on("end",()=>{try{let s=JSON.parse(o);this.fromJSON(s),r()}catch(s){i(s)}})})}fromAPIKey(t){if(typeof t!="string")throw new Error("Must provide an API Key string.");this.apiKey=t}async getCredentials(){if(this.key)return{private_key:this.key,client_email:this.email};if(this.keyFile){let r=await this.createGToken().getCredentials(this.keyFile);return{private_key:r.privateKey,client_email:r.clientEmail}}throw new Error("A key or a keyFile must be provided to getCredentials.")}};wl.JWT=pd});var yd=Y(lo=>{"use strict";Object.defineProperty(lo,"__esModule",{value:!0});lo.UserRefreshClient=lo.USER_REFRESH_ACCOUNT_TYPE=void 0;var ZI=ii(),jI=Mt();lo.USER_REFRESH_ACCOUNT_TYPE="authorized_user";var gd=class n extends ZI.OAuth2Client{constructor(t,r,i,o,s){let u=t&&typeof t=="object"?t:{clientId:t,clientSecret:r,refreshToken:i,eagerRefreshThresholdMillis:o,forceRefreshOnFailure:s};super(u);x(this,"_refreshToken");this._refreshToken=u.refreshToken,this.credentials.refresh_token=u.refreshToken}async refreshTokenNoCache(){return super.refreshTokenNoCache(this._refreshToken)}async fetchIdToken(t){let r={...n.RETRY_CONFIG,url:this.endpoints.oauth2TokenUrl,method:"POST",data:new URLSearchParams({client_id:this._clientId,client_secret:this._clientSecret,grant_type:"refresh_token",refresh_token:this._refreshToken,target_audience:t})};return jI.AuthClient.setMethodName(r,"fetchIdToken"),(await this.transporter.request(r)).data.id_token}fromJSON(t){if(!t)throw new Error("Must pass in a JSON object containing the user refresh token");if(t.type!=="authorized_user")throw new Error('The incoming JSON object does not have the "authorized_user" type');if(!t.client_id)throw new Error("The incoming JSON object does not contain a client_id field");if(!t.client_secret)throw new Error("The incoming JSON object does not contain a client_secret field");if(!t.refresh_token)throw new Error("The incoming JSON object does not contain a refresh_token field");this._clientId=t.client_id,this._clientSecret=t.client_secret,this._refreshToken=t.refresh_token,this.credentials.refresh_token=t.refresh_token,this.quotaProjectId=t.quota_project_id,this.universeDomain=t.universe_domain||this.universeDomain}fromStream(t,r){if(r)this.fromStreamAsync(t).then(()=>r(),r);else return this.fromStreamAsync(t)}async fromStreamAsync(t){return new Promise((r,i)=>{if(!t)return i(new Error("Must pass in a stream containing the user refresh token."));let o="";t.setEncoding("utf8").on("error",i).on("data",s=>o+=s).on("end",()=>{try{let s=JSON.parse(o);return this.fromJSON(s),r()}catch(s){return i(s)}})})}static fromJSON(t){let r=new n;return r.fromJSON(t),r}};lo.UserRefreshClient=gd});var Ed=Y(uo=>{"use strict";Object.defineProperty(uo,"__esModule",{value:!0});uo.Impersonated=uo.IMPERSONATED_ACCOUNT_TYPE=void 0;var HE=ii(),eP=Ze(),tP=dn();uo.IMPERSONATED_ACCOUNT_TYPE="impersonated_service_account";var _d=class n extends HE.OAuth2Client{constructor(t={}){var i,o,s,u,f,d;super(t);x(this,"sourceClient");x(this,"targetPrincipal");x(this,"targetScopes");x(this,"delegates");x(this,"lifetime");x(this,"endpoint");if(this.credentials={expiry_date:1,refresh_token:"impersonated-placeholder"},this.sourceClient=(i=t.sourceClient)!=null?i:new HE.OAuth2Client,this.targetPrincipal=(o=t.targetPrincipal)!=null?o:"",this.delegates=(s=t.delegates)!=null?s:[],this.targetScopes=(u=t.targetScopes)!=null?u:[],this.lifetime=(f=t.lifetime)!=null?f:3600,!!!(0,tP.originalOrCamelOptions)(t).get("universe_domain"))this.universeDomain=this.sourceClient.universeDomain;else if(this.sourceClient.universeDomain!==this.universeDomain)throw new RangeError(`Universe domain ${this.sourceClient.universeDomain} in source credentials does not match ${this.universeDomain} universe domain set for impersonated credentials.`);this.endpoint=(d=t.endpoint)!=null?d:`https://iamcredentials.${this.universeDomain}`}async sign(t){await this.sourceClient.getAccessToken();let r=`projects/-/serviceAccounts/${this.targetPrincipal}`,i=`${this.endpoint}/v1/${r}:signBlob`,o={delegates:this.delegates,payload:Buffer.from(t).toString("base64")};return(await this.sourceClient.request({...n.RETRY_CONFIG,url:i,data:o,method:"POST"})).data}getTargetPrincipal(){return this.targetPrincipal}async refreshToken(){var t,r,i,o,s,u;try{await this.sourceClient.getAccessToken();let f="projects/-/serviceAccounts/"+this.targetPrincipal,d=`${this.endpoint}/v1/${f}:generateAccessToken`,h={delegates:this.delegates,scope:this.targetScopes,lifetime:this.lifetime+"s"},m=await this.sourceClient.request({...n.RETRY_CONFIG,url:d,data:h,method:"POST"}),g=m.data;return this.credentials.access_token=g.accessToken,this.credentials.expiry_date=Date.parse(g.expireTime),{tokens:this.credentials,res:m}}catch(f){if(!(f instanceof Error))throw f;let d=0,h="";throw f instanceof eP.GaxiosError&&(d=(i=(r=(t=f==null?void 0:f.response)==null?void 0:t.data)==null?void 0:r.error)==null?void 0:i.status,h=(u=(s=(o=f==null?void 0:f.response)==null?void 0:o.data)==null?void 0:s.error)==null?void 0:u.message),d&&h?(f.message=`${d}: unable to impersonate: ${h}`,f):(f.message=`unable to impersonate: ${f}`,f)}}async fetchIdToken(t,r){var f,d;await this.sourceClient.getAccessToken();let i=`projects/-/serviceAccounts/${this.targetPrincipal}`,o=`${this.endpoint}/v1/${i}:generateIdToken`,s={delegates:this.delegates,audience:t,includeEmail:(f=r==null?void 0:r.includeEmail)!=null?f:!0,useEmailAzp:(d=r==null?void 0:r.includeEmail)!=null?d:!0};return(await this.sourceClient.request({...n.RETRY_CONFIG,url:o,data:s,method:"POST"})).data.token}};uo.Impersonated=_d});var Td=Y(Ps=>{"use strict";Object.defineProperty(Ps,"__esModule",{value:!0});Ps.OAuthClientAuthHandler=void 0;Ps.getErrorFromOAuthErrorResponse=iP;var co=Ze(),nP=Es(),rP=["PUT","POST","PATCH"],Cl,gt,Sd=class{constructor(e){se(this,Cl,(0,nP.createCrypto)());se(this,gt);x(this,"transporter");e&&"clientId"in e?(ce(this,gt,e),this.transporter=new co.Gaxios):(ce(this,gt,e==null?void 0:e.clientAuthentication),this.transporter=(e==null?void 0:e.transporter)||new co.Gaxios)}applyClientAuthenticationOptions(e,t){e.headers=co.Gaxios.mergeHeaders(e.headers),this.injectAuthenticatedHeaders(e,t),t||this.injectAuthenticatedRequestBody(e)}injectAuthenticatedHeaders(e,t){var r;if(t)e.headers=co.Gaxios.mergeHeaders(e.headers,{authorization:`Bearer ${t}`});else if(((r=D(this,gt))==null?void 0:r.confidentialClientType)==="basic"){e.headers=co.Gaxios.mergeHeaders(e.headers);let i=D(this,gt).clientId,o=D(this,gt).clientSecret||"",s=D(this,Cl).encodeBase64StringUtf8(`${i}:${o}`);co.Gaxios.mergeHeaders(e.headers,{authorization:`Basic ${s}`})}}injectAuthenticatedRequestBody(e){var t,r;if(((t=D(this,gt))==null?void 0:t.confidentialClientType)==="request-body"){let i=(e.method||"GET").toUpperCase();if(!rP.includes(i))throw new Error(`${i} HTTP method does not support ${D(this,gt).confidentialClientType} client authentication`);let s=new Headers(e.headers).get("content-type");if(s!=null&&s.startsWith("application/x-www-form-urlencoded")||e.data instanceof URLSearchParams){let u=new URLSearchParams((r=e.data)!=null?r:"");u.append("client_id",D(this,gt).clientId),u.append("client_secret",D(this,gt).clientSecret||""),e.data=u}else if(s!=null&&s.startsWith("application/json"))e.data=e.data||{},Object.assign(e.data,{client_id:D(this,gt).clientId,client_secret:D(this,gt).clientSecret||""});else throw new Error(`${s} content-types are not supported with ${D(this,gt).confidentialClientType} client authentication`)}}static get RETRY_CONFIG(){return{retry:!0,retryConfig:{httpMethodsToRetry:["GET","PUT","POST","HEAD","OPTIONS","DELETE"]}}}};Cl=new WeakMap,gt=new WeakMap;Ps.OAuthClientAuthHandler=Sd;function iP(n,e){let t=n.error,r=n.error_description,i=n.error_uri,o=`Error code ${t}`;typeof r!="undefined"&&(o+=`: ${r}`),typeof i!="undefined"&&(o+=` - ${i}`);let s=new Error(o);if(e){let u=Object.keys(e);e.stack&&u.push("stack"),u.forEach(f=>{f!=="message"&&Object.defineProperty(s,f,{value:e[f],writable:!1,enumerable:!0})})}return s}});var bl=Y(Al=>{"use strict";Object.defineProperty(Al,"__esModule",{value:!0});Al.StsCredentials=void 0;var oP=Ze(),sP=Mt(),VE=Td(),aP=dn(),xs,wd=class wd extends VE.OAuthClientAuthHandler{constructor(t={tokenExchangeEndpoint:""},r){(typeof t!="object"||t instanceof URL)&&(t={tokenExchangeEndpoint:t,clientAuthentication:r});super(t);se(this,xs);ce(this,xs,t.tokenExchangeEndpoint)}async exchangeToken(t,r,i){var u,f,d;let o={grant_type:t.grantType,resource:t.resource,audience:t.audience,scope:(u=t.scope)==null?void 0:u.join(" "),requested_token_type:t.requestedTokenType,subject_token:t.subjectToken,subject_token_type:t.subjectTokenType,actor_token:(f=t.actingParty)==null?void 0:f.actorToken,actor_token_type:(d=t.actingParty)==null?void 0:d.actorTokenType,options:i&&JSON.stringify(i)},s={...wd.RETRY_CONFIG,url:D(this,xs).toString(),method:"POST",headers:r,data:new URLSearchParams((0,aP.removeUndefinedValuesInObject)(o))};sP.AuthClient.setMethodName(s,"exchangeToken"),this.applyClientAuthenticationOptions(s);try{let h=await this.transporter.request(s),m=h.data;return m.res=h,m}catch(h){throw h instanceof oP.GaxiosError&&h.response?(0,VE.getErrorFromOAuthErrorResponse)(h.response.data,h):h}}};xs=new WeakMap;var vd=wd;Al.StsCredentials=vd});var Rr=Y(Xt=>{"use strict";Object.defineProperty(Xt,"__esModule",{value:!0});Xt.BaseExternalAccountClient=Xt.CLOUD_RESOURCE_MANAGER=Xt.EXTERNAL_ACCOUNT_TYPE=Xt.EXPIRATION_TIME_OFFSET=void 0;var lP=Ze(),uP=require("stream"),Cd=Mt(),cP=bl(),$E=dn(),fP=Lf(),dP="urn:ietf:params:oauth:grant-type:token-exchange",hP="urn:ietf:params:oauth:token-type:access_token",Ad="https://www.googleapis.com/auth/cloud-platform",pP=3600;Xt.EXPIRATION_TIME_OFFSET=300*1e3;Xt.EXTERNAL_ACCOUNT_TYPE="external_account";Xt.CLOUD_RESOURCE_MANAGER="https://cloudresourcemanager.googleapis.com/v1/projects/";var mP="//iam\\.googleapis\\.com/locations/[^/]+/workforcePools/[^/]+/providers/.+",gP="https://sts.{universeDomain}/v1/token",oi,Rl,WE,Il=class Il extends Cd.AuthClient{constructor(t){var _;super(t);se(this,Rl);x(this,"scopes");x(this,"projectNumber");x(this,"audience");x(this,"subjectTokenType");x(this,"stsCredential");x(this,"clientAuth");x(this,"credentialSourceType");x(this,"cachedAccessToken");x(this,"serviceAccountImpersonationUrl");x(this,"serviceAccountImpersonationLifetime");x(this,"workforcePoolUserProject");x(this,"configLifetimeRequested");x(this,"tokenUrl");x(this,"cloudResourceManagerURL");x(this,"supplierContext");se(this,oi,null);let r=(0,$E.originalOrCamelOptions)(t),i=r.get("type");if(i&&i!==Xt.EXTERNAL_ACCOUNT_TYPE)throw new Error(`Expected "${Xt.EXTERNAL_ACCOUNT_TYPE}" type but received "${t.type}"`);let o=r.get("client_id"),s=r.get("client_secret");this.tokenUrl=(_=r.get("token_url"))!=null?_:gP.replace("{universeDomain}",this.universeDomain);let u=r.get("subject_token_type"),f=r.get("workforce_pool_user_project"),d=r.get("service_account_impersonation_url"),h=r.get("service_account_impersonation"),m=(0,$E.originalOrCamelOptions)(h).get("token_lifetime_seconds");this.cloudResourceManagerURL=new URL(r.get("cloud_resource_manager_url")||`https://cloudresourcemanager.${this.universeDomain}/v1/projects/`),o&&(this.clientAuth={confidentialClientType:"basic",clientId:o,clientSecret:s}),this.stsCredential=new cP.StsCredentials({tokenExchangeEndpoint:this.tokenUrl,clientAuthentication:this.clientAuth}),this.scopes=r.get("scopes")||[Ad],this.cachedAccessToken=null,this.audience=r.get("audience"),this.subjectTokenType=u,this.workforcePoolUserProject=f;let g=new RegExp(mP);if(this.workforcePoolUserProject&&!this.audience.match(g))throw new Error("workforcePoolUserProject should not be set for non-workforce pool credentials.");this.serviceAccountImpersonationUrl=d,this.serviceAccountImpersonationLifetime=m,this.serviceAccountImpersonationLifetime?this.configLifetimeRequested=!0:(this.configLifetimeRequested=!1,this.serviceAccountImpersonationLifetime=pP),this.projectNumber=this.getProjectNumber(this.audience),this.supplierContext={audience:this.audience,subjectTokenType:this.subjectTokenType,transporter:this.transporter}}getServiceAccountEmail(){var t;if(this.serviceAccountImpersonationUrl){if(this.serviceAccountImpersonationUrl.length>256)throw new RangeError(`URL is too long: ${this.serviceAccountImpersonationUrl}`);let i=/serviceAccounts\/(?<email>[^:]+):generateAccessToken$/.exec(this.serviceAccountImpersonationUrl);return((t=i==null?void 0:i.groups)==null?void 0:t.email)||null}return null}setCredentials(t){super.setCredentials(t),this.cachedAccessToken=t}async getAccessToken(){return(!this.cachedAccessToken||this.isExpired(this.cachedAccessToken))&&await this.refreshAccessTokenAsync(),{token:this.cachedAccessToken.access_token,res:this.cachedAccessToken.res}}async getRequestHeaders(){let t=await this.getAccessToken(),r=new Headers({authorization:`Bearer ${t.token}`});return this.addSharedMetadataHeaders(r)}request(t,r){if(r)this.requestAsync(t).then(i=>r(null,i),i=>r(i,i.response));else return this.requestAsync(t)}async getProjectId(){let t=this.projectNumber||this.workforcePoolUserProject;if(this.projectId)return this.projectId;if(t){let r=await this.getRequestHeaders(),i={...Il.RETRY_CONFIG,headers:r,url:`${this.cloudResourceManagerURL.toString()}${t}`};Cd.AuthClient.setMethodName(i,"getProjectId");let o=await this.transporter.request(i);return this.projectId=o.data.projectId,this.projectId}return null}async requestAsync(t,r=!1){let i;try{let o=await this.getRequestHeaders();t.headers=lP.Gaxios.mergeHeaders(t.headers),this.addUserProjectAndAuthHeaders(t.headers,o),i=await this.transporter.request(t)}catch(o){let s=o.response;if(s){let u=s.status,f=s.config.data instanceof uP.Readable;if(!r&&(u===401||u===403)&&!f&&this.forceRefreshOnFailure)return await this.refreshAccessTokenAsync(),await this.requestAsync(t,!0)}throw o}return i}async refreshAccessTokenAsync(){ce(this,oi,D(this,oi)||oe(this,Rl,WE).call(this));try{return await D(this,oi)}finally{ce(this,oi,null)}}getProjectNumber(t){let r=t.match(/\/projects\/([^/]+)/);return r?r[1]:null}async getImpersonatedAccessToken(t){let r={...Il.RETRY_CONFIG,url:this.serviceAccountImpersonationUrl,method:"POST",headers:{"content-type":"application/json",authorization:`Bearer ${t}`},data:{scope:this.getScopesArray(),lifetime:this.serviceAccountImpersonationLifetime+"s"}};Cd.AuthClient.setMethodName(r,"getImpersonatedAccessToken");let i=await this.transporter.request(r),o=i.data;return{access_token:o.accessToken,expiry_date:new Date(o.expireTime).getTime(),res:i}}isExpired(t){let r=new Date().getTime();return t.expiry_date?r>=t.expiry_date-this.eagerRefreshThresholdMillis:!1}getScopesArray(){return typeof this.scopes=="string"?[this.scopes]:this.scopes||[Ad]}getMetricsHeaderValue(){let t=process.version.replace(/^v/,""),r=this.serviceAccountImpersonationUrl!==void 0,i=this.credentialSourceType?this.credentialSourceType:"unknown";return`gl-node/${t} auth/${fP.pkg.version} google-byoid-sdk source/${i} sa-impersonation/${r} config-lifetime/${this.configLifetimeRequested}`}getTokenUrl(){return this.tokenUrl}};oi=new WeakMap,Rl=new WeakSet,WE=async function(){let t=await this.retrieveSubjectToken(),r={grantType:dP,audience:this.audience,requestedTokenType:hP,subjectToken:t,subjectTokenType:this.subjectTokenType,scope:this.serviceAccountImpersonationUrl?[Ad]:this.getScopesArray()},i=!this.clientAuth&&this.workforcePoolUserProject?{userProject:this.workforcePoolUserProject}:void 0,o=new Headers({"x-goog-api-client":this.getMetricsHeaderValue()}),s=await this.stsCredential.exchangeToken(r,o,i);return this.serviceAccountImpersonationUrl?this.cachedAccessToken=await this.getImpersonatedAccessToken(s.access_token):s.expires_in?this.cachedAccessToken={access_token:s.access_token,expiry_date:new Date().getTime()+s.expires_in*1e3,res:s.res}:this.cachedAccessToken={access_token:s.access_token,res:s.res},this.credentials={},Object.assign(this.credentials,this.cachedAccessToken),delete this.credentials.res,this.emit("tokens",{refresh_token:null,expiry_date:this.cachedAccessToken.expiry_date,access_token:this.cachedAccessToken.access_token,token_type:"Bearer",id_token:null}),this.cachedAccessToken};var bd=Il;Xt.BaseExternalAccountClient=bd});var YE=Y(Pl=>{"use strict";Object.defineProperty(Pl,"__esModule",{value:!0});Pl.FileSubjectTokenSupplier=void 0;var Id=require("util"),Pd=require("fs"),zE,yP=(0,Id.promisify)((zE=Pd.readFile)!=null?zE:(()=>{})),JE,_P=(0,Id.promisify)((JE=Pd.realpath)!=null?JE:(()=>{})),KE,EP=(0,Id.promisify)((KE=Pd.lstat)!=null?KE:(()=>{})),Rd=class{constructor(e){x(this,"filePath");x(this,"formatType");x(this,"subjectTokenFieldName");this.filePath=e.filePath,this.formatType=e.formatType,this.subjectTokenFieldName=e.subjectTokenFieldName}async getSubjectToken(){let e=this.filePath;try{if(e=await _P(e),!(await EP(e)).isFile())throw new Error}catch(i){throw i instanceof Error&&(i.message=`The file at ${e} does not exist, or it is not a file. ${i.message}`),i}let t,r=await yP(e,{encoding:"utf8"});if(this.formatType==="text"?t=r:this.formatType==="json"&&this.subjectTokenFieldName&&(t=JSON.parse(r)[this.subjectTokenFieldName]),!t)throw new Error("Unable to parse the subject_token from the credential_source file");return t}};Pl.FileSubjectTokenSupplier=Rd});var XE=Y(xl=>{"use strict";Object.defineProperty(xl,"__esModule",{value:!0});xl.UrlSubjectTokenSupplier=void 0;var SP=Mt(),xd=class{constructor(e){x(this,"url");x(this,"headers");x(this,"formatType");x(this,"subjectTokenFieldName");x(this,"additionalGaxiosOptions");this.url=e.url,this.formatType=e.formatType,this.subjectTokenFieldName=e.subjectTokenFieldName,this.headers=e.headers,this.additionalGaxiosOptions=e.additionalGaxiosOptions}async getSubjectToken(e){let t={...this.additionalGaxiosOptions,url:this.url,method:"GET",headers:this.headers};SP.AuthClient.setMethodName(t,"getSubjectToken");let r;if(this.formatType==="text"?r=(await e.transporter.request(t)).data:this.formatType==="json"&&this.subjectTokenFieldName&&(r=(await e.transporter.request(t)).data[this.subjectTokenFieldName]),!r)throw new Error("Unable to parse the subject_token from the credential_source URL");return r}};xl.UrlSubjectTokenSupplier=xd});var tS=Y(Ft=>{"use strict";Object.defineProperty(Ft,"__esModule",{value:!0});Ft.CertificateSubjectTokenSupplier=Ft.InvalidConfigurationError=Ft.CertificateSourceUnavailableError=Ft.CERTIFICATE_CONFIGURATION_ENV_VARIABLE=void 0;var Nl=dn(),kl=require("fs"),Ml=require("crypto"),TP=require("https");Ft.CERTIFICATE_CONFIGURATION_ENV_VARIABLE="GOOGLE_API_CERTIFICATE_CONFIG";var Dn=class extends Error{constructor(e){super(e),this.name="CertificateSourceUnavailableError"}};Ft.CertificateSourceUnavailableError=Dn;var Qt=class extends Error{constructor(e){super(e),this.name="InvalidConfigurationError"}};Ft.InvalidConfigurationError=Qt;var On,QE,ZE,jE,eS,Nd=class{constructor(e){se(this,On);x(this,"certificateConfigPath");x(this,"trustChainPath");x(this,"cert");x(this,"key");var t;if(!e.useDefaultCertificateConfig&&!e.certificateConfigLocation)throw new Qt("Either `useDefaultCertificateConfig` must be true or a `certificateConfigLocation` must be provided.");if(e.useDefaultCertificateConfig&&e.certificateConfigLocation)throw new Qt("Both `useDefaultCertificateConfig` and `certificateConfigLocation` cannot be provided.");this.trustChainPath=e.trustChainPath,this.certificateConfigPath=(t=e.certificateConfigLocation)!=null?t:""}async createMtlsHttpsAgent(){if(!this.key||!this.cert)throw new Qt("Cannot create mTLS Agent with missing certificate or key");return new TP.Agent({key:this.key,cert:this.cert})}async getSubjectToken(){this.certificateConfigPath=await oe(this,On,QE).call(this);let{certPath:e,keyPath:t}=await oe(this,On,ZE).call(this);return{cert:this.cert,key:this.key}=await oe(this,On,jE).call(this,e,t),await oe(this,On,eS).call(this,this.cert)}};On=new WeakSet,QE=async function(){let e=this.certificateConfigPath;if(e){if(await(0,Nl.isValidFile)(e))return e;throw new Dn(`Provided certificate config path is invalid: ${e}`)}let t=process.env[Ft.CERTIFICATE_CONFIGURATION_ENV_VARIABLE];if(t){if(await(0,Nl.isValidFile)(t))return t;throw new Dn(`Path from environment variable "${Ft.CERTIFICATE_CONFIGURATION_ENV_VARIABLE}" is invalid: ${t}`)}let r=(0,Nl.getWellKnownCertificateConfigFileLocation)();if(await(0,Nl.isValidFile)(r))return r;throw new Dn(`Could not find certificate configuration file. Searched override path, the "${Ft.CERTIFICATE_CONFIGURATION_ENV_VARIABLE}" env var, and the gcloud path (${r}).`)},ZE=async function(){var r,i,o,s;let e=this.certificateConfigPath,t;try{t=await kl.promises.readFile(e,"utf8")}catch(u){throw new Dn(`Failed to read certificate config file at: ${e}`)}try{let u=JSON.parse(t),f=(i=(r=u==null?void 0:u.cert_configs)==null?void 0:r.workload)==null?void 0:i.cert_path,d=(s=(o=u==null?void 0:u.cert_configs)==null?void 0:o.workload)==null?void 0:s.key_path;if(!f||!d)throw new Qt(`Certificate config file (${e}) is missing required "cert_path" or "key_path" in the workload config.`);return{certPath:f,keyPath:d}}catch(u){throw u instanceof Qt?u:new Qt(`Failed to parse certificate config from ${e}: ${u.message}`)}},jE=async function(e,t){let r,i;try{r=await kl.promises.readFile(e),new Ml.X509Certificate(r)}catch(o){let s=o instanceof Error?o.message:String(o);throw new Dn(`Failed to read certificate file at ${e}: ${s}`)}try{i=await kl.promises.readFile(t),(0,Ml.createPrivateKey)(i)}catch(o){let s=o instanceof Error?o.message:String(o);throw new Dn(`Failed to read private key file at ${t}: ${s}`)}return{cert:r,key:i}},eS=async function(e){var r;let t=new Ml.X509Certificate(e);if(!this.trustChainPath)return JSON.stringify([t.raw.toString("base64")]);try{let s=((r=(await kl.promises.readFile(this.trustChainPath,"utf8")).match(/-----BEGIN CERTIFICATE-----[^-]+-----END CERTIFICATE-----/g))!=null?r:[]).map((d,h)=>{try{return new Ml.X509Certificate(d)}catch(m){let g=m instanceof Error?m.message:String(m);throw new Qt(`Failed to parse certificate at index ${h} in trust chain file ${this.trustChainPath}: ${g}`)}}),u=s.findIndex(d=>t.raw.equals(d.raw)),f;if(u===-1)f=[t,...s];else if(u===0)f=s;else throw new Qt(`Leaf certificate exists in the trust chain but is not the first entry (found at index ${u}).`);return JSON.stringify(f.map(d=>d.raw.toString("base64")))}catch(i){if(i instanceof Qt)throw i;let o=i instanceof Error?i.message:String(i);throw new Dn(`Failed to process certificate chain from ${this.trustChainPath}: ${o}`)}};Ft.CertificateSubjectTokenSupplier=Nd});var Dd=Y(Dl=>{"use strict";Object.defineProperty(Dl,"__esModule",{value:!0});Dl.IdentityPoolClient=void 0;var vP=Rr(),kd=dn(),wP=YE(),CP=XE(),nS=tS(),AP=bl(),rS=Ze(),Md=class n extends vP.BaseExternalAccountClient{constructor(t){super(t);x(this,"subjectTokenSupplier");let r=(0,kd.originalOrCamelOptions)(t),i=r.get("credential_source"),o=r.get("subject_token_supplier");if(!i&&!o)throw new Error("A credential source or subject token supplier must be specified.");if(i&&o)throw new Error("Only one of credential source or subject token supplier can be specified.");if(o)this.subjectTokenSupplier=o,this.credentialSourceType="programmatic";else{let s=(0,kd.originalOrCamelOptions)(i),u=(0,kd.originalOrCamelOptions)(s.get("format")),f=u.get("type")||"text",d=u.get("subject_token_field_name");if(f!=="json"&&f!=="text")throw new Error(`Invalid credential_source format "${f}"`);if(f==="json"&&!d)throw new Error("Missing subject_token_field_name for JSON credential_source format");let h=s.get("file"),m=s.get("url"),g=s.get("certificate"),_=s.get("headers");if(h&&m||m&&g||h&&g)throw new Error('No valid Identity Pool "credential_source" provided, must be either file, url, or certificate.');if(h)this.credentialSourceType="file",this.subjectTokenSupplier=new wP.FileSubjectTokenSupplier({filePath:h,formatType:f,subjectTokenFieldName:d});else if(m)this.credentialSourceType="url",this.subjectTokenSupplier=new CP.UrlSubjectTokenSupplier({url:m,formatType:f,subjectTokenFieldName:d,headers:_,additionalGaxiosOptions:n.RETRY_CONFIG});else if(g){this.credentialSourceType="certificate";let v=new nS.CertificateSubjectTokenSupplier({useDefaultCertificateConfig:g.use_default_certificate_config,certificateConfigLocation:g.certificate_config_location,trustChainPath:g.trust_chain_path});this.subjectTokenSupplier=v}else throw new Error('No valid Identity Pool "credential_source" provided, must be either file, url, or certificate.')}}async retrieveSubjectToken(){let t=await this.subjectTokenSupplier.getSubjectToken(this.supplierContext);if(this.subjectTokenSupplier instanceof nS.CertificateSubjectTokenSupplier){let r=await this.subjectTokenSupplier.createMtlsHttpsAgent();this.stsCredential=new AP.StsCredentials({tokenExchangeEndpoint:this.getTokenUrl(),clientAuthentication:this.clientAuth,transporter:new rS.Gaxios({agent:r})}),this.transporter=new rS.Gaxios({...this.transporter.defaults||{},agent:r})}return t}};Dl.IdentityPoolClient=Md});var Ud=Y(Ul=>{"use strict";Object.defineProperty(Ul,"__esModule",{value:!0});Ul.AwsRequestSigner=void 0;var Ol=Ze(),oS=Es(),iS="AWS4-HMAC-SHA256",bP="aws4_request",Od=class{constructor(e,t){x(this,"getCredentials");x(this,"region");x(this,"crypto");this.getCredentials=e,this.region=t,this.crypto=(0,oS.createCrypto)()}async getRequestOptions(e){if(!e.url)throw new RangeError('"url" is required in "amzOptions"');let t=typeof e.data=="object"?JSON.stringify(e.data):e.data,r=e.url,i=e.method||"GET",o=e.body||t,s=e.headers,u=await this.getCredentials(),f=new URL(r);if(typeof o!="string"&&o!==void 0)throw new TypeError(`'requestPayload' is expected to be a string if provided. Got: ${o}`);let d=await IP({crypto:this.crypto,host:f.host,canonicalUri:f.pathname,canonicalQuerystring:f.search.slice(1),method:i,region:this.region,securityCredentials:u,requestPayload:o,additionalAmzHeaders:s}),h=Ol.Gaxios.mergeHeaders(d.amzDate?{"x-amz-date":d.amzDate}:{},{authorization:d.authorizationHeader,host:f.host},s||{});u.token&&Ol.Gaxios.mergeHeaders(h,{"x-amz-security-token":u.token});let m={url:r,method:i,headers:h};return o!==void 0&&(m.body=o),m}};Ul.AwsRequestSigner=Od;async function Ns(n,e,t){return await n.signWithHmacSha256(e,t)}async function RP(n,e,t,r,i){let o=await Ns(n,`AWS4${e}`,t),s=await Ns(n,o,r),u=await Ns(n,s,i);return await Ns(n,u,"aws4_request")}async function IP(n){let e=Ol.Gaxios.mergeHeaders(n.additionalAmzHeaders),t=n.requestPayload||"",r=n.host.split(".")[0],i=new Date,o=i.toISOString().replace(/[-:]/g,"").replace(/\.[0-9]+/,""),s=i.toISOString().replace(/[-]/g,"").replace(/T.*/,"");n.securityCredentials.token&&e.set("x-amz-security-token",n.securityCredentials.token);let u=Ol.Gaxios.mergeHeaders({host:n.host},e.has("date")?{}:{"x-amz-date":o},e),f="",d=[...u.keys()].sort();d.forEach(z=>{f+=`${z}:${u.get(z)}
`});let h=d.join(";"),m=await n.crypto.sha256DigestHex(t),g=`${n.method.toUpperCase()}
${n.canonicalUri}
${n.canonicalQuerystring}
${f}
${h}
${m}`,_=`${s}/${n.region}/${r}/${bP}`,v=`${iS}
${o}
${_}
`+await n.crypto.sha256DigestHex(g),C=await RP(n.crypto,n.securityCredentials.secretAccessKey,s,n.region,r),R=await Ns(n.crypto,C,v),I=`${iS} Credential=${n.securityCredentials.accessKeyId}/${_}, SignedHeaders=${h}, Signature=${(0,oS.fromArrayBufferToHex)(R)}`;return{amzDate:e.has("date")?void 0:o,authorizationHeader:I,canonicalQuerystring:n.canonicalQuerystring}}});var lS=Y(ql=>{"use strict";Object.defineProperty(ql,"__esModule",{value:!0});ql.DefaultAwsSecurityCredentialsSupplier=void 0;var Fl=Mt(),it,Ld,sS,aS,Ll,qd,Fd=class{constructor(e){se(this,it);x(this,"regionUrl");x(this,"securityCredentialsUrl");x(this,"imdsV2SessionTokenUrl");x(this,"additionalGaxiosOptions");this.regionUrl=e.regionUrl,this.securityCredentialsUrl=e.securityCredentialsUrl,this.imdsV2SessionTokenUrl=e.imdsV2SessionTokenUrl,this.additionalGaxiosOptions=e.additionalGaxiosOptions}async getAwsRegion(e){if(D(this,it,Ll))return D(this,it,Ll);let t=new Headers;if(!D(this,it,Ll)&&this.imdsV2SessionTokenUrl&&t.set("x-aws-ec2-metadata-token",await oe(this,it,Ld).call(this,e.transporter)),!this.regionUrl)throw new RangeError('Unable to determine AWS region due to missing "options.credential_source.region_url"');let r={...this.additionalGaxiosOptions,url:this.regionUrl,method:"GET",headers:t};Fl.AuthClient.setMethodName(r,"getAwsRegion");let i=await e.transporter.request(r);return i.data.substr(0,i.data.length-1)}async getAwsSecurityCredentials(e){if(D(this,it,qd))return D(this,it,qd);let t=new Headers;this.imdsV2SessionTokenUrl&&t.set("x-aws-ec2-metadata-token",await oe(this,it,Ld).call(this,e.transporter));let r=await oe(this,it,sS).call(this,t,e.transporter),i=await oe(this,it,aS).call(this,r,t,e.transporter);return{accessKeyId:i.AccessKeyId,secretAccessKey:i.SecretAccessKey,token:i.Token}}};it=new WeakSet,Ld=async function(e){let t={...this.additionalGaxiosOptions,url:this.imdsV2SessionTokenUrl,method:"PUT",headers:{"x-aws-ec2-metadata-token-ttl-seconds":"300"}};return Fl.AuthClient.setMethodName(t,"#getImdsV2SessionToken"),(await e.request(t)).data},sS=async function(e,t){if(!this.securityCredentialsUrl)throw new Error('Unable to determine AWS role name due to missing "options.credential_source.url"');let r={...this.additionalGaxiosOptions,url:this.securityCredentialsUrl,method:"GET",headers:e};return Fl.AuthClient.setMethodName(r,"#getAwsRoleName"),(await t.request(r)).data},aS=async function(e,t,r){let i={...this.additionalGaxiosOptions,url:`${this.securityCredentialsUrl}/${e}`,headers:t};return Fl.AuthClient.setMethodName(i,"#retrieveAwsSecurityCredentials"),(await r.request(i)).data},Ll=function(){return process.env.AWS_REGION||process.env.AWS_DEFAULT_REGION||null},qd=function(){return process.env.AWS_ACCESS_KEY_ID&&process.env.AWS_SECRET_ACCESS_KEY?{accessKeyId:process.env.AWS_ACCESS_KEY_ID,secretAccessKey:process.env.AWS_SECRET_ACCESS_KEY,token:process.env.AWS_SESSION_TOKEN}:null};ql.DefaultAwsSecurityCredentialsSupplier=Fd});var Gd=Y(Gl=>{"use strict";Object.defineProperty(Gl,"__esModule",{value:!0});Gl.AwsClient=void 0;var PP=Ud(),xP=Rr(),NP=lS(),uS=dn(),kP=Ze(),Bl,si=class si extends xP.BaseExternalAccountClient{constructor(t){super(t);x(this,"environmentId");x(this,"awsSecurityCredentialsSupplier");x(this,"regionalCredVerificationUrl");x(this,"awsRequestSigner");x(this,"region");let r=(0,uS.originalOrCamelOptions)(t),i=r.get("credential_source"),o=r.get("aws_security_credentials_supplier");if(!i&&!o)throw new Error("A credential source or AWS security credentials supplier must be specified.");if(i&&o)throw new Error("Only one of credential source or AWS security credentials supplier can be specified.");if(o)this.awsSecurityCredentialsSupplier=o,this.regionalCredVerificationUrl=D(si,Bl),this.credentialSourceType="programmatic";else{let s=(0,uS.originalOrCamelOptions)(i);this.environmentId=s.get("environment_id");let u=s.get("region_url"),f=s.get("url"),d=s.get("imdsv2_session_token_url");this.awsSecurityCredentialsSupplier=new NP.DefaultAwsSecurityCredentialsSupplier({regionUrl:u,securityCredentialsUrl:f,imdsV2SessionTokenUrl:d}),this.regionalCredVerificationUrl=s.get("regional_cred_verification_url"),this.credentialSourceType="aws",this.validateEnvironmentId()}this.awsRequestSigner=null,this.region=""}validateEnvironmentId(){var r;let t=(r=this.environmentId)==null?void 0:r.match(/^(aws)(\d+)$/);if(!t||!this.regionalCredVerificationUrl)throw new Error('No valid AWS "credential_source" provided');if(parseInt(t[2],10)!==1)throw new Error(`aws version "${t[2]}" is not supported in the current build.`)}async retrieveSubjectToken(){this.awsRequestSigner||(this.region=await this.awsSecurityCredentialsSupplier.getAwsRegion(this.supplierContext),this.awsRequestSigner=new PP.AwsRequestSigner(async()=>this.awsSecurityCredentialsSupplier.getAwsSecurityCredentials(this.supplierContext),this.region));let t=await this.awsRequestSigner.getRequestOptions({...si.RETRY_CONFIG,url:this.regionalCredVerificationUrl.replace("{region}",this.region),method:"POST"}),r=[];return kP.Gaxios.mergeHeaders({"x-goog-cloud-target-resource":this.audience},t.headers).forEach((o,s)=>r.push({key:s,value:o})),encodeURIComponent(JSON.stringify({url:t.url,method:t.method,headers:r}))}};Bl=new WeakMap,se(si,Bl,"https://sts.{region}.amazonaws.com?Action=GetCallerIdentity&Version=2011-06-15"),x(si,"AWS_EC2_METADATA_IPV4_ADDRESS","169.254.169.254"),x(si,"AWS_EC2_METADATA_IPV6_ADDRESS","fd00:ec2::254");var Bd=si;Gl.AwsClient=Bd});var zd=Y(Ve=>{"use strict";Object.defineProperty(Ve,"__esModule",{value:!0});Ve.InvalidSubjectTokenError=Ve.InvalidMessageFieldError=Ve.InvalidCodeFieldError=Ve.InvalidTokenTypeFieldError=Ve.InvalidExpirationTimeFieldError=Ve.InvalidSuccessFieldError=Ve.InvalidVersionFieldError=Ve.ExecutableResponseError=Ve.ExecutableResponse=void 0;var Hl="urn:ietf:params:oauth:token-type:saml2",Hd="urn:ietf:params:oauth:token-type:id_token",Vd="urn:ietf:params:oauth:token-type:jwt",$d=class{constructor(e){x(this,"version");x(this,"success");x(this,"expirationTime");x(this,"tokenType");x(this,"errorCode");x(this,"errorMessage");x(this,"subjectToken");if(!e.version)throw new Vl("Executable response must contain a 'version' field.");if(e.success===void 0)throw new $l("Executable response must contain a 'success' field.");if(this.version=e.version,this.success=e.success,this.success){if(this.expirationTime=e.expiration_time,this.tokenType=e.token_type,this.tokenType!==Hl&&this.tokenType!==Hd&&this.tokenType!==Vd)throw new Wl(`Executable response must contain a 'token_type' field when successful and it must be one of ${Hd}, ${Vd}, or ${Hl}.`);if(this.tokenType===Hl){if(!e.saml_response)throw new ks(`Executable response must contain a 'saml_response' field when token_type=${Hl}.`);this.subjectToken=e.saml_response}else{if(!e.id_token)throw new ks(`Executable response must contain a 'id_token' field when token_type=${Hd} or ${Vd}.`);this.subjectToken=e.id_token}}else{if(!e.code)throw new zl("Executable response must contain a 'code' field when unsuccessful.");if(!e.message)throw new Jl("Executable response must contain a 'message' field when unsuccessful.");this.errorCode=e.code,this.errorMessage=e.message}}isValid(){return!this.isExpired()&&this.success}isExpired(){return this.expirationTime!==void 0&&this.expirationTime<Math.round(Date.now()/1e3)}};Ve.ExecutableResponse=$d;var Un=class extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}};Ve.ExecutableResponseError=Un;var Vl=class extends Un{};Ve.InvalidVersionFieldError=Vl;var $l=class extends Un{};Ve.InvalidSuccessFieldError=$l;var Wd=class extends Un{};Ve.InvalidExpirationTimeFieldError=Wd;var Wl=class extends Un{};Ve.InvalidTokenTypeFieldError=Wl;var zl=class extends Un{};Ve.InvalidCodeFieldError=zl;var Jl=class extends Un{};Ve.InvalidMessageFieldError=Jl;var ks=class extends Un{};Ve.InvalidSubjectTokenError=ks});var Yd=Y(fo=>{"use strict";Object.defineProperty(fo,"__esModule",{value:!0});fo.PluggableAuthHandler=fo.ExecutableError=void 0;var ai=zd(),MP=require("child_process"),Jd=require("fs"),Kl=class extends Error{constructor(t,r){super(`The executable failed with exit code: ${r} and error message: ${t}.`);x(this,"code");this.code=r,Object.setPrototypeOf(this,new.target.prototype)}};fo.ExecutableError=Kl;var Kd=class n{constructor(e){x(this,"commandComponents");x(this,"timeoutMillis");x(this,"outputFile");if(!e.command)throw new Error("No command provided.");if(this.commandComponents=n.parseCommand(e.command),this.timeoutMillis=e.timeoutMillis,!this.timeoutMillis)throw new Error("No timeoutMillis provided.");this.outputFile=e.outputFile}retrieveResponseFromExecutable(e){return new Promise((t,r)=>{let i=MP.spawn(this.commandComponents[0],this.commandComponents.slice(1),{env:{...process.env,...Object.fromEntries(e)}}),o="";i.stdout.on("data",u=>{o+=u}),i.stderr.on("data",u=>{o+=u});let s=setTimeout(()=>(i.removeAllListeners(),i.kill(),r(new Error("The executable failed to finish within the timeout specified."))),this.timeoutMillis);i.on("close",u=>{if(clearTimeout(s),u===0)try{let f=JSON.parse(o),d=new ai.ExecutableResponse(f);return t(d)}catch(f){return f instanceof ai.ExecutableResponseError?r(f):r(new ai.ExecutableResponseError(`The executable returned an invalid response: ${o}`))}else return r(new Kl(o,u.toString()))})})}async retrieveCachedResponse(){if(!this.outputFile||this.outputFile.length===0)return;let e;try{e=await Jd.promises.realpath(this.outputFile)}catch(r){return}if(!(await Jd.promises.lstat(e)).isFile())return;let t=await Jd.promises.readFile(e,{encoding:"utf8"});if(t!=="")try{let r=JSON.parse(t);return new ai.ExecutableResponse(r).isValid()?new ai.ExecutableResponse(r):void 0}catch(r){throw r instanceof ai.ExecutableResponseError?r:new ai.ExecutableResponseError(`The output file contained an invalid response: ${t}`)}}static parseCommand(e){let t=e.match(/(?:[^\s"]+|"[^"]*")+/g);if(!t)throw new Error(`Provided command: "${e}" could not be parsed.`);for(let r=0;r<t.length;r++)t[r][0]==='"'&&t[r].slice(-1)==='"'&&(t[r]=t[r].slice(1,-1));return t}};fo.PluggableAuthHandler=Kd});var Qd=Y(ho=>{"use strict";Object.defineProperty(ho,"__esModule",{value:!0});ho.PluggableAuthClient=ho.ExecutableError=void 0;var DP=Rr(),OP=zd(),cS=Yd(),UP=Yd();Object.defineProperty(ho,"ExecutableError",{enumerable:!0,get:function(){return UP.ExecutableError}});var FP=30*1e3,fS=5*1e3,dS=120*1e3,LP="GOOGLE_EXTERNAL_ACCOUNT_ALLOW_EXECUTABLES",hS=1,Xd=class extends DP.BaseExternalAccountClient{constructor(t){super(t);x(this,"command");x(this,"timeoutMillis");x(this,"outputFile");x(this,"handler");if(!t.credential_source.executable)throw new Error('No valid Pluggable Auth "credential_source" provided.');if(this.command=t.credential_source.executable.command,!this.command)throw new Error('No valid Pluggable Auth "credential_source" provided.');if(t.credential_source.executable.timeout_millis===void 0)this.timeoutMillis=FP;else if(this.timeoutMillis=t.credential_source.executable.timeout_millis,this.timeoutMillis<fS||this.timeoutMillis>dS)throw new Error(`Timeout must be between ${fS} and ${dS} milliseconds.`);this.outputFile=t.credential_source.executable.output_file,this.handler=new cS.PluggableAuthHandler({command:this.command,timeoutMillis:this.timeoutMillis,outputFile:this.outputFile}),this.credentialSourceType="executable"}async retrieveSubjectToken(){if(process.env[LP]!=="1")throw new Error("Pluggable Auth executables need to be explicitly allowed to run by setting the GOOGLE_EXTERNAL_ACCOUNT_ALLOW_EXECUTABLES environment Variable to 1.");let t;if(this.outputFile&&(t=await this.handler.retrieveCachedResponse()),!t){let r=new Map;r.set("GOOGLE_EXTERNAL_ACCOUNT_AUDIENCE",this.audience),r.set("GOOGLE_EXTERNAL_ACCOUNT_TOKEN_TYPE",this.subjectTokenType),r.set("GOOGLE_EXTERNAL_ACCOUNT_INTERACTIVE","0"),this.outputFile&&r.set("GOOGLE_EXTERNAL_ACCOUNT_OUTPUT_FILE",this.outputFile);let i=this.getServiceAccountEmail();i&&r.set("GOOGLE_EXTERNAL_ACCOUNT_IMPERSONATED_EMAIL",i),t=await this.handler.retrieveResponseFromExecutable(r)}if(t.version>hS)throw new Error(`Version of executable is not currently supported, maximum supported version is ${hS}.`);if(!t.success)throw new cS.ExecutableError(t.errorMessage,t.errorCode);if(this.outputFile&&!t.expirationTime)throw new OP.InvalidExpirationTimeFieldError("The executable response must contain the `expiration_time` field for successful responses when an output_file has been specified in the configuration.");if(t.isExpired())throw new Error("Executable response is expired.");return t.subjectToken}};ho.PluggableAuthClient=Xd});var jd=Y(Yl=>{"use strict";Object.defineProperty(Yl,"__esModule",{value:!0});Yl.ExternalAccountClient=void 0;var qP=Rr(),BP=Dd(),GP=Gd(),HP=Qd(),Zd=class{constructor(){throw new Error("ExternalAccountClients should be initialized via: ExternalAccountClient.fromJSON(), directly via explicit constructors, eg. new AwsClient(options), new IdentityPoolClient(options), newPluggableAuthClientOptions, or via new GoogleAuth(options).getClient()")}static fromJSON(e){var t,r;return e&&e.type===qP.EXTERNAL_ACCOUNT_TYPE?(t=e.credential_source)!=null&&t.environment_id?new GP.AwsClient(e):(r=e.credential_source)!=null&&r.executable?new HP.PluggableAuthClient(e):new BP.IdentityPoolClient(e):null}};Yl.ExternalAccountClient=Zd});var rh=Y(po=>{"use strict";Object.defineProperty(po,"__esModule",{value:!0});po.ExternalAccountAuthorizedUserClient=po.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE=void 0;var mS=Mt(),pS=Td(),gS=Ze(),VP=require("stream"),$P=Rr();po.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE="external_account_authorized_user";var WP="https://sts.{universeDomain}/v1/oauthtoken",Ms,nh=class nh extends pS.OAuthClientAuthHandler{constructor(t){super(t);se(this,Ms);ce(this,Ms,t.tokenRefreshEndpoint)}async refreshToken(t,r){let i={...nh.RETRY_CONFIG,url:D(this,Ms),method:"POST",headers:r,data:new URLSearchParams({grant_type:"refresh_token",refresh_token:t})};mS.AuthClient.setMethodName(i,"refreshToken"),this.applyClientAuthenticationOptions(i);try{let o=await this.transporter.request(i),s=o.data;return s.res=o,s}catch(o){throw o instanceof gS.GaxiosError&&o.response?(0,pS.getErrorFromOAuthErrorResponse)(o.response.data,o):o}}};Ms=new WeakMap;var eh=nh,th=class extends mS.AuthClient{constructor(t){var i;super(t);x(this,"cachedAccessToken");x(this,"externalAccountAuthorizedUserHandler");x(this,"refreshToken");t.universe_domain&&(this.universeDomain=t.universe_domain),this.refreshToken=t.refresh_token;let r={confidentialClientType:"basic",clientId:t.client_id,clientSecret:t.client_secret};this.externalAccountAuthorizedUserHandler=new eh({tokenRefreshEndpoint:(i=t.token_url)!=null?i:WP.replace("{universeDomain}",this.universeDomain),transporter:this.transporter,clientAuthentication:r}),this.cachedAccessToken=null,this.quotaProjectId=t.quota_project_id,typeof(t==null?void 0:t.eagerRefreshThresholdMillis)!="number"?this.eagerRefreshThresholdMillis=$P.EXPIRATION_TIME_OFFSET:this.eagerRefreshThresholdMillis=t.eagerRefreshThresholdMillis,this.forceRefreshOnFailure=!!(t!=null&&t.forceRefreshOnFailure)}async getAccessToken(){return(!this.cachedAccessToken||this.isExpired(this.cachedAccessToken))&&await this.refreshAccessTokenAsync(),{token:this.cachedAccessToken.access_token,res:this.cachedAccessToken.res}}async getRequestHeaders(){let t=await this.getAccessToken(),r=new Headers({authorization:`Bearer ${t.token}`});return this.addSharedMetadataHeaders(r)}request(t,r){if(r)this.requestAsync(t).then(i=>r(null,i),i=>r(i,i.response));else return this.requestAsync(t)}async requestAsync(t,r=!1){let i;try{let o=await this.getRequestHeaders();t.headers=gS.Gaxios.mergeHeaders(t.headers),this.addUserProjectAndAuthHeaders(t.headers,o),i=await this.transporter.request(t)}catch(o){let s=o.response;if(s){let u=s.status,f=s.config.data instanceof VP.Readable;if(!r&&(u===401||u===403)&&!f&&this.forceRefreshOnFailure)return await this.refreshAccessTokenAsync(),await this.requestAsync(t,!0)}throw o}return i}async refreshAccessTokenAsync(){let t=await this.externalAccountAuthorizedUserHandler.refreshToken(this.refreshToken);return this.cachedAccessToken={access_token:t.access_token,expiry_date:new Date().getTime()+t.expires_in*1e3,res:t.res},t.refresh_token!==void 0&&(this.refreshToken=t.refresh_token),this.cachedAccessToken}isExpired(t){let r=new Date().getTime();return t.expiry_date?r>=t.expiry_date-this.eagerRefreshThresholdMillis:!1}};po.ExternalAccountAuthorizedUserClient=th});var TS=Y(gn=>{"use strict";Object.defineProperty(gn,"__esModule",{value:!0});gn.GoogleAuth=gn.GoogleAuthExceptionMessages=void 0;var zP=require("child_process"),Ds=require("fs"),JP=Ze(),Os=_s(),KP=require("os"),ih=require("path"),YP=Es(),XP=Jf(),QP=Yf(),ZP=Xf(),mo=md(),yS=yd(),go=Ed(),jP=jd(),Us=Rr(),oh=Mt(),_S=rh(),ES=dn();gn.GoogleAuthExceptionMessages={API_KEY_WITH_CREDENTIALS:"API Keys and Credentials are mutually exclusive authentication methods and cannot be used together.",NO_PROJECT_ID_FOUND:`Unable to detect a Project Id in the current environment. 
To learn more about authentication and Google APIs, visit: 
https://cloud.google.com/docs/authentication/getting-started`,NO_CREDENTIALS_FOUND:`Unable to find credentials in current environment. 
To learn more about authentication and Google APIs, visit: 
https://cloud.google.com/docs/authentication/getting-started`,NO_ADC_FOUND:"Could not load the default credentials. Browse to https://cloud.google.com/docs/authentication/getting-started for more information.",NO_UNIVERSE_DOMAIN_FOUND:`Unable to detect a Universe Domain in the current environment.
To learn more about Universe Domain retrieval, visit: 
https://cloud.google.com/compute/docs/metadata/predefined-metadata-keys`};var li,Fn,yo,SS,sh=class{constructor(e={}){se(this,Fn);x(this,"checkIsGCE");x(this,"useJWTAccessWithScope");x(this,"defaultServicePath");x(this,"_findProjectIdPromise");x(this,"_cachedProjectId");x(this,"jsonContent",null);x(this,"apiKey");x(this,"cachedCredential",null);se(this,li,null);x(this,"defaultScopes");x(this,"keyFilename");x(this,"scopes");x(this,"clientOptions",{});if(this._cachedProjectId=e.projectId||null,this.cachedCredential=e.authClient||null,this.keyFilename=e.keyFilename||e.keyFile,this.scopes=e.scopes,this.clientOptions=e.clientOptions||{},this.jsonContent=e.credentials||null,this.apiKey=e.apiKey||this.clientOptions.apiKey||null,this.apiKey&&(this.jsonContent||this.clientOptions.credentials))throw new RangeError(gn.GoogleAuthExceptionMessages.API_KEY_WITH_CREDENTIALS);e.universeDomain&&(this.clientOptions.universeDomain=e.universeDomain)}get isGCE(){return this.checkIsGCE}setGapicJWTValues(e){e.defaultServicePath=this.defaultServicePath,e.useJWTAccessWithScope=this.useJWTAccessWithScope,e.defaultScopes=this.defaultScopes}getProjectId(e){if(e)this.getProjectIdAsync().then(t=>e(null,t),e);else return this.getProjectIdAsync()}async getProjectIdOptional(){try{return await this.getProjectId()}catch(e){if(e instanceof Error&&e.message===gn.GoogleAuthExceptionMessages.NO_PROJECT_ID_FOUND)return null;throw e}}async findAndCacheProjectId(){let e=null;if(e||(e=await this.getProductionProjectId()),e||(e=await this.getFileProjectId()),e||(e=await this.getDefaultServiceProjectId()),e||(e=await this.getGCEProjectId()),e||(e=await this.getExternalAccountClientProjectId()),e)return this._cachedProjectId=e,e;throw new Error(gn.GoogleAuthExceptionMessages.NO_PROJECT_ID_FOUND)}async getProjectIdAsync(){return this._cachedProjectId?this._cachedProjectId:(this._findProjectIdPromise||(this._findProjectIdPromise=this.findAndCacheProjectId()),this._findProjectIdPromise)}async getUniverseDomainFromMetadataServer(){var t;let e;try{e=await Os.universe("universe-domain"),e||(e=oh.DEFAULT_UNIVERSE)}catch(r){if(r&&((t=r==null?void 0:r.response)==null?void 0:t.status)===404)e=oh.DEFAULT_UNIVERSE;else throw r}return e}async getUniverseDomain(){let e=(0,ES.originalOrCamelOptions)(this.clientOptions).get("universe_domain");try{e!=null||(e=(await this.getClient()).universeDomain)}catch(t){e!=null||(e=oh.DEFAULT_UNIVERSE)}return e}getAnyScopes(){return this.scopes||this.defaultScopes}getApplicationDefault(e={},t){let r;if(typeof e=="function"?t=e:r=e,t)this.getApplicationDefaultAsync(r).then(i=>t(null,i.credential,i.projectId),t);else return this.getApplicationDefaultAsync(r)}async getApplicationDefaultAsync(e={}){if(this.cachedCredential)return await oe(this,Fn,yo).call(this,this.cachedCredential,null);let t;if(t=await this._tryGetApplicationCredentialsFromEnvironmentVariable(e),t)return t instanceof mo.JWT?t.scopes=this.scopes:t instanceof Us.BaseExternalAccountClient&&(t.scopes=this.getAnyScopes()),await oe(this,Fn,yo).call(this,t);if(t=await this._tryGetApplicationCredentialsFromWellKnownFile(e),t)return t instanceof mo.JWT?t.scopes=this.scopes:t instanceof Us.BaseExternalAccountClient&&(t.scopes=this.getAnyScopes()),await oe(this,Fn,yo).call(this,t);if(await this._checkIsGCE())return e.scopes=this.getAnyScopes(),await oe(this,Fn,yo).call(this,new XP.Compute(e));throw new Error(gn.GoogleAuthExceptionMessages.NO_ADC_FOUND)}async _checkIsGCE(){return this.checkIsGCE===void 0&&(this.checkIsGCE=Os.getGCPResidency()||await Os.isAvailable()),this.checkIsGCE}async _tryGetApplicationCredentialsFromEnvironmentVariable(e){let t=process.env.GOOGLE_APPLICATION_CREDENTIALS||process.env.google_application_credentials;if(!t||t.length===0)return null;try{return this._getApplicationCredentialsFromFilePath(t,e)}catch(r){throw r instanceof Error&&(r.message=`Unable to read the credential file specified by the GOOGLE_APPLICATION_CREDENTIALS environment variable: ${r.message}`),r}}async _tryGetApplicationCredentialsFromWellKnownFile(e){let t=null;if(this._isWindows())t=process.env.APPDATA;else{let i=process.env.HOME;i&&(t=ih.join(i,".config"))}return t&&(t=ih.join(t,"gcloud","application_default_credentials.json"),Ds.existsSync(t)||(t=null)),t?await this._getApplicationCredentialsFromFilePath(t,e):null}async _getApplicationCredentialsFromFilePath(e,t={}){if(!e||e.length===0)throw new Error("The file path is invalid.");try{if(e=Ds.realpathSync(e),!Ds.lstatSync(e).isFile())throw new Error}catch(i){throw i instanceof Error&&(i.message=`The file at ${e} does not exist, or it is not a file. ${i.message}`),i}let r=Ds.createReadStream(e);return this.fromStream(r,t)}fromImpersonatedJSON(e){var o,s,u,f;if(!e)throw new Error("Must pass in a JSON object containing an  impersonated refresh token");if(e.type!==go.IMPERSONATED_ACCOUNT_TYPE)throw new Error(`The incoming JSON object does not have the "${go.IMPERSONATED_ACCOUNT_TYPE}" type`);if(!e.source_credentials)throw new Error("The incoming JSON object does not contain a source_credentials field");if(!e.service_account_impersonation_url)throw new Error("The incoming JSON object does not contain a service_account_impersonation_url field");let t=this.fromJSON(e.source_credentials);if(((o=e.service_account_impersonation_url)==null?void 0:o.length)>256)throw new RangeError(`Target principal is too long: ${e.service_account_impersonation_url}`);let r=(u=(s=/(?<target>[^/]+):(generateAccessToken|generateIdToken)$/.exec(e.service_account_impersonation_url))==null?void 0:s.groups)==null?void 0:u.target;if(!r)throw new RangeError(`Cannot extract target principal from ${e.service_account_impersonation_url}`);let i=(f=this.scopes||e.scopes||this.defaultScopes)!=null?f:[];return new go.Impersonated({...e,sourceClient:t,targetPrincipal:r,targetScopes:Array.isArray(i)?i:[i]})}fromJSON(e,t={}){let r,i=(0,ES.originalOrCamelOptions)(t).get("universe_domain");return e.type===yS.USER_REFRESH_ACCOUNT_TYPE?(r=new yS.UserRefreshClient(t),r.fromJSON(e)):e.type===go.IMPERSONATED_ACCOUNT_TYPE?r=this.fromImpersonatedJSON(e):e.type===Us.EXTERNAL_ACCOUNT_TYPE?(r=jP.ExternalAccountClient.fromJSON({...e,...t}),r.scopes=this.getAnyScopes()):e.type===_S.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE?r=new _S.ExternalAccountAuthorizedUserClient({...e,...t}):(t.scopes=this.scopes,r=new mo.JWT(t),this.setGapicJWTValues(r),r.fromJSON(e)),i&&(r.universeDomain=i),r}_cacheClientFromJSON(e,t){let r=this.fromJSON(e,t);return this.jsonContent=e,this.cachedCredential=r,r}fromStream(e,t={},r){let i={};if(typeof t=="function"?r=t:i=t,r)this.fromStreamAsync(e,i).then(o=>r(null,o),r);else return this.fromStreamAsync(e,i)}fromStreamAsync(e,t){return new Promise((r,i)=>{if(!e)throw new Error("Must pass in a stream containing the Google auth settings.");let o=[];e.setEncoding("utf8").on("error",i).on("data",s=>o.push(s)).on("end",()=>{try{try{let s=JSON.parse(o.join("")),u=this._cacheClientFromJSON(s,t);return r(u)}catch(s){if(!this.keyFilename)throw s;let u=new mo.JWT({...this.clientOptions,keyFile:this.keyFilename});return this.cachedCredential=u,this.setGapicJWTValues(u),r(u)}}catch(s){return i(s)}})})}fromAPIKey(e,t={}){return new mo.JWT({...t,apiKey:e})}_isWindows(){let e=KP.platform();return!!(e&&e.length>=3&&e.substring(0,3).toLowerCase()==="win")}async getDefaultServiceProjectId(){return new Promise(e=>{(0,zP.exec)("gcloud config config-helper --format json",(t,r)=>{if(!t&&r)try{let i=JSON.parse(r).configuration.properties.core.project;e(i);return}catch(i){}e(null)})})}getProductionProjectId(){return process.env.GCLOUD_PROJECT||process.env.GOOGLE_CLOUD_PROJECT||process.env.gcloud_project||process.env.google_cloud_project}async getFileProjectId(){if(this.cachedCredential)return this.cachedCredential.projectId;if(this.keyFilename){let t=await this.getClient();if(t&&t.projectId)return t.projectId}let e=await this._tryGetApplicationCredentialsFromEnvironmentVariable();return e?e.projectId:null}async getExternalAccountClientProjectId(){return!this.jsonContent||this.jsonContent.type!==Us.EXTERNAL_ACCOUNT_TYPE?null:await(await this.getClient()).getProjectId()}async getGCEProjectId(){try{return await Os.project("project-id")}catch(e){return null}}getCredentials(e){if(e)this.getCredentialsAsync().then(t=>e(null,t),e);else return this.getCredentialsAsync()}async getCredentialsAsync(){let e=await this.getClient();if(e instanceof go.Impersonated)return{client_email:e.getTargetPrincipal()};if(e instanceof Us.BaseExternalAccountClient){let t=e.getServiceAccountEmail();if(t)return{client_email:t,universe_domain:e.universeDomain}}if(this.jsonContent)return{client_email:this.jsonContent.client_email,private_key:this.jsonContent.private_key,universe_domain:this.jsonContent.universe_domain};if(await this._checkIsGCE()){let[t,r]=await Promise.all([Os.instance("service-accounts/default/email"),this.getUniverseDomain()]);return{client_email:t,universe_domain:r}}throw new Error(gn.GoogleAuthExceptionMessages.NO_CREDENTIALS_FOUND)}async getClient(){if(this.cachedCredential)return this.cachedCredential;ce(this,li,D(this,li)||oe(this,Fn,SS).call(this));try{return await D(this,li)}finally{ce(this,li,null)}}async getIdTokenClient(e){let t=await this.getClient();if(!("fetchIdToken"in t))throw new Error("Cannot fetch ID token in this environment, use GCE or set the GOOGLE_APPLICATION_CREDENTIALS environment variable to a service account credentials JSON file.");return new QP.IdTokenClient({targetAudience:e,idTokenProvider:t})}async getAccessToken(){return(await(await this.getClient()).getAccessToken()).token}async getRequestHeaders(e){return(await this.getClient()).getRequestHeaders(e)}async authorizeRequest(e={}){let t=e.url,i=await(await this.getClient()).getRequestHeaders(t);return e.headers=JP.Gaxios.mergeHeaders(e.headers,i),e}async fetch(...e){return(await this.getClient()).fetch(...e)}async request(e){return(await this.getClient()).request(e)}getEnv(){return(0,ZP.getEnv)()}async sign(e,t){let r=await this.getClient(),i=await this.getUniverseDomain();if(t=t||`https://iamcredentials.${i}/v1/projects/-/serviceAccounts/`,r instanceof go.Impersonated)return(await r.sign(e)).signedBlob;let o=(0,YP.createCrypto)();if(r instanceof mo.JWT&&r.key)return await o.sign(r.key,e);let s=await this.getCredentials();if(!s.client_email)throw new Error("Cannot sign data without `client_email`.");return this.signBlob(o,s.client_email,e,t)}async signBlob(e,t,r,i){let o=new URL(i+`${t}:signBlob`);return(await this.request({method:"POST",url:o.href,data:{payload:e.encodeBase64StringUtf8(r)},retry:!0,retryConfig:{httpMethodsToRetry:["POST"]}})).data.signedBlob}};li=new WeakMap,Fn=new WeakSet,yo=async function(e,t=process.env.GOOGLE_CLOUD_QUOTA_PROJECT||null){let r=await this.getProjectIdOptional();return t&&(e.quotaProjectId=t),this.cachedCredential=e,{credential:e,projectId:r}},SS=async function(){if(this.jsonContent)return this._cacheClientFromJSON(this.jsonContent,this.clientOptions);if(this.keyFilename){let e=ih.resolve(this.keyFilename),t=Ds.createReadStream(e);return await this.fromStreamAsync(t,this.clientOptions)}else if(this.apiKey){let e=await this.fromAPIKey(this.apiKey,this.clientOptions);e.scopes=this.scopes;let{credential:t}=await oe(this,Fn,yo).call(this,e);return t}else{let{credential:e}=await this.getApplicationDefaultAsync(this.clientOptions);return e}};gn.GoogleAuth=sh});var vS=Y(Xl=>{"use strict";Object.defineProperty(Xl,"__esModule",{value:!0});Xl.IAMAuth=void 0;var ah=class{constructor(e,t){x(this,"selector");x(this,"token");this.selector=e,this.token=t,this.selector=e,this.token=t}getRequestHeaders(){return{"x-goog-iam-authority-selector":this.selector,"x-goog-iam-authorization-token":this.token}}};Xl.IAMAuth=ah});var wS=Y(Ln=>{"use strict";Object.defineProperty(Ln,"__esModule",{value:!0});Ln.DownscopedClient=Ln.EXPIRATION_TIME_OFFSET=Ln.MAX_ACCESS_BOUNDARY_RULES_COUNT=void 0;var ex=Ze(),tx=require("stream"),lh=Mt(),nx=bl(),rx="urn:ietf:params:oauth:grant-type:token-exchange",ix="urn:ietf:params:oauth:token-type:access_token",ox="urn:ietf:params:oauth:token-type:access_token";Ln.MAX_ACCESS_BOUNDARY_RULES_COUNT=10;Ln.EXPIRATION_TIME_OFFSET=300*1e3;var uh=class extends lh.AuthClient{constructor(t,r={accessBoundary:{accessBoundaryRules:[]}}){super(t instanceof lh.AuthClient?{}:t);x(this,"authClient");x(this,"credentialAccessBoundary");x(this,"cachedDownscopedAccessToken");x(this,"stsCredential");if(t instanceof lh.AuthClient?(this.authClient=t,this.credentialAccessBoundary=r):(this.authClient=t.authClient,this.credentialAccessBoundary=t.credentialAccessBoundary),this.credentialAccessBoundary.accessBoundary.accessBoundaryRules.length===0)throw new Error("At least one access boundary rule needs to be defined.");if(this.credentialAccessBoundary.accessBoundary.accessBoundaryRules.length>Ln.MAX_ACCESS_BOUNDARY_RULES_COUNT)throw new Error(`The provided access boundary has more than ${Ln.MAX_ACCESS_BOUNDARY_RULES_COUNT} access boundary rules.`);for(let i of this.credentialAccessBoundary.accessBoundary.accessBoundaryRules)if(i.availablePermissions.length===0)throw new Error("At least one permission should be defined in access boundary rules.");this.stsCredential=new nx.StsCredentials({tokenExchangeEndpoint:`https://sts.${this.universeDomain}/v1/token`}),this.cachedDownscopedAccessToken=null}setCredentials(t){if(!t.expiry_date)throw new Error("The access token expiry_date field is missing in the provided credentials.");super.setCredentials(t),this.cachedDownscopedAccessToken=t}async getAccessToken(){return(!this.cachedDownscopedAccessToken||this.isExpired(this.cachedDownscopedAccessToken))&&await this.refreshAccessTokenAsync(),{token:this.cachedDownscopedAccessToken.access_token,expirationTime:this.cachedDownscopedAccessToken.expiry_date,res:this.cachedDownscopedAccessToken.res}}async getRequestHeaders(){let t=await this.getAccessToken(),r=new Headers({authorization:`Bearer ${t.token}`});return this.addSharedMetadataHeaders(r)}request(t,r){if(r)this.requestAsync(t).then(i=>r(null,i),i=>r(i,i.response));else return this.requestAsync(t)}async requestAsync(t,r=!1){let i;try{let o=await this.getRequestHeaders();t.headers=ex.Gaxios.mergeHeaders(t.headers),this.addUserProjectAndAuthHeaders(t.headers,o),i=await this.transporter.request(t)}catch(o){let s=o.response;if(s){let u=s.status,f=s.config.data instanceof tx.Readable;if(!r&&(u===401||u===403)&&!f&&this.forceRefreshOnFailure)return await this.refreshAccessTokenAsync(),await this.requestAsync(t,!0)}throw o}return i}async refreshAccessTokenAsync(){var u;let t=(await this.authClient.getAccessToken()).token,r={grantType:rx,requestedTokenType:ix,subjectToken:t,subjectTokenType:ox},i=await this.stsCredential.exchangeToken(r,void 0,this.credentialAccessBoundary),o=((u=this.authClient.credentials)==null?void 0:u.expiry_date)||null,s=i.expires_in?new Date().getTime()+i.expires_in*1e3:o;return this.cachedDownscopedAccessToken={access_token:i.access_token,expiry_date:s,res:i.res},this.credentials={},Object.assign(this.credentials,this.cachedDownscopedAccessToken),delete this.credentials.res,this.emit("tokens",{refresh_token:null,expiry_date:this.cachedDownscopedAccessToken.expiry_date,access_token:this.cachedDownscopedAccessToken.access_token,token_type:"Bearer",id_token:null}),this.cachedDownscopedAccessToken}isExpired(t){let r=new Date().getTime();return t.expiry_date?r>=t.expiry_date-this.eagerRefreshThresholdMillis:!1}};Ln.DownscopedClient=uh});var CS=Y(Ql=>{"use strict";Object.defineProperty(Ql,"__esModule",{value:!0});Ql.PassThroughClient=void 0;var sx=Mt(),ch=class extends sx.AuthClient{async request(e){return this.transporter.request(e)}async getAccessToken(){return{}}async getRequestHeaders(){return new Headers}};Ql.PassThroughClient=ch});var PS=Y(ae=>{"use strict";Object.defineProperty(ae,"__esModule",{value:!0});ae.GoogleAuth=ae.auth=ae.PassThroughClient=ae.ExternalAccountAuthorizedUserClient=ae.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE=ae.ExecutableError=ae.PluggableAuthClient=ae.DownscopedClient=ae.BaseExternalAccountClient=ae.ExternalAccountClient=ae.IdentityPoolClient=ae.AwsRequestSigner=ae.AwsClient=ae.UserRefreshClient=ae.LoginTicket=ae.ClientAuthentication=ae.OAuth2Client=ae.CodeChallengeMethod=ae.Impersonated=ae.JWT=ae.JWTAccess=ae.IdTokenClient=ae.IAMAuth=ae.GCPEnv=ae.Compute=ae.DEFAULT_UNIVERSE=ae.AuthClient=ae.gaxios=ae.gcpMetadata=void 0;var AS=TS();Object.defineProperty(ae,"GoogleAuth",{enumerable:!0,get:function(){return AS.GoogleAuth}});ae.gcpMetadata=_s();ae.gaxios=Ze();var bS=Mt();Object.defineProperty(ae,"AuthClient",{enumerable:!0,get:function(){return bS.AuthClient}});Object.defineProperty(ae,"DEFAULT_UNIVERSE",{enumerable:!0,get:function(){return bS.DEFAULT_UNIVERSE}});var ax=Jf();Object.defineProperty(ae,"Compute",{enumerable:!0,get:function(){return ax.Compute}});var lx=Xf();Object.defineProperty(ae,"GCPEnv",{enumerable:!0,get:function(){return lx.GCPEnv}});var ux=vS();Object.defineProperty(ae,"IAMAuth",{enumerable:!0,get:function(){return ux.IAMAuth}});var cx=Yf();Object.defineProperty(ae,"IdTokenClient",{enumerable:!0,get:function(){return cx.IdTokenClient}});var fx=hd();Object.defineProperty(ae,"JWTAccess",{enumerable:!0,get:function(){return fx.JWTAccess}});var dx=md();Object.defineProperty(ae,"JWT",{enumerable:!0,get:function(){return dx.JWT}});var hx=Ed();Object.defineProperty(ae,"Impersonated",{enumerable:!0,get:function(){return hx.Impersonated}});var fh=ii();Object.defineProperty(ae,"CodeChallengeMethod",{enumerable:!0,get:function(){return fh.CodeChallengeMethod}});Object.defineProperty(ae,"OAuth2Client",{enumerable:!0,get:function(){return fh.OAuth2Client}});Object.defineProperty(ae,"ClientAuthentication",{enumerable:!0,get:function(){return fh.ClientAuthentication}});var px=Vf();Object.defineProperty(ae,"LoginTicket",{enumerable:!0,get:function(){return px.LoginTicket}});var mx=yd();Object.defineProperty(ae,"UserRefreshClient",{enumerable:!0,get:function(){return mx.UserRefreshClient}});var gx=Gd();Object.defineProperty(ae,"AwsClient",{enumerable:!0,get:function(){return gx.AwsClient}});var yx=Ud();Object.defineProperty(ae,"AwsRequestSigner",{enumerable:!0,get:function(){return yx.AwsRequestSigner}});var _x=Dd();Object.defineProperty(ae,"IdentityPoolClient",{enumerable:!0,get:function(){return _x.IdentityPoolClient}});var Ex=jd();Object.defineProperty(ae,"ExternalAccountClient",{enumerable:!0,get:function(){return Ex.ExternalAccountClient}});var Sx=Rr();Object.defineProperty(ae,"BaseExternalAccountClient",{enumerable:!0,get:function(){return Sx.BaseExternalAccountClient}});var Tx=wS();Object.defineProperty(ae,"DownscopedClient",{enumerable:!0,get:function(){return Tx.DownscopedClient}});var RS=Qd();Object.defineProperty(ae,"PluggableAuthClient",{enumerable:!0,get:function(){return RS.PluggableAuthClient}});Object.defineProperty(ae,"ExecutableError",{enumerable:!0,get:function(){return RS.ExecutableError}});var IS=rh();Object.defineProperty(ae,"EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE",{enumerable:!0,get:function(){return IS.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE}});Object.defineProperty(ae,"ExternalAccountAuthorizedUserClient",{enumerable:!0,get:function(){return IS.ExternalAccountAuthorizedUserClient}});var vx=CS();Object.defineProperty(ae,"PassThroughClient",{enumerable:!0,get:function(){return vx.PassThroughClient}});var wx=new AS.GoogleAuth;ae.auth=wx});var nr=Y((bB,kS)=>{"use strict";var xS=["nodebuffer","arraybuffer","fragments"],NS=typeof Blob!="undefined";NS&&xS.push("blob");kS.exports={BINARY_TYPES:xS,EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",hasBlob:NS,kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}});var Fs=Y((RB,Zl)=>{"use strict";var{EMPTY_BUFFER:Cx}=nr(),dh=Buffer[Symbol.species];function Ax(n,e){if(n.length===0)return Cx;if(n.length===1)return n[0];let t=Buffer.allocUnsafe(e),r=0;for(let i=0;i<n.length;i++){let o=n[i];t.set(o,r),r+=o.length}return r<e?new dh(t.buffer,t.byteOffset,r):t}function MS(n,e,t,r,i){for(let o=0;o<i;o++)t[r+o]=n[o]^e[o&3]}function DS(n,e){for(let t=0;t<n.length;t++)n[t]^=e[t&3]}function bx(n){return n.length===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.length)}function hh(n){if(hh.readOnly=!0,Buffer.isBuffer(n))return n;let e;return n instanceof ArrayBuffer?e=new dh(n):ArrayBuffer.isView(n)?e=new dh(n.buffer,n.byteOffset,n.byteLength):(e=Buffer.from(n),hh.readOnly=!1),e}Zl.exports={concat:Ax,mask:MS,toArrayBuffer:bx,toBuffer:hh,unmask:DS};if(!process.env.WS_NO_BUFFER_UTIL)try{let n=require("bufferutil");Zl.exports.mask=function(e,t,r,i,o){o<48?MS(e,t,r,i,o):n.mask(e,t,r,i,o)},Zl.exports.unmask=function(e,t){e.length<32?DS(e,t):n.unmask(e,t)}}catch(n){}});var FS=Y((IB,US)=>{"use strict";var OS=Symbol("kDone"),ph=Symbol("kRun"),mh=class{constructor(e){this[OS]=()=>{this.pending--,this[ph]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[ph]()}[ph](){if(this.pending!==this.concurrency&&this.jobs.length){let e=this.jobs.shift();this.pending++,e(this[OS])}}};US.exports=mh});var qs=Y((PB,GS)=>{"use strict";var Ls=require("zlib"),LS=Fs(),Rx=FS(),{kStatusCode:qS}=nr(),Ix=Buffer[Symbol.species],Px=Buffer.from([0,0,255,255]),eu=Symbol("permessage-deflate"),rr=Symbol("total-length"),_o=Symbol("callback"),Ir=Symbol("buffers"),Eo=Symbol("error"),jl,gh=class{constructor(e,t,r){if(this._maxPayload=r|0,this._options=e||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,!jl){let i=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;jl=new Rx(i)}}static get extensionName(){return"permessage-deflate"}offer(){let e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits==null&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){let e=this._deflate[_o];this._deflate.close(),this._deflate=null,e&&e(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){let t=this._options,r=e.find(i=>!(t.serverNoContextTakeover===!1&&i.server_no_context_takeover||i.server_max_window_bits&&(t.serverMaxWindowBits===!1||typeof t.serverMaxWindowBits=="number"&&t.serverMaxWindowBits>i.server_max_window_bits)||typeof t.clientMaxWindowBits=="number"&&!i.client_max_window_bits));if(!r)throw new Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(r.server_no_context_takeover=!0),t.clientNoContextTakeover&&(r.client_no_context_takeover=!0),typeof t.serverMaxWindowBits=="number"&&(r.server_max_window_bits=t.serverMaxWindowBits),typeof t.clientMaxWindowBits=="number"?r.client_max_window_bits=t.clientMaxWindowBits:(r.client_max_window_bits===!0||t.clientMaxWindowBits===!1)&&delete r.client_max_window_bits,r}acceptAsClient(e){let t=e[0];if(this._options.clientNoContextTakeover===!1&&t.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!t.client_max_window_bits)typeof this._options.clientMaxWindowBits=="number"&&(t.client_max_window_bits=this._options.clientMaxWindowBits);else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits=="number"&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return t}normalizeParams(e){return e.forEach(t=>{Object.keys(t).forEach(r=>{let i=t[r];if(i.length>1)throw new Error(`Parameter "${r}" must have only a single value`);if(i=i[0],r==="client_max_window_bits"){if(i!==!0){let o=+i;if(!Number.isInteger(o)||o<8||o>15)throw new TypeError(`Invalid value for parameter "${r}": ${i}`);i=o}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${r}": ${i}`)}else if(r==="server_max_window_bits"){let o=+i;if(!Number.isInteger(o)||o<8||o>15)throw new TypeError(`Invalid value for parameter "${r}": ${i}`);i=o}else if(r==="client_no_context_takeover"||r==="server_no_context_takeover"){if(i!==!0)throw new TypeError(`Invalid value for parameter "${r}": ${i}`)}else throw new Error(`Unknown parameter "${r}"`);t[r]=i})}),e}decompress(e,t,r){jl.add(i=>{this._decompress(e,t,(o,s)=>{i(),r(o,s)})})}compress(e,t,r){jl.add(i=>{this._compress(e,t,(o,s)=>{i(),r(o,s)})})}_decompress(e,t,r){let i=this._isServer?"client":"server";if(!this._inflate){let o=`${i}_max_window_bits`,s=typeof this.params[o]!="number"?Ls.Z_DEFAULT_WINDOWBITS:this.params[o];this._inflate=Ls.createInflateRaw({...this._options.zlibInflateOptions,windowBits:s}),this._inflate[eu]=this,this._inflate[rr]=0,this._inflate[Ir]=[],this._inflate.on("error",Nx),this._inflate.on("data",BS)}this._inflate[_o]=r,this._inflate.write(e),t&&this._inflate.write(Px),this._inflate.flush(()=>{let o=this._inflate[Eo];if(o){this._inflate.close(),this._inflate=null,r(o);return}let s=LS.concat(this._inflate[Ir],this._inflate[rr]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[rr]=0,this._inflate[Ir]=[],t&&this.params[`${i}_no_context_takeover`]&&this._inflate.reset()),r(null,s)})}_compress(e,t,r){let i=this._isServer?"server":"client";if(!this._deflate){let o=`${i}_max_window_bits`,s=typeof this.params[o]!="number"?Ls.Z_DEFAULT_WINDOWBITS:this.params[o];this._deflate=Ls.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:s}),this._deflate[rr]=0,this._deflate[Ir]=[],this._deflate.on("data",xx)}this._deflate[_o]=r,this._deflate.write(e),this._deflate.flush(Ls.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let o=LS.concat(this._deflate[Ir],this._deflate[rr]);t&&(o=new Ix(o.buffer,o.byteOffset,o.length-4)),this._deflate[_o]=null,this._deflate[rr]=0,this._deflate[Ir]=[],t&&this.params[`${i}_no_context_takeover`]&&this._deflate.reset(),r(null,o)})}};GS.exports=gh;function xx(n){this[Ir].push(n),this[rr]+=n.length}function BS(n){if(this[rr]+=n.length,this[eu]._maxPayload<1||this[rr]<=this[eu]._maxPayload){this[Ir].push(n);return}this[Eo]=new RangeError("Max payload size exceeded"),this[Eo].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[Eo][qS]=1009,this.removeListener("data",BS),this.reset()}function Nx(n){if(this[eu]._inflate=null,this[Eo]){this[_o](this[Eo]);return}n[qS]=1007,this[_o](n)}});var So=Y((xB,tu)=>{"use strict";var{isUtf8:HS}=require("buffer"),{hasBlob:kx}=nr(),Mx=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function Dx(n){return n>=1e3&&n<=1014&&n!==1004&&n!==1005&&n!==1006||n>=3e3&&n<=4999}function yh(n){let e=n.length,t=0;for(;t<e;)if((n[t]&128)===0)t++;else if((n[t]&224)===192){if(t+1===e||(n[t+1]&192)!==128||(n[t]&254)===192)return!1;t+=2}else if((n[t]&240)===224){if(t+2>=e||(n[t+1]&192)!==128||(n[t+2]&192)!==128||n[t]===224&&(n[t+1]&224)===128||n[t]===237&&(n[t+1]&224)===160)return!1;t+=3}else if((n[t]&248)===240){if(t+3>=e||(n[t+1]&192)!==128||(n[t+2]&192)!==128||(n[t+3]&192)!==128||n[t]===240&&(n[t+1]&240)===128||n[t]===244&&n[t+1]>143||n[t]>244)return!1;t+=4}else return!1;return!0}function Ox(n){return kx&&typeof n=="object"&&typeof n.arrayBuffer=="function"&&typeof n.type=="string"&&typeof n.stream=="function"&&(n[Symbol.toStringTag]==="Blob"||n[Symbol.toStringTag]==="File")}tu.exports={isBlob:Ox,isValidStatusCode:Dx,isValidUTF8:yh,tokenChars:Mx};if(HS)tu.exports.isValidUTF8=function(n){return n.length<24?yh(n):HS(n)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{let n=require("utf-8-validate");tu.exports.isValidUTF8=function(e){return e.length<32?yh(e):n(e)}}catch(n){}});var vh=Y((NB,YS)=>{"use strict";var{Writable:Ux}=require("stream"),VS=qs(),{BINARY_TYPES:Fx,EMPTY_BUFFER:$S,kStatusCode:Lx,kWebSocket:qx}=nr(),{concat:_h,toArrayBuffer:Bx,unmask:Gx}=Fs(),{isValidStatusCode:Hx,isValidUTF8:WS}=So(),nu=Buffer[Symbol.species],Zt=0,zS=1,JS=2,KS=3,Eh=4,Sh=5,ru=6,Th=class extends Ux{constructor(e={}){super(),this._allowSynchronousEvents=e.allowSynchronousEvents!==void 0?e.allowSynchronousEvents:!0,this._binaryType=e.binaryType||Fx[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=e.maxPayload|0,this._skipUTF8Validation=!!e.skipUTF8Validation,this[qx]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=Zt}_write(e,t,r){if(this._opcode===8&&this._state==Zt)return r();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(r)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){let r=this._buffers[0];return this._buffers[0]=new nu(r.buffer,r.byteOffset+e,r.length-e),new nu(r.buffer,r.byteOffset,e)}let t=Buffer.allocUnsafe(e);do{let r=this._buffers[0],i=t.length-e;e>=r.length?t.set(this._buffers.shift(),i):(t.set(new Uint8Array(r.buffer,r.byteOffset,e),i),this._buffers[0]=new nu(r.buffer,r.byteOffset+e,r.length-e)),e-=r.length}while(e>0);return t}startLoop(e){this._loop=!0;do switch(this._state){case Zt:this.getInfo(e);break;case zS:this.getPayloadLength16(e);break;case JS:this.getPayloadLength64(e);break;case KS:this.getMask();break;case Eh:this.getData(e);break;case Sh:case ru:this._loop=!1;return}while(this._loop);this._errored||e()}getInfo(e){if(this._bufferedBytes<2){this._loop=!1;return}let t=this.consume(2);if((t[0]&48)!==0){let i=this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");e(i);return}let r=(t[0]&64)===64;if(r&&!this._extensions[VS.extensionName]){let i=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(i);return}if(this._fin=(t[0]&128)===128,this._opcode=t[0]&15,this._payloadLength=t[1]&127,this._opcode===0){if(r){let i=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(i);return}if(!this._fragmented){let i=this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");e(i);return}this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented){let i=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");e(i);return}this._compressed=r}else if(this._opcode>7&&this._opcode<11){if(!this._fin){let i=this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");e(i);return}if(r){let i=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(i);return}if(this._payloadLength>125||this._opcode===8&&this._payloadLength===1){let i=this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH");e(i);return}}else{let i=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");e(i);return}if(!this._fin&&!this._fragmented&&(this._fragmented=this._opcode),this._masked=(t[1]&128)===128,this._isServer){if(!this._masked){let i=this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK");e(i);return}}else if(this._masked){let i=this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");e(i);return}this._payloadLength===126?this._state=zS:this._payloadLength===127?this._state=JS:this.haveLength(e)}getPayloadLength16(e){if(this._bufferedBytes<2){this._loop=!1;return}this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(e)}getPayloadLength64(e){if(this._bufferedBytes<8){this._loop=!1;return}let t=this.consume(8),r=t.readUInt32BE(0);if(r>Math.pow(2,21)-1){let i=this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH");e(i);return}this._payloadLength=r*Math.pow(2,32)+t.readUInt32BE(4),this.haveLength(e)}haveLength(e){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0)){let t=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");e(t);return}this._masked?this._state=KS:this._state=Eh}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=Eh}getData(e){let t=$S;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}t=this.consume(this._payloadLength),this._masked&&(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])!==0&&Gx(t,this._mask)}if(this._opcode>7){this.controlMessage(t,e);return}if(this._compressed){this._state=Sh,this.decompress(t,e);return}t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage(e)}decompress(e,t){this._extensions[VS.extensionName].decompress(e,this._fin,(i,o)=>{if(i)return t(i);if(o.length){if(this._messageLength+=o.length,this._messageLength>this._maxPayload&&this._maxPayload>0){let s=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");t(s);return}this._fragments.push(o)}this.dataMessage(t),this._state===Zt&&this.startLoop(t)})}dataMessage(e){if(!this._fin){this._state=Zt;return}let t=this._messageLength,r=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){let i;this._binaryType==="nodebuffer"?i=_h(r,t):this._binaryType==="arraybuffer"?i=Bx(_h(r,t)):this._binaryType==="blob"?i=new Blob(r):i=r,this._allowSynchronousEvents?(this.emit("message",i,!0),this._state=Zt):(this._state=ru,setImmediate(()=>{this.emit("message",i,!0),this._state=Zt,this.startLoop(e)}))}else{let i=_h(r,t);if(!this._skipUTF8Validation&&!WS(i)){let o=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");e(o);return}this._state===Sh||this._allowSynchronousEvents?(this.emit("message",i,!1),this._state=Zt):(this._state=ru,setImmediate(()=>{this.emit("message",i,!1),this._state=Zt,this.startLoop(e)}))}}controlMessage(e,t){if(this._opcode===8){if(e.length===0)this._loop=!1,this.emit("conclude",1005,$S),this.end();else{let r=e.readUInt16BE(0);if(!Hx(r)){let o=this.createError(RangeError,`invalid status code ${r}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");t(o);return}let i=new nu(e.buffer,e.byteOffset+2,e.length-2);if(!this._skipUTF8Validation&&!WS(i)){let o=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");t(o);return}this._loop=!1,this.emit("conclude",r,i),this.end()}this._state=Zt;return}this._allowSynchronousEvents?(this.emit(this._opcode===9?"ping":"pong",e),this._state=Zt):(this._state=ru,setImmediate(()=>{this.emit(this._opcode===9?"ping":"pong",e),this._state=Zt,this.startLoop(t)}))}createError(e,t,r,i,o){this._loop=!1,this._errored=!0;let s=new e(r?`Invalid WebSocket frame: ${t}`:t);return Error.captureStackTrace(s,this.createError),s.code=o,s[Lx]=i,s}};YS.exports=Th});var Ah=Y((MB,ZS)=>{"use strict";var{Duplex:kB}=require("stream"),{randomFillSync:Vx}=require("crypto"),XS=qs(),{EMPTY_BUFFER:$x,kWebSocket:Wx,NOOP:zx}=nr(),{isBlob:To,isValidStatusCode:Jx}=So(),{mask:QS,toBuffer:ui}=Fs(),jt=Symbol("kByteLength"),Kx=Buffer.alloc(4),iu=8*1024,ci,vo=iu,yn=0,Yx=1,Xx=2,wh=class n{constructor(e,t,r){this._extensions=t||{},r&&(this._generateMask=r,this._maskBuffer=Buffer.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._queue=[],this._state=yn,this.onerror=zx,this[Wx]=void 0}static frame(e,t){let r,i=!1,o=2,s=!1;t.mask&&(r=t.maskBuffer||Kx,t.generateMask?t.generateMask(r):(vo===iu&&(ci===void 0&&(ci=Buffer.alloc(iu)),Vx(ci,0,iu),vo=0),r[0]=ci[vo++],r[1]=ci[vo++],r[2]=ci[vo++],r[3]=ci[vo++]),s=(r[0]|r[1]|r[2]|r[3])===0,o=6);let u;typeof e=="string"?(!t.mask||s)&&t[jt]!==void 0?u=t[jt]:(e=Buffer.from(e),u=e.length):(u=e.length,i=t.mask&&t.readOnly&&!s);let f=u;u>=65536?(o+=8,f=127):u>125&&(o+=2,f=126);let d=Buffer.allocUnsafe(i?u+o:o);return d[0]=t.fin?t.opcode|128:t.opcode,t.rsv1&&(d[0]|=64),d[1]=f,f===126?d.writeUInt16BE(u,2):f===127&&(d[2]=d[3]=0,d.writeUIntBE(u,4,6)),t.mask?(d[1]|=128,d[o-4]=r[0],d[o-3]=r[1],d[o-2]=r[2],d[o-1]=r[3],s?[d,e]:i?(QS(e,r,d,o,u),[d]):(QS(e,r,e,0,u),[d,e])):[d,e]}close(e,t,r,i){let o;if(e===void 0)o=$x;else{if(typeof e!="number"||!Jx(e))throw new TypeError("First argument must be a valid error code number");if(t===void 0||!t.length)o=Buffer.allocUnsafe(2),o.writeUInt16BE(e,0);else{let u=Buffer.byteLength(t);if(u>123)throw new RangeError("The message must not be greater than 123 bytes");o=Buffer.allocUnsafe(2+u),o.writeUInt16BE(e,0),typeof t=="string"?o.write(t,2):o.set(t,2)}}let s={[jt]:o.length,fin:!0,generateMask:this._generateMask,mask:r,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};this._state!==yn?this.enqueue([this.dispatch,o,!1,s,i]):this.sendFrame(n.frame(o,s),i)}ping(e,t,r){let i,o;if(typeof e=="string"?(i=Buffer.byteLength(e),o=!1):To(e)?(i=e.size,o=!1):(e=ui(e),i=e.length,o=ui.readOnly),i>125)throw new RangeError("The data size must not be greater than 125 bytes");let s={[jt]:i,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:9,readOnly:o,rsv1:!1};To(e)?this._state!==yn?this.enqueue([this.getBlobData,e,!1,s,r]):this.getBlobData(e,!1,s,r):this._state!==yn?this.enqueue([this.dispatch,e,!1,s,r]):this.sendFrame(n.frame(e,s),r)}pong(e,t,r){let i,o;if(typeof e=="string"?(i=Buffer.byteLength(e),o=!1):To(e)?(i=e.size,o=!1):(e=ui(e),i=e.length,o=ui.readOnly),i>125)throw new RangeError("The data size must not be greater than 125 bytes");let s={[jt]:i,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:10,readOnly:o,rsv1:!1};To(e)?this._state!==yn?this.enqueue([this.getBlobData,e,!1,s,r]):this.getBlobData(e,!1,s,r):this._state!==yn?this.enqueue([this.dispatch,e,!1,s,r]):this.sendFrame(n.frame(e,s),r)}send(e,t,r){let i=this._extensions[XS.extensionName],o=t.binary?2:1,s=t.compress,u,f;typeof e=="string"?(u=Buffer.byteLength(e),f=!1):To(e)?(u=e.size,f=!1):(e=ui(e),u=e.length,f=ui.readOnly),this._firstFragment?(this._firstFragment=!1,s&&i&&i.params[i._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(s=u>=i._threshold),this._compress=s):(s=!1,o=0),t.fin&&(this._firstFragment=!0);let d={[jt]:u,fin:t.fin,generateMask:this._generateMask,mask:t.mask,maskBuffer:this._maskBuffer,opcode:o,readOnly:f,rsv1:s};To(e)?this._state!==yn?this.enqueue([this.getBlobData,e,this._compress,d,r]):this.getBlobData(e,this._compress,d,r):this._state!==yn?this.enqueue([this.dispatch,e,this._compress,d,r]):this.dispatch(e,this._compress,d,r)}getBlobData(e,t,r,i){this._bufferedBytes+=r[jt],this._state=Xx,e.arrayBuffer().then(o=>{if(this._socket.destroyed){let u=new Error("The socket was closed while the blob was being read");process.nextTick(Ch,this,u,i);return}this._bufferedBytes-=r[jt];let s=ui(o);t?this.dispatch(s,t,r,i):(this._state=yn,this.sendFrame(n.frame(s,r),i),this.dequeue())}).catch(o=>{process.nextTick(Qx,this,o,i)})}dispatch(e,t,r,i){if(!t){this.sendFrame(n.frame(e,r),i);return}let o=this._extensions[XS.extensionName];this._bufferedBytes+=r[jt],this._state=Yx,o.compress(e,r.fin,(s,u)=>{if(this._socket.destroyed){let f=new Error("The socket was closed while data was being compressed");Ch(this,f,i);return}this._bufferedBytes-=r[jt],this._state=yn,r.readOnly=!1,this.sendFrame(n.frame(u,r),i),this.dequeue()})}dequeue(){for(;this._state===yn&&this._queue.length;){let e=this._queue.shift();this._bufferedBytes-=e[3][jt],Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[3][jt],this._queue.push(e)}sendFrame(e,t){e.length===2?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}};ZS.exports=wh;function Ch(n,e,t){typeof t=="function"&&t(e);for(let r=0;r<n._queue.length;r++){let i=n._queue[r],o=i[i.length-1];typeof o=="function"&&o(e)}}function Qx(n,e,t){Ch(n,e,t),n.onerror(e)}});var aT=Y((DB,sT)=>{"use strict";var{kForOnEventAttribute:Bs,kListener:bh}=nr(),jS=Symbol("kCode"),eT=Symbol("kData"),tT=Symbol("kError"),nT=Symbol("kMessage"),rT=Symbol("kReason"),wo=Symbol("kTarget"),iT=Symbol("kType"),oT=Symbol("kWasClean"),ir=class{constructor(e){this[wo]=null,this[iT]=e}get target(){return this[wo]}get type(){return this[iT]}};Object.defineProperty(ir.prototype,"target",{enumerable:!0});Object.defineProperty(ir.prototype,"type",{enumerable:!0});var fi=class extends ir{constructor(e,t={}){super(e),this[jS]=t.code===void 0?0:t.code,this[rT]=t.reason===void 0?"":t.reason,this[oT]=t.wasClean===void 0?!1:t.wasClean}get code(){return this[jS]}get reason(){return this[rT]}get wasClean(){return this[oT]}};Object.defineProperty(fi.prototype,"code",{enumerable:!0});Object.defineProperty(fi.prototype,"reason",{enumerable:!0});Object.defineProperty(fi.prototype,"wasClean",{enumerable:!0});var Co=class extends ir{constructor(e,t={}){super(e),this[tT]=t.error===void 0?null:t.error,this[nT]=t.message===void 0?"":t.message}get error(){return this[tT]}get message(){return this[nT]}};Object.defineProperty(Co.prototype,"error",{enumerable:!0});Object.defineProperty(Co.prototype,"message",{enumerable:!0});var Gs=class extends ir{constructor(e,t={}){super(e),this[eT]=t.data===void 0?null:t.data}get data(){return this[eT]}};Object.defineProperty(Gs.prototype,"data",{enumerable:!0});var Zx={addEventListener(n,e,t={}){for(let i of this.listeners(n))if(!t[Bs]&&i[bh]===e&&!i[Bs])return;let r;if(n==="message")r=function(o,s){let u=new Gs("message",{data:s?o:o.toString()});u[wo]=this,ou(e,this,u)};else if(n==="close")r=function(o,s){let u=new fi("close",{code:o,reason:s.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});u[wo]=this,ou(e,this,u)};else if(n==="error")r=function(o){let s=new Co("error",{error:o,message:o.message});s[wo]=this,ou(e,this,s)};else if(n==="open")r=function(){let o=new ir("open");o[wo]=this,ou(e,this,o)};else return;r[Bs]=!!t[Bs],r[bh]=e,t.once?this.once(n,r):this.on(n,r)},removeEventListener(n,e){for(let t of this.listeners(n))if(t[bh]===e&&!t[Bs]){this.removeListener(n,t);break}}};sT.exports={CloseEvent:fi,ErrorEvent:Co,Event:ir,EventTarget:Zx,MessageEvent:Gs};function ou(n,e,t){typeof n=="object"&&n.handleEvent?n.handleEvent.call(n,t):n.call(e,t)}});var Rh=Y((OB,lT)=>{"use strict";var{tokenChars:Hs}=So();function qn(n,e,t){n[e]===void 0?n[e]=[t]:n[e].push(t)}function jx(n){let e=Object.create(null),t=Object.create(null),r=!1,i=!1,o=!1,s,u,f=-1,d=-1,h=-1,m=0;for(;m<n.length;m++)if(d=n.charCodeAt(m),s===void 0)if(h===-1&&Hs[d]===1)f===-1&&(f=m);else if(m!==0&&(d===32||d===9))h===-1&&f!==-1&&(h=m);else if(d===59||d===44){if(f===-1)throw new SyntaxError(`Unexpected character at index ${m}`);h===-1&&(h=m);let _=n.slice(f,h);d===44?(qn(e,_,t),t=Object.create(null)):s=_,f=h=-1}else throw new SyntaxError(`Unexpected character at index ${m}`);else if(u===void 0)if(h===-1&&Hs[d]===1)f===-1&&(f=m);else if(d===32||d===9)h===-1&&f!==-1&&(h=m);else if(d===59||d===44){if(f===-1)throw new SyntaxError(`Unexpected character at index ${m}`);h===-1&&(h=m),qn(t,n.slice(f,h),!0),d===44&&(qn(e,s,t),t=Object.create(null),s=void 0),f=h=-1}else if(d===61&&f!==-1&&h===-1)u=n.slice(f,m),f=h=-1;else throw new SyntaxError(`Unexpected character at index ${m}`);else if(i){if(Hs[d]!==1)throw new SyntaxError(`Unexpected character at index ${m}`);f===-1?f=m:r||(r=!0),i=!1}else if(o)if(Hs[d]===1)f===-1&&(f=m);else if(d===34&&f!==-1)o=!1,h=m;else if(d===92)i=!0;else throw new SyntaxError(`Unexpected character at index ${m}`);else if(d===34&&n.charCodeAt(m-1)===61)o=!0;else if(h===-1&&Hs[d]===1)f===-1&&(f=m);else if(f!==-1&&(d===32||d===9))h===-1&&(h=m);else if(d===59||d===44){if(f===-1)throw new SyntaxError(`Unexpected character at index ${m}`);h===-1&&(h=m);let _=n.slice(f,h);r&&(_=_.replace(/\\/g,""),r=!1),qn(t,u,_),d===44&&(qn(e,s,t),t=Object.create(null),s=void 0),u=void 0,f=h=-1}else throw new SyntaxError(`Unexpected character at index ${m}`);if(f===-1||o||d===32||d===9)throw new SyntaxError("Unexpected end of input");h===-1&&(h=m);let g=n.slice(f,h);return s===void 0?qn(e,g,t):(u===void 0?qn(t,g,!0):r?qn(t,u,g.replace(/\\/g,"")):qn(t,u,g),qn(e,s,t)),e}function eN(n){return Object.keys(n).map(e=>{let t=n[e];return Array.isArray(t)||(t=[t]),t.map(r=>[e].concat(Object.keys(r).map(i=>{let o=r[i];return Array.isArray(o)||(o=[o]),o.map(s=>s===!0?i:`${i}=${s}`).join("; ")})).join("; ")).join(", ")}).join(", ")}lT.exports={format:eN,parse:jx}});var uu=Y((LB,ST)=>{"use strict";var tN=require("events"),nN=require("https"),rN=require("http"),fT=require("net"),iN=require("tls"),{randomBytes:oN,createHash:sN}=require("crypto"),{Duplex:UB,Readable:FB}=require("stream"),{URL:Ih}=require("url"),Pr=qs(),aN=vh(),lN=Ah(),{isBlob:uN}=So(),{BINARY_TYPES:uT,EMPTY_BUFFER:su,GUID:cN,kForOnEventAttribute:Ph,kListener:fN,kStatusCode:dN,kWebSocket:Qe,NOOP:dT}=nr(),{EventTarget:{addEventListener:hN,removeEventListener:pN}}=aT(),{format:mN,parse:gN}=Rh(),{toBuffer:yN}=Fs(),_N=30*1e3,hT=Symbol("kAborted"),xh=[8,13],or=["CONNECTING","OPEN","CLOSING","CLOSED"],EN=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/,Ue=class n extends tN{constructor(e,t,r){super(),this._binaryType=uT[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=su,this._closeTimer=null,this._errorEmitted=!1,this._extensions={},this._paused=!1,this._protocol="",this._readyState=n.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,e!==null?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,t===void 0?t=[]:Array.isArray(t)||(typeof t=="object"&&t!==null?(r=t,t=[]):t=[t]),pT(this,e,t,r)):(this._autoPong=r.autoPong,this._isServer=!0)}get binaryType(){return this._binaryType}set binaryType(e){uT.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,t,r){let i=new aN({allowSynchronousEvents:r.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:r.maxPayload,skipUTF8Validation:r.skipUTF8Validation}),o=new lN(e,this._extensions,r.generateMask);this._receiver=i,this._sender=o,this._socket=e,i[Qe]=this,o[Qe]=this,e[Qe]=this,i.on("conclude",vN),i.on("drain",wN),i.on("error",CN),i.on("message",AN),i.on("ping",bN),i.on("pong",RN),o.onerror=IN,e.setTimeout&&e.setTimeout(0),e.setNoDelay&&e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",yT),e.on("data",lu),e.on("end",_T),e.on("error",ET),this._readyState=n.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=n.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[Pr.extensionName]&&this._extensions[Pr.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=n.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==n.CLOSED){if(this.readyState===n.CONNECTING){Lt(this,this._req,"WebSocket was closed before the connection was established");return}if(this.readyState===n.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=n.CLOSING,this._sender.close(e,t,!this._isServer,r=>{r||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),gT(this)}}pause(){this.readyState===n.CONNECTING||this.readyState===n.CLOSED||(this._paused=!0,this._socket.pause())}ping(e,t,r){if(this.readyState===n.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(r=e,e=t=void 0):typeof t=="function"&&(r=t,t=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==n.OPEN){Nh(this,e,r);return}t===void 0&&(t=!this._isServer),this._sender.ping(e||su,t,r)}pong(e,t,r){if(this.readyState===n.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(r=e,e=t=void 0):typeof t=="function"&&(r=t,t=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==n.OPEN){Nh(this,e,r);return}t===void 0&&(t=!this._isServer),this._sender.pong(e||su,t,r)}resume(){this.readyState===n.CONNECTING||this.readyState===n.CLOSED||(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(e,t,r){if(this.readyState===n.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof t=="function"&&(r=t,t={}),typeof e=="number"&&(e=e.toString()),this.readyState!==n.OPEN){Nh(this,e,r);return}let i={binary:typeof e!="string",mask:!this._isServer,compress:!0,fin:!0,...t};this._extensions[Pr.extensionName]||(i.compress=!1),this._sender.send(e||su,i,r)}terminate(){if(this.readyState!==n.CLOSED){if(this.readyState===n.CONNECTING){Lt(this,this._req,"WebSocket was closed before the connection was established");return}this._socket&&(this._readyState=n.CLOSING,this._socket.destroy())}}};Object.defineProperty(Ue,"CONNECTING",{enumerable:!0,value:or.indexOf("CONNECTING")});Object.defineProperty(Ue.prototype,"CONNECTING",{enumerable:!0,value:or.indexOf("CONNECTING")});Object.defineProperty(Ue,"OPEN",{enumerable:!0,value:or.indexOf("OPEN")});Object.defineProperty(Ue.prototype,"OPEN",{enumerable:!0,value:or.indexOf("OPEN")});Object.defineProperty(Ue,"CLOSING",{enumerable:!0,value:or.indexOf("CLOSING")});Object.defineProperty(Ue.prototype,"CLOSING",{enumerable:!0,value:or.indexOf("CLOSING")});Object.defineProperty(Ue,"CLOSED",{enumerable:!0,value:or.indexOf("CLOSED")});Object.defineProperty(Ue.prototype,"CLOSED",{enumerable:!0,value:or.indexOf("CLOSED")});["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(n=>{Object.defineProperty(Ue.prototype,n,{enumerable:!0})});["open","error","close","message"].forEach(n=>{Object.defineProperty(Ue.prototype,`on${n}`,{enumerable:!0,get(){for(let e of this.listeners(n))if(e[Ph])return e[fN];return null},set(e){for(let t of this.listeners(n))if(t[Ph]){this.removeListener(n,t);break}typeof e=="function"&&this.addEventListener(n,e,{[Ph]:!0})}})});Ue.prototype.addEventListener=hN;Ue.prototype.removeEventListener=pN;ST.exports=Ue;function pT(n,e,t,r){let i={allowSynchronousEvents:!0,autoPong:!0,protocolVersion:xh[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...r,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(n._autoPong=i.autoPong,!xh.includes(i.protocolVersion))throw new RangeError(`Unsupported protocol version: ${i.protocolVersion} (supported versions: ${xh.join(", ")})`);let o;if(e instanceof Ih)o=e;else try{o=new Ih(e)}catch(C){throw new SyntaxError(`Invalid URL: ${e}`)}o.protocol==="http:"?o.protocol="ws:":o.protocol==="https:"&&(o.protocol="wss:"),n._url=o.href;let s=o.protocol==="wss:",u=o.protocol==="ws+unix:",f;if(o.protocol!=="ws:"&&!s&&!u?f=`The URL's protocol must be one of "ws:", "wss:", "http:", "https:", or "ws+unix:"`:u&&!o.pathname?f="The URL's pathname is empty":o.hash&&(f="The URL contains a fragment identifier"),f){let C=new SyntaxError(f);if(n._redirects===0)throw C;au(n,C);return}let d=s?443:80,h=oN(16).toString("base64"),m=s?nN.request:rN.request,g=new Set,_;if(i.createConnection=i.createConnection||(s?TN:SN),i.defaultPort=i.defaultPort||d,i.port=o.port||d,i.host=o.hostname.startsWith("[")?o.hostname.slice(1,-1):o.hostname,i.headers={...i.headers,"Sec-WebSocket-Version":i.protocolVersion,"Sec-WebSocket-Key":h,Connection:"Upgrade",Upgrade:"websocket"},i.path=o.pathname+o.search,i.timeout=i.handshakeTimeout,i.perMessageDeflate&&(_=new Pr(i.perMessageDeflate!==!0?i.perMessageDeflate:{},!1,i.maxPayload),i.headers["Sec-WebSocket-Extensions"]=mN({[Pr.extensionName]:_.offer()})),t.length){for(let C of t){if(typeof C!="string"||!EN.test(C)||g.has(C))throw new SyntaxError("An invalid or duplicated subprotocol was specified");g.add(C)}i.headers["Sec-WebSocket-Protocol"]=t.join(",")}if(i.origin&&(i.protocolVersion<13?i.headers["Sec-WebSocket-Origin"]=i.origin:i.headers.Origin=i.origin),(o.username||o.password)&&(i.auth=`${o.username}:${o.password}`),u){let C=i.path.split(":");i.socketPath=C[0],i.path=C[1]}let v;if(i.followRedirects){if(n._redirects===0){n._originalIpc=u,n._originalSecure=s,n._originalHostOrSocketPath=u?i.socketPath:o.host;let C=r&&r.headers;if(r={...r,headers:{}},C)for(let[R,I]of Object.entries(C))r.headers[R.toLowerCase()]=I}else if(n.listenerCount("redirect")===0){let C=u?n._originalIpc?i.socketPath===n._originalHostOrSocketPath:!1:n._originalIpc?!1:o.host===n._originalHostOrSocketPath;(!C||n._originalSecure&&!s)&&(delete i.headers.authorization,delete i.headers.cookie,C||delete i.headers.host,i.auth=void 0)}i.auth&&!r.headers.authorization&&(r.headers.authorization="Basic "+Buffer.from(i.auth).toString("base64")),v=n._req=m(i),n._redirects&&n.emit("redirect",n.url,v)}else v=n._req=m(i);i.timeout&&v.on("timeout",()=>{Lt(n,v,"Opening handshake has timed out")}),v.on("error",C=>{v===null||v[hT]||(v=n._req=null,au(n,C))}),v.on("response",C=>{let R=C.headers.location,I=C.statusCode;if(R&&i.followRedirects&&I>=300&&I<400){if(++n._redirects>i.maxRedirects){Lt(n,v,"Maximum redirects exceeded");return}v.abort();let z;try{z=new Ih(R,e)}catch($){let W=new SyntaxError(`Invalid URL: ${R}`);au(n,W);return}pT(n,z,t,r)}else n.emit("unexpected-response",v,C)||Lt(n,v,`Unexpected server response: ${C.statusCode}`)}),v.on("upgrade",(C,R,I)=>{if(n.emit("upgrade",C),n.readyState!==Ue.CONNECTING)return;v=n._req=null;let z=C.headers.upgrade;if(z===void 0||z.toLowerCase()!=="websocket"){Lt(n,R,"Invalid Upgrade header");return}let $=sN("sha1").update(h+cN).digest("base64");if(C.headers["sec-websocket-accept"]!==$){Lt(n,R,"Invalid Sec-WebSocket-Accept header");return}let W=C.headers["sec-websocket-protocol"],H;if(W!==void 0?g.size?g.has(W)||(H="Server sent an invalid subprotocol"):H="Server sent a subprotocol but none was requested":g.size&&(H="Server sent no subprotocol"),H){Lt(n,R,H);return}W&&(n._protocol=W);let G=C.headers["sec-websocket-extensions"];if(G!==void 0){if(!_){Lt(n,R,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}let K;try{K=gN(G)}catch(T){Lt(n,R,"Invalid Sec-WebSocket-Extensions header");return}let te=Object.keys(K);if(te.length!==1||te[0]!==Pr.extensionName){Lt(n,R,"Server indicated an extension that was not requested");return}try{_.accept(K[Pr.extensionName])}catch(T){Lt(n,R,"Invalid Sec-WebSocket-Extensions header");return}n._extensions[Pr.extensionName]=_}n.setSocket(R,I,{allowSynchronousEvents:i.allowSynchronousEvents,generateMask:i.generateMask,maxPayload:i.maxPayload,skipUTF8Validation:i.skipUTF8Validation})}),i.finishRequest?i.finishRequest(v,n):v.end()}function au(n,e){n._readyState=Ue.CLOSING,n._errorEmitted=!0,n.emit("error",e),n.emitClose()}function SN(n){return n.path=n.socketPath,fT.connect(n)}function TN(n){return n.path=void 0,!n.servername&&n.servername!==""&&(n.servername=fT.isIP(n.host)?"":n.host),iN.connect(n)}function Lt(n,e,t){n._readyState=Ue.CLOSING;let r=new Error(t);Error.captureStackTrace(r,Lt),e.setHeader?(e[hT]=!0,e.abort(),e.socket&&!e.socket.destroyed&&e.socket.destroy(),process.nextTick(au,n,r)):(e.destroy(r),e.once("error",n.emit.bind(n,"error")),e.once("close",n.emitClose.bind(n)))}function Nh(n,e,t){if(e){let r=uN(e)?e.size:yN(e).length;n._socket?n._sender._bufferedBytes+=r:n._bufferedAmount+=r}if(t){let r=new Error(`WebSocket is not open: readyState ${n.readyState} (${or[n.readyState]})`);process.nextTick(t,r)}}function vN(n,e){let t=this[Qe];t._closeFrameReceived=!0,t._closeMessage=e,t._closeCode=n,t._socket[Qe]!==void 0&&(t._socket.removeListener("data",lu),process.nextTick(mT,t._socket),n===1005?t.close():t.close(n,e))}function wN(){let n=this[Qe];n.isPaused||n._socket.resume()}function CN(n){let e=this[Qe];e._socket[Qe]!==void 0&&(e._socket.removeListener("data",lu),process.nextTick(mT,e._socket),e.close(n[dN])),e._errorEmitted||(e._errorEmitted=!0,e.emit("error",n))}function cT(){this[Qe].emitClose()}function AN(n,e){this[Qe].emit("message",n,e)}function bN(n){let e=this[Qe];e._autoPong&&e.pong(n,!this._isServer,dT),e.emit("ping",n)}function RN(n){this[Qe].emit("pong",n)}function mT(n){n.resume()}function IN(n){let e=this[Qe];e.readyState!==Ue.CLOSED&&(e.readyState===Ue.OPEN&&(e._readyState=Ue.CLOSING,gT(e)),this._socket.end(),e._errorEmitted||(e._errorEmitted=!0,e.emit("error",n)))}function gT(n){n._closeTimer=setTimeout(n._socket.destroy.bind(n._socket),_N)}function yT(){let n=this[Qe];this.removeListener("close",yT),this.removeListener("data",lu),this.removeListener("end",_T),n._readyState=Ue.CLOSING;let e;!this._readableState.endEmitted&&!n._closeFrameReceived&&!n._receiver._writableState.errorEmitted&&(e=n._socket.read())!==null&&n._receiver.write(e),n._receiver.end(),this[Qe]=void 0,clearTimeout(n._closeTimer),n._receiver._writableState.finished||n._receiver._writableState.errorEmitted?n.emitClose():(n._receiver.on("error",cT),n._receiver.on("finish",cT))}function lu(n){this[Qe]._receiver.write(n)||this.pause()}function _T(){let n=this[Qe];n._readyState=Ue.CLOSING,n._receiver.end(),this.end()}function ET(){let n=this[Qe];this.removeListener("error",ET),this.on("error",dT),n&&(n._readyState=Ue.CLOSING,this.destroy())}});var CT=Y((BB,wT)=>{"use strict";var qB=uu(),{Duplex:PN}=require("stream");function TT(n){n.emit("close")}function xN(){!this.destroyed&&this._writableState.finished&&this.destroy()}function vT(n){this.removeListener("error",vT),this.destroy(),this.listenerCount("error")===0&&this.emit("error",n)}function NN(n,e){let t=!0,r=new PN({...e,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return n.on("message",function(o,s){let u=!s&&r._readableState.objectMode?o.toString():o;r.push(u)||n.pause()}),n.once("error",function(o){r.destroyed||(t=!1,r.destroy(o))}),n.once("close",function(){r.destroyed||r.push(null)}),r._destroy=function(i,o){if(n.readyState===n.CLOSED){o(i),process.nextTick(TT,r);return}let s=!1;n.once("error",function(f){s=!0,o(f)}),n.once("close",function(){s||o(i),process.nextTick(TT,r)}),t&&n.terminate()},r._final=function(i){if(n.readyState===n.CONNECTING){n.once("open",function(){r._final(i)});return}n._socket!==null&&(n._socket._writableState.finished?(i(),r._readableState.endEmitted&&r.destroy()):(n._socket.once("finish",function(){i()}),n.close()))},r._read=function(){n.isPaused&&n.resume()},r._write=function(i,o,s){if(n.readyState===n.CONNECTING){n.once("open",function(){r._write(i,o,s)});return}n.send(i,s)},r.on("end",xN),r.on("error",vT),r}wT.exports=NN});var bT=Y((GB,AT)=>{"use strict";var{tokenChars:kN}=So();function MN(n){let e=new Set,t=-1,r=-1,i=0;for(i;i<n.length;i++){let s=n.charCodeAt(i);if(r===-1&&kN[s]===1)t===-1&&(t=i);else if(i!==0&&(s===32||s===9))r===-1&&t!==-1&&(r=i);else if(s===44){if(t===-1)throw new SyntaxError(`Unexpected character at index ${i}`);r===-1&&(r=i);let u=n.slice(t,r);if(e.has(u))throw new SyntaxError(`The "${u}" subprotocol is duplicated`);e.add(u),t=r=-1}else throw new SyntaxError(`Unexpected character at index ${i}`)}if(t===-1||r!==-1)throw new SyntaxError("Unexpected end of input");let o=n.slice(t,i);if(e.has(o))throw new SyntaxError(`The "${o}" subprotocol is duplicated`);return e.add(o),e}AT.exports={parse:MN}});var MT=Y((VB,kT)=>{"use strict";var DN=require("events"),cu=require("http"),{Duplex:HB}=require("stream"),{createHash:ON}=require("crypto"),RT=Rh(),di=qs(),UN=bT(),FN=uu(),{GUID:LN,kWebSocket:qN}=nr(),BN=/^[+/0-9A-Za-z]{22}==$/,IT=0,PT=1,NT=2,kh=class extends DN{constructor(e,t){if(super(),e={allowSynchronousEvents:!0,autoPong:!0,maxPayload:100*1024*1024,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:FN,...e},e.port==null&&!e.server&&!e.noServer||e.port!=null&&(e.server||e.noServer)||e.server&&e.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(e.port!=null?(this._server=cu.createServer((r,i)=>{let o=cu.STATUS_CODES[426];i.writeHead(426,{"Content-Length":o.length,"Content-Type":"text/plain"}),i.end(o)}),this._server.listen(e.port,e.host,e.backlog,t)):e.server&&(this._server=e.server),this._server){let r=this.emit.bind(this,"connection");this._removeListeners=GN(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(i,o,s)=>{this.handleUpgrade(i,o,s,r)}})}e.perMessageDeflate===!0&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=e,this._state=IT}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(this._state===NT){e&&this.once("close",()=>{e(new Error("The server is not running"))}),process.nextTick(Vs,this);return}if(e&&this.once("close",e),this._state!==PT)if(this._state=PT,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients?this.clients.size?this._shouldEmitClose=!0:process.nextTick(Vs,this):process.nextTick(Vs,this);else{let t=this._server;this._removeListeners(),this._removeListeners=this._server=null,t.close(()=>{Vs(this)})}}shouldHandle(e){if(this.options.path){let t=e.url.indexOf("?");if((t!==-1?e.url.slice(0,t):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,t,r,i){t.on("error",xT);let o=e.headers["sec-websocket-key"],s=e.headers.upgrade,u=+e.headers["sec-websocket-version"];if(e.method!=="GET"){hi(this,e,t,405,"Invalid HTTP method");return}if(s===void 0||s.toLowerCase()!=="websocket"){hi(this,e,t,400,"Invalid Upgrade header");return}if(o===void 0||!BN.test(o)){hi(this,e,t,400,"Missing or invalid Sec-WebSocket-Key header");return}if(u!==13&&u!==8){hi(this,e,t,400,"Missing or invalid Sec-WebSocket-Version header",{"Sec-WebSocket-Version":"13, 8"});return}if(!this.shouldHandle(e)){$s(t,400);return}let f=e.headers["sec-websocket-protocol"],d=new Set;if(f!==void 0)try{d=UN.parse(f)}catch(g){hi(this,e,t,400,"Invalid Sec-WebSocket-Protocol header");return}let h=e.headers["sec-websocket-extensions"],m={};if(this.options.perMessageDeflate&&h!==void 0){let g=new di(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let _=RT.parse(h);_[di.extensionName]&&(g.accept(_[di.extensionName]),m[di.extensionName]=g)}catch(_){hi(this,e,t,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){let g={origin:e.headers[`${u===8?"sec-websocket-origin":"origin"}`],secure:!!(e.socket.authorized||e.socket.encrypted),req:e};if(this.options.verifyClient.length===2){this.options.verifyClient(g,(_,v,C,R)=>{if(!_)return $s(t,v||401,C,R);this.completeUpgrade(m,o,d,e,t,r,i)});return}if(!this.options.verifyClient(g))return $s(t,401)}this.completeUpgrade(m,o,d,e,t,r,i)}completeUpgrade(e,t,r,i,o,s,u){if(!o.readable||!o.writable)return o.destroy();if(o[qN])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>IT)return $s(o,503);let d=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${ON("sha1").update(t+LN).digest("base64")}`],h=new this.options.WebSocket(null,void 0,this.options);if(r.size){let m=this.options.handleProtocols?this.options.handleProtocols(r,i):r.values().next().value;m&&(d.push(`Sec-WebSocket-Protocol: ${m}`),h._protocol=m)}if(e[di.extensionName]){let m=e[di.extensionName].params,g=RT.format({[di.extensionName]:[m]});d.push(`Sec-WebSocket-Extensions: ${g}`),h._extensions=e}this.emit("headers",d,i),o.write(d.concat(`\r
`).join(`\r
`)),o.removeListener("error",xT),h.setSocket(o,s,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(h),h.on("close",()=>{this.clients.delete(h),this._shouldEmitClose&&!this.clients.size&&process.nextTick(Vs,this)})),u(h,i)}};kT.exports=kh;function GN(n,e){for(let t of Object.keys(e))n.on(t,e[t]);return function(){for(let r of Object.keys(e))n.removeListener(r,e[r])}}function Vs(n){n._state=NT,n.emit("close")}function xT(){this.destroy()}function $s(n,e,t,r){t=t||cu.STATUS_CODES[e],r={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(t),...r},n.once("finish",n.destroy),n.end(`HTTP/1.1 ${e} ${cu.STATUS_CODES[e]}\r
`+Object.keys(r).map(i=>`${i}: ${r[i]}`).join(`\r
`)+`\r
\r
`+t)}function hi(n,e,t,r,i,o){if(n.listenerCount("wsClientError")){let s=new Error(i);Error.captureStackTrace(s,hi),n.emit("wsClientError",s,t,e)}else $s(t,r,i,o)}});var $F={};mc($F,{default:()=>Gu});module.exports=qA($F);var _i=require("obsidian");var Vw=require("crypto");var Bm="1.2.1";var _c=Le(Hm(),1);var Ec=class n extends Error{constructor(t,r){var i;super(t,r);x(this,"name","TimeoutError");(i=Error.captureStackTrace)==null||i.call(Error,this,n)}},Vm=n=>{var e;return(e=n.reason)!=null?e:new DOMException("This operation was aborted.","AbortError")};function Sc(n,e){let{milliseconds:t,fallback:r,message:i,customTimers:o={setTimeout,clearTimeout},signal:s}=e,u,f,h=new Promise((m,g)=>{if(typeof t!="number"||Math.sign(t)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${t}\``);if(s!=null&&s.aborted){g(Vm(s));return}if(s&&(f=()=>{g(Vm(s))},s.addEventListener("abort",f,{once:!0})),n.then(m,g),t===Number.POSITIVE_INFINITY)return;let _=new Ec;u=o.setTimeout.call(void 0,()=>{if(r){try{m(r())}catch(v){g(v)}return}typeof n.cancel=="function"&&n.cancel(),i===!1?m():i instanceof Error?g(i):(_.message=i!=null?i:`Promise timed out after ${t} milliseconds`,g(_))},t)}).finally(()=>{h.clear(),f&&s&&s.removeEventListener("abort",f)});return h.clear=()=>{o.clearTimeout.call(void 0,u),u=void 0},h}function Tc(n,e,t){let r=0,i=n.length;for(;i>0;){let o=Math.trunc(i/2),s=r+o;t(n[s],e)<=0?(r=++s,i-=o+1):i=o}return r}var Gt,Jo=class{constructor(){se(this,Gt,[])}enqueue(e,t){let{priority:r=0,id:i}=t!=null?t:{},o={priority:r,id:i,run:e};if(this.size===0||D(this,Gt)[this.size-1].priority>=r){D(this,Gt).push(o);return}let s=Tc(D(this,Gt),o,(u,f)=>f.priority-u.priority);D(this,Gt).splice(s,0,o)}setPriority(e,t){let r=D(this,Gt).findIndex(o=>o.id===e);if(r===-1)throw new ReferenceError(`No promise function with the id "${e}" exists in the queue.`);let[i]=D(this,Gt).splice(r,1);this.enqueue(i.run,{priority:t,id:e})}dequeue(){let e=D(this,Gt).shift();return e==null?void 0:e.run}filter(e){return D(this,Gt).filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return D(this,Gt).length}};Gt=new WeakMap;var Oi,sn,vn,Ui,Fi,Li,yr,Xo,qi,wn,Jn,He,Qo,nt,Vr,Kn,Aa,$r,pe,$m,Wm,zm,Jm,Km,vc,wc,Ym,wa,Cc,Ac,Ca,Hr,Xm,Ko,bc,Yo=class extends _c.default{constructor(t){var r,i,o,s,u,f;super();se(this,pe);se(this,Oi);se(this,sn);se(this,vn,0);se(this,Ui);se(this,Fi,!1);se(this,Li,!1);se(this,yr);se(this,Xo,0);se(this,qi,0);se(this,wn);se(this,Jn);se(this,He);se(this,Qo);se(this,nt,0);se(this,Vr);se(this,Kn);se(this,Aa,BigInt(1));se(this,$r,new Map);x(this,"timeout");if(t={carryoverIntervalCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:Jo,...t},!(typeof t.intervalCap=="number"&&t.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(i=(r=t.intervalCap)==null?void 0:r.toString())!=null?i:""}\` (${typeof t.intervalCap})`);if(t.interval===void 0||!(Number.isFinite(t.interval)&&t.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(s=(o=t.interval)==null?void 0:o.toString())!=null?s:""}\` (${typeof t.interval})`);if(ce(this,Oi,(f=(u=t.carryoverIntervalCount)!=null?u:t.carryoverConcurrencyCount)!=null?f:!1),ce(this,sn,t.intervalCap===Number.POSITIVE_INFINITY||t.interval===0),ce(this,Ui,t.intervalCap),ce(this,yr,t.interval),ce(this,He,new t.queueClass),ce(this,Qo,t.queueClass),this.concurrency=t.concurrency,t.timeout!==void 0&&!(Number.isFinite(t.timeout)&&t.timeout>0))throw new TypeError(`Expected \`timeout\` to be a positive finite number, got \`${t.timeout}\` (${typeof t.timeout})`);this.timeout=t.timeout,ce(this,Kn,t.autoStart===!1),oe(this,pe,Xm).call(this)}get concurrency(){return D(this,Vr)}set concurrency(t){if(!(typeof t=="number"&&t>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${t}\` (${typeof t})`);ce(this,Vr,t),oe(this,pe,Ca).call(this)}setPriority(t,r){if(typeof r!="number"||!Number.isFinite(r))throw new TypeError(`Expected \`priority\` to be a finite number, got \`${r}\` (${typeof r})`);D(this,He).setPriority(t,r)}async add(t,r={}){var i;return(i=r.id)!=null||(r.id=(Di(this,Aa)._++).toString()),r={timeout:this.timeout,...r},new Promise((o,s)=>{let u=Symbol(`task-${r.id}`);D(this,He).enqueue(async()=>{var d,h,m;Di(this,nt)._++,D(this,$r).set(u,{id:r.id,priority:(d=r.priority)!=null?d:0,startTime:Date.now(),timeout:r.timeout});let f;try{try{(h=r.signal)==null||h.throwIfAborted()}catch(v){throw D(this,sn)||Di(this,vn)._--,D(this,$r).delete(u),v}let g=t({signal:r.signal});if(r.timeout&&(g=Sc(Promise.resolve(g),{milliseconds:r.timeout,message:`Task timed out after ${r.timeout}ms (queue has ${D(this,nt)} running, ${D(this,He).size} waiting)`})),r.signal){let{signal:v}=r;g=Promise.race([g,new Promise((C,R)=>{f=()=>{R(v.reason)},v.addEventListener("abort",f,{once:!0})})])}let _=await g;o(_),this.emit("completed",_)}catch(g){s(g),this.emit("error",g)}finally{f&&((m=r.signal)==null||m.removeEventListener("abort",f)),D(this,$r).delete(u),queueMicrotask(()=>{oe(this,pe,zm).call(this)})}},r),this.emit("add"),oe(this,pe,wa).call(this)})}async addAll(t,r){return Promise.all(t.map(async i=>this.add(i,r)))}start(){return D(this,Kn)?(ce(this,Kn,!1),oe(this,pe,Ca).call(this),this):this}pause(){ce(this,Kn,!0)}clear(){ce(this,He,new(D(this,Qo))),oe(this,pe,bc).call(this)}async onEmpty(){D(this,He).size!==0&&await oe(this,pe,Hr).call(this,"empty")}async onSizeLessThan(t){D(this,He).size<t||await oe(this,pe,Hr).call(this,"next",()=>D(this,He).size<t)}async onIdle(){D(this,nt)===0&&D(this,He).size===0||await oe(this,pe,Hr).call(this,"idle")}async onPendingZero(){D(this,nt)!==0&&await oe(this,pe,Hr).call(this,"pendingZero")}async onRateLimit(){this.isRateLimited||await oe(this,pe,Hr).call(this,"rateLimit")}async onRateLimitCleared(){this.isRateLimited&&await oe(this,pe,Hr).call(this,"rateLimitCleared")}async onError(){return new Promise((t,r)=>{let i=o=>{this.off("error",i),r(o)};this.on("error",i)})}get size(){return D(this,He).size}sizeBy(t){return D(this,He).filter(t).length}get pending(){return D(this,nt)}get isPaused(){return D(this,Kn)}get isRateLimited(){return D(this,Fi)}get isSaturated(){return D(this,nt)===D(this,Vr)&&D(this,He).size>0||this.isRateLimited&&D(this,He).size>0}get runningTasks(){return[...D(this,$r).values()].map(t=>({...t}))}};Oi=new WeakMap,sn=new WeakMap,vn=new WeakMap,Ui=new WeakMap,Fi=new WeakMap,Li=new WeakMap,yr=new WeakMap,Xo=new WeakMap,qi=new WeakMap,wn=new WeakMap,Jn=new WeakMap,He=new WeakMap,Qo=new WeakMap,nt=new WeakMap,Vr=new WeakMap,Kn=new WeakMap,Aa=new WeakMap,$r=new WeakMap,pe=new WeakSet,$m=function(){return D(this,sn)||D(this,vn)<D(this,Ui)},Wm=function(){return D(this,nt)<D(this,Vr)},zm=function(){Di(this,nt)._--,D(this,nt)===0&&this.emit("pendingZero"),oe(this,pe,wa).call(this),this.emit("next")},Jm=function(){oe(this,pe,Ac).call(this),oe(this,pe,Cc).call(this),ce(this,Jn,void 0)},Km=function(){let t=Date.now();if(D(this,wn)===void 0){let r=D(this,Xo)-t;if(r<0){if(D(this,qi)>0){let i=t-D(this,qi);if(i<D(this,yr))return oe(this,pe,vc).call(this,D(this,yr)-i),!0}ce(this,vn,D(this,Oi)?D(this,nt):0)}else return oe(this,pe,vc).call(this,r),!0}return!1},vc=function(t){D(this,Jn)===void 0&&ce(this,Jn,setTimeout(()=>{oe(this,pe,Jm).call(this)},t))},wc=function(){D(this,wn)&&(clearInterval(D(this,wn)),ce(this,wn,void 0))},Ym=function(){D(this,Jn)&&(clearTimeout(D(this,Jn)),ce(this,Jn,void 0))},wa=function(){if(D(this,He).size===0)return oe(this,pe,wc).call(this),this.emit("empty"),D(this,nt)===0&&(oe(this,pe,Ym).call(this),this.emit("idle")),!1;let t=!1;if(!D(this,Kn)){let r=!D(this,pe,Km);if(D(this,pe,$m)&&D(this,pe,Wm)){let i=D(this,He).dequeue();D(this,sn)||(Di(this,vn)._++,oe(this,pe,Ko).call(this)),this.emit("active"),ce(this,qi,Date.now()),i(),r&&oe(this,pe,Cc).call(this),t=!0}}return t},Cc=function(){D(this,sn)||D(this,wn)!==void 0||(ce(this,wn,setInterval(()=>{oe(this,pe,Ac).call(this)},D(this,yr))),ce(this,Xo,Date.now()+D(this,yr)))},Ac=function(){D(this,vn)===0&&D(this,nt)===0&&D(this,wn)&&oe(this,pe,wc).call(this),ce(this,vn,D(this,Oi)?D(this,nt):0),oe(this,pe,Ca).call(this),oe(this,pe,Ko).call(this)},Ca=function(){for(;oe(this,pe,wa).call(this););},Hr=async function(t,r){return new Promise(i=>{let o=()=>{r&&!r()||(this.off(t,o),i())};this.on(t,o)})},Xm=function(){D(this,sn)||(this.on("add",()=>{D(this,He).size>0&&oe(this,pe,Ko).call(this)}),this.on("next",()=>{oe(this,pe,Ko).call(this)}))},Ko=function(){D(this,sn)||D(this,Li)||(ce(this,Li,!0),queueMicrotask(()=>{ce(this,Li,!1),oe(this,pe,bc).call(this)}))},bc=function(){let t=D(this,Fi),r=!D(this,sn)&&D(this,vn)>=D(this,Ui)&&D(this,He).size>0;r!==t&&(ce(this,Fi,r),this.emit(r?"rateLimit":"rateLimitCleared"))};var Qm=Bm,ba=new Yo({concurrency:1,timeout:3e5});function Rc(n,e){return Promise.race([n,new Promise((t,r)=>setTimeout(()=>r(new Error(`timeout after ${e}ms`)),e))])}var Gw=require("obsidian");var tn=require("obsidian");var Np=require("obsidian");var Zm=["ollama","gemini"];var Bi=class{shutdown(){}setLastModel(e){this.lastModel=e}setLastImageModel(e){this.lastImageModel=e}};var dt=require("obsidian");var Zo=Le(require("node:fs"),1),Fc=require("node:path");var uL=Le(Ic(),1),eg="11434",tg=`http://127.0.0.1:${eg}`,$A="0.6.3",WA=Object.defineProperty,zA=(n,e,t)=>e in n?WA(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Pc=(n,e,t)=>(zA(n,typeof e!="symbol"?e+"":e,t),t),kc=class n extends Error{constructor(e,t){super(e),this.error=e,this.status_code=t,this.name="ResponseError",Error.captureStackTrace&&Error.captureStackTrace(this,n)}},Mc=class{constructor(e,t,r){Pc(this,"abortController"),Pc(this,"itr"),Pc(this,"doneCallback"),this.abortController=e,this.itr=t,this.doneCallback=r}abort(){this.abortController.abort()}async*[Symbol.asyncIterator](){for await(let e of this.itr){if("error"in e)throw new Error(e.error);if(yield e,e.done||e.status==="success"){this.doneCallback();return}}throw new Error("Did not receive done or success response in stream.")}},Dc=async n=>{var r;if(n.ok)return;let e=`Error ${n.status}: ${n.statusText}`,t=null;if((r=n.headers.get("content-type"))!=null&&r.includes("application/json"))try{t=await n.json(),e=t.error||e}catch(i){console.log("Failed to parse error response as JSON")}else try{console.log("Getting text from response"),e=await n.text()||e}catch(i){console.log("Failed to get text from error response")}throw new kc(e,n.status)};function JA(){var n;if(typeof window!="undefined"&&window.navigator){let e=navigator;return"userAgentData"in e&&((n=e.userAgentData)!=null&&n.platform)?`${e.userAgentData.platform.toLowerCase()} Browser/${navigator.userAgent};`:navigator.platform?`${navigator.platform.toLowerCase()} Browser/${navigator.userAgent};`:`unknown Browser/${navigator.userAgent};`}else if(typeof process!="undefined")return`${process.arch} ${process.platform} Node.js/${process.version}`;return""}function KA(n){if(n instanceof Headers){let e={};return n.forEach((t,r)=>{e[r]=t}),e}else return Array.isArray(n)?Object.fromEntries(n):n||{}}var YA=(n,e)=>n[e],Oc=async(n,e,t={})=>{let r={"Content-Type":"application/json",Accept:"application/json","User-Agent":`ollama-js/${$A} (${JA()})`};t.headers=KA(t.headers);try{let o=new URL(e);if(o.protocol==="https:"&&o.hostname==="ollama.com"){let s=typeof process=="object"&&process!==null&&typeof process.env=="object"&&process.env!==null?YA(process.env,"OLLAMA_API_KEY"):void 0;!(t.headers.authorization||t.headers.Authorization)&&s&&(t.headers.Authorization=`Bearer ${s}`)}}catch(o){console.error("error parsing url",o)}let i=Object.fromEntries(Object.entries(t.headers).filter(([o])=>!Object.keys(r).some(s=>s.toLowerCase()===o.toLowerCase())));return t.headers={...r,...i},n(e,t)},xc=async(n,e,t)=>{let r=await Oc(n,e,{headers:t==null?void 0:t.headers});return await Dc(r),r},_r=async(n,e,t,r)=>{let o=(u=>u!==null&&typeof u=="object"&&!Array.isArray(u))(t)?JSON.stringify(t):t,s=await Oc(n,e,{method:"POST",body:o,signal:r==null?void 0:r.signal,headers:r==null?void 0:r.headers});return await Dc(s),s},XA=async(n,e,t,r)=>{let i=await Oc(n,e,{method:"DELETE",body:JSON.stringify(t),headers:r==null?void 0:r.headers});return await Dc(i),i},QA=async function*(n){var i;let e=new TextDecoder("utf-8"),t="",r=n.getReader();for(;;){let{done:o,value:s}=await r.read();if(o)break;t+=e.decode(s,{stream:!0});let u=t.split(`
`);t=(i=u.pop())!=null?i:"";for(let f of u)try{yield JSON.parse(f)}catch(d){console.warn("invalid json: ",f)}}t+=e.decode();for(let o of t.split(`
`).filter(s=>s!==""))try{yield JSON.parse(o)}catch(s){console.warn("invalid json: ",o)}},ZA=n=>{if(!n)return tg;let e=n.includes("://");n.startsWith(":")&&(n=`http://127.0.0.1${n}`,e=!0),e||(n=`http://${n}`);let t=new URL(n),r=t.port;r||(e?r=t.protocol==="https:"?"443":"80":r=eg);let i="";t.username&&(i=t.username,t.password&&(i+=`:${t.password}`),i+="@");let o=`${t.protocol}//${i}${t.hostname}:${r}${t.pathname}`;return o.endsWith("/")&&(o=o.slice(0,-1)),o},jA=Object.defineProperty,e0=(n,e,t)=>e in n?jA(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Nc=(n,e,t)=>(e0(n,typeof e!="symbol"?e+"":e,t),t),Uc=class{constructor(e){var t,r;Nc(this,"config"),Nc(this,"fetch"),Nc(this,"ongoingStreamedRequests",[]),this.config={host:"",headers:e==null?void 0:e.headers},e!=null&&e.proxy||(this.config.host=ZA((t=e==null?void 0:e.host)!=null?t:tg)),this.fetch=(r=e==null?void 0:e.fetch)!=null?r:fetch}abort(){for(let e of this.ongoingStreamedRequests)e.abort();this.ongoingStreamedRequests.length=0}async processStreamableRequest(e,t){var o;t.stream=(o=t.stream)!=null?o:!1;let r=`${this.config.host}/api/${e}`;if(t.stream){let s=new AbortController,u=await _r(this.fetch,r,t,{signal:s.signal,headers:this.config.headers});if(!u.body)throw new Error("Missing body");let f=QA(u.body),d=new Mc(s,f,()=>{let h=this.ongoingStreamedRequests.indexOf(d);h>-1&&this.ongoingStreamedRequests.splice(h,1)});return this.ongoingStreamedRequests.push(d),d}return await(await _r(this.fetch,r,t,{headers:this.config.headers})).json()}async encodeImage(e){if(typeof e!="string"){let t=new Uint8Array(e),r="",i=t.byteLength;for(let o=0;o<i;o++)r+=String.fromCharCode(t[o]);return btoa(r)}return e}async generate(e){return e.images&&(e.images=await Promise.all(e.images.map(this.encodeImage.bind(this)))),this.processStreamableRequest("generate",e)}async chat(e){if(e.messages)for(let t of e.messages)t.images&&(t.images=await Promise.all(t.images.map(this.encodeImage.bind(this))));return this.processStreamableRequest("chat",e)}async create(e){return this.processStreamableRequest("create",{...e})}async pull(e){return this.processStreamableRequest("pull",{name:e.model,stream:e.stream,insecure:e.insecure})}async push(e){return this.processStreamableRequest("push",{name:e.model,stream:e.stream,insecure:e.insecure})}async delete(e){return await XA(this.fetch,`${this.config.host}/api/delete`,{name:e.model},{headers:this.config.headers}),{status:"success"}}async copy(e){return await _r(this.fetch,`${this.config.host}/api/copy`,{...e},{headers:this.config.headers}),{status:"success"}}async list(){return await(await xc(this.fetch,`${this.config.host}/api/tags`,{headers:this.config.headers})).json()}async show(e){return await(await _r(this.fetch,`${this.config.host}/api/show`,{...e},{headers:this.config.headers})).json()}async embed(e){return await(await _r(this.fetch,`${this.config.host}/api/embed`,{...e},{headers:this.config.headers})).json()}async embeddings(e){return await(await _r(this.fetch,`${this.config.host}/api/embeddings`,{...e},{headers:this.config.headers})).json()}async ps(){return await(await xc(this.fetch,`${this.config.host}/api/ps`,{headers:this.config.headers})).json()}async version(){return await(await xc(this.fetch,`${this.config.host}/api/version`,{headers:this.config.headers})).json()}async webSearch(e){if(!e.query||e.query.length===0)throw new Error("Query is required");return await(await _r(this.fetch,"https://ollama.com/api/web_search",{...e},{headers:this.config.headers})).json()}async webFetch(e){if(!e.url||e.url.length===0)throw new Error("URL is required");return await(await _r(this.fetch,"https://ollama.com/api/web_fetch",{...e},{headers:this.config.headers})).json()}},fL=new Uc;var pL=Le(Ic(),1),jo=class extends Uc{async encodeImage(e){if(typeof e!="string")return Buffer.from(e).toString("base64");try{if(Zo.default.existsSync(e)){let t=await Zo.promises.readFile((0,Fc.resolve)(e));return Buffer.from(t).toString("base64")}}catch(t){}return e}async fileExists(e){try{return await Zo.promises.access(e),!0}catch(t){return!1}}async create(e){if(e.from&&await this.fileExists((0,Fc.resolve)(e.from)))throw Error("Creating with a local path is not currently supported from ollama-js");return e.stream?super.create(e):super.create(e)}},mL=new jo;function Pa(n){ft=n}var ft,Be=[{name:"llava-llama3 (8B) [default]",model:"llava-llama3:latest",imageReady:!0,provider:"ollama"},{name:"llama3.2-vision (11B)",model:"llama3.2-vision:11b",imageReady:!0,provider:"ollama"},{name:"llama3.2-vision (90B)",model:"llama3.2-vision:90b",imageReady:!0,provider:"ollama"},{name:"llava (7B)",model:"llava:latest",imageReady:!0,provider:"ollama"},{name:"llava (13B)",model:"llava:13b",imageReady:!0,provider:"ollama"},{name:"llava (34B)",model:"llava:34b",imageReady:!0,provider:"ollama"},{name:"llama3.3 (70B)",model:"llama3.3",imageReady:!1,provider:"ollama"},{name:"deepseek-r1 (7B)",model:"deepseek-r1",imageReady:!1,provider:"ollama"},{name:"llama3.2 (3B)",model:"llama3.2",imageReady:!1,provider:"ollama"},{name:"llama3.2 (1B)",model:"llama3.2:1b",imageReady:!1,provider:"ollama"},{name:"llama3.1 (8B)",model:"llama3.1",imageReady:!1,provider:"ollama"},{name:"llama3.1 (70B)",model:"llama3.1:70b",imageReady:!1,provider:"ollama"},{name:"gemma3 (1B)",model:"gemma3:1b",imageReady:!1,provider:"ollama"},{name:"gemma3 (4B)",model:"gemma3:4b",imageReady:!0,provider:"ollama"},{name:"gemma3 (12B)",model:"gemma3:12b",imageReady:!0,provider:"ollama"},{name:"gemma3 (27B)",model:"gemma3:27b",imageReady:!0,provider:"ollama"}],xa=null;function ng(n){xa=n}var Ia=[];function rg(n){return Ia.push(n),()=>{let e=Ia.indexOf(n);e>-1&&Ia.splice(e,1)}}function Gi(){Ia.forEach(n=>n())}var Et="ai-adapter/providers/ollamaProvider",Cn,Lc={lastModel:Be[8],lastImageModel:Be[0],url:"http://127.0.0.1:11434",fallbackUrl:"",token:""},Ge=class Ge extends Bi{constructor(){super(),this.lastModel=fe.aiAdapterSettings.ollamaSettings.lastModel,this.lastImageModel=fe.aiAdapterSettings.ollamaSettings.lastImageModel,Ge.refreshInstance(),this.checkOllama().then(e=>{ue(Et,"Ollama check success: "+e)})}generateSettings(e,t){new dt.Setting(e).setName("Ollama").setHeading(),new dt.Setting(e).setName("Pull models").setDesc("Pull the selected models").addButton(r=>r.setButtonText("Pull model").onClick(async()=>{await Ge.pullImage(fe.aiAdapterSettings.selectedImageModel)})),new dt.Setting(e).setName("Ollama URL").setDesc("Set the URL for the ollama server").addText(r=>r.setPlaceholder("Enter the host (http://127.0.0.1:11434)").setValue(fe.aiAdapterSettings.ollamaSettings.url).onChange(async i=>{i.length===0&&(i=Lc.url),fe.aiAdapterSettings.ollamaSettings.url=i,Ge.refreshInstance(),this.checkOllama().then(o=>{ue(Et,"Ollama check success: "+o)}),await Ht(t)})),new dt.Setting(e).setName("Fallback URL (optional)").setDesc("Set a fallback URL for the ollama server").addText(r=>r.setPlaceholder("Enter the host (http://127.0.0.1:11434)").setValue(fe.aiAdapterSettings.ollamaSettings.fallbackUrl).onChange(async i=>{fe.aiAdapterSettings.ollamaSettings.fallbackUrl=i,Ge.refreshInstance(),this.checkOllama().then(o=>{ue(Et,"Ollama check success: "+o)}),await Ht(t)})),new dt.Setting(e).setName("Ollama token (optional)").setDesc("Set the token used to authenticate with the ollama server").addText(r=>r.setValue(fe.aiAdapterSettings.ollamaSettings.token!==""?"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022":"").onChange(async i=>{i.contains("\u2022")||(fe.aiAdapterSettings.ollamaSettings.token=i,Ge.refreshInstance(),await Ht(t))}))}async queryHandling(e){return(await Cn.chat({model:fe.aiAdapterSettings.selectedModel.model,messages:[{role:"user",content:e}]})).message.content}async queryWithImageHandling(e,t){return(await Cn.chat({model:fe.aiAdapterSettings.selectedImageModel.model,messages:[{role:"user",content:e,images:[t]}]})).message.content}async checkOllama(){var e;try{let t=await Cn.list();ue(Et,t);let r=!1;for(let i of t.models){let o=(await Cn.show({model:i.name})).capabilities,s=o.includes("vision"),u=o.includes("completion"),f=i.name.split(":")[0]+" ["+i.details.parameter_size+"] (custom)";u&&!Be.some(d=>d.model===i.name&&!d.imageReady)&&(Be.push({name:f,model:i.name,provider:"ollama",imageReady:!1}),ue(Et,"Added model: "+f),r=!0),s&&!Be.some(d=>d.model===i.name&&d.imageReady)&&(Be.push({name:f,model:i.name,provider:"ollama",imageReady:!0}),ue(Et,"Added image model: "+f),r=!0)}return r&&(ue(Et,"Models updated, notifying settings tab"),Gi()),t.models.some(i=>i.name===fe.aiAdapterSettings.selectedModel.model)||ue(Et,"No text model found (currently not used)"),t.models.some(i=>i.name===fe.aiAdapterSettings.selectedImageModel.model)||new dt.Notice(`No ${fe.aiAdapterSettings.selectedImageModel.name} model found, please make sure you have pulled it (you can pull it over the settings tab or choose another model)`),!0}catch(t){return ue(Et,t),!Ge.fallback&&((e=fe.aiAdapterSettings.ollamaSettings.fallbackUrl)==null?void 0:e.length)>0?(Ge.fallback=!0,ue(Et,"Falling back to fallback URL"),Ge.refreshInstance(),await this.checkOllama()):(new dt.Notice("Error connecting to ollama."),new dt.Notice(t.toString()),!1)}}static async pullImage(e){let t;try{new dt.Notice(`Pulling ${e.name} model started, this may take a while...`);let r=await Cn.pull({model:e.model,stream:!0});t=new dt.Notice(`Pulling ${e.name} model 0%`,0);for await(let i of r)if(ue(Et,i),i.total!==null&&i.completed!==null){let o=i.completed/i.total*100;if(!isNaN(o)&&o!==1/0&&o!==-1/0){let s=o.toFixed(2),u=(i.completed/1e9).toFixed(2),f=(i.total/1e9).toFixed(2);t.setMessage(`Pulling ${e.name} model ${s}% (${u}GB/${f}GB)`)}}t.hide(),new dt.Notice(`${e.name} model pulled successfully`)}catch(r){ue(Et,r),t==null||t.hide(),new dt.Notice(`Failed to pull ${e.name} model`),new dt.Notice(r.toString())}}static refreshInstance(){ue(Et,"Refreshing Ollama instance (fallback: "+Ge.fallback+")"),Cn!==void 0&&Cn.abort(),Ge.abortCurrentOllamaRequest(),Cn=new jo({host:this.fallback?fe.aiAdapterSettings.ollamaSettings.fallbackUrl:fe.aiAdapterSettings.ollamaSettings.url,headers:{Authorization:`Bearer ${fe.aiAdapterSettings.ollamaSettings.token}`},fetch:Ge.ollamaFetch})}setLastModel(e){super.setLastModel(e),fe.aiAdapterSettings.ollamaSettings.lastModel=e}setLastImageModel(e){super.setLastImageModel(e),fe.aiAdapterSettings.ollamaSettings.lastImageModel=e}shutdown(){ue(Et,"Shutting down Ollama instance"),Ge.abortCurrentOllamaRequest(),Cn!==void 0&&Cn.abort()}static ollamaFetch(e,t){let r=new AbortController;if(t!=null&&t.signal){let s=t.signal;if(s.aborted)r.abort();else{let u=()=>r.abort();s.addEventListener("abort",u,{once:!0})}}Ge.currentOllamaController=r;let i={...t||{},signal:r.signal},o=fetch(e,i);return o.finally(()=>{Ge.currentOllamaController===r&&(Ge.currentOllamaController=void 0)}).catch(()=>{}),o}static abortCurrentOllamaRequest(){if(Ge.currentOllamaController)try{Ge.currentOllamaController.abort()}catch(e){}finally{Ge.currentOllamaController=void 0}}};Ge.fallback=!1;var an=Ge;var Mo=require("obsidian");var Yv=Le(PS(),1),Xv=require("fs"),Pu=Le(require("fs/promises"),1),Qv=require("fs/promises"),Zv=require("node:stream"),jv=require("node:stream/promises");var HN=Le(CT(),1),VN=Le(vh(),1),$N=Le(Ah(),1),Mh=Le(uu(),1),WN=Le(MT(),1);var ew=Le(require("path"),1);var JN,KN;function YN(){return{geminiUrl:JN,vertexUrl:KN}}function XN(n,e,t,r){var i,o;if(!(n!=null&&n.baseUrl)){let s=YN();return e?(i=s.vertexUrl)!==null&&i!==void 0?i:t:(o=s.geminiUrl)!==null&&o!==void 0?o:r}return n.baseUrl}var _n=class{};function ne(n,e){let t=/\{([^}]+)\}/g;return n.replace(t,(r,i)=>{if(Object.prototype.hasOwnProperty.call(e,i)){let o=e[i];return o!=null?String(o):""}else throw new Error(`Key '${i}' not found in valueMap.`)})}function l(n,e,t){for(let o=0;o<e.length-1;o++){let s=e[o];if(s.endsWith("[]")){let u=s.slice(0,-2);if(!(u in n))if(Array.isArray(t))n[u]=Array.from({length:t.length},()=>({}));else throw new Error(`Value must be a list given an array path ${s}`);if(Array.isArray(n[u])){let f=n[u];if(Array.isArray(t))for(let d=0;d<f.length;d++){let h=f[d];l(h,e.slice(o+1),t[d])}else for(let d of f)l(d,e.slice(o+1),t)}return}else if(s.endsWith("[0]")){let u=s.slice(0,-3);u in n||(n[u]=[{}]);let f=n[u];l(f[0],e.slice(o+1),t);return}(!n[s]||typeof n[s]!="object")&&(n[s]={}),n=n[s]}let r=e[e.length-1],i=n[r];if(i!==void 0){if(!t||typeof t=="object"&&Object.keys(t).length===0||t===i)return;if(typeof i=="object"&&typeof t=="object"&&i!==null&&t!==null)Object.assign(i,t);else throw new Error(`Cannot set value for an existing key. Key: ${r}`)}else r==="_self"&&typeof t=="object"&&t!==null&&!Array.isArray(t)?Object.assign(n,t):n[r]=t}function a(n,e,t=void 0){try{if(e.length===1&&e[0]==="_self")return n;for(let r=0;r<e.length;r++){if(typeof n!="object"||n===null)return t;let i=e[r];if(i.endsWith("[]")){let o=i.slice(0,-2);if(o in n){let s=n[o];return Array.isArray(s)?s.map(u=>a(u,e.slice(r+1),t)):t}else return t}else n=n[i]}return n}catch(r){if(r instanceof TypeError)return t;throw r}}function QN(n,e){for(let[t,r]of Object.entries(e)){let i=t.split("."),o=r.split("."),s=new Set,u=-1;for(let f=0;f<i.length;f++)if(i[f]==="*"){u=f;break}if(u!==-1&&o.length>u)for(let f=u;f<o.length;f++){let d=o[f];d!=="*"&&!d.endsWith("[]")&&!d.endsWith("[0]")&&s.add(d)}Dh(n,i,o,0,s)}}function Dh(n,e,t,r,i){if(r>=e.length||typeof n!="object"||n===null)return;let o=e[r];if(o.endsWith("[]")){let s=o.slice(0,-2),u=n;if(s in u&&Array.isArray(u[s]))for(let f of u[s])Dh(f,e,t,r+1,i)}else if(o==="*"){if(typeof n=="object"&&n!==null&&!Array.isArray(n)){let s=n,u=Object.keys(s).filter(d=>!d.startsWith("_")&&!i.has(d)),f={};for(let d of u)f[d]=s[d];for(let[d,h]of Object.entries(f)){let m=[];for(let g of t.slice(r))g==="*"?m.push(d):m.push(g);l(s,m,h)}for(let d of u)delete s[d]}}else{let s=n;o in s&&Dh(s[o],e,t,r+1,i)}}function Cp(n){if(typeof n!="string")throw new Error("fromImageBytes must be a string");return n}function ZN(n){let e={},t=a(n,["operationName"]);t!=null&&l(e,["operationName"],t);let r=a(n,["resourceName"]);return r!=null&&l(e,["_url","resourceName"],r),e}function jN(n){let e={},t=a(n,["name"]);t!=null&&l(e,["name"],t);let r=a(n,["metadata"]);r!=null&&l(e,["metadata"],r);let i=a(n,["done"]);i!=null&&l(e,["done"],i);let o=a(n,["error"]);o!=null&&l(e,["error"],o);let s=a(n,["response","generateVideoResponse"]);return s!=null&&l(e,["response"],tk(s)),e}function ek(n){let e={},t=a(n,["name"]);t!=null&&l(e,["name"],t);let r=a(n,["metadata"]);r!=null&&l(e,["metadata"],r);let i=a(n,["done"]);i!=null&&l(e,["done"],i);let o=a(n,["error"]);o!=null&&l(e,["error"],o);let s=a(n,["response"]);return s!=null&&l(e,["response"],nk(s)),e}function tk(n){let e={},t=a(n,["generatedSamples"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(s=>rk(s))),l(e,["generatedVideos"],o)}let r=a(n,["raiMediaFilteredCount"]);r!=null&&l(e,["raiMediaFilteredCount"],r);let i=a(n,["raiMediaFilteredReasons"]);return i!=null&&l(e,["raiMediaFilteredReasons"],i),e}function nk(n){let e={},t=a(n,["videos"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(s=>ik(s))),l(e,["generatedVideos"],o)}let r=a(n,["raiMediaFilteredCount"]);r!=null&&l(e,["raiMediaFilteredCount"],r);let i=a(n,["raiMediaFilteredReasons"]);return i!=null&&l(e,["raiMediaFilteredReasons"],i),e}function rk(n){let e={},t=a(n,["video"]);return t!=null&&l(e,["video"],ck(t)),e}function ik(n){let e={},t=a(n,["_self"]);return t!=null&&l(e,["video"],fk(t)),e}function ok(n){let e={},t=a(n,["operationName"]);return t!=null&&l(e,["_url","operationName"],t),e}function sk(n){let e={},t=a(n,["operationName"]);return t!=null&&l(e,["_url","operationName"],t),e}function ak(n){let e={},t=a(n,["name"]);t!=null&&l(e,["name"],t);let r=a(n,["metadata"]);r!=null&&l(e,["metadata"],r);let i=a(n,["done"]);i!=null&&l(e,["done"],i);let o=a(n,["error"]);o!=null&&l(e,["error"],o);let s=a(n,["response"]);return s!=null&&l(e,["response"],lk(s)),e}function lk(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);let r=a(n,["parent"]);r!=null&&l(e,["parent"],r);let i=a(n,["documentName"]);return i!=null&&l(e,["documentName"],i),e}function Ap(n){let e={},t=a(n,["name"]);t!=null&&l(e,["name"],t);let r=a(n,["metadata"]);r!=null&&l(e,["metadata"],r);let i=a(n,["done"]);i!=null&&l(e,["done"],i);let o=a(n,["error"]);o!=null&&l(e,["error"],o);let s=a(n,["response"]);return s!=null&&l(e,["response"],uk(s)),e}function uk(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);let r=a(n,["parent"]);r!=null&&l(e,["parent"],r);let i=a(n,["documentName"]);return i!=null&&l(e,["documentName"],i),e}function ck(n){let e={},t=a(n,["uri"]);t!=null&&l(e,["uri"],t);let r=a(n,["encodedVideo"]);r!=null&&l(e,["videoBytes"],Cp(r));let i=a(n,["encoding"]);return i!=null&&l(e,["mimeType"],i),e}function fk(n){let e={},t=a(n,["gcsUri"]);t!=null&&l(e,["uri"],t);let r=a(n,["bytesBase64Encoded"]);r!=null&&l(e,["videoBytes"],Cp(r));let i=a(n,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}var DT;(function(n){n.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",n.OUTCOME_OK="OUTCOME_OK",n.OUTCOME_FAILED="OUTCOME_FAILED",n.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(DT||(DT={}));var OT;(function(n){n.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",n.PYTHON="PYTHON"})(OT||(OT={}));var UT;(function(n){n.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",n.SILENT="SILENT",n.WHEN_IDLE="WHEN_IDLE",n.INTERRUPT="INTERRUPT"})(UT||(UT={}));var xr;(function(n){n.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",n.STRING="STRING",n.NUMBER="NUMBER",n.INTEGER="INTEGER",n.BOOLEAN="BOOLEAN",n.ARRAY="ARRAY",n.OBJECT="OBJECT",n.NULL="NULL"})(xr||(xr={}));var FT;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})(FT||(FT={}));var LT;(function(n){n.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",n.SIMPLE_SEARCH="SIMPLE_SEARCH",n.ELASTIC_SEARCH="ELASTIC_SEARCH"})(LT||(LT={}));var qT;(function(n){n.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",n.NO_AUTH="NO_AUTH",n.API_KEY_AUTH="API_KEY_AUTH",n.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",n.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",n.OAUTH="OAUTH",n.OIDC_AUTH="OIDC_AUTH"})(qT||(qT={}));var BT;(function(n){n.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",n.HTTP_IN_QUERY="HTTP_IN_QUERY",n.HTTP_IN_HEADER="HTTP_IN_HEADER",n.HTTP_IN_PATH="HTTP_IN_PATH",n.HTTP_IN_BODY="HTTP_IN_BODY",n.HTTP_IN_COOKIE="HTTP_IN_COOKIE"})(BT||(BT={}));var GT;(function(n){n.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",n.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",n.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",n.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"})(GT||(GT={}));var HT;(function(n){n.THINKING_LEVEL_UNSPECIFIED="THINKING_LEVEL_UNSPECIFIED",n.LOW="LOW",n.HIGH="HIGH"})(HT||(HT={}));var VT;(function(n){n.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",n.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",n.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",n.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",n.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",n.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",n.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",n.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",n.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",n.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",n.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"})(VT||(VT={}));var $T;(function(n){n.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",n.SEVERITY="SEVERITY",n.PROBABILITY="PROBABILITY"})($T||($T={}));var WT;(function(n){n.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE",n.OFF="OFF"})(WT||(WT={}));var zT;(function(n){n.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",n.STOP="STOP",n.MAX_TOKENS="MAX_TOKENS",n.SAFETY="SAFETY",n.RECITATION="RECITATION",n.LANGUAGE="LANGUAGE",n.OTHER="OTHER",n.BLOCKLIST="BLOCKLIST",n.PROHIBITED_CONTENT="PROHIBITED_CONTENT",n.SPII="SPII",n.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",n.IMAGE_SAFETY="IMAGE_SAFETY",n.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",n.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",n.NO_IMAGE="NO_IMAGE"})(zT||(zT={}));var JT;(function(n){n.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",n.NEGLIGIBLE="NEGLIGIBLE",n.LOW="LOW",n.MEDIUM="MEDIUM",n.HIGH="HIGH"})(JT||(JT={}));var KT;(function(n){n.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",n.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",n.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",n.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",n.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(KT||(KT={}));var YT;(function(n){n.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",n.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",n.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",n.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",n.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(YT||(YT={}));var XT;(function(n){n.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",n.SAFETY="SAFETY",n.OTHER="OTHER",n.BLOCKLIST="BLOCKLIST",n.PROHIBITED_CONTENT="PROHIBITED_CONTENT",n.IMAGE_SAFETY="IMAGE_SAFETY",n.MODEL_ARMOR="MODEL_ARMOR",n.JAILBREAK="JAILBREAK"})(XT||(XT={}));var QT;(function(n){n.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",n.ON_DEMAND="ON_DEMAND",n.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(QT||(QT={}));var hu;(function(n){n.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",n.TEXT="TEXT",n.IMAGE="IMAGE",n.AUDIO="AUDIO"})(hu||(hu={}));var ZT;(function(n){n.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",n.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",n.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",n.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(ZT||(ZT={}));var jT;(function(n){n.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",n.TUNING_MODE_FULL="TUNING_MODE_FULL",n.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(jT||(jT={}));var ev;(function(n){n.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",n.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",n.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",n.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",n.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",n.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",n.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(ev||(ev={}));var Oh;(function(n){n.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",n.JOB_STATE_QUEUED="JOB_STATE_QUEUED",n.JOB_STATE_PENDING="JOB_STATE_PENDING",n.JOB_STATE_RUNNING="JOB_STATE_RUNNING",n.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",n.JOB_STATE_FAILED="JOB_STATE_FAILED",n.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",n.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",n.JOB_STATE_PAUSED="JOB_STATE_PAUSED",n.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",n.JOB_STATE_UPDATING="JOB_STATE_UPDATING",n.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(Oh||(Oh={}));var tv;(function(n){n.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",n.TUNING_TASK_I2V="TUNING_TASK_I2V",n.TUNING_TASK_T2V="TUNING_TASK_T2V",n.TUNING_TASK_R2V="TUNING_TASK_R2V"})(tv||(tv={}));var nv;(function(n){n.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",n.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",n.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",n.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(nv||(nv={}));var rv;(function(n){n.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",n.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",n.BALANCED="BALANCED",n.PRIORITIZE_COST="PRIORITIZE_COST"})(rv||(rv={}));var iv;(function(n){n.UNSPECIFIED="UNSPECIFIED",n.BLOCKING="BLOCKING",n.NON_BLOCKING="NON_BLOCKING"})(iv||(iv={}));var ov;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})(ov||(ov={}));var sv;(function(n){n.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",n.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(sv||(sv={}));var av;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.AUTO="AUTO",n.ANY="ANY",n.NONE="NONE",n.VALIDATED="VALIDATED"})(av||(av={}));var lv;(function(n){n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE"})(lv||(lv={}));var uv;(function(n){n.DONT_ALLOW="DONT_ALLOW",n.ALLOW_ADULT="ALLOW_ADULT",n.ALLOW_ALL="ALLOW_ALL"})(uv||(uv={}));var cv;(function(n){n.auto="auto",n.en="en",n.ja="ja",n.ko="ko",n.hi="hi",n.zh="zh",n.pt="pt",n.es="es"})(cv||(cv={}));var fv;(function(n){n.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",n.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",n.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",n.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",n.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(fv||(fv={}));var dv;(function(n){n.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",n.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",n.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",n.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(dv||(dv={}));var hv;(function(n){n.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",n.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",n.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",n.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(hv||(hv={}));var pv;(function(n){n.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",n.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",n.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",n.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",n.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",n.EDIT_MODE_STYLE="EDIT_MODE_STYLE",n.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",n.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(pv||(pv={}));var mv;(function(n){n.FOREGROUND="FOREGROUND",n.BACKGROUND="BACKGROUND",n.PROMPT="PROMPT",n.SEMANTIC="SEMANTIC",n.INTERACTIVE="INTERACTIVE"})(mv||(mv={}));var gv;(function(n){n.ASSET="ASSET",n.STYLE="STYLE"})(gv||(gv={}));var yv;(function(n){n.INSERT="INSERT",n.REMOVE="REMOVE",n.REMOVE_STATIC="REMOVE_STATIC",n.OUTPAINT="OUTPAINT"})(yv||(yv={}));var _v;(function(n){n.OPTIMIZED="OPTIMIZED",n.LOSSLESS="LOSSLESS"})(_v||(_v={}));var Ev;(function(n){n.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",n.PREFERENCE_TUNING="PREFERENCE_TUNING"})(Ev||(Ev={}));var Sv;(function(n){n.STATE_UNSPECIFIED="STATE_UNSPECIFIED",n.STATE_PENDING="STATE_PENDING",n.STATE_ACTIVE="STATE_ACTIVE",n.STATE_FAILED="STATE_FAILED"})(Sv||(Sv={}));var Tv;(function(n){n.STATE_UNSPECIFIED="STATE_UNSPECIFIED",n.PROCESSING="PROCESSING",n.ACTIVE="ACTIVE",n.FAILED="FAILED"})(Tv||(Tv={}));var vv;(function(n){n.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",n.UPLOADED="UPLOADED",n.GENERATED="GENERATED"})(vv||(vv={}));var wv;(function(n){n.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",n.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",n.RESPONSE_REJECTED="RESPONSE_REJECTED",n.NEED_MORE_INPUT="NEED_MORE_INPUT"})(wv||(wv={}));var Cv;(function(n){n.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",n.TEXT="TEXT",n.IMAGE="IMAGE",n.VIDEO="VIDEO",n.AUDIO="AUDIO",n.DOCUMENT="DOCUMENT"})(Cv||(Cv={}));var Av;(function(n){n.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",n.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",n.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(Av||(Av={}));var bv;(function(n){n.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",n.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",n.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(bv||(bv={}));var Rv;(function(n){n.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",n.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",n.NO_INTERRUPTION="NO_INTERRUPTION"})(Rv||(Rv={}));var Iv;(function(n){n.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",n.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",n.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(Iv||(Iv={}));var Pv;(function(n){n.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",n.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",n.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",n.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",n.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",n.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",n.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",n.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",n.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",n.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",n.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",n.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",n.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(Pv||(Pv={}));var xv;(function(n){n.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",n.QUALITY="QUALITY",n.DIVERSITY="DIVERSITY",n.VOCALIZATION="VOCALIZATION"})(xv||(xv={}));var Ao;(function(n){n.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",n.PLAY="PLAY",n.PAUSE="PAUSE",n.STOP="STOP",n.RESET_CONTEXT="RESET_CONTEXT"})(Ao||(Ao={}));var gi=class{constructor(e){let t={};for(let r of e.headers.entries())t[r[0]]=r[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}};var pi=class{get text(){var e,t,r,i,o,s,u,f;if(((i=(r=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||r===void 0?void 0:r.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let d="",h=!1,m=[];for(let g of(f=(u=(s=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||s===void 0?void 0:s.content)===null||u===void 0?void 0:u.parts)!==null&&f!==void 0?f:[]){for(let[_,v]of Object.entries(g))_!=="text"&&_!=="thought"&&_!=="thoughtSignature"&&(v!==null||v!==void 0)&&m.push(_);if(typeof g.text=="string"){if(typeof g.thought=="boolean"&&g.thought)continue;h=!0,d+=g.text}}return m.length>0&&console.warn(`there are non-text parts ${m} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),h?d:void 0}get data(){var e,t,r,i,o,s,u,f;if(((i=(r=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||r===void 0?void 0:r.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let d="",h=[];for(let m of(f=(u=(s=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||s===void 0?void 0:s.content)===null||u===void 0?void 0:u.parts)!==null&&f!==void 0?f:[]){for(let[g,_]of Object.entries(m))g!=="inlineData"&&(_!==null||_!==void 0)&&h.push(g);m.inlineData&&typeof m.inlineData.data=="string"&&(d+=atob(m.inlineData.data))}return h.length>0&&console.warn(`there are non-data parts ${h} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),d.length>0?btoa(d):void 0}get functionCalls(){var e,t,r,i,o,s,u,f;if(((i=(r=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||r===void 0?void 0:r.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");let d=(f=(u=(s=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||s===void 0?void 0:s.content)===null||u===void 0?void 0:u.parts)===null||f===void 0?void 0:f.filter(h=>h.functionCall).map(h=>h.functionCall).filter(h=>h!==void 0);if((d==null?void 0:d.length)!==0)return d}get executableCode(){var e,t,r,i,o,s,u,f,d;if(((i=(r=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||r===void 0?void 0:r.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");let h=(f=(u=(s=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||s===void 0?void 0:s.content)===null||u===void 0?void 0:u.parts)===null||f===void 0?void 0:f.filter(m=>m.executableCode).map(m=>m.executableCode).filter(m=>m!==void 0);if((h==null?void 0:h.length)!==0)return(d=h==null?void 0:h[0])===null||d===void 0?void 0:d.code}get codeExecutionResult(){var e,t,r,i,o,s,u,f,d;if(((i=(r=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||r===void 0?void 0:r.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");let h=(f=(u=(s=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||s===void 0?void 0:s.content)===null||u===void 0?void 0:u.parts)===null||f===void 0?void 0:f.filter(m=>m.codeExecutionResult).map(m=>m.codeExecutionResult).filter(m=>m!==void 0);if((h==null?void 0:h.length)!==0)return(d=h==null?void 0:h[0])===null||d===void 0?void 0:d.output}},pu=class{},mu=class{},Uh=class{},Fh=class{},Lh=class{},qh=class{},gu=class{},yu=class{},_u=class{},Bh=class{};var Eu=class n{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let r=new n,i,o=e;return t?i=ek(o):i=jN(o),Object.assign(r,i),r}},Su=class{},Tu=class{},vu=class{},wu=class{},Gh=class{},Hh=class{},Vh=class{};var $h=class n{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let r=new n,o=ak(e);return Object.assign(r,o),r}},Wh=class{},zh=class{},Jh=class{};var Cu=class{};var Kh=class{get text(){var e,t,r;let i="",o=!1,s=[];for(let u of(r=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&r!==void 0?r:[]){for(let[f,d]of Object.entries(u))f!=="text"&&f!=="thought"&&d!==null&&s.push(f);if(typeof u.text=="string"){if(typeof u.thought=="boolean"&&u.thought)continue;o=!0,i+=u.text}}return s.length>0&&console.warn(`there are non-text parts ${s} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),o?i:void 0}get data(){var e,t,r;let i="",o=[];for(let s of(r=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&r!==void 0?r:[]){for(let[u,f]of Object.entries(s))u!=="inlineData"&&f!==null&&o.push(u);s.inlineData&&typeof s.inlineData.data=="string"&&(i+=atob(s.inlineData.data))}return o.length>0&&console.warn(`there are non-data parts ${o} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),i.length>0?btoa(i):void 0}};var Yh=class{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}};var Au=class n{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let r=new n,o=Ap(e);return Object.assign(r,o),r}};function Ce(n,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(e.includes("..")||e.includes("?")||e.includes("&"))throw new Error("invalid model parameter");if(n.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){let t=e.split("/",2);return`publishers/${t[0]}/models/${t[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function tw(n,e){let t=Ce(n,e);return t?t.startsWith("publishers/")&&n.isVertexAI()?`projects/${n.getProject()}/locations/${n.getLocation()}/${t}`:t.startsWith("models/")&&n.isVertexAI()?`projects/${n.getProject()}/locations/${n.getLocation()}/publishers/google/${t}`:t:""}function nw(n){return Array.isArray(n)?n.map(e=>bu(e)):[bu(n)]}function bu(n){if(typeof n=="object"&&n!==null)return n;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof n}`)}function rw(n){let e=bu(n);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function iw(n){let e=bu(n);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function Nv(n){if(n==null)throw new Error("PartUnion is required");if(typeof n=="object")return n;if(typeof n=="string")return{text:n};throw new Error(`Unsupported part type: ${typeof n}`)}function ow(n){if(n==null||Array.isArray(n)&&n.length===0)throw new Error("PartListUnion is required");return Array.isArray(n)?n.map(e=>Nv(e)):[Nv(n)]}function Xh(n){return n!=null&&typeof n=="object"&&"parts"in n&&Array.isArray(n.parts)}function kv(n){return n!=null&&typeof n=="object"&&"functionCall"in n}function Mv(n){return n!=null&&typeof n=="object"&&"functionResponse"in n}function ot(n){if(n==null)throw new Error("ContentUnion is required");return Xh(n)?n:{role:"user",parts:ow(n)}}function bp(n,e){if(!e)return[];if(n.isVertexAI()&&Array.isArray(e))return e.flatMap(t=>{let r=ot(t);return r.parts&&r.parts.length>0&&r.parts[0].text!==void 0?[r.parts[0].text]:[]});if(n.isVertexAI()){let t=ot(e);return t.parts&&t.parts.length>0&&t.parts[0].text!==void 0?[t.parts[0].text]:[]}return Array.isArray(e)?e.map(t=>ot(t)):[ot(e)]}function en(n){if(n==null||Array.isArray(n)&&n.length===0)throw new Error("contents are required");if(!Array.isArray(n)){if(kv(n)||Mv(n))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[ot(n)]}let e=[],t=[],r=Xh(n[0]);for(let i of n){let o=Xh(i);if(o!=r)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(o)e.push(i);else{if(kv(i)||Mv(i))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");t.push(i)}}return r||e.push({role:"user",parts:ow(t)}),e}function dk(n,e){n.includes("null")&&(e.nullable=!0);let t=n.filter(r=>r!=="null");if(t.length===1)e.type=Object.values(xr).includes(t[0].toUpperCase())?t[0].toUpperCase():xr.TYPE_UNSPECIFIED;else{e.anyOf=[];for(let r of t)e.anyOf.push({type:Object.values(xr).includes(r.toUpperCase())?r.toUpperCase():xr.TYPE_UNSPECIFIED})}}function bo(n){let e={},t=["items"],r=["anyOf"],i=["properties"];if(n.type&&n.anyOf)throw new Error("type and anyOf cannot be both populated.");let o=n.anyOf;o!=null&&o.length==2&&(o[0].type==="null"?(e.nullable=!0,n=o[1]):o[1].type==="null"&&(e.nullable=!0,n=o[0])),n.type instanceof Array&&dk(n.type,e);for(let[s,u]of Object.entries(n))if(u!=null)if(s=="type"){if(u==="null")throw new Error("type: null can not be the only possible type for the field.");if(u instanceof Array)continue;e.type=Object.values(xr).includes(u.toUpperCase())?u.toUpperCase():xr.TYPE_UNSPECIFIED}else if(t.includes(s))e[s]=bo(u);else if(r.includes(s)){let f=[];for(let d of u){if(d.type=="null"){e.nullable=!0;continue}f.push(bo(d))}e[s]=f}else if(i.includes(s)){let f={};for(let[d,h]of Object.entries(u))f[d]=bo(h);e[s]=f}else{if(s==="additionalProperties")continue;e[s]=u}return e}function Rp(n){return bo(n)}function Ip(n){if(typeof n=="object")return n;if(typeof n=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:n}}};throw new Error(`Unsupported speechConfig type: ${typeof n}`)}function Pp(n){if("multiSpeakerVoiceConfig"in n)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return n}function Po(n){if(n.functionDeclarations)for(let e of n.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=bo(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=bo(e.response));return n}function xo(n){if(n==null)throw new Error("tools is required");if(!Array.isArray(n))throw new Error("tools is required and must be an array of Tools");let e=[];for(let t of n)e.push(t);return e}function hk(n,e,t,r=1){let i=!e.startsWith(`${t}/`)&&e.split("/").length===r;return n.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${n.getProject()}/${e}`:e.startsWith(`${t}/`)?`projects/${n.getProject()}/locations/${n.getLocation()}/${e}`:i?`projects/${n.getProject()}/locations/${n.getLocation()}/${t}/${e}`:e:i?`${t}/${e}`:e}function lr(n,e){if(typeof e!="string")throw new Error("name must be a string");return hk(n,e,"cachedContents")}function sw(n){switch(n){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return n}}function kr(n){return Cp(n)}function pk(n){return n!=null&&typeof n=="object"&&"name"in n}function aw(n){return n!=null&&typeof n=="object"&&"video"in n}function lw(n){return n!=null&&typeof n=="object"&&"uri"in n}function xp(n){var e;let t;if(pk(n)&&(t=n.name),!(lw(n)&&(t=n.uri,t===void 0))&&!(aw(n)&&(t=(e=n.video)===null||e===void 0?void 0:e.uri,t===void 0))){if(typeof n=="string"&&(t=n),t===void 0)throw new Error("Could not extract file name from the provided input.");if(t.startsWith("https://")){let i=t.split("files/")[1].match(/[a-z0-9]+/);if(i===null)throw new Error(`Could not extract file name from URI ${t}`);t=i[0]}else t.startsWith("files/")&&(t=t.split("files/")[1]);return t}}function uw(n,e){let t;return n.isVertexAI()?t=e?"publishers/google/models":"models":t=e?"models":"tunedModels",t}function cw(n){for(let e of["models","tunedModels","publisherModels"])if(mk(n,e))return n[e];return[]}function mk(n,e){return n!==null&&typeof n=="object"&&e in n}function gk(n,e={}){let t=n,r={name:t.name,description:t.description,parametersJsonSchema:t.inputSchema};return t.outputSchema&&(r.responseJsonSchema=t.outputSchema),e.behavior&&(r.behavior=e.behavior),{functionDeclarations:[r]}}function yk(n,e={}){let t=[],r=new Set;for(let i of n){let o=i.name;if(r.has(o))throw new Error(`Duplicate function name ${o} found in MCP tools. Please ensure function names are unique.`);r.add(o);let s=gk(i,e);s.functionDeclarations&&t.push(...s.functionDeclarations)}return{functionDeclarations:t}}function fw(n,e){let t;if(typeof e=="string")if(n.isVertexAI())if(e.startsWith("gs://"))t={format:"jsonl",gcsUri:[e]};else if(e.startsWith("bq://"))t={format:"bigquery",bigqueryUri:e};else throw new Error(`Unsupported string source for Vertex AI: ${e}`);else if(e.startsWith("files/"))t={fileName:e};else throw new Error(`Unsupported string source for Gemini API: ${e}`);else if(Array.isArray(e)){if(n.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");t={inlinedRequests:e}}else t=e;let r=[t.gcsUri,t.bigqueryUri].filter(Boolean).length,i=[t.inlinedRequests,t.fileName].filter(Boolean).length;if(n.isVertexAI()){if(i>0||r!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(r>0||i!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return t}function _k(n){if(typeof n!="string")return n;let e=n;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function dw(n){if(typeof n!="object"||n===null)return{};let e=n,t=e.inlinedResponses;if(typeof t!="object"||t===null)return n;let i=t.inlinedResponses;if(!Array.isArray(i)||i.length===0)return n;let o=!1;for(let s of i){if(typeof s!="object"||s===null)continue;let f=s.response;if(typeof f!="object"||f===null)continue;if(f.embedding!==void 0){o=!0;break}}return o&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),n}function No(n,e){let t=e;if(!n.isVertexAI()){if(/batches\/[^/]+$/.test(t))return t.split("/").pop();throw new Error(`Invalid batch job name: ${t}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(t))return t.split("/").pop();if(/^\d+$/.test(t))return t;throw new Error(`Invalid batch job name: ${t}.`)}function hw(n){let e=n;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":e}function Ek(n){let e={},t=a(n,["responsesFile"]);t!=null&&l(e,["fileName"],t);let r=a(n,["inlinedResponses","inlinedResponses"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(s=>jk(s))),l(e,["inlinedResponses"],o)}let i=a(n,["inlinedEmbedContentResponses","inlinedResponses"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(s=>s)),l(e,["inlinedEmbedContentResponses"],o)}return e}function Sk(n){let e={},t=a(n,["predictionsFormat"]);t!=null&&l(e,["format"],t);let r=a(n,["gcsDestination","outputUriPrefix"]);r!=null&&l(e,["gcsUri"],r);let i=a(n,["bigqueryDestination","outputUri"]);return i!=null&&l(e,["bigqueryUri"],i),e}function Tk(n){let e={},t=a(n,["format"]);t!=null&&l(e,["predictionsFormat"],t);let r=a(n,["gcsUri"]);r!=null&&l(e,["gcsDestination","outputUriPrefix"],r);let i=a(n,["bigqueryUri"]);if(i!=null&&l(e,["bigqueryDestination","outputUri"],i),a(n,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(a(n,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(a(n,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return e}function fu(n){let e={},t=a(n,["name"]);t!=null&&l(e,["name"],t);let r=a(n,["metadata","displayName"]);r!=null&&l(e,["displayName"],r);let i=a(n,["metadata","state"]);i!=null&&l(e,["state"],hw(i));let o=a(n,["metadata","createTime"]);o!=null&&l(e,["createTime"],o);let s=a(n,["metadata","endTime"]);s!=null&&l(e,["endTime"],s);let u=a(n,["metadata","updateTime"]);u!=null&&l(e,["updateTime"],u);let f=a(n,["metadata","model"]);f!=null&&l(e,["model"],f);let d=a(n,["metadata","output"]);return d!=null&&l(e,["dest"],Ek(dw(d))),e}function Qh(n){let e={},t=a(n,["name"]);t!=null&&l(e,["name"],t);let r=a(n,["displayName"]);r!=null&&l(e,["displayName"],r);let i=a(n,["state"]);i!=null&&l(e,["state"],hw(i));let o=a(n,["error"]);o!=null&&l(e,["error"],o);let s=a(n,["createTime"]);s!=null&&l(e,["createTime"],s);let u=a(n,["startTime"]);u!=null&&l(e,["startTime"],u);let f=a(n,["endTime"]);f!=null&&l(e,["endTime"],f);let d=a(n,["updateTime"]);d!=null&&l(e,["updateTime"],d);let h=a(n,["model"]);h!=null&&l(e,["model"],h);let m=a(n,["inputConfig"]);m!=null&&l(e,["src"],vk(m));let g=a(n,["outputConfig"]);g!=null&&l(e,["dest"],Sk(dw(g)));let _=a(n,["completionStats"]);return _!=null&&l(e,["completionStats"],_),e}function vk(n){let e={},t=a(n,["instancesFormat"]);t!=null&&l(e,["format"],t);let r=a(n,["gcsSource","uris"]);r!=null&&l(e,["gcsUri"],r);let i=a(n,["bigquerySource","inputUri"]);return i!=null&&l(e,["bigqueryUri"],i),e}function wk(n,e){let t={};if(a(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(a(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(a(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");let r=a(e,["fileName"]);r!=null&&l(t,["fileName"],r);let i=a(e,["inlinedRequests"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(s=>Zk(n,s))),l(t,["requests","requests"],o)}return t}function Ck(n){let e={},t=a(n,["format"]);t!=null&&l(e,["instancesFormat"],t);let r=a(n,["gcsUri"]);r!=null&&l(e,["gcsSource","uris"],r);let i=a(n,["bigqueryUri"]);if(i!=null&&l(e,["bigquerySource","inputUri"],i),a(n,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(a(n,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function Ak(n){let e={},t=a(n,["data"]);if(t!=null&&l(e,["data"],t),a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let r=a(n,["mimeType"]);return r!=null&&l(e,["mimeType"],r),e}function bk(n,e){let t={},r=a(e,["name"]);return r!=null&&l(t,["_url","name"],No(n,r)),t}function Rk(n,e){let t={},r=a(e,["name"]);return r!=null&&l(t,["_url","name"],No(n,r)),t}function Ik(n){let e={},t=a(n,["content"]);t!=null&&l(e,["content"],t);let r=a(n,["citationMetadata"]);r!=null&&l(e,["citationMetadata"],Pk(r));let i=a(n,["tokenCount"]);i!=null&&l(e,["tokenCount"],i);let o=a(n,["finishReason"]);o!=null&&l(e,["finishReason"],o);let s=a(n,["avgLogprobs"]);s!=null&&l(e,["avgLogprobs"],s);let u=a(n,["groundingMetadata"]);u!=null&&l(e,["groundingMetadata"],u);let f=a(n,["index"]);f!=null&&l(e,["index"],f);let d=a(n,["logprobsResult"]);d!=null&&l(e,["logprobsResult"],d);let h=a(n,["safetyRatings"]);if(h!=null){let g=h;Array.isArray(g)&&(g=g.map(_=>_)),l(e,["safetyRatings"],g)}let m=a(n,["urlContextMetadata"]);return m!=null&&l(e,["urlContextMetadata"],m),e}function Pk(n){let e={},t=a(n,["citationSources"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(i=>i)),l(e,["citations"],r)}return e}function pw(n){let e={},t=a(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>sM(o))),l(e,["parts"],i)}let r=a(n,["role"]);return r!=null&&l(e,["role"],r),e}function xk(n,e){let t={},r=a(n,["displayName"]);if(e!==void 0&&r!=null&&l(e,["batch","displayName"],r),a(n,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return t}function Nk(n,e){let t={},r=a(n,["displayName"]);e!==void 0&&r!=null&&l(e,["displayName"],r);let i=a(n,["dest"]);return e!==void 0&&i!=null&&l(e,["outputConfig"],Tk(_k(i))),t}function Dv(n,e){let t={},r=a(e,["model"]);r!=null&&l(t,["_url","model"],Ce(n,r));let i=a(e,["src"]);i!=null&&l(t,["batch","inputConfig"],wk(n,fw(n,i)));let o=a(e,["config"]);return o!=null&&xk(o,t),t}function kk(n,e){let t={},r=a(e,["model"]);r!=null&&l(t,["model"],Ce(n,r));let i=a(e,["src"]);i!=null&&l(t,["inputConfig"],Ck(fw(n,i)));let o=a(e,["config"]);return o!=null&&Nk(o,t),t}function Mk(n,e){let t={},r=a(n,["displayName"]);return e!==void 0&&r!=null&&l(e,["batch","displayName"],r),t}function Dk(n,e){let t={},r=a(e,["model"]);r!=null&&l(t,["_url","model"],Ce(n,r));let i=a(e,["src"]);i!=null&&l(t,["batch","inputConfig"],Gk(n,i));let o=a(e,["config"]);return o!=null&&Mk(o,t),t}function Ok(n,e){let t={},r=a(e,["name"]);return r!=null&&l(t,["_url","name"],No(n,r)),t}function Uk(n,e){let t={},r=a(e,["name"]);return r!=null&&l(t,["_url","name"],No(n,r)),t}function Fk(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);let r=a(n,["name"]);r!=null&&l(e,["name"],r);let i=a(n,["done"]);i!=null&&l(e,["done"],i);let o=a(n,["error"]);return o!=null&&l(e,["error"],o),e}function Lk(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);let r=a(n,["name"]);r!=null&&l(e,["name"],r);let i=a(n,["done"]);i!=null&&l(e,["done"],i);let o=a(n,["error"]);return o!=null&&l(e,["error"],o),e}function qk(n,e){let t={},r=a(e,["contents"]);if(r!=null){let o=bp(n,r);Array.isArray(o)&&(o=o.map(s=>s)),l(t,["requests[]","request","content"],o)}let i=a(e,["config"]);return i!=null&&(l(t,["_self"],Bk(i,t)),QN(t,{"requests[].*":"requests[].request.*"})),t}function Bk(n,e){let t={},r=a(n,["taskType"]);e!==void 0&&r!=null&&l(e,["requests[]","taskType"],r);let i=a(n,["title"]);e!==void 0&&i!=null&&l(e,["requests[]","title"],i);let o=a(n,["outputDimensionality"]);if(e!==void 0&&o!=null&&l(e,["requests[]","outputDimensionality"],o),a(n,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(a(n,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function Gk(n,e){let t={},r=a(e,["fileName"]);r!=null&&l(t,["file_name"],r);let i=a(e,["inlinedRequests"]);return i!=null&&l(t,["requests"],qk(n,i)),t}function Hk(n){let e={};if(a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=a(n,["fileUri"]);t!=null&&l(e,["fileUri"],t);let r=a(n,["mimeType"]);return r!=null&&l(e,["mimeType"],r),e}function Vk(n){let e={},t=a(n,["id"]);t!=null&&l(e,["id"],t);let r=a(n,["args"]);r!=null&&l(e,["args"],r);let i=a(n,["name"]);if(i!=null&&l(e,["name"],i),a(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(a(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function $k(n){let e={},t=a(n,["mode"]);t!=null&&l(e,["mode"],t);let r=a(n,["allowedFunctionNames"]);if(r!=null&&l(e,["allowedFunctionNames"],r),a(n,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function Wk(n,e,t){let r={},i=a(e,["systemInstruction"]);t!==void 0&&i!=null&&l(t,["systemInstruction"],pw(ot(i)));let o=a(e,["temperature"]);o!=null&&l(r,["temperature"],o);let s=a(e,["topP"]);s!=null&&l(r,["topP"],s);let u=a(e,["topK"]);u!=null&&l(r,["topK"],u);let f=a(e,["candidateCount"]);f!=null&&l(r,["candidateCount"],f);let d=a(e,["maxOutputTokens"]);d!=null&&l(r,["maxOutputTokens"],d);let h=a(e,["stopSequences"]);h!=null&&l(r,["stopSequences"],h);let m=a(e,["responseLogprobs"]);m!=null&&l(r,["responseLogprobs"],m);let g=a(e,["logprobs"]);g!=null&&l(r,["logprobs"],g);let _=a(e,["presencePenalty"]);_!=null&&l(r,["presencePenalty"],_);let v=a(e,["frequencyPenalty"]);v!=null&&l(r,["frequencyPenalty"],v);let C=a(e,["seed"]);C!=null&&l(r,["seed"],C);let R=a(e,["responseMimeType"]);R!=null&&l(r,["responseMimeType"],R);let I=a(e,["responseSchema"]);I!=null&&l(r,["responseSchema"],Rp(I));let z=a(e,["responseJsonSchema"]);if(z!=null&&l(r,["responseJsonSchema"],z),a(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(a(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");let $=a(e,["safetySettings"]);if(t!==void 0&&$!=null){let Z=$;Array.isArray(Z)&&(Z=Z.map(j=>aM(j))),l(t,["safetySettings"],Z)}let W=a(e,["tools"]);if(t!==void 0&&W!=null){let Z=xo(W);Array.isArray(Z)&&(Z=Z.map(j=>uM(Po(j)))),l(t,["tools"],Z)}let H=a(e,["toolConfig"]);if(t!==void 0&&H!=null&&l(t,["toolConfig"],lM(H)),a(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let G=a(e,["cachedContent"]);t!==void 0&&G!=null&&l(t,["cachedContent"],lr(n,G));let K=a(e,["responseModalities"]);K!=null&&l(r,["responseModalities"],K);let te=a(e,["mediaResolution"]);te!=null&&l(r,["mediaResolution"],te);let T=a(e,["speechConfig"]);if(T!=null&&l(r,["speechConfig"],Ip(T)),a(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");let L=a(e,["thinkingConfig"]);L!=null&&l(r,["thinkingConfig"],L);let X=a(e,["imageConfig"]);X!=null&&l(r,["imageConfig"],Qk(X));let ee=a(e,["enableEnhancedCivicAnswers"]);return ee!=null&&l(r,["enableEnhancedCivicAnswers"],ee),r}function zk(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);let r=a(n,["candidates"]);if(r!=null){let f=r;Array.isArray(f)&&(f=f.map(d=>Ik(d))),l(e,["candidates"],f)}let i=a(n,["modelVersion"]);i!=null&&l(e,["modelVersion"],i);let o=a(n,["promptFeedback"]);o!=null&&l(e,["promptFeedback"],o);let s=a(n,["responseId"]);s!=null&&l(e,["responseId"],s);let u=a(n,["usageMetadata"]);return u!=null&&l(e,["usageMetadata"],u),e}function Jk(n,e){let t={},r=a(e,["name"]);return r!=null&&l(t,["_url","name"],No(n,r)),t}function Kk(n,e){let t={},r=a(e,["name"]);return r!=null&&l(t,["_url","name"],No(n,r)),t}function Yk(n){let e={};if(a(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=a(n,["enableWidget"]);return t!=null&&l(e,["enableWidget"],t),e}function Xk(n){let e={};if(a(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(a(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=a(n,["timeRangeFilter"]);return t!=null&&l(e,["timeRangeFilter"],t),e}function Qk(n){let e={},t=a(n,["aspectRatio"]);t!=null&&l(e,["aspectRatio"],t);let r=a(n,["imageSize"]);if(r!=null&&l(e,["imageSize"],r),a(n,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(a(n,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function Zk(n,e){let t={},r=a(e,["model"]);r!=null&&l(t,["request","model"],Ce(n,r));let i=a(e,["contents"]);if(i!=null){let u=en(i);Array.isArray(u)&&(u=u.map(f=>pw(f))),l(t,["request","contents"],u)}let o=a(e,["metadata"]);o!=null&&l(t,["metadata"],o);let s=a(e,["config"]);return s!=null&&l(t,["request","generationConfig"],Wk(n,s,a(t,["request"],{}))),t}function jk(n){let e={},t=a(n,["response"]);t!=null&&l(e,["response"],zk(t));let r=a(n,["error"]);return r!=null&&l(e,["error"],r),e}function eM(n,e){let t={},r=a(n,["pageSize"]);e!==void 0&&r!=null&&l(e,["_query","pageSize"],r);let i=a(n,["pageToken"]);if(e!==void 0&&i!=null&&l(e,["_query","pageToken"],i),a(n,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return t}function tM(n,e){let t={},r=a(n,["pageSize"]);e!==void 0&&r!=null&&l(e,["_query","pageSize"],r);let i=a(n,["pageToken"]);e!==void 0&&i!=null&&l(e,["_query","pageToken"],i);let o=a(n,["filter"]);return e!==void 0&&o!=null&&l(e,["_query","filter"],o),t}function nM(n){let e={},t=a(n,["config"]);return t!=null&&eM(t,e),e}function rM(n){let e={},t=a(n,["config"]);return t!=null&&tM(t,e),e}function iM(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);let r=a(n,["nextPageToken"]);r!=null&&l(e,["nextPageToken"],r);let i=a(n,["operations"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(s=>fu(s))),l(e,["batchJobs"],o)}return e}function oM(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);let r=a(n,["nextPageToken"]);r!=null&&l(e,["nextPageToken"],r);let i=a(n,["batchPredictionJobs"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(s=>Qh(s))),l(e,["batchJobs"],o)}return e}function sM(n){let e={},t=a(n,["mediaResolution"]);t!=null&&l(e,["mediaResolution"],t);let r=a(n,["codeExecutionResult"]);r!=null&&l(e,["codeExecutionResult"],r);let i=a(n,["executableCode"]);i!=null&&l(e,["executableCode"],i);let o=a(n,["fileData"]);o!=null&&l(e,["fileData"],Hk(o));let s=a(n,["functionCall"]);s!=null&&l(e,["functionCall"],Vk(s));let u=a(n,["functionResponse"]);u!=null&&l(e,["functionResponse"],u);let f=a(n,["inlineData"]);f!=null&&l(e,["inlineData"],Ak(f));let d=a(n,["text"]);d!=null&&l(e,["text"],d);let h=a(n,["thought"]);h!=null&&l(e,["thought"],h);let m=a(n,["thoughtSignature"]);m!=null&&l(e,["thoughtSignature"],m);let g=a(n,["videoMetadata"]);return g!=null&&l(e,["videoMetadata"],g),e}function aM(n){let e={},t=a(n,["category"]);if(t!=null&&l(e,["category"],t),a(n,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");let r=a(n,["threshold"]);return r!=null&&l(e,["threshold"],r),e}function lM(n){let e={},t=a(n,["functionCallingConfig"]);t!=null&&l(e,["functionCallingConfig"],$k(t));let r=a(n,["retrievalConfig"]);return r!=null&&l(e,["retrievalConfig"],r),e}function uM(n){let e={},t=a(n,["functionDeclarations"]);if(t!=null){let h=t;Array.isArray(h)&&(h=h.map(m=>m)),l(e,["functionDeclarations"],h)}if(a(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let r=a(n,["googleSearchRetrieval"]);r!=null&&l(e,["googleSearchRetrieval"],r);let i=a(n,["computerUse"]);i!=null&&l(e,["computerUse"],i);let o=a(n,["fileSearch"]);o!=null&&l(e,["fileSearch"],o);let s=a(n,["codeExecution"]);if(s!=null&&l(e,["codeExecution"],s),a(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let u=a(n,["googleMaps"]);u!=null&&l(e,["googleMaps"],Yk(u));let f=a(n,["googleSearch"]);f!=null&&l(e,["googleSearch"],Xk(f));let d=a(n,["urlContext"]);return d!=null&&l(e,["urlContext"],d),e}var sr;(function(n){n.PAGED_ITEM_BATCH_JOBS="batchJobs",n.PAGED_ITEM_MODELS="models",n.PAGED_ITEM_TUNING_JOBS="tuningJobs",n.PAGED_ITEM_FILES="files",n.PAGED_ITEM_CACHED_CONTENTS="cachedContents",n.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",n.PAGED_ITEM_DOCUMENTS="documents"})(sr||(sr={}));var ar=class{constructor(e,t,r,i){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,r,i)}init(e,t,r){var i,o;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.sdkHttpResponseInternal=t==null?void 0:t.sdkHttpResponse,this.idxInternal=0;let s={config:{}};!r||Object.keys(r).length===0?s={config:{}}:typeof r=="object"?s=Object.assign({},r):s=r,s.config&&(s.config.pageToken=t.nextPageToken),this.paramsInternal=s,this.pageInternalSize=(o=(i=s.config)===null||i===void 0?void 0:i.pageSize)!==null&&o!==void 0?o:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};let e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");let e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}};var Zh=class extends _n{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new ar(sr.PAGED_ITEM_BATCH_JOBS,r=>this.listInternal(r),await this.listInternal(t),t),this.create=async t=>(this.apiClient.isVertexAI()&&(t.config=this.formatDestination(t.src,t.config)),this.createInternal(t)),this.createEmbeddings=async t=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(t)}}createInlinedGenerateContentRequest(e){let t=Dv(this.apiClient,e),r=t._url,i=ne("{model}:batchGenerateContent",r),u=t.batch.inputConfig.requests,f=u.requests,d=[];for(let h of f){let m=Object.assign({},h);if(m.systemInstruction){let g=m.systemInstruction;delete m.systemInstruction;let _=m.request;_.systemInstruction=g,m.request=_}d.push(m)}return u.requests=d,delete t.config,delete t._url,delete t._query,{path:i,body:t}}getGcsUri(e){if(typeof e=="string")return e.startsWith("gs://")?e:void 0;if(!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0)return e.gcsUri[0]}getBigqueryUri(e){if(typeof e=="string")return e.startsWith("bq://")?e:void 0;if(!Array.isArray(e))return e.bigqueryUri}formatDestination(e,t){let r=t?Object.assign({},t):{},i=Date.now().toString();if(r.displayName||(r.displayName=`genaiBatchJob_${i}`),r.dest===void 0){let o=this.getGcsUri(e),s=this.getBigqueryUri(e);if(o)o.endsWith(".jsonl")?r.dest=`${o.slice(0,-6)}/dest`:r.dest=`${o}_dest_${i}`;else if(s)r.dest=`${s}_dest_${i}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return r}async createInternal(e){var t,r,i,o;let s,u="",f={};if(this.apiClient.isVertexAI()){let d=kk(this.apiClient,e);return u=ne("batchPredictionJobs",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>Qh(h))}else{let d=Dv(this.apiClient,e);return u=ne("{model}:batchGenerateContent",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(h=>fu(h))}}async createEmbeddingsInternal(e){var t,r;let i,o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let u=Dk(this.apiClient,e);return o=ne("{model}:asyncBatchEmbedContent",u._url),s=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i.then(f=>fu(f))}}async get(e){var t,r,i,o;let s,u="",f={};if(this.apiClient.isVertexAI()){let d=Kk(this.apiClient,e);return u=ne("batchPredictionJobs/{name}",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>Qh(h))}else{let d=Jk(this.apiClient,e);return u=ne("batches/{name}",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(h=>fu(h))}}async cancel(e){var t,r,i,o;let s="",u={};if(this.apiClient.isVertexAI()){let f=Rk(this.apiClient,e);s=ne("batchPredictionJobs/{name}:cancel",f._url),u=f._query,delete f._url,delete f._query,await this.apiClient.request({path:s,queryParams:u,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}else{let f=bk(this.apiClient,e);s=ne("batches/{name}:cancel",f._url),u=f._query,delete f._url,delete f._query,await this.apiClient.request({path:s,queryParams:u,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal})}}async listInternal(e){var t,r,i,o;let s,u="",f={};if(this.apiClient.isVertexAI()){let d=rM(e);return u=ne("batchPredictionJobs",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),s.then(h=>{let m=oM(h),g=new Cu;return Object.assign(g,m),g})}else{let d=nM(e);return u=ne("batches",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),s.then(h=>{let m=iM(h),g=new Cu;return Object.assign(g,m),g})}}async delete(e){var t,r,i,o;let s,u="",f={};if(this.apiClient.isVertexAI()){let d=Uk(this.apiClient,e);return u=ne("batchPredictionJobs/{name}",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),s.then(h=>Lk(h))}else{let d=Ok(this.apiClient,e);return u=ne("batches/{name}",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),s.then(h=>Fk(h))}}};function cM(n){let e={},t=a(n,["data"]);if(t!=null&&l(e,["data"],t),a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let r=a(n,["mimeType"]);return r!=null&&l(e,["mimeType"],r),e}function Ov(n){let e={},t=a(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>MM(o))),l(e,["parts"],i)}let r=a(n,["role"]);return r!=null&&l(e,["role"],r),e}function fM(n,e){let t={},r=a(n,["ttl"]);e!==void 0&&r!=null&&l(e,["ttl"],r);let i=a(n,["expireTime"]);e!==void 0&&i!=null&&l(e,["expireTime"],i);let o=a(n,["displayName"]);e!==void 0&&o!=null&&l(e,["displayName"],o);let s=a(n,["contents"]);if(e!==void 0&&s!=null){let h=en(s);Array.isArray(h)&&(h=h.map(m=>Ov(m))),l(e,["contents"],h)}let u=a(n,["systemInstruction"]);e!==void 0&&u!=null&&l(e,["systemInstruction"],Ov(ot(u)));let f=a(n,["tools"]);if(e!==void 0&&f!=null){let h=f;Array.isArray(h)&&(h=h.map(m=>OM(m))),l(e,["tools"],h)}let d=a(n,["toolConfig"]);if(e!==void 0&&d!=null&&l(e,["toolConfig"],DM(d)),a(n,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return t}function dM(n,e){let t={},r=a(n,["ttl"]);e!==void 0&&r!=null&&l(e,["ttl"],r);let i=a(n,["expireTime"]);e!==void 0&&i!=null&&l(e,["expireTime"],i);let o=a(n,["displayName"]);e!==void 0&&o!=null&&l(e,["displayName"],o);let s=a(n,["contents"]);if(e!==void 0&&s!=null){let m=en(s);Array.isArray(m)&&(m=m.map(g=>g)),l(e,["contents"],m)}let u=a(n,["systemInstruction"]);e!==void 0&&u!=null&&l(e,["systemInstruction"],ot(u));let f=a(n,["tools"]);if(e!==void 0&&f!=null){let m=f;Array.isArray(m)&&(m=m.map(g=>UM(g))),l(e,["tools"],m)}let d=a(n,["toolConfig"]);e!==void 0&&d!=null&&l(e,["toolConfig"],d);let h=a(n,["kmsKeyName"]);return e!==void 0&&h!=null&&l(e,["encryption_spec","kmsKeyName"],h),t}function hM(n,e){let t={},r=a(e,["model"]);r!=null&&l(t,["model"],tw(n,r));let i=a(e,["config"]);return i!=null&&fM(i,t),t}function pM(n,e){let t={},r=a(e,["model"]);r!=null&&l(t,["model"],tw(n,r));let i=a(e,["config"]);return i!=null&&dM(i,t),t}function mM(n,e){let t={},r=a(e,["name"]);return r!=null&&l(t,["_url","name"],lr(n,r)),t}function gM(n,e){let t={},r=a(e,["name"]);return r!=null&&l(t,["_url","name"],lr(n,r)),t}function yM(n){let e={},t=a(n,["sdkHttpResponse"]);return t!=null&&l(e,["sdkHttpResponse"],t),e}function _M(n){let e={},t=a(n,["sdkHttpResponse"]);return t!=null&&l(e,["sdkHttpResponse"],t),e}function EM(n){let e={};if(a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=a(n,["fileUri"]);t!=null&&l(e,["fileUri"],t);let r=a(n,["mimeType"]);return r!=null&&l(e,["mimeType"],r),e}function SM(n){let e={},t=a(n,["id"]);t!=null&&l(e,["id"],t);let r=a(n,["args"]);r!=null&&l(e,["args"],r);let i=a(n,["name"]);if(i!=null&&l(e,["name"],i),a(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(a(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function TM(n){let e={},t=a(n,["mode"]);t!=null&&l(e,["mode"],t);let r=a(n,["allowedFunctionNames"]);if(r!=null&&l(e,["allowedFunctionNames"],r),a(n,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function vM(n){let e={};if(a(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");let t=a(n,["description"]);t!=null&&l(e,["description"],t);let r=a(n,["name"]);r!=null&&l(e,["name"],r);let i=a(n,["parameters"]);i!=null&&l(e,["parameters"],i);let o=a(n,["parametersJsonSchema"]);o!=null&&l(e,["parametersJsonSchema"],o);let s=a(n,["response"]);s!=null&&l(e,["response"],s);let u=a(n,["responseJsonSchema"]);return u!=null&&l(e,["responseJsonSchema"],u),e}function wM(n,e){let t={},r=a(e,["name"]);return r!=null&&l(t,["_url","name"],lr(n,r)),t}function CM(n,e){let t={},r=a(e,["name"]);return r!=null&&l(t,["_url","name"],lr(n,r)),t}function AM(n){let e={};if(a(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=a(n,["enableWidget"]);return t!=null&&l(e,["enableWidget"],t),e}function bM(n){let e={};if(a(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(a(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=a(n,["timeRangeFilter"]);return t!=null&&l(e,["timeRangeFilter"],t),e}function RM(n,e){let t={},r=a(n,["pageSize"]);e!==void 0&&r!=null&&l(e,["_query","pageSize"],r);let i=a(n,["pageToken"]);return e!==void 0&&i!=null&&l(e,["_query","pageToken"],i),t}function IM(n,e){let t={},r=a(n,["pageSize"]);e!==void 0&&r!=null&&l(e,["_query","pageSize"],r);let i=a(n,["pageToken"]);return e!==void 0&&i!=null&&l(e,["_query","pageToken"],i),t}function PM(n){let e={},t=a(n,["config"]);return t!=null&&RM(t,e),e}function xM(n){let e={},t=a(n,["config"]);return t!=null&&IM(t,e),e}function NM(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);let r=a(n,["nextPageToken"]);r!=null&&l(e,["nextPageToken"],r);let i=a(n,["cachedContents"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(s=>s)),l(e,["cachedContents"],o)}return e}function kM(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);let r=a(n,["nextPageToken"]);r!=null&&l(e,["nextPageToken"],r);let i=a(n,["cachedContents"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(s=>s)),l(e,["cachedContents"],o)}return e}function MM(n){let e={},t=a(n,["mediaResolution"]);t!=null&&l(e,["mediaResolution"],t);let r=a(n,["codeExecutionResult"]);r!=null&&l(e,["codeExecutionResult"],r);let i=a(n,["executableCode"]);i!=null&&l(e,["executableCode"],i);let o=a(n,["fileData"]);o!=null&&l(e,["fileData"],EM(o));let s=a(n,["functionCall"]);s!=null&&l(e,["functionCall"],SM(s));let u=a(n,["functionResponse"]);u!=null&&l(e,["functionResponse"],u);let f=a(n,["inlineData"]);f!=null&&l(e,["inlineData"],cM(f));let d=a(n,["text"]);d!=null&&l(e,["text"],d);let h=a(n,["thought"]);h!=null&&l(e,["thought"],h);let m=a(n,["thoughtSignature"]);m!=null&&l(e,["thoughtSignature"],m);let g=a(n,["videoMetadata"]);return g!=null&&l(e,["videoMetadata"],g),e}function DM(n){let e={},t=a(n,["functionCallingConfig"]);t!=null&&l(e,["functionCallingConfig"],TM(t));let r=a(n,["retrievalConfig"]);return r!=null&&l(e,["retrievalConfig"],r),e}function OM(n){let e={},t=a(n,["functionDeclarations"]);if(t!=null){let h=t;Array.isArray(h)&&(h=h.map(m=>m)),l(e,["functionDeclarations"],h)}if(a(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let r=a(n,["googleSearchRetrieval"]);r!=null&&l(e,["googleSearchRetrieval"],r);let i=a(n,["computerUse"]);i!=null&&l(e,["computerUse"],i);let o=a(n,["fileSearch"]);o!=null&&l(e,["fileSearch"],o);let s=a(n,["codeExecution"]);if(s!=null&&l(e,["codeExecution"],s),a(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let u=a(n,["googleMaps"]);u!=null&&l(e,["googleMaps"],AM(u));let f=a(n,["googleSearch"]);f!=null&&l(e,["googleSearch"],bM(f));let d=a(n,["urlContext"]);return d!=null&&l(e,["urlContext"],d),e}function UM(n){let e={},t=a(n,["functionDeclarations"]);if(t!=null){let m=t;Array.isArray(m)&&(m=m.map(g=>vM(g))),l(e,["functionDeclarations"],m)}let r=a(n,["retrieval"]);r!=null&&l(e,["retrieval"],r);let i=a(n,["googleSearchRetrieval"]);i!=null&&l(e,["googleSearchRetrieval"],i);let o=a(n,["computerUse"]);if(o!=null&&l(e,["computerUse"],o),a(n,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let s=a(n,["codeExecution"]);s!=null&&l(e,["codeExecution"],s);let u=a(n,["enterpriseWebSearch"]);u!=null&&l(e,["enterpriseWebSearch"],u);let f=a(n,["googleMaps"]);f!=null&&l(e,["googleMaps"],f);let d=a(n,["googleSearch"]);d!=null&&l(e,["googleSearch"],d);let h=a(n,["urlContext"]);return h!=null&&l(e,["urlContext"],h),e}function FM(n,e){let t={},r=a(n,["ttl"]);e!==void 0&&r!=null&&l(e,["ttl"],r);let i=a(n,["expireTime"]);return e!==void 0&&i!=null&&l(e,["expireTime"],i),t}function LM(n,e){let t={},r=a(n,["ttl"]);e!==void 0&&r!=null&&l(e,["ttl"],r);let i=a(n,["expireTime"]);return e!==void 0&&i!=null&&l(e,["expireTime"],i),t}function qM(n,e){let t={},r=a(e,["name"]);r!=null&&l(t,["_url","name"],lr(n,r));let i=a(e,["config"]);return i!=null&&FM(i,t),t}function BM(n,e){let t={},r=a(e,["name"]);r!=null&&l(t,["_url","name"],lr(n,r));let i=a(e,["config"]);return i!=null&&LM(i,t),t}var jh=class extends _n{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new ar(sr.PAGED_ITEM_CACHED_CONTENTS,r=>this.listInternal(r),await this.listInternal(t),t)}async create(e){var t,r,i,o;let s,u="",f={};if(this.apiClient.isVertexAI()){let d=pM(this.apiClient,e);return u=ne("cachedContents",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>h)}else{let d=hM(this.apiClient,e);return u=ne("cachedContents",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(h=>h)}}async get(e){var t,r,i,o;let s,u="",f={};if(this.apiClient.isVertexAI()){let d=CM(this.apiClient,e);return u=ne("{name}",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>h)}else{let d=wM(this.apiClient,e);return u=ne("{name}",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(h=>h)}}async delete(e){var t,r,i,o;let s,u="",f={};if(this.apiClient.isVertexAI()){let d=gM(this.apiClient,e);return u=ne("{name}",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),s.then(h=>{let m=_M(h),g=new vu;return Object.assign(g,m),g})}else{let d=mM(this.apiClient,e);return u=ne("{name}",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),s.then(h=>{let m=yM(h),g=new vu;return Object.assign(g,m),g})}}async update(e){var t,r,i,o;let s,u="",f={};if(this.apiClient.isVertexAI()){let d=BM(this.apiClient,e);return u=ne("{name}",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>h)}else{let d=qM(this.apiClient,e);return u=ne("{name}",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(h=>h)}}async listInternal(e){var t,r,i,o;let s,u="",f={};if(this.apiClient.isVertexAI()){let d=xM(e);return u=ne("cachedContents",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),s.then(h=>{let m=kM(h),g=new wu;return Object.assign(g,m),g})}else{let d=PM(e);return u=ne("cachedContents",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),s.then(h=>{let m=NM(h),g=new wu;return Object.assign(g,m),g})}}};function Uv(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function De(n){return this instanceof De?(this.v=n,this):new De(n)}function Ro(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),i,o=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),u("next"),u("throw"),u("return",s),i[Symbol.asyncIterator]=function(){return this},i;function s(_){return function(v){return Promise.resolve(v).then(_,m)}}function u(_,v){r[_]&&(i[_]=function(C){return new Promise(function(R,I){o.push([_,C,R,I])>1||f(_,C)})},v&&(i[_]=v(i[_])))}function f(_,v){try{d(r[_](v))}catch(C){g(o[0][3],C)}}function d(_){_.value instanceof De?Promise.resolve(_.value.v).then(h,m):g(o[0][2],_)}function h(_){f("next",_)}function m(_){f("throw",_)}function g(_,v){_(v),o.shift(),o.length&&f(o[0][0],o[0][1])}}function zs(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof Uv=="function"?Uv(n):n[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(o){t[o]=n[o]&&function(s){return new Promise(function(u,f){s=n[o](s),i(u,f,s.done,s.value)})}}function i(o,s,u,f){Promise.resolve(f).then(function(d){o({value:d,done:u})},s)}}function GM(n){var e;if(n.candidates==null||n.candidates.length===0)return!1;let t=(e=n.candidates[0])===null||e===void 0?void 0:e.content;return t===void 0?!1:mw(t)}function mw(n){if(n.parts===void 0||n.parts.length===0)return!1;for(let e of n.parts)if(e===void 0||Object.keys(e).length===0)return!1;return!0}function HM(n){if(n.length!==0){for(let e of n)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function Fv(n){if(n===void 0||n.length===0)return[];let e=[],t=n.length,r=0;for(;r<t;)if(n[r].role==="user")e.push(n[r]),r++;else{let i=[],o=!0;for(;r<t&&n[r].role==="model";)i.push(n[r]),o&&!mw(n[r])&&(o=!1),r++;o?e.push(...i):e.pop()}return e}var ep=class{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new tp(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}},tp=class{constructor(e,t,r,i={},o=[]){this.apiClient=e,this.modelsModule=t,this.model=r,this.config=i,this.history=o,this.sendPromise=Promise.resolve(),HM(o)}async sendMessage(e){var t;await this.sendPromise;let r=ot(e.message),i=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(r),config:(t=e.config)!==null&&t!==void 0?t:this.config});return this.sendPromise=(async()=>{var o,s,u;let f=await i,d=(s=(o=f.candidates)===null||o===void 0?void 0:o[0])===null||s===void 0?void 0:s.content,h=f.automaticFunctionCallingHistory,m=this.getHistory(!0).length,g=[];h!=null&&(g=(u=h.slice(m))!==null&&u!==void 0?u:[]);let _=d?[d]:[];this.recordHistory(r,_,g)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),i}async sendMessageStream(e){var t;await this.sendPromise;let r=ot(e.message),i=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(r),config:(t=e.config)!==null&&t!==void 0?t:this.config});this.sendPromise=i.then(()=>{}).catch(()=>{});let o=await i;return this.processStreamResponse(o,r)}getHistory(e=!1){let t=e?Fv(this.history):this.history;return structuredClone(t)}processStreamResponse(e,t){return Ro(this,arguments,function*(){var i,o,s,u,f,d;let h=[];try{for(var m=!0,g=zs(e),_;_=yield De(g.next()),i=_.done,!i;m=!0){u=_.value,m=!1;let v=u;if(GM(v)){let C=(d=(f=v.candidates)===null||f===void 0?void 0:f[0])===null||d===void 0?void 0:d.content;C!==void 0&&h.push(C)}yield yield De(v)}}catch(v){o={error:v}}finally{try{!m&&!i&&(s=g.return)&&(yield De(s.call(g)))}finally{if(o)throw o.error}}this.recordHistory(t,h)})}recordHistory(e,t,r){let i=[];t.length>0&&t.every(o=>o.role!==void 0)?i=t:i.push({role:"model",parts:[]}),r&&r.length>0?this.history.push(...Fv(r)):this.history.push(e),this.history.push(...i)}};var Ru=class n extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,n.prototype)}};function VM(n){let e={},t=a(n,["file"]);return t!=null&&l(e,["file"],t),e}function $M(n){let e={},t=a(n,["sdkHttpResponse"]);return t!=null&&l(e,["sdkHttpResponse"],t),e}function WM(n){let e={},t=a(n,["name"]);return t!=null&&l(e,["_url","file"],xp(t)),e}function zM(n){let e={},t=a(n,["sdkHttpResponse"]);return t!=null&&l(e,["sdkHttpResponse"],t),e}function JM(n){let e={},t=a(n,["name"]);return t!=null&&l(e,["_url","file"],xp(t)),e}function KM(n,e){let t={},r=a(n,["pageSize"]);e!==void 0&&r!=null&&l(e,["_query","pageSize"],r);let i=a(n,["pageToken"]);return e!==void 0&&i!=null&&l(e,["_query","pageToken"],i),t}function YM(n){let e={},t=a(n,["config"]);return t!=null&&KM(t,e),e}function XM(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);let r=a(n,["nextPageToken"]);r!=null&&l(e,["nextPageToken"],r);let i=a(n,["files"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(s=>s)),l(e,["files"],o)}return e}var np=class extends _n{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new ar(sr.PAGED_ITEM_FILES,r=>this.listInternal(r),await this.listInternal(t),t)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(t=>t)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var t,r;let i,o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let u=YM(e);return o=ne("files",u._url),s=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(d=>{let h=d;return h.sdkHttpResponse={headers:f.headers},h})),i.then(f=>{let d=XM(f),h=new Wh;return Object.assign(h,d),h})}}async createInternal(e){var t,r;let i,o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let u=VM(e);return o=ne("upload/v1beta/files",u._url),s=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i.then(f=>{let d=$M(f),h=new zh;return Object.assign(h,d),h})}}async get(e){var t,r;let i,o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let u=JM(e);return o=ne("files/{file}",u._url),s=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i.then(f=>f)}}async delete(e){var t,r;let i,o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let u=WM(e);return o=ne("files/{file}",u._url),s=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(d=>{let h=d;return h.sdkHttpResponse={headers:f.headers},h})),i.then(f=>{let d=zM(f),h=new Jh;return Object.assign(h,d),h})}}};function du(n){let e={},t=a(n,["data"]);if(t!=null&&l(e,["data"],t),a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let r=a(n,["mimeType"]);return r!=null&&l(e,["mimeType"],r),e}function QM(n){let e={},t=a(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>hD(o))),l(e,["parts"],i)}let r=a(n,["role"]);return r!=null&&l(e,["role"],r),e}function ZM(n){let e={};if(a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=a(n,["fileUri"]);t!=null&&l(e,["fileUri"],t);let r=a(n,["mimeType"]);return r!=null&&l(e,["mimeType"],r),e}function jM(n){let e={},t=a(n,["id"]);t!=null&&l(e,["id"],t);let r=a(n,["args"]);r!=null&&l(e,["args"],r);let i=a(n,["name"]);if(i!=null&&l(e,["name"],i),a(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(a(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function eD(n){let e={};if(a(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");let t=a(n,["description"]);t!=null&&l(e,["description"],t);let r=a(n,["name"]);r!=null&&l(e,["name"],r);let i=a(n,["parameters"]);i!=null&&l(e,["parameters"],i);let o=a(n,["parametersJsonSchema"]);o!=null&&l(e,["parametersJsonSchema"],o);let s=a(n,["response"]);s!=null&&l(e,["response"],s);let u=a(n,["responseJsonSchema"]);return u!=null&&l(e,["responseJsonSchema"],u),e}function tD(n){let e={},t=a(n,["modelSelectionConfig"]);t!=null&&l(e,["modelConfig"],t);let r=a(n,["responseJsonSchema"]);r!=null&&l(e,["responseJsonSchema"],r);let i=a(n,["audioTimestamp"]);i!=null&&l(e,["audioTimestamp"],i);let o=a(n,["candidateCount"]);o!=null&&l(e,["candidateCount"],o);let s=a(n,["enableAffectiveDialog"]);s!=null&&l(e,["enableAffectiveDialog"],s);let u=a(n,["frequencyPenalty"]);u!=null&&l(e,["frequencyPenalty"],u);let f=a(n,["logprobs"]);f!=null&&l(e,["logprobs"],f);let d=a(n,["maxOutputTokens"]);d!=null&&l(e,["maxOutputTokens"],d);let h=a(n,["mediaResolution"]);h!=null&&l(e,["mediaResolution"],h);let m=a(n,["presencePenalty"]);m!=null&&l(e,["presencePenalty"],m);let g=a(n,["responseLogprobs"]);g!=null&&l(e,["responseLogprobs"],g);let _=a(n,["responseMimeType"]);_!=null&&l(e,["responseMimeType"],_);let v=a(n,["responseModalities"]);v!=null&&l(e,["responseModalities"],v);let C=a(n,["responseSchema"]);C!=null&&l(e,["responseSchema"],C);let R=a(n,["routingConfig"]);R!=null&&l(e,["routingConfig"],R);let I=a(n,["seed"]);I!=null&&l(e,["seed"],I);let z=a(n,["speechConfig"]);z!=null&&l(e,["speechConfig"],gw(z));let $=a(n,["stopSequences"]);$!=null&&l(e,["stopSequences"],$);let W=a(n,["temperature"]);W!=null&&l(e,["temperature"],W);let H=a(n,["thinkingConfig"]);H!=null&&l(e,["thinkingConfig"],H);let G=a(n,["topK"]);G!=null&&l(e,["topK"],G);let K=a(n,["topP"]);if(K!=null&&l(e,["topP"],K),a(n,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function nD(n){let e={};if(a(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=a(n,["enableWidget"]);return t!=null&&l(e,["enableWidget"],t),e}function rD(n){let e={};if(a(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(a(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=a(n,["timeRangeFilter"]);return t!=null&&l(e,["timeRangeFilter"],t),e}function iD(n,e){let t={},r=a(n,["generationConfig"]);e!==void 0&&r!=null&&l(e,["setup","generationConfig"],r);let i=a(n,["responseModalities"]);e!==void 0&&i!=null&&l(e,["setup","generationConfig","responseModalities"],i);let o=a(n,["temperature"]);e!==void 0&&o!=null&&l(e,["setup","generationConfig","temperature"],o);let s=a(n,["topP"]);e!==void 0&&s!=null&&l(e,["setup","generationConfig","topP"],s);let u=a(n,["topK"]);e!==void 0&&u!=null&&l(e,["setup","generationConfig","topK"],u);let f=a(n,["maxOutputTokens"]);e!==void 0&&f!=null&&l(e,["setup","generationConfig","maxOutputTokens"],f);let d=a(n,["mediaResolution"]);e!==void 0&&d!=null&&l(e,["setup","generationConfig","mediaResolution"],d);let h=a(n,["seed"]);e!==void 0&&h!=null&&l(e,["setup","generationConfig","seed"],h);let m=a(n,["speechConfig"]);e!==void 0&&m!=null&&l(e,["setup","generationConfig","speechConfig"],Pp(m));let g=a(n,["thinkingConfig"]);e!==void 0&&g!=null&&l(e,["setup","generationConfig","thinkingConfig"],g);let _=a(n,["enableAffectiveDialog"]);e!==void 0&&_!=null&&l(e,["setup","generationConfig","enableAffectiveDialog"],_);let v=a(n,["systemInstruction"]);e!==void 0&&v!=null&&l(e,["setup","systemInstruction"],QM(ot(v)));let C=a(n,["tools"]);if(e!==void 0&&C!=null){let G=xo(C);Array.isArray(G)&&(G=G.map(K=>mD(Po(K)))),l(e,["setup","tools"],G)}let R=a(n,["sessionResumption"]);e!==void 0&&R!=null&&l(e,["setup","sessionResumption"],pD(R));let I=a(n,["inputAudioTranscription"]);e!==void 0&&I!=null&&l(e,["setup","inputAudioTranscription"],I);let z=a(n,["outputAudioTranscription"]);e!==void 0&&z!=null&&l(e,["setup","outputAudioTranscription"],z);let $=a(n,["realtimeInputConfig"]);e!==void 0&&$!=null&&l(e,["setup","realtimeInputConfig"],$);let W=a(n,["contextWindowCompression"]);e!==void 0&&W!=null&&l(e,["setup","contextWindowCompression"],W);let H=a(n,["proactivity"]);return e!==void 0&&H!=null&&l(e,["setup","proactivity"],H),t}function oD(n,e){let t={},r=a(n,["generationConfig"]);e!==void 0&&r!=null&&l(e,["setup","generationConfig"],tD(r));let i=a(n,["responseModalities"]);e!==void 0&&i!=null&&l(e,["setup","generationConfig","responseModalities"],i);let o=a(n,["temperature"]);e!==void 0&&o!=null&&l(e,["setup","generationConfig","temperature"],o);let s=a(n,["topP"]);e!==void 0&&s!=null&&l(e,["setup","generationConfig","topP"],s);let u=a(n,["topK"]);e!==void 0&&u!=null&&l(e,["setup","generationConfig","topK"],u);let f=a(n,["maxOutputTokens"]);e!==void 0&&f!=null&&l(e,["setup","generationConfig","maxOutputTokens"],f);let d=a(n,["mediaResolution"]);e!==void 0&&d!=null&&l(e,["setup","generationConfig","mediaResolution"],d);let h=a(n,["seed"]);e!==void 0&&h!=null&&l(e,["setup","generationConfig","seed"],h);let m=a(n,["speechConfig"]);e!==void 0&&m!=null&&l(e,["setup","generationConfig","speechConfig"],gw(Pp(m)));let g=a(n,["thinkingConfig"]);e!==void 0&&g!=null&&l(e,["setup","generationConfig","thinkingConfig"],g);let _=a(n,["enableAffectiveDialog"]);e!==void 0&&_!=null&&l(e,["setup","generationConfig","enableAffectiveDialog"],_);let v=a(n,["systemInstruction"]);e!==void 0&&v!=null&&l(e,["setup","systemInstruction"],ot(v));let C=a(n,["tools"]);if(e!==void 0&&C!=null){let G=xo(C);Array.isArray(G)&&(G=G.map(K=>gD(Po(K)))),l(e,["setup","tools"],G)}let R=a(n,["sessionResumption"]);e!==void 0&&R!=null&&l(e,["setup","sessionResumption"],R);let I=a(n,["inputAudioTranscription"]);e!==void 0&&I!=null&&l(e,["setup","inputAudioTranscription"],I);let z=a(n,["outputAudioTranscription"]);e!==void 0&&z!=null&&l(e,["setup","outputAudioTranscription"],z);let $=a(n,["realtimeInputConfig"]);e!==void 0&&$!=null&&l(e,["setup","realtimeInputConfig"],$);let W=a(n,["contextWindowCompression"]);e!==void 0&&W!=null&&l(e,["setup","contextWindowCompression"],W);let H=a(n,["proactivity"]);return e!==void 0&&H!=null&&l(e,["setup","proactivity"],H),t}function sD(n,e){let t={},r=a(e,["model"]);r!=null&&l(t,["setup","model"],Ce(n,r));let i=a(e,["config"]);return i!=null&&l(t,["config"],iD(i,t)),t}function aD(n,e){let t={},r=a(e,["model"]);r!=null&&l(t,["setup","model"],Ce(n,r));let i=a(e,["config"]);return i!=null&&l(t,["config"],oD(i,t)),t}function lD(n){let e={},t=a(n,["musicGenerationConfig"]);return t!=null&&l(e,["musicGenerationConfig"],t),e}function uD(n){let e={},t=a(n,["weightedPrompts"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(i=>i)),l(e,["weightedPrompts"],r)}return e}function cD(n){let e={},t=a(n,["media"]);if(t!=null){let d=nw(t);Array.isArray(d)&&(d=d.map(h=>du(h))),l(e,["mediaChunks"],d)}let r=a(n,["audio"]);r!=null&&l(e,["audio"],du(iw(r)));let i=a(n,["audioStreamEnd"]);i!=null&&l(e,["audioStreamEnd"],i);let o=a(n,["video"]);o!=null&&l(e,["video"],du(rw(o)));let s=a(n,["text"]);s!=null&&l(e,["text"],s);let u=a(n,["activityStart"]);u!=null&&l(e,["activityStart"],u);let f=a(n,["activityEnd"]);return f!=null&&l(e,["activityEnd"],f),e}function fD(n){let e={},t=a(n,["media"]);if(t!=null){let d=nw(t);Array.isArray(d)&&(d=d.map(h=>h)),l(e,["mediaChunks"],d)}let r=a(n,["audio"]);r!=null&&l(e,["audio"],iw(r));let i=a(n,["audioStreamEnd"]);i!=null&&l(e,["audioStreamEnd"],i);let o=a(n,["video"]);o!=null&&l(e,["video"],rw(o));let s=a(n,["text"]);s!=null&&l(e,["text"],s);let u=a(n,["activityStart"]);u!=null&&l(e,["activityStart"],u);let f=a(n,["activityEnd"]);return f!=null&&l(e,["activityEnd"],f),e}function dD(n){let e={},t=a(n,["setupComplete"]);t!=null&&l(e,["setupComplete"],t);let r=a(n,["serverContent"]);r!=null&&l(e,["serverContent"],r);let i=a(n,["toolCall"]);i!=null&&l(e,["toolCall"],i);let o=a(n,["toolCallCancellation"]);o!=null&&l(e,["toolCallCancellation"],o);let s=a(n,["usageMetadata"]);s!=null&&l(e,["usageMetadata"],yD(s));let u=a(n,["goAway"]);u!=null&&l(e,["goAway"],u);let f=a(n,["sessionResumptionUpdate"]);return f!=null&&l(e,["sessionResumptionUpdate"],f),e}function hD(n){let e={},t=a(n,["mediaResolution"]);t!=null&&l(e,["mediaResolution"],t);let r=a(n,["codeExecutionResult"]);r!=null&&l(e,["codeExecutionResult"],r);let i=a(n,["executableCode"]);i!=null&&l(e,["executableCode"],i);let o=a(n,["fileData"]);o!=null&&l(e,["fileData"],ZM(o));let s=a(n,["functionCall"]);s!=null&&l(e,["functionCall"],jM(s));let u=a(n,["functionResponse"]);u!=null&&l(e,["functionResponse"],u);let f=a(n,["inlineData"]);f!=null&&l(e,["inlineData"],du(f));let d=a(n,["text"]);d!=null&&l(e,["text"],d);let h=a(n,["thought"]);h!=null&&l(e,["thought"],h);let m=a(n,["thoughtSignature"]);m!=null&&l(e,["thoughtSignature"],m);let g=a(n,["videoMetadata"]);return g!=null&&l(e,["videoMetadata"],g),e}function pD(n){let e={},t=a(n,["handle"]);if(t!=null&&l(e,["handle"],t),a(n,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function gw(n){let e={},t=a(n,["voiceConfig"]);t!=null&&l(e,["voiceConfig"],t);let r=a(n,["languageCode"]);if(r!=null&&l(e,["languageCode"],r),a(n,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");return e}function mD(n){let e={},t=a(n,["functionDeclarations"]);if(t!=null){let h=t;Array.isArray(h)&&(h=h.map(m=>m)),l(e,["functionDeclarations"],h)}if(a(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let r=a(n,["googleSearchRetrieval"]);r!=null&&l(e,["googleSearchRetrieval"],r);let i=a(n,["computerUse"]);i!=null&&l(e,["computerUse"],i);let o=a(n,["fileSearch"]);o!=null&&l(e,["fileSearch"],o);let s=a(n,["codeExecution"]);if(s!=null&&l(e,["codeExecution"],s),a(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let u=a(n,["googleMaps"]);u!=null&&l(e,["googleMaps"],nD(u));let f=a(n,["googleSearch"]);f!=null&&l(e,["googleSearch"],rD(f));let d=a(n,["urlContext"]);return d!=null&&l(e,["urlContext"],d),e}function gD(n){let e={},t=a(n,["functionDeclarations"]);if(t!=null){let m=t;Array.isArray(m)&&(m=m.map(g=>eD(g))),l(e,["functionDeclarations"],m)}let r=a(n,["retrieval"]);r!=null&&l(e,["retrieval"],r);let i=a(n,["googleSearchRetrieval"]);i!=null&&l(e,["googleSearchRetrieval"],i);let o=a(n,["computerUse"]);if(o!=null&&l(e,["computerUse"],o),a(n,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let s=a(n,["codeExecution"]);s!=null&&l(e,["codeExecution"],s);let u=a(n,["enterpriseWebSearch"]);u!=null&&l(e,["enterpriseWebSearch"],u);let f=a(n,["googleMaps"]);f!=null&&l(e,["googleMaps"],f);let d=a(n,["googleSearch"]);d!=null&&l(e,["googleSearch"],d);let h=a(n,["urlContext"]);return h!=null&&l(e,["urlContext"],h),e}function yD(n){let e={},t=a(n,["promptTokenCount"]);t!=null&&l(e,["promptTokenCount"],t);let r=a(n,["cachedContentTokenCount"]);r!=null&&l(e,["cachedContentTokenCount"],r);let i=a(n,["candidatesTokenCount"]);i!=null&&l(e,["responseTokenCount"],i);let o=a(n,["toolUsePromptTokenCount"]);o!=null&&l(e,["toolUsePromptTokenCount"],o);let s=a(n,["thoughtsTokenCount"]);s!=null&&l(e,["thoughtsTokenCount"],s);let u=a(n,["totalTokenCount"]);u!=null&&l(e,["totalTokenCount"],u);let f=a(n,["promptTokensDetails"]);if(f!=null){let _=f;Array.isArray(_)&&(_=_.map(v=>v)),l(e,["promptTokensDetails"],_)}let d=a(n,["cacheTokensDetails"]);if(d!=null){let _=d;Array.isArray(_)&&(_=_.map(v=>v)),l(e,["cacheTokensDetails"],_)}let h=a(n,["candidatesTokensDetails"]);if(h!=null){let _=h;Array.isArray(_)&&(_=_.map(v=>v)),l(e,["responseTokensDetails"],_)}let m=a(n,["toolUsePromptTokensDetails"]);if(m!=null){let _=m;Array.isArray(_)&&(_=_.map(v=>v)),l(e,["toolUsePromptTokensDetails"],_)}let g=a(n,["trafficType"]);return g!=null&&l(e,["trafficType"],g),e}function _D(n){let e={},t=a(n,["data"]);if(t!=null&&l(e,["data"],t),a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let r=a(n,["mimeType"]);return r!=null&&l(e,["mimeType"],r),e}function ED(n){let e={},t=a(n,["content"]);t!=null&&l(e,["content"],t);let r=a(n,["citationMetadata"]);r!=null&&l(e,["citationMetadata"],SD(r));let i=a(n,["tokenCount"]);i!=null&&l(e,["tokenCount"],i);let o=a(n,["finishReason"]);o!=null&&l(e,["finishReason"],o);let s=a(n,["avgLogprobs"]);s!=null&&l(e,["avgLogprobs"],s);let u=a(n,["groundingMetadata"]);u!=null&&l(e,["groundingMetadata"],u);let f=a(n,["index"]);f!=null&&l(e,["index"],f);let d=a(n,["logprobsResult"]);d!=null&&l(e,["logprobsResult"],d);let h=a(n,["safetyRatings"]);if(h!=null){let g=h;Array.isArray(g)&&(g=g.map(_=>_)),l(e,["safetyRatings"],g)}let m=a(n,["urlContextMetadata"]);return m!=null&&l(e,["urlContextMetadata"],m),e}function SD(n){let e={},t=a(n,["citationSources"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(i=>i)),l(e,["citations"],r)}return e}function TD(n,e){let t={},r=a(e,["model"]);r!=null&&l(t,["_url","model"],Ce(n,r));let i=a(e,["contents"]);if(i!=null){let o=en(i);Array.isArray(o)&&(o=o.map(s=>s)),l(t,["contents"],o)}return t}function vD(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);let r=a(n,["tokensInfo"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(o=>o)),l(e,["tokensInfo"],i)}return e}function wD(n){let e={},t=a(n,["values"]);t!=null&&l(e,["values"],t);let r=a(n,["statistics"]);return r!=null&&l(e,["statistics"],CD(r)),e}function CD(n){let e={},t=a(n,["truncated"]);t!=null&&l(e,["truncated"],t);let r=a(n,["token_count"]);return r!=null&&l(e,["tokenCount"],r),e}function xu(n){let e={},t=a(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>MO(o))),l(e,["parts"],i)}let r=a(n,["role"]);return r!=null&&l(e,["role"],r),e}function AD(n){let e={},t=a(n,["controlType"]);t!=null&&l(e,["controlType"],t);let r=a(n,["enableControlImageComputation"]);return r!=null&&l(e,["computeControl"],r),e}function bD(n){let e={};if(a(n,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(a(n,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(a(n,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function RD(n,e){let t={},r=a(n,["systemInstruction"]);e!==void 0&&r!=null&&l(e,["systemInstruction"],ot(r));let i=a(n,["tools"]);if(e!==void 0&&i!=null){let s=i;Array.isArray(s)&&(s=s.map(u=>Tw(u))),l(e,["tools"],s)}let o=a(n,["generationConfig"]);return e!==void 0&&o!=null&&l(e,["generationConfig"],_O(o)),t}function ID(n,e){let t={},r=a(e,["model"]);r!=null&&l(t,["_url","model"],Ce(n,r));let i=a(e,["contents"]);if(i!=null){let s=en(i);Array.isArray(s)&&(s=s.map(u=>xu(u))),l(t,["contents"],s)}let o=a(e,["config"]);return o!=null&&bD(o),t}function PD(n,e){let t={},r=a(e,["model"]);r!=null&&l(t,["_url","model"],Ce(n,r));let i=a(e,["contents"]);if(i!=null){let s=en(i);Array.isArray(s)&&(s=s.map(u=>u)),l(t,["contents"],s)}let o=a(e,["config"]);return o!=null&&RD(o,t),t}function xD(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);let r=a(n,["totalTokens"]);r!=null&&l(e,["totalTokens"],r);let i=a(n,["cachedContentTokenCount"]);return i!=null&&l(e,["cachedContentTokenCount"],i),e}function ND(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);let r=a(n,["totalTokens"]);return r!=null&&l(e,["totalTokens"],r),e}function kD(n,e){let t={},r=a(e,["model"]);return r!=null&&l(t,["_url","name"],Ce(n,r)),t}function MD(n,e){let t={},r=a(e,["model"]);return r!=null&&l(t,["_url","name"],Ce(n,r)),t}function DD(n){let e={},t=a(n,["sdkHttpResponse"]);return t!=null&&l(e,["sdkHttpResponse"],t),e}function OD(n){let e={},t=a(n,["sdkHttpResponse"]);return t!=null&&l(e,["sdkHttpResponse"],t),e}function UD(n,e){let t={},r=a(n,["outputGcsUri"]);e!==void 0&&r!=null&&l(e,["parameters","storageUri"],r);let i=a(n,["negativePrompt"]);e!==void 0&&i!=null&&l(e,["parameters","negativePrompt"],i);let o=a(n,["numberOfImages"]);e!==void 0&&o!=null&&l(e,["parameters","sampleCount"],o);let s=a(n,["aspectRatio"]);e!==void 0&&s!=null&&l(e,["parameters","aspectRatio"],s);let u=a(n,["guidanceScale"]);e!==void 0&&u!=null&&l(e,["parameters","guidanceScale"],u);let f=a(n,["seed"]);e!==void 0&&f!=null&&l(e,["parameters","seed"],f);let d=a(n,["safetyFilterLevel"]);e!==void 0&&d!=null&&l(e,["parameters","safetySetting"],d);let h=a(n,["personGeneration"]);e!==void 0&&h!=null&&l(e,["parameters","personGeneration"],h);let m=a(n,["includeSafetyAttributes"]);e!==void 0&&m!=null&&l(e,["parameters","includeSafetyAttributes"],m);let g=a(n,["includeRaiReason"]);e!==void 0&&g!=null&&l(e,["parameters","includeRaiReason"],g);let _=a(n,["language"]);e!==void 0&&_!=null&&l(e,["parameters","language"],_);let v=a(n,["outputMimeType"]);e!==void 0&&v!=null&&l(e,["parameters","outputOptions","mimeType"],v);let C=a(n,["outputCompressionQuality"]);e!==void 0&&C!=null&&l(e,["parameters","outputOptions","compressionQuality"],C);let R=a(n,["addWatermark"]);e!==void 0&&R!=null&&l(e,["parameters","addWatermark"],R);let I=a(n,["labels"]);e!==void 0&&I!=null&&l(e,["labels"],I);let z=a(n,["editMode"]);e!==void 0&&z!=null&&l(e,["parameters","editMode"],z);let $=a(n,["baseSteps"]);return e!==void 0&&$!=null&&l(e,["parameters","editConfig","baseSteps"],$),t}function FD(n,e){let t={},r=a(e,["model"]);r!=null&&l(t,["_url","model"],Ce(n,r));let i=a(e,["prompt"]);i!=null&&l(t,["instances[0]","prompt"],i);let o=a(e,["referenceImages"]);if(o!=null){let u=o;Array.isArray(u)&&(u=u.map(f=>qO(f))),l(t,["instances[0]","referenceImages"],u)}let s=a(e,["config"]);return s!=null&&UD(s,t),t}function LD(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);let r=a(n,["predictions"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(o=>Nu(o))),l(e,["generatedImages"],i)}return e}function qD(n,e){let t={},r=a(n,["taskType"]);e!==void 0&&r!=null&&l(e,["requests[]","taskType"],r);let i=a(n,["title"]);e!==void 0&&i!=null&&l(e,["requests[]","title"],i);let o=a(n,["outputDimensionality"]);if(e!==void 0&&o!=null&&l(e,["requests[]","outputDimensionality"],o),a(n,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(a(n,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function BD(n,e){let t={},r=a(n,["taskType"]);e!==void 0&&r!=null&&l(e,["instances[]","task_type"],r);let i=a(n,["title"]);e!==void 0&&i!=null&&l(e,["instances[]","title"],i);let o=a(n,["outputDimensionality"]);e!==void 0&&o!=null&&l(e,["parameters","outputDimensionality"],o);let s=a(n,["mimeType"]);e!==void 0&&s!=null&&l(e,["instances[]","mimeType"],s);let u=a(n,["autoTruncate"]);return e!==void 0&&u!=null&&l(e,["parameters","autoTruncate"],u),t}function GD(n,e){let t={},r=a(e,["model"]);r!=null&&l(t,["_url","model"],Ce(n,r));let i=a(e,["contents"]);if(i!=null){let u=bp(n,i);Array.isArray(u)&&(u=u.map(f=>f)),l(t,["requests[]","content"],u)}let o=a(e,["config"]);o!=null&&qD(o,t);let s=a(e,["model"]);return s!==void 0&&l(t,["requests[]","model"],Ce(n,s)),t}function HD(n,e){let t={},r=a(e,["model"]);r!=null&&l(t,["_url","model"],Ce(n,r));let i=a(e,["contents"]);if(i!=null){let s=bp(n,i);Array.isArray(s)&&(s=s.map(u=>u)),l(t,["instances[]","content"],s)}let o=a(e,["config"]);return o!=null&&BD(o,t),t}function VD(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);let r=a(n,["embeddings"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(s=>s)),l(e,["embeddings"],o)}let i=a(n,["metadata"]);return i!=null&&l(e,["metadata"],i),e}function $D(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);let r=a(n,["predictions[]","embeddings"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(s=>wD(s))),l(e,["embeddings"],o)}let i=a(n,["metadata"]);return i!=null&&l(e,["metadata"],i),e}function WD(n){let e={},t=a(n,["endpoint"]);t!=null&&l(e,["name"],t);let r=a(n,["deployedModelId"]);return r!=null&&l(e,["deployedModelId"],r),e}function zD(n){let e={};if(a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=a(n,["fileUri"]);t!=null&&l(e,["fileUri"],t);let r=a(n,["mimeType"]);return r!=null&&l(e,["mimeType"],r),e}function JD(n){let e={},t=a(n,["id"]);t!=null&&l(e,["id"],t);let r=a(n,["args"]);r!=null&&l(e,["args"],r);let i=a(n,["name"]);if(i!=null&&l(e,["name"],i),a(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(a(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function KD(n){let e={},t=a(n,["mode"]);t!=null&&l(e,["mode"],t);let r=a(n,["allowedFunctionNames"]);if(r!=null&&l(e,["allowedFunctionNames"],r),a(n,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function YD(n){let e={};if(a(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");let t=a(n,["description"]);t!=null&&l(e,["description"],t);let r=a(n,["name"]);r!=null&&l(e,["name"],r);let i=a(n,["parameters"]);i!=null&&l(e,["parameters"],i);let o=a(n,["parametersJsonSchema"]);o!=null&&l(e,["parametersJsonSchema"],o);let s=a(n,["response"]);s!=null&&l(e,["response"],s);let u=a(n,["responseJsonSchema"]);return u!=null&&l(e,["responseJsonSchema"],u),e}function XD(n,e,t){let r={},i=a(e,["systemInstruction"]);t!==void 0&&i!=null&&l(t,["systemInstruction"],xu(ot(i)));let o=a(e,["temperature"]);o!=null&&l(r,["temperature"],o);let s=a(e,["topP"]);s!=null&&l(r,["topP"],s);let u=a(e,["topK"]);u!=null&&l(r,["topK"],u);let f=a(e,["candidateCount"]);f!=null&&l(r,["candidateCount"],f);let d=a(e,["maxOutputTokens"]);d!=null&&l(r,["maxOutputTokens"],d);let h=a(e,["stopSequences"]);h!=null&&l(r,["stopSequences"],h);let m=a(e,["responseLogprobs"]);m!=null&&l(r,["responseLogprobs"],m);let g=a(e,["logprobs"]);g!=null&&l(r,["logprobs"],g);let _=a(e,["presencePenalty"]);_!=null&&l(r,["presencePenalty"],_);let v=a(e,["frequencyPenalty"]);v!=null&&l(r,["frequencyPenalty"],v);let C=a(e,["seed"]);C!=null&&l(r,["seed"],C);let R=a(e,["responseMimeType"]);R!=null&&l(r,["responseMimeType"],R);let I=a(e,["responseSchema"]);I!=null&&l(r,["responseSchema"],Rp(I));let z=a(e,["responseJsonSchema"]);if(z!=null&&l(r,["responseJsonSchema"],z),a(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(a(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");let $=a(e,["safetySettings"]);if(t!==void 0&&$!=null){let Z=$;Array.isArray(Z)&&(Z=Z.map(j=>BO(j))),l(t,["safetySettings"],Z)}let W=a(e,["tools"]);if(t!==void 0&&W!=null){let Z=xo(W);Array.isArray(Z)&&(Z=Z.map(j=>JO(Po(j)))),l(t,["tools"],Z)}let H=a(e,["toolConfig"]);if(t!==void 0&&H!=null&&l(t,["toolConfig"],zO(H)),a(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let G=a(e,["cachedContent"]);t!==void 0&&G!=null&&l(t,["cachedContent"],lr(n,G));let K=a(e,["responseModalities"]);K!=null&&l(r,["responseModalities"],K);let te=a(e,["mediaResolution"]);te!=null&&l(r,["mediaResolution"],te);let T=a(e,["speechConfig"]);if(T!=null&&l(r,["speechConfig"],Ip(T)),a(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");let L=a(e,["thinkingConfig"]);L!=null&&l(r,["thinkingConfig"],L);let X=a(e,["imageConfig"]);X!=null&&l(r,["imageConfig"],wO(X));let ee=a(e,["enableEnhancedCivicAnswers"]);return ee!=null&&l(r,["enableEnhancedCivicAnswers"],ee),r}function QD(n,e,t){let r={},i=a(e,["systemInstruction"]);t!==void 0&&i!=null&&l(t,["systemInstruction"],ot(i));let o=a(e,["temperature"]);o!=null&&l(r,["temperature"],o);let s=a(e,["topP"]);s!=null&&l(r,["topP"],s);let u=a(e,["topK"]);u!=null&&l(r,["topK"],u);let f=a(e,["candidateCount"]);f!=null&&l(r,["candidateCount"],f);let d=a(e,["maxOutputTokens"]);d!=null&&l(r,["maxOutputTokens"],d);let h=a(e,["stopSequences"]);h!=null&&l(r,["stopSequences"],h);let m=a(e,["responseLogprobs"]);m!=null&&l(r,["responseLogprobs"],m);let g=a(e,["logprobs"]);g!=null&&l(r,["logprobs"],g);let _=a(e,["presencePenalty"]);_!=null&&l(r,["presencePenalty"],_);let v=a(e,["frequencyPenalty"]);v!=null&&l(r,["frequencyPenalty"],v);let C=a(e,["seed"]);C!=null&&l(r,["seed"],C);let R=a(e,["responseMimeType"]);R!=null&&l(r,["responseMimeType"],R);let I=a(e,["responseSchema"]);I!=null&&l(r,["responseSchema"],Rp(I));let z=a(e,["responseJsonSchema"]);z!=null&&l(r,["responseJsonSchema"],z);let $=a(e,["routingConfig"]);$!=null&&l(r,["routingConfig"],$);let W=a(e,["modelSelectionConfig"]);W!=null&&l(r,["modelConfig"],W);let H=a(e,["safetySettings"]);if(t!==void 0&&H!=null){let _e=H;Array.isArray(_e)&&(_e=_e.map(Re=>Re)),l(t,["safetySettings"],_e)}let G=a(e,["tools"]);if(t!==void 0&&G!=null){let _e=xo(G);Array.isArray(_e)&&(_e=_e.map(Re=>Tw(Po(Re)))),l(t,["tools"],_e)}let K=a(e,["toolConfig"]);t!==void 0&&K!=null&&l(t,["toolConfig"],K);let te=a(e,["labels"]);t!==void 0&&te!=null&&l(t,["labels"],te);let T=a(e,["cachedContent"]);t!==void 0&&T!=null&&l(t,["cachedContent"],lr(n,T));let L=a(e,["responseModalities"]);L!=null&&l(r,["responseModalities"],L);let X=a(e,["mediaResolution"]);X!=null&&l(r,["mediaResolution"],X);let ee=a(e,["speechConfig"]);ee!=null&&l(r,["speechConfig"],Sw(Ip(ee)));let Z=a(e,["audioTimestamp"]);Z!=null&&l(r,["audioTimestamp"],Z);let j=a(e,["thinkingConfig"]);j!=null&&l(r,["thinkingConfig"],j);let we=a(e,["imageConfig"]);if(we!=null&&l(r,["imageConfig"],CO(we)),a(e,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return r}function Lv(n,e){let t={},r=a(e,["model"]);r!=null&&l(t,["_url","model"],Ce(n,r));let i=a(e,["contents"]);if(i!=null){let s=en(i);Array.isArray(s)&&(s=s.map(u=>xu(u))),l(t,["contents"],s)}let o=a(e,["config"]);return o!=null&&l(t,["generationConfig"],XD(n,o,t)),t}function qv(n,e){let t={},r=a(e,["model"]);r!=null&&l(t,["_url","model"],Ce(n,r));let i=a(e,["contents"]);if(i!=null){let s=en(i);Array.isArray(s)&&(s=s.map(u=>u)),l(t,["contents"],s)}let o=a(e,["config"]);return o!=null&&l(t,["generationConfig"],QD(n,o,t)),t}function Bv(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);let r=a(n,["candidates"]);if(r!=null){let f=r;Array.isArray(f)&&(f=f.map(d=>ED(d))),l(e,["candidates"],f)}let i=a(n,["modelVersion"]);i!=null&&l(e,["modelVersion"],i);let o=a(n,["promptFeedback"]);o!=null&&l(e,["promptFeedback"],o);let s=a(n,["responseId"]);s!=null&&l(e,["responseId"],s);let u=a(n,["usageMetadata"]);return u!=null&&l(e,["usageMetadata"],u),e}function Gv(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);let r=a(n,["candidates"]);if(r!=null){let d=r;Array.isArray(d)&&(d=d.map(h=>h)),l(e,["candidates"],d)}let i=a(n,["createTime"]);i!=null&&l(e,["createTime"],i);let o=a(n,["modelVersion"]);o!=null&&l(e,["modelVersion"],o);let s=a(n,["promptFeedback"]);s!=null&&l(e,["promptFeedback"],s);let u=a(n,["responseId"]);u!=null&&l(e,["responseId"],u);let f=a(n,["usageMetadata"]);return f!=null&&l(e,["usageMetadata"],f),e}function ZD(n,e){let t={};if(a(n,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(a(n,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");let r=a(n,["numberOfImages"]);e!==void 0&&r!=null&&l(e,["parameters","sampleCount"],r);let i=a(n,["aspectRatio"]);e!==void 0&&i!=null&&l(e,["parameters","aspectRatio"],i);let o=a(n,["guidanceScale"]);if(e!==void 0&&o!=null&&l(e,["parameters","guidanceScale"],o),a(n,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");let s=a(n,["safetyFilterLevel"]);e!==void 0&&s!=null&&l(e,["parameters","safetySetting"],s);let u=a(n,["personGeneration"]);e!==void 0&&u!=null&&l(e,["parameters","personGeneration"],u);let f=a(n,["includeSafetyAttributes"]);e!==void 0&&f!=null&&l(e,["parameters","includeSafetyAttributes"],f);let d=a(n,["includeRaiReason"]);e!==void 0&&d!=null&&l(e,["parameters","includeRaiReason"],d);let h=a(n,["language"]);e!==void 0&&h!=null&&l(e,["parameters","language"],h);let m=a(n,["outputMimeType"]);e!==void 0&&m!=null&&l(e,["parameters","outputOptions","mimeType"],m);let g=a(n,["outputCompressionQuality"]);if(e!==void 0&&g!=null&&l(e,["parameters","outputOptions","compressionQuality"],g),a(n,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(a(n,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let _=a(n,["imageSize"]);if(e!==void 0&&_!=null&&l(e,["parameters","sampleImageSize"],_),a(n,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return t}function jD(n,e){let t={},r=a(n,["outputGcsUri"]);e!==void 0&&r!=null&&l(e,["parameters","storageUri"],r);let i=a(n,["negativePrompt"]);e!==void 0&&i!=null&&l(e,["parameters","negativePrompt"],i);let o=a(n,["numberOfImages"]);e!==void 0&&o!=null&&l(e,["parameters","sampleCount"],o);let s=a(n,["aspectRatio"]);e!==void 0&&s!=null&&l(e,["parameters","aspectRatio"],s);let u=a(n,["guidanceScale"]);e!==void 0&&u!=null&&l(e,["parameters","guidanceScale"],u);let f=a(n,["seed"]);e!==void 0&&f!=null&&l(e,["parameters","seed"],f);let d=a(n,["safetyFilterLevel"]);e!==void 0&&d!=null&&l(e,["parameters","safetySetting"],d);let h=a(n,["personGeneration"]);e!==void 0&&h!=null&&l(e,["parameters","personGeneration"],h);let m=a(n,["includeSafetyAttributes"]);e!==void 0&&m!=null&&l(e,["parameters","includeSafetyAttributes"],m);let g=a(n,["includeRaiReason"]);e!==void 0&&g!=null&&l(e,["parameters","includeRaiReason"],g);let _=a(n,["language"]);e!==void 0&&_!=null&&l(e,["parameters","language"],_);let v=a(n,["outputMimeType"]);e!==void 0&&v!=null&&l(e,["parameters","outputOptions","mimeType"],v);let C=a(n,["outputCompressionQuality"]);e!==void 0&&C!=null&&l(e,["parameters","outputOptions","compressionQuality"],C);let R=a(n,["addWatermark"]);e!==void 0&&R!=null&&l(e,["parameters","addWatermark"],R);let I=a(n,["labels"]);e!==void 0&&I!=null&&l(e,["labels"],I);let z=a(n,["imageSize"]);e!==void 0&&z!=null&&l(e,["parameters","sampleImageSize"],z);let $=a(n,["enhancePrompt"]);return e!==void 0&&$!=null&&l(e,["parameters","enhancePrompt"],$),t}function eO(n,e){let t={},r=a(e,["model"]);r!=null&&l(t,["_url","model"],Ce(n,r));let i=a(e,["prompt"]);i!=null&&l(t,["instances[0]","prompt"],i);let o=a(e,["config"]);return o!=null&&ZD(o,t),t}function tO(n,e){let t={},r=a(e,["model"]);r!=null&&l(t,["_url","model"],Ce(n,r));let i=a(e,["prompt"]);i!=null&&l(t,["instances[0]","prompt"],i);let o=a(e,["config"]);return o!=null&&jD(o,t),t}function nO(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);let r=a(n,["predictions"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(s=>pO(s))),l(e,["generatedImages"],o)}let i=a(n,["positivePromptSafetyAttributes"]);return i!=null&&l(e,["positivePromptSafetyAttributes"],_w(i)),e}function rO(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);let r=a(n,["predictions"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(s=>Nu(s))),l(e,["generatedImages"],o)}let i=a(n,["positivePromptSafetyAttributes"]);return i!=null&&l(e,["positivePromptSafetyAttributes"],Ew(i)),e}function iO(n,e){let t={},r=a(n,["numberOfVideos"]);if(e!==void 0&&r!=null&&l(e,["parameters","sampleCount"],r),a(n,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(a(n,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");let i=a(n,["durationSeconds"]);if(e!==void 0&&i!=null&&l(e,["parameters","durationSeconds"],i),a(n,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");let o=a(n,["aspectRatio"]);e!==void 0&&o!=null&&l(e,["parameters","aspectRatio"],o);let s=a(n,["resolution"]);e!==void 0&&s!=null&&l(e,["parameters","resolution"],s);let u=a(n,["personGeneration"]);if(e!==void 0&&u!=null&&l(e,["parameters","personGeneration"],u),a(n,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");let f=a(n,["negativePrompt"]);e!==void 0&&f!=null&&l(e,["parameters","negativePrompt"],f);let d=a(n,["enhancePrompt"]);if(e!==void 0&&d!=null&&l(e,["parameters","enhancePrompt"],d),a(n,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");let h=a(n,["lastFrame"]);e!==void 0&&h!=null&&l(e,["instances[0]","lastFrame"],ku(h));let m=a(n,["referenceImages"]);if(e!==void 0&&m!=null){let g=m;Array.isArray(g)&&(g=g.map(_=>sU(_))),l(e,["instances[0]","referenceImages"],g)}if(a(n,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(a(n,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return t}function oO(n,e){let t={},r=a(n,["numberOfVideos"]);e!==void 0&&r!=null&&l(e,["parameters","sampleCount"],r);let i=a(n,["outputGcsUri"]);e!==void 0&&i!=null&&l(e,["parameters","storageUri"],i);let o=a(n,["fps"]);e!==void 0&&o!=null&&l(e,["parameters","fps"],o);let s=a(n,["durationSeconds"]);e!==void 0&&s!=null&&l(e,["parameters","durationSeconds"],s);let u=a(n,["seed"]);e!==void 0&&u!=null&&l(e,["parameters","seed"],u);let f=a(n,["aspectRatio"]);e!==void 0&&f!=null&&l(e,["parameters","aspectRatio"],f);let d=a(n,["resolution"]);e!==void 0&&d!=null&&l(e,["parameters","resolution"],d);let h=a(n,["personGeneration"]);e!==void 0&&h!=null&&l(e,["parameters","personGeneration"],h);let m=a(n,["pubsubTopic"]);e!==void 0&&m!=null&&l(e,["parameters","pubsubTopic"],m);let g=a(n,["negativePrompt"]);e!==void 0&&g!=null&&l(e,["parameters","negativePrompt"],g);let _=a(n,["enhancePrompt"]);e!==void 0&&_!=null&&l(e,["parameters","enhancePrompt"],_);let v=a(n,["generateAudio"]);e!==void 0&&v!=null&&l(e,["parameters","generateAudio"],v);let C=a(n,["lastFrame"]);e!==void 0&&C!=null&&l(e,["instances[0]","lastFrame"],En(C));let R=a(n,["referenceImages"]);if(e!==void 0&&R!=null){let $=R;Array.isArray($)&&($=$.map(W=>aU(W))),l(e,["instances[0]","referenceImages"],$)}let I=a(n,["mask"]);e!==void 0&&I!=null&&l(e,["instances[0]","mask"],oU(I));let z=a(n,["compressionQuality"]);return e!==void 0&&z!=null&&l(e,["parameters","compressionQuality"],z),t}function sO(n){let e={},t=a(n,["name"]);t!=null&&l(e,["name"],t);let r=a(n,["metadata"]);r!=null&&l(e,["metadata"],r);let i=a(n,["done"]);i!=null&&l(e,["done"],i);let o=a(n,["error"]);o!=null&&l(e,["error"],o);let s=a(n,["response","generateVideoResponse"]);return s!=null&&l(e,["response"],cO(s)),e}function aO(n){let e={},t=a(n,["name"]);t!=null&&l(e,["name"],t);let r=a(n,["metadata"]);r!=null&&l(e,["metadata"],r);let i=a(n,["done"]);i!=null&&l(e,["done"],i);let o=a(n,["error"]);o!=null&&l(e,["error"],o);let s=a(n,["response"]);return s!=null&&l(e,["response"],fO(s)),e}function lO(n,e){let t={},r=a(e,["model"]);r!=null&&l(t,["_url","model"],Ce(n,r));let i=a(e,["prompt"]);i!=null&&l(t,["instances[0]","prompt"],i);let o=a(e,["image"]);o!=null&&l(t,["instances[0]","image"],ku(o));let s=a(e,["video"]);s!=null&&l(t,["instances[0]","video"],vw(s));let u=a(e,["source"]);u!=null&&dO(u,t);let f=a(e,["config"]);return f!=null&&iO(f,t),t}function uO(n,e){let t={},r=a(e,["model"]);r!=null&&l(t,["_url","model"],Ce(n,r));let i=a(e,["prompt"]);i!=null&&l(t,["instances[0]","prompt"],i);let o=a(e,["image"]);o!=null&&l(t,["instances[0]","image"],En(o));let s=a(e,["video"]);s!=null&&l(t,["instances[0]","video"],ww(s));let u=a(e,["source"]);u!=null&&hO(u,t);let f=a(e,["config"]);return f!=null&&oO(f,t),t}function cO(n){let e={},t=a(n,["generatedSamples"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(s=>gO(s))),l(e,["generatedVideos"],o)}let r=a(n,["raiMediaFilteredCount"]);r!=null&&l(e,["raiMediaFilteredCount"],r);let i=a(n,["raiMediaFilteredReasons"]);return i!=null&&l(e,["raiMediaFilteredReasons"],i),e}function fO(n){let e={},t=a(n,["videos"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(s=>yO(s))),l(e,["generatedVideos"],o)}let r=a(n,["raiMediaFilteredCount"]);r!=null&&l(e,["raiMediaFilteredCount"],r);let i=a(n,["raiMediaFilteredReasons"]);return i!=null&&l(e,["raiMediaFilteredReasons"],i),e}function dO(n,e){let t={},r=a(n,["prompt"]);e!==void 0&&r!=null&&l(e,["instances[0]","prompt"],r);let i=a(n,["image"]);e!==void 0&&i!=null&&l(e,["instances[0]","image"],ku(i));let o=a(n,["video"]);return e!==void 0&&o!=null&&l(e,["instances[0]","video"],vw(o)),t}function hO(n,e){let t={},r=a(n,["prompt"]);e!==void 0&&r!=null&&l(e,["instances[0]","prompt"],r);let i=a(n,["image"]);e!==void 0&&i!=null&&l(e,["instances[0]","image"],En(i));let o=a(n,["video"]);return e!==void 0&&o!=null&&l(e,["instances[0]","video"],ww(o)),t}function pO(n){let e={},t=a(n,["_self"]);t!=null&&l(e,["image"],AO(t));let r=a(n,["raiFilteredReason"]);r!=null&&l(e,["raiFilteredReason"],r);let i=a(n,["_self"]);return i!=null&&l(e,["safetyAttributes"],_w(i)),e}function Nu(n){let e={},t=a(n,["_self"]);t!=null&&l(e,["image"],yw(t));let r=a(n,["raiFilteredReason"]);r!=null&&l(e,["raiFilteredReason"],r);let i=a(n,["_self"]);i!=null&&l(e,["safetyAttributes"],Ew(i));let o=a(n,["prompt"]);return o!=null&&l(e,["enhancedPrompt"],o),e}function mO(n){let e={},t=a(n,["_self"]);t!=null&&l(e,["mask"],yw(t));let r=a(n,["labels"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(o=>o)),l(e,["labels"],i)}return e}function gO(n){let e={},t=a(n,["video"]);return t!=null&&l(e,["video"],rU(t)),e}function yO(n){let e={},t=a(n,["_self"]);return t!=null&&l(e,["video"],iU(t)),e}function _O(n){let e={},t=a(n,["modelSelectionConfig"]);t!=null&&l(e,["modelConfig"],t);let r=a(n,["responseJsonSchema"]);r!=null&&l(e,["responseJsonSchema"],r);let i=a(n,["audioTimestamp"]);i!=null&&l(e,["audioTimestamp"],i);let o=a(n,["candidateCount"]);o!=null&&l(e,["candidateCount"],o);let s=a(n,["enableAffectiveDialog"]);s!=null&&l(e,["enableAffectiveDialog"],s);let u=a(n,["frequencyPenalty"]);u!=null&&l(e,["frequencyPenalty"],u);let f=a(n,["logprobs"]);f!=null&&l(e,["logprobs"],f);let d=a(n,["maxOutputTokens"]);d!=null&&l(e,["maxOutputTokens"],d);let h=a(n,["mediaResolution"]);h!=null&&l(e,["mediaResolution"],h);let m=a(n,["presencePenalty"]);m!=null&&l(e,["presencePenalty"],m);let g=a(n,["responseLogprobs"]);g!=null&&l(e,["responseLogprobs"],g);let _=a(n,["responseMimeType"]);_!=null&&l(e,["responseMimeType"],_);let v=a(n,["responseModalities"]);v!=null&&l(e,["responseModalities"],v);let C=a(n,["responseSchema"]);C!=null&&l(e,["responseSchema"],C);let R=a(n,["routingConfig"]);R!=null&&l(e,["routingConfig"],R);let I=a(n,["seed"]);I!=null&&l(e,["seed"],I);let z=a(n,["speechConfig"]);z!=null&&l(e,["speechConfig"],Sw(z));let $=a(n,["stopSequences"]);$!=null&&l(e,["stopSequences"],$);let W=a(n,["temperature"]);W!=null&&l(e,["temperature"],W);let H=a(n,["thinkingConfig"]);H!=null&&l(e,["thinkingConfig"],H);let G=a(n,["topK"]);G!=null&&l(e,["topK"],G);let K=a(n,["topP"]);if(K!=null&&l(e,["topP"],K),a(n,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function EO(n,e){let t={},r=a(e,["model"]);return r!=null&&l(t,["_url","name"],Ce(n,r)),t}function SO(n,e){let t={},r=a(e,["model"]);return r!=null&&l(t,["_url","name"],Ce(n,r)),t}function TO(n){let e={};if(a(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=a(n,["enableWidget"]);return t!=null&&l(e,["enableWidget"],t),e}function vO(n){let e={};if(a(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(a(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=a(n,["timeRangeFilter"]);return t!=null&&l(e,["timeRangeFilter"],t),e}function wO(n){let e={},t=a(n,["aspectRatio"]);t!=null&&l(e,["aspectRatio"],t);let r=a(n,["imageSize"]);if(r!=null&&l(e,["imageSize"],r),a(n,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(a(n,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function CO(n){let e={},t=a(n,["aspectRatio"]);t!=null&&l(e,["aspectRatio"],t);let r=a(n,["imageSize"]);r!=null&&l(e,["imageSize"],r);let i=a(n,["outputMimeType"]);i!=null&&l(e,["imageOutputOptions","mimeType"],i);let o=a(n,["outputCompressionQuality"]);return o!=null&&l(e,["imageOutputOptions","compressionQuality"],o),e}function AO(n){let e={},t=a(n,["bytesBase64Encoded"]);t!=null&&l(e,["imageBytes"],kr(t));let r=a(n,["mimeType"]);return r!=null&&l(e,["mimeType"],r),e}function yw(n){let e={},t=a(n,["gcsUri"]);t!=null&&l(e,["gcsUri"],t);let r=a(n,["bytesBase64Encoded"]);r!=null&&l(e,["imageBytes"],kr(r));let i=a(n,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function ku(n){let e={};if(a(n,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");let t=a(n,["imageBytes"]);t!=null&&l(e,["bytesBase64Encoded"],kr(t));let r=a(n,["mimeType"]);return r!=null&&l(e,["mimeType"],r),e}function En(n){let e={},t=a(n,["gcsUri"]);t!=null&&l(e,["gcsUri"],t);let r=a(n,["imageBytes"]);r!=null&&l(e,["bytesBase64Encoded"],kr(r));let i=a(n,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function bO(n,e,t){let r={},i=a(e,["pageSize"]);t!==void 0&&i!=null&&l(t,["_query","pageSize"],i);let o=a(e,["pageToken"]);t!==void 0&&o!=null&&l(t,["_query","pageToken"],o);let s=a(e,["filter"]);t!==void 0&&s!=null&&l(t,["_query","filter"],s);let u=a(e,["queryBase"]);return t!==void 0&&u!=null&&l(t,["_url","models_url"],uw(n,u)),r}function RO(n,e,t){let r={},i=a(e,["pageSize"]);t!==void 0&&i!=null&&l(t,["_query","pageSize"],i);let o=a(e,["pageToken"]);t!==void 0&&o!=null&&l(t,["_query","pageToken"],o);let s=a(e,["filter"]);t!==void 0&&s!=null&&l(t,["_query","filter"],s);let u=a(e,["queryBase"]);return t!==void 0&&u!=null&&l(t,["_url","models_url"],uw(n,u)),r}function IO(n,e){let t={},r=a(e,["config"]);return r!=null&&bO(n,r,t),t}function PO(n,e){let t={},r=a(e,["config"]);return r!=null&&RO(n,r,t),t}function xO(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);let r=a(n,["nextPageToken"]);r!=null&&l(e,["nextPageToken"],r);let i=a(n,["_self"]);if(i!=null){let o=cw(i);Array.isArray(o)&&(o=o.map(s=>rp(s))),l(e,["models"],o)}return e}function NO(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);let r=a(n,["nextPageToken"]);r!=null&&l(e,["nextPageToken"],r);let i=a(n,["_self"]);if(i!=null){let o=cw(i);Array.isArray(o)&&(o=o.map(s=>ip(s))),l(e,["models"],o)}return e}function kO(n){let e={},t=a(n,["maskMode"]);t!=null&&l(e,["maskMode"],t);let r=a(n,["segmentationClasses"]);r!=null&&l(e,["maskClasses"],r);let i=a(n,["maskDilation"]);return i!=null&&l(e,["dilation"],i),e}function rp(n){let e={},t=a(n,["name"]);t!=null&&l(e,["name"],t);let r=a(n,["displayName"]);r!=null&&l(e,["displayName"],r);let i=a(n,["description"]);i!=null&&l(e,["description"],i);let o=a(n,["version"]);o!=null&&l(e,["version"],o);let s=a(n,["_self"]);s!=null&&l(e,["tunedModelInfo"],KO(s));let u=a(n,["inputTokenLimit"]);u!=null&&l(e,["inputTokenLimit"],u);let f=a(n,["outputTokenLimit"]);f!=null&&l(e,["outputTokenLimit"],f);let d=a(n,["supportedGenerationMethods"]);d!=null&&l(e,["supportedActions"],d);let h=a(n,["temperature"]);h!=null&&l(e,["temperature"],h);let m=a(n,["maxTemperature"]);m!=null&&l(e,["maxTemperature"],m);let g=a(n,["topP"]);g!=null&&l(e,["topP"],g);let _=a(n,["topK"]);_!=null&&l(e,["topK"],_);let v=a(n,["thinking"]);return v!=null&&l(e,["thinking"],v),e}function ip(n){let e={},t=a(n,["name"]);t!=null&&l(e,["name"],t);let r=a(n,["displayName"]);r!=null&&l(e,["displayName"],r);let i=a(n,["description"]);i!=null&&l(e,["description"],i);let o=a(n,["versionId"]);o!=null&&l(e,["version"],o);let s=a(n,["deployedModels"]);if(s!=null){let m=s;Array.isArray(m)&&(m=m.map(g=>WD(g))),l(e,["endpoints"],m)}let u=a(n,["labels"]);u!=null&&l(e,["labels"],u);let f=a(n,["_self"]);f!=null&&l(e,["tunedModelInfo"],YO(f));let d=a(n,["defaultCheckpointId"]);d!=null&&l(e,["defaultCheckpointId"],d);let h=a(n,["checkpoints"]);if(h!=null){let m=h;Array.isArray(m)&&(m=m.map(g=>g)),l(e,["checkpoints"],m)}return e}function MO(n){let e={},t=a(n,["mediaResolution"]);t!=null&&l(e,["mediaResolution"],t);let r=a(n,["codeExecutionResult"]);r!=null&&l(e,["codeExecutionResult"],r);let i=a(n,["executableCode"]);i!=null&&l(e,["executableCode"],i);let o=a(n,["fileData"]);o!=null&&l(e,["fileData"],zD(o));let s=a(n,["functionCall"]);s!=null&&l(e,["functionCall"],JD(s));let u=a(n,["functionResponse"]);u!=null&&l(e,["functionResponse"],u);let f=a(n,["inlineData"]);f!=null&&l(e,["inlineData"],_D(f));let d=a(n,["text"]);d!=null&&l(e,["text"],d);let h=a(n,["thought"]);h!=null&&l(e,["thought"],h);let m=a(n,["thoughtSignature"]);m!=null&&l(e,["thoughtSignature"],m);let g=a(n,["videoMetadata"]);return g!=null&&l(e,["videoMetadata"],g),e}function DO(n){let e={},t=a(n,["productImage"]);return t!=null&&l(e,["image"],En(t)),e}function OO(n,e){let t={},r=a(n,["numberOfImages"]);e!==void 0&&r!=null&&l(e,["parameters","sampleCount"],r);let i=a(n,["baseSteps"]);e!==void 0&&i!=null&&l(e,["parameters","baseSteps"],i);let o=a(n,["outputGcsUri"]);e!==void 0&&o!=null&&l(e,["parameters","storageUri"],o);let s=a(n,["seed"]);e!==void 0&&s!=null&&l(e,["parameters","seed"],s);let u=a(n,["safetyFilterLevel"]);e!==void 0&&u!=null&&l(e,["parameters","safetySetting"],u);let f=a(n,["personGeneration"]);e!==void 0&&f!=null&&l(e,["parameters","personGeneration"],f);let d=a(n,["addWatermark"]);e!==void 0&&d!=null&&l(e,["parameters","addWatermark"],d);let h=a(n,["outputMimeType"]);e!==void 0&&h!=null&&l(e,["parameters","outputOptions","mimeType"],h);let m=a(n,["outputCompressionQuality"]);e!==void 0&&m!=null&&l(e,["parameters","outputOptions","compressionQuality"],m);let g=a(n,["enhancePrompt"]);e!==void 0&&g!=null&&l(e,["parameters","enhancePrompt"],g);let _=a(n,["labels"]);return e!==void 0&&_!=null&&l(e,["labels"],_),t}function UO(n,e){let t={},r=a(e,["model"]);r!=null&&l(t,["_url","model"],Ce(n,r));let i=a(e,["source"]);i!=null&&LO(i,t);let o=a(e,["config"]);return o!=null&&OO(o,t),t}function FO(n){let e={},t=a(n,["predictions"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(i=>Nu(i))),l(e,["generatedImages"],r)}return e}function LO(n,e){let t={},r=a(n,["prompt"]);e!==void 0&&r!=null&&l(e,["instances[0]","prompt"],r);let i=a(n,["personImage"]);e!==void 0&&i!=null&&l(e,["instances[0]","personImage","image"],En(i));let o=a(n,["productImages"]);if(e!==void 0&&o!=null){let s=o;Array.isArray(s)&&(s=s.map(u=>DO(u))),l(e,["instances[0]","productImages"],s)}return t}function qO(n){let e={},t=a(n,["referenceImage"]);t!=null&&l(e,["referenceImage"],En(t));let r=a(n,["referenceId"]);r!=null&&l(e,["referenceId"],r);let i=a(n,["referenceType"]);i!=null&&l(e,["referenceType"],i);let o=a(n,["maskImageConfig"]);o!=null&&l(e,["maskImageConfig"],kO(o));let s=a(n,["controlImageConfig"]);s!=null&&l(e,["controlImageConfig"],AD(s));let u=a(n,["styleImageConfig"]);u!=null&&l(e,["styleImageConfig"],u);let f=a(n,["subjectImageConfig"]);return f!=null&&l(e,["subjectImageConfig"],f),e}function _w(n){let e={},t=a(n,["safetyAttributes","categories"]);t!=null&&l(e,["categories"],t);let r=a(n,["safetyAttributes","scores"]);r!=null&&l(e,["scores"],r);let i=a(n,["contentType"]);return i!=null&&l(e,["contentType"],i),e}function Ew(n){let e={},t=a(n,["safetyAttributes","categories"]);t!=null&&l(e,["categories"],t);let r=a(n,["safetyAttributes","scores"]);r!=null&&l(e,["scores"],r);let i=a(n,["contentType"]);return i!=null&&l(e,["contentType"],i),e}function BO(n){let e={},t=a(n,["category"]);if(t!=null&&l(e,["category"],t),a(n,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");let r=a(n,["threshold"]);return r!=null&&l(e,["threshold"],r),e}function GO(n){let e={},t=a(n,["image"]);return t!=null&&l(e,["image"],En(t)),e}function HO(n,e){let t={},r=a(n,["mode"]);e!==void 0&&r!=null&&l(e,["parameters","mode"],r);let i=a(n,["maxPredictions"]);e!==void 0&&i!=null&&l(e,["parameters","maxPredictions"],i);let o=a(n,["confidenceThreshold"]);e!==void 0&&o!=null&&l(e,["parameters","confidenceThreshold"],o);let s=a(n,["maskDilation"]);e!==void 0&&s!=null&&l(e,["parameters","maskDilation"],s);let u=a(n,["binaryColorThreshold"]);e!==void 0&&u!=null&&l(e,["parameters","binaryColorThreshold"],u);let f=a(n,["labels"]);return e!==void 0&&f!=null&&l(e,["labels"],f),t}function VO(n,e){let t={},r=a(e,["model"]);r!=null&&l(t,["_url","model"],Ce(n,r));let i=a(e,["source"]);i!=null&&WO(i,t);let o=a(e,["config"]);return o!=null&&HO(o,t),t}function $O(n){let e={},t=a(n,["predictions"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(i=>mO(i))),l(e,["generatedMasks"],r)}return e}function WO(n,e){let t={},r=a(n,["prompt"]);e!==void 0&&r!=null&&l(e,["instances[0]","prompt"],r);let i=a(n,["image"]);e!==void 0&&i!=null&&l(e,["instances[0]","image"],En(i));let o=a(n,["scribbleImage"]);return e!==void 0&&o!=null&&l(e,["instances[0]","scribble"],GO(o)),t}function Sw(n){let e={},t=a(n,["voiceConfig"]);t!=null&&l(e,["voiceConfig"],t);let r=a(n,["languageCode"]);if(r!=null&&l(e,["languageCode"],r),a(n,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");return e}function zO(n){let e={},t=a(n,["functionCallingConfig"]);t!=null&&l(e,["functionCallingConfig"],KD(t));let r=a(n,["retrievalConfig"]);return r!=null&&l(e,["retrievalConfig"],r),e}function JO(n){let e={},t=a(n,["functionDeclarations"]);if(t!=null){let h=t;Array.isArray(h)&&(h=h.map(m=>m)),l(e,["functionDeclarations"],h)}if(a(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let r=a(n,["googleSearchRetrieval"]);r!=null&&l(e,["googleSearchRetrieval"],r);let i=a(n,["computerUse"]);i!=null&&l(e,["computerUse"],i);let o=a(n,["fileSearch"]);o!=null&&l(e,["fileSearch"],o);let s=a(n,["codeExecution"]);if(s!=null&&l(e,["codeExecution"],s),a(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let u=a(n,["googleMaps"]);u!=null&&l(e,["googleMaps"],TO(u));let f=a(n,["googleSearch"]);f!=null&&l(e,["googleSearch"],vO(f));let d=a(n,["urlContext"]);return d!=null&&l(e,["urlContext"],d),e}function Tw(n){let e={},t=a(n,["functionDeclarations"]);if(t!=null){let m=t;Array.isArray(m)&&(m=m.map(g=>YD(g))),l(e,["functionDeclarations"],m)}let r=a(n,["retrieval"]);r!=null&&l(e,["retrieval"],r);let i=a(n,["googleSearchRetrieval"]);i!=null&&l(e,["googleSearchRetrieval"],i);let o=a(n,["computerUse"]);if(o!=null&&l(e,["computerUse"],o),a(n,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let s=a(n,["codeExecution"]);s!=null&&l(e,["codeExecution"],s);let u=a(n,["enterpriseWebSearch"]);u!=null&&l(e,["enterpriseWebSearch"],u);let f=a(n,["googleMaps"]);f!=null&&l(e,["googleMaps"],f);let d=a(n,["googleSearch"]);d!=null&&l(e,["googleSearch"],d);let h=a(n,["urlContext"]);return h!=null&&l(e,["urlContext"],h),e}function KO(n){let e={},t=a(n,["baseModel"]);t!=null&&l(e,["baseModel"],t);let r=a(n,["createTime"]);r!=null&&l(e,["createTime"],r);let i=a(n,["updateTime"]);return i!=null&&l(e,["updateTime"],i),e}function YO(n){let e={},t=a(n,["labels","google-vertex-llm-tuning-base-model-id"]);t!=null&&l(e,["baseModel"],t);let r=a(n,["createTime"]);r!=null&&l(e,["createTime"],r);let i=a(n,["updateTime"]);return i!=null&&l(e,["updateTime"],i),e}function XO(n,e){let t={},r=a(n,["displayName"]);e!==void 0&&r!=null&&l(e,["displayName"],r);let i=a(n,["description"]);e!==void 0&&i!=null&&l(e,["description"],i);let o=a(n,["defaultCheckpointId"]);return e!==void 0&&o!=null&&l(e,["defaultCheckpointId"],o),t}function QO(n,e){let t={},r=a(n,["displayName"]);e!==void 0&&r!=null&&l(e,["displayName"],r);let i=a(n,["description"]);e!==void 0&&i!=null&&l(e,["description"],i);let o=a(n,["defaultCheckpointId"]);return e!==void 0&&o!=null&&l(e,["defaultCheckpointId"],o),t}function ZO(n,e){let t={},r=a(e,["model"]);r!=null&&l(t,["_url","name"],Ce(n,r));let i=a(e,["config"]);return i!=null&&XO(i,t),t}function jO(n,e){let t={},r=a(e,["model"]);r!=null&&l(t,["_url","model"],Ce(n,r));let i=a(e,["config"]);return i!=null&&QO(i,t),t}function eU(n,e){let t={},r=a(n,["outputGcsUri"]);e!==void 0&&r!=null&&l(e,["parameters","storageUri"],r);let i=a(n,["safetyFilterLevel"]);e!==void 0&&i!=null&&l(e,["parameters","safetySetting"],i);let o=a(n,["personGeneration"]);e!==void 0&&o!=null&&l(e,["parameters","personGeneration"],o);let s=a(n,["includeRaiReason"]);e!==void 0&&s!=null&&l(e,["parameters","includeRaiReason"],s);let u=a(n,["outputMimeType"]);e!==void 0&&u!=null&&l(e,["parameters","outputOptions","mimeType"],u);let f=a(n,["outputCompressionQuality"]);e!==void 0&&f!=null&&l(e,["parameters","outputOptions","compressionQuality"],f);let d=a(n,["enhanceInputImage"]);e!==void 0&&d!=null&&l(e,["parameters","upscaleConfig","enhanceInputImage"],d);let h=a(n,["imagePreservationFactor"]);e!==void 0&&h!=null&&l(e,["parameters","upscaleConfig","imagePreservationFactor"],h);let m=a(n,["labels"]);e!==void 0&&m!=null&&l(e,["labels"],m);let g=a(n,["numberOfImages"]);e!==void 0&&g!=null&&l(e,["parameters","sampleCount"],g);let _=a(n,["mode"]);return e!==void 0&&_!=null&&l(e,["parameters","mode"],_),t}function tU(n,e){let t={},r=a(e,["model"]);r!=null&&l(t,["_url","model"],Ce(n,r));let i=a(e,["image"]);i!=null&&l(t,["instances[0]","image"],En(i));let o=a(e,["upscaleFactor"]);o!=null&&l(t,["parameters","upscaleConfig","upscaleFactor"],o);let s=a(e,["config"]);return s!=null&&eU(s,t),t}function nU(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);let r=a(n,["predictions"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(o=>Nu(o))),l(e,["generatedImages"],i)}return e}function rU(n){let e={},t=a(n,["uri"]);t!=null&&l(e,["uri"],t);let r=a(n,["encodedVideo"]);r!=null&&l(e,["videoBytes"],kr(r));let i=a(n,["encoding"]);return i!=null&&l(e,["mimeType"],i),e}function iU(n){let e={},t=a(n,["gcsUri"]);t!=null&&l(e,["uri"],t);let r=a(n,["bytesBase64Encoded"]);r!=null&&l(e,["videoBytes"],kr(r));let i=a(n,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function oU(n){let e={},t=a(n,["image"]);t!=null&&l(e,["_self"],En(t));let r=a(n,["maskMode"]);return r!=null&&l(e,["maskMode"],r),e}function sU(n){let e={},t=a(n,["image"]);t!=null&&l(e,["image"],ku(t));let r=a(n,["referenceType"]);return r!=null&&l(e,["referenceType"],r),e}function aU(n){let e={},t=a(n,["image"]);t!=null&&l(e,["image"],En(t));let r=a(n,["referenceType"]);return r!=null&&l(e,["referenceType"],r),e}function vw(n){let e={},t=a(n,["uri"]);t!=null&&l(e,["uri"],t);let r=a(n,["videoBytes"]);r!=null&&l(e,["encodedVideo"],kr(r));let i=a(n,["mimeType"]);return i!=null&&l(e,["encoding"],i),e}function ww(n){let e={},t=a(n,["uri"]);t!=null&&l(e,["gcsUri"],t);let r=a(n,["videoBytes"]);r!=null&&l(e,["bytesBase64Encoded"],kr(r));let i=a(n,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function lU(n,e){let t={},r=a(n,["displayName"]);return e!==void 0&&r!=null&&l(e,["displayName"],r),t}function uU(n){let e={},t=a(n,["config"]);return t!=null&&lU(t,e),e}function cU(n,e){let t={},r=a(n,["force"]);return e!==void 0&&r!=null&&l(e,["_query","force"],r),t}function fU(n){let e={},t=a(n,["name"]);t!=null&&l(e,["_url","name"],t);let r=a(n,["config"]);return r!=null&&cU(r,e),e}function dU(n){let e={},t=a(n,["name"]);return t!=null&&l(e,["_url","name"],t),e}function hU(n,e){let t={},r=a(n,["customMetadata"]);if(e!==void 0&&r!=null){let o=r;Array.isArray(o)&&(o=o.map(s=>s)),l(e,["customMetadata"],o)}let i=a(n,["chunkingConfig"]);return e!==void 0&&i!=null&&l(e,["chunkingConfig"],i),t}function pU(n){let e={},t=a(n,["name"]);t!=null&&l(e,["name"],t);let r=a(n,["metadata"]);r!=null&&l(e,["metadata"],r);let i=a(n,["done"]);i!=null&&l(e,["done"],i);let o=a(n,["error"]);o!=null&&l(e,["error"],o);let s=a(n,["response"]);return s!=null&&l(e,["response"],gU(s)),e}function mU(n){let e={},t=a(n,["fileSearchStoreName"]);t!=null&&l(e,["_url","file_search_store_name"],t);let r=a(n,["fileName"]);r!=null&&l(e,["fileName"],r);let i=a(n,["config"]);return i!=null&&hU(i,e),e}function gU(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);let r=a(n,["parent"]);r!=null&&l(e,["parent"],r);let i=a(n,["documentName"]);return i!=null&&l(e,["documentName"],i),e}function yU(n,e){let t={},r=a(n,["pageSize"]);e!==void 0&&r!=null&&l(e,["_query","pageSize"],r);let i=a(n,["pageToken"]);return e!==void 0&&i!=null&&l(e,["_query","pageToken"],i),t}function _U(n){let e={},t=a(n,["config"]);return t!=null&&yU(t,e),e}function EU(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);let r=a(n,["nextPageToken"]);r!=null&&l(e,["nextPageToken"],r);let i=a(n,["fileSearchStores"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(s=>s)),l(e,["fileSearchStores"],o)}return e}function Cw(n,e){let t={},r=a(n,["mimeType"]);e!==void 0&&r!=null&&l(e,["mimeType"],r);let i=a(n,["displayName"]);e!==void 0&&i!=null&&l(e,["displayName"],i);let o=a(n,["customMetadata"]);if(e!==void 0&&o!=null){let u=o;Array.isArray(u)&&(u=u.map(f=>f)),l(e,["customMetadata"],u)}let s=a(n,["chunkingConfig"]);return e!==void 0&&s!=null&&l(e,["chunkingConfig"],s),t}function SU(n){let e={},t=a(n,["fileSearchStoreName"]);t!=null&&l(e,["_url","file_search_store_name"],t);let r=a(n,["config"]);return r!=null&&Cw(r,e),e}function TU(n){let e={},t=a(n,["sdkHttpResponse"]);return t!=null&&l(e,["sdkHttpResponse"],t),e}var vU="Content-Type",wU="X-Server-Timeout",CU="User-Agent",op="x-goog-api-client",AU="1.32.0",bU=`google-genai-sdk/${AU}`,RU="v1beta1",IU="v1beta",sp=class{constructor(e){var t,r;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});let i={};this.clientOptions.vertexai?(i.apiVersion=(t=this.clientOptions.apiVersion)!==null&&t!==void 0?t:RU,i.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(i.apiVersion=(r=this.clientOptions.apiVersion)!==null&&r!==void 0?r:IU,i.baseUrl="https://generativelanguage.googleapis.com/"),i.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=i,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(i,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");let r=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&r.push(e.apiVersion),r.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){let e=this.getBaseUrl(),t=new URL(e);return t.protocol=t.protocol=="http:"?"ws":"wss",t.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,t,r){let i=[this.getRequestUrlInternal(t)];return r&&i.push(this.getBaseResourcePath()),e!==""&&i.push(e),new URL(`${i.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let r=this.shouldPrependVertexProjectPath(e),i=this.constructUrl(e.path,t,r);if(e.queryParams)for(let[s,u]of Object.entries(e.queryParams))i.searchParams.append(s,String(u));let o={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else o.body=e.body;return o=await this.includeExtraHttpOptionsToRequestInit(o,t,i.toString(),e.abortSignal),this.unaryApiCall(i,o,e.httpMethod)}patchHttpOptions(e,t){let r=JSON.parse(JSON.stringify(e));for(let[i,o]of Object.entries(t))typeof o=="object"?r[i]=Object.assign(Object.assign({},r[i]),o):o!==void 0&&(r[i]=o);return r}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let r=this.shouldPrependVertexProjectPath(e),i=this.constructUrl(e.path,t,r);(!i.searchParams.has("alt")||i.searchParams.get("alt")!=="sse")&&i.searchParams.set("alt","sse");let o={};return o.body=e.body,o=await this.includeExtraHttpOptionsToRequestInit(o,t,i.toString(),e.abortSignal),this.streamApiCall(i,o,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,r,i){if(t&&t.timeout||i){let o=new AbortController,s=o.signal;if(t.timeout&&(t==null?void 0:t.timeout)>0){let u=setTimeout(()=>o.abort(),t.timeout);u&&typeof u.unref=="function"&&u.unref()}i&&i.addEventListener("abort",()=>{o.abort()}),e.signal=s}return t&&t.extraBody!==null&&PU(e,t.extraBody),e.headers=await this.getHeadersInternal(t,r),e}async unaryApiCall(e,t,r){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:r})).then(async i=>(await Hv(i),new gi(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}async streamApiCall(e,t,r){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:r})).then(async i=>(await Hv(i),this.processStreamResponse(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}processStreamResponse(e){return Ro(this,arguments,function*(){var r;let i=(r=e==null?void 0:e.body)===null||r===void 0?void 0:r.getReader(),o=new TextDecoder("utf-8");if(!i)throw new Error("Response body is empty");try{let s="",u="data:",f=[`

`,"\r\r",`\r
\r
`];for(;;){let{done:d,value:h}=yield De(i.read());if(d){if(s.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}let m=o.decode(h,{stream:!0});try{let v=JSON.parse(m);if("error"in v){let C=JSON.parse(JSON.stringify(v.error)),R=C.status,I=C.code,z=`got status: ${R}. ${JSON.stringify(v)}`;if(I>=400&&I<600)throw new Ru({message:z,status:I})}}catch(v){if(v.name==="ApiError")throw v}s+=m;let g=-1,_=0;for(;;){g=-1,_=0;for(let R of f){let I=s.indexOf(R);I!==-1&&(g===-1||I<g)&&(g=I,_=R.length)}if(g===-1)break;let v=s.substring(0,g);s=s.substring(g+_);let C=v.trim();if(C.startsWith(u)){let R=C.substring(u.length).trim();try{let I=new Response(R,{headers:e==null?void 0:e.headers,status:e==null?void 0:e.status,statusText:e==null?void 0:e.statusText});yield yield De(new gi(I))}catch(I){throw new Error(`exception parsing stream chunk ${R}. ${I}`)}}}}}finally{i.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(r=>{throw new Error(`exception ${r} sending request`)})}getDefaultHeaders(){let e={},t=bU+" "+this.clientOptions.userAgentExtra;return e[CU]=t,e[op]=t,e[vU]="application/json",e}async getHeadersInternal(e,t){let r=new Headers;if(e&&e.headers){for(let[i,o]of Object.entries(e.headers))r.append(i,o);e.timeout&&e.timeout>0&&r.append(wU,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(r,t),r}getFileName(e){var t;let r="";return typeof e=="string"&&(r=e.replace(/[/\\]+$/,""),r=(t=r.split(/[/\\]/).pop())!==null&&t!==void 0?t:""),r}async uploadFile(e,t){var r;let i={};t!=null&&(i.mimeType=t.mimeType,i.name=t.name,i.displayName=t.displayName),i.name&&!i.name.startsWith("files/")&&(i.name=`files/${i.name}`);let o=this.clientOptions.uploader,s=await o.stat(e);i.sizeBytes=String(s.size);let u=(r=t==null?void 0:t.mimeType)!==null&&r!==void 0?r:s.type;if(u===void 0||u==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");i.mimeType=u;let f={file:i},d=this.getFileName(e),h=ne("upload/v1beta/files",f._url),m=await this.fetchUploadUrl(h,i.sizeBytes,i.mimeType,d,f,t==null?void 0:t.httpOptions);return o.upload(e,m,this)}async uploadFileToFileSearchStore(e,t,r){var i;let o=this.clientOptions.uploader,s=await o.stat(t),u=String(s.size),f=(i=r==null?void 0:r.mimeType)!==null&&i!==void 0?i:s.type;if(f===void 0||f==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");let d=`upload/v1beta/${e}:uploadToFileSearchStore`,h=this.getFileName(t),m={};r!=null&&Cw(r,m);let g=await this.fetchUploadUrl(d,u,f,h,m,r==null?void 0:r.httpOptions);return o.uploadToFileSearchStore(t,g,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,t,r,i,o,s){var u;let f={};s?f=s:f={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${t}`,"X-Goog-Upload-Header-Content-Type":`${r}`},i?{"X-Goog-Upload-File-Name":i}:{})};let d=await this.request({path:e,body:JSON.stringify(o),httpMethod:"POST",httpOptions:f});if(!d||!(d!=null&&d.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");let h=(u=d==null?void 0:d.headers)===null||u===void 0?void 0:u["x-goog-upload-url"];if(h===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return h}};async function Hv(n){var e;if(n===void 0)throw new Error("response is undefined");if(!n.ok){let t=n.status,r;!((e=n.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?r=await n.json():r={error:{message:await n.text(),code:n.status,status:n.statusText}};let i=JSON.stringify(r);throw t>=400&&t<600?new Ru({message:i,status:t}):new Error(i)}}function PU(n,e){if(!e||Object.keys(e).length===0)return;if(n.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let t={};if(typeof n.body=="string"&&n.body.length>0)try{let o=JSON.parse(n.body);if(typeof o=="object"&&o!==null&&!Array.isArray(o))t=o;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch(o){console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function r(o,s){let u=Object.assign({},o);for(let f in s)if(Object.prototype.hasOwnProperty.call(s,f)){let d=s[f],h=u[f];d&&typeof d=="object"&&!Array.isArray(d)&&h&&typeof h=="object"&&!Array.isArray(h)?u[f]=r(h,d):(h&&d&&typeof h!=typeof d&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${f}". Original type: ${typeof h}, New type: ${typeof d}. Overwriting.`),u[f]=d)}return u}let i=r(t,e);n.body=JSON.stringify(i)}var xU="mcp_used/unknown",NU=!1;function Aw(n){for(let e of n)if(kU(e)||typeof e=="object"&&"inputSchema"in e)return!0;return NU}function bw(n){var e;let t=(e=n[op])!==null&&e!==void 0?e:"";n[op]=(t+` ${xU}`).trimStart()}function kU(n){return n!==null&&typeof n=="object"&&n instanceof ap}function MU(n){return Ro(this,arguments,function*(t,r=100){let i,o=0;for(;o<r;){let s=yield De(t.listTools({cursor:i}));for(let u of s.tools)yield yield De(u),o++;if(!s.nextCursor)break;i=s.nextCursor}})}var ap=class n{constructor(e=[],t){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=t}static create(e,t){return new n(e,t)}async initialize(){var e,t,r,i;if(this.mcpTools.length>0)return;let o={},s=[];for(let h of this.mcpClients)try{for(var u=!0,f=(t=void 0,zs(MU(h))),d;d=await f.next(),e=d.done,!e;u=!0){i=d.value,u=!1;let m=i;s.push(m);let g=m.name;if(o[g])throw new Error(`Duplicate function name ${g} found in MCP tools. Please ensure function names are unique.`);o[g]=h}}catch(m){t={error:m}}finally{try{!u&&!e&&(r=f.return)&&await r.call(f)}finally{if(t)throw t.error}}this.mcpTools=s,this.functionNameToMcpClient=o}async tool(){return await this.initialize(),yk(this.mcpTools,this.config)}async callTool(e){await this.initialize();let t=[];for(let r of e)if(r.name in this.functionNameToMcpClient){let i=this.functionNameToMcpClient[r.name],o;this.config.timeout&&(o={timeout:this.config.timeout});let s=await i.callTool({name:r.name,arguments:r.args},void 0,o);t.push({functionResponse:{name:r.name,response:s.isError?{error:s}:s}})}return t}};async function DU(n,e,t){let r=new Yh,i;t.data instanceof Blob?i=JSON.parse(await t.data.text()):i=JSON.parse(t.data),Object.assign(r,i),e(r)}var lp=class{constructor(e,t,r){this.apiClient=e,this.auth=t,this.webSocketFactory=r}async connect(e){var t,r;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");let i=this.apiClient.getWebsocketBaseUrl(),o=this.apiClient.getApiVersion(),s=UU(this.apiClient.getDefaultHeaders()),u=this.apiClient.getApiKey(),f=`${i}/ws/google.ai.generativelanguage.${o}.GenerativeService.BidiGenerateMusic?key=${u}`,d=()=>{},h=new Promise($=>{d=$}),m=e.callbacks,g=function(){d({})},_=this.apiClient,v={onopen:g,onmessage:$=>{DU(_,m.onmessage,$)},onerror:(t=m==null?void 0:m.onerror)!==null&&t!==void 0?t:function($){},onclose:(r=m==null?void 0:m.onclose)!==null&&r!==void 0?r:function($){}},C=this.webSocketFactory.create(f,OU(s),v);C.connect(),await h;let z={setup:{model:Ce(this.apiClient,e.model)}};return C.send(JSON.stringify(z)),new up(C,this.apiClient)}},up=class{constructor(e,t){this.conn=e,this.apiClient=t}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");let t=uD(e);this.conn.send(JSON.stringify({clientContent:t}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});let t=lD(e);this.conn.send(JSON.stringify(t))}sendPlaybackControl(e){let t={playbackControl:e};this.conn.send(JSON.stringify(t))}play(){this.sendPlaybackControl(Ao.PLAY)}pause(){this.sendPlaybackControl(Ao.PAUSE)}stop(){this.sendPlaybackControl(Ao.STOP)}resetContext(){this.sendPlaybackControl(Ao.RESET_CONTEXT)}close(){this.conn.close()}};function OU(n){let e={};return n.forEach((t,r)=>{e[r]=t}),e}function UU(n){let e=new Headers;for(let[t,r]of Object.entries(n))e.append(t,r);return e}var FU="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function LU(n,e,t){let r=new Kh,i;t.data instanceof Blob?i=await t.data.text():t.data instanceof ArrayBuffer?i=new TextDecoder().decode(t.data):i=t.data;let o=JSON.parse(i);if(n.isVertexAI()){let s=dD(o);Object.assign(r,s)}else Object.assign(r,o);e(r)}var cp=class{constructor(e,t,r){this.apiClient=e,this.auth=t,this.webSocketFactory=r,this.music=new lp(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,r,i,o,s,u;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");let f=this.apiClient.getWebsocketBaseUrl(),d=this.apiClient.getApiVersion(),h,m=this.apiClient.getHeaders();e.config&&e.config.tools&&Aw(e.config.tools)&&bw(m);let g=GU(m);if(this.apiClient.isVertexAI())h=`${f}/ws/google.cloud.aiplatform.${d}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(g,h);else{let T=this.apiClient.getApiKey(),L="BidiGenerateContent",X="key";T!=null&&T.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),d!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),L="BidiGenerateContentConstrained",X="access_token"),h=`${f}/ws/google.ai.generativelanguage.${d}.GenerativeService.${L}?${X}=${T}`}let _=()=>{},v=new Promise(T=>{_=T}),C=e.callbacks,R=function(){var T;(T=C==null?void 0:C.onopen)===null||T===void 0||T.call(C),_({})},I=this.apiClient,z={onopen:R,onmessage:T=>{LU(I,C.onmessage,T)},onerror:(t=C==null?void 0:C.onerror)!==null&&t!==void 0?t:function(T){},onclose:(r=C==null?void 0:C.onclose)!==null&&r!==void 0?r:function(T){}},$=this.webSocketFactory.create(h,BU(g),z);$.connect(),await v;let W=Ce(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&W.startsWith("publishers/")){let T=this.apiClient.getProject(),L=this.apiClient.getLocation();W=`projects/${T}/locations/${L}/`+W}let H={};this.apiClient.isVertexAI()&&((i=e.config)===null||i===void 0?void 0:i.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[hu.AUDIO]}:e.config.responseModalities=[hu.AUDIO]),!((o=e.config)===null||o===void 0)&&o.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");let G=(u=(s=e.config)===null||s===void 0?void 0:s.tools)!==null&&u!==void 0?u:[],K=[];for(let T of G)if(this.isCallableTool(T)){let L=T;K.push(await L.tool())}else K.push(T);K.length>0&&(e.config.tools=K);let te={model:W,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?H=aD(this.apiClient,te):H=sD(this.apiClient,te),delete H.config,$.send(JSON.stringify(H)),new fp($,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}},qU={turnComplete:!0},fp=class{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(t.turns!==null&&t.turns!==void 0){let r=[];try{r=en(t.turns),e.isVertexAI()||(r=r.map(i=>xu(i)))}catch(i){throw new Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:r,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let r=[];if(t.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(t.functionResponses)?r=t.functionResponses:r=[t.functionResponses],r.length===0)throw new Error("functionResponses is required.");for(let o of r){if(typeof o!="object"||o===null||!("name"in o)||!("response"in o))throw new Error(`Could not parse function response, type '${typeof o}'.`);if(!e.isVertexAI()&&!("id"in o))throw new Error(FU)}return{toolResponse:{functionResponses:r}}}sendClientContent(e){e=Object.assign(Object.assign({},qU),e);let t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};this.apiClient.isVertexAI()?t={realtimeInput:fD(e)}:t={realtimeInput:cD(e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");let t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}};function BU(n){let e={};return n.forEach((t,r)=>{e[r]=t}),e}function GU(n){let e=new Headers;for(let[t,r]of Object.entries(n))e.append(t,r);return e}var Vv=10;function $v(n){var e,t,r;if(!((e=n==null?void 0:n.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let i=!1;for(let s of(t=n==null?void 0:n.tools)!==null&&t!==void 0?t:[])if(Io(s)){i=!0;break}if(!i)return!0;let o=(r=n==null?void 0:n.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls;return o&&(o<0||!Number.isInteger(o))||o==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",o),!0):!1}function Io(n){return"callTool"in n&&typeof n.callTool=="function"}function HU(n){var e,t,r;return(r=(t=(e=n.config)===null||e===void 0?void 0:e.tools)===null||t===void 0?void 0:t.some(i=>Io(i)))!==null&&r!==void 0?r:!1}function Wv(n){var e;let t=[];return!((e=n==null?void 0:n.config)===null||e===void 0)&&e.tools&&n.config.tools.forEach((r,i)=>{if(Io(r))return;let o=r;o.functionDeclarations&&o.functionDeclarations.length>0&&t.push(i)}),t}function zv(n){var e;return!(!((e=n==null?void 0:n.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}var dp=class extends _n{constructor(e){super(),this.apiClient=e,this.generateContent=async t=>{var r,i,o,s,u;let f=await this.processParamsMaybeAddMcpUsage(t);if(this.maybeMoveToResponseJsonSchem(t),!HU(t)||$v(t.config))return await this.generateContentInternal(f);let d=Wv(t);if(d.length>0){let C=d.map(R=>`tools[${R}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${C}.`)}let h,m,g=en(f.contents),_=(o=(i=(r=f.config)===null||r===void 0?void 0:r.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls)!==null&&o!==void 0?o:Vv,v=0;for(;v<_&&(h=await this.generateContentInternal(f),!(!h.functionCalls||h.functionCalls.length===0));){let C=h.candidates[0].content,R=[];for(let I of(u=(s=t.config)===null||s===void 0?void 0:s.tools)!==null&&u!==void 0?u:[])if(Io(I)){let $=await I.callTool(h.functionCalls);R.push(...$)}v++,m={role:"user",parts:R},f.contents=en(f.contents),f.contents.push(C),f.contents.push(m),zv(f.config)&&(g.push(C),g.push(m))}return zv(f.config)&&(h.automaticFunctionCallingHistory=g),h},this.generateContentStream=async t=>{var r,i,o,s,u;if(this.maybeMoveToResponseJsonSchem(t),$v(t.config)){let m=await this.processParamsMaybeAddMcpUsage(t);return await this.generateContentStreamInternal(m)}let f=Wv(t);if(f.length>0){let m=f.map(g=>`tools[${g}]`).join(", ");throw new Error(`Incompatible tools found at ${m}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}let d=(o=(i=(r=t==null?void 0:t.config)===null||r===void 0?void 0:r.toolConfig)===null||i===void 0?void 0:i.functionCallingConfig)===null||o===void 0?void 0:o.streamFunctionCallArguments,h=(u=(s=t==null?void 0:t.config)===null||s===void 0?void 0:s.automaticFunctionCalling)===null||u===void 0?void 0:u.disable;if(d&&!h)throw new Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(t)},this.generateImages=async t=>await this.generateImagesInternal(t).then(r=>{var i;let o,s=[];if(r!=null&&r.generatedImages)for(let f of r.generatedImages)f&&(f!=null&&f.safetyAttributes)&&((i=f==null?void 0:f.safetyAttributes)===null||i===void 0?void 0:i.contentType)==="Positive Prompt"?o=f==null?void 0:f.safetyAttributes:s.push(f);let u;return o?u={generatedImages:s,positivePromptSafetyAttributes:o,sdkHttpResponse:r.sdkHttpResponse}:u={generatedImages:s,sdkHttpResponse:r.sdkHttpResponse},u}),this.list=async t=>{var r;let s={config:Object.assign(Object.assign({},{queryBase:!0}),t==null?void 0:t.config)};if(this.apiClient.isVertexAI()&&!s.config.queryBase){if(!((r=s.config)===null||r===void 0)&&r.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");s.config.filter="labels.tune-type:*"}return new ar(sr.PAGED_ITEM_MODELS,u=>this.listInternal(u),await this.listInternal(s),s)},this.editImage=async t=>{let r={model:t.model,prompt:t.prompt,referenceImages:[],config:t.config};return t.referenceImages&&t.referenceImages&&(r.referenceImages=t.referenceImages.map(i=>i.toReferenceImageAPI())),await this.editImageInternal(r)},this.upscaleImage=async t=>{let r={numberOfImages:1,mode:"upscale"};t.config&&(r=Object.assign(Object.assign({},r),t.config));let i={model:t.model,image:t.image,upscaleFactor:t.upscaleFactor,config:r};return await this.upscaleImageInternal(i)},this.generateVideos=async t=>{var r,i,o,s,u,f;if((t.prompt||t.image||t.video)&&t.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((r=t.video)===null||r===void 0)&&r.uri&&(!((i=t.video)===null||i===void 0)&&i.videoBytes)?t.video={uri:t.video.uri,mimeType:t.video.mimeType}:!((s=(o=t.source)===null||o===void 0?void 0:o.video)===null||s===void 0)&&s.uri&&(!((f=(u=t.source)===null||u===void 0?void 0:u.video)===null||f===void 0)&&f.videoBytes)&&(t.source.video={uri:t.source.video.uri,mimeType:t.source.video.mimeType})),await this.generateVideosInternal(t)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var t,r,i;let o=(t=e.config)===null||t===void 0?void 0:t.tools;if(!o)return e;let s=await Promise.all(o.map(async f=>Io(f)?await f.tool():f)),u={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:s})};if(u.config.tools=s,e.config&&e.config.tools&&Aw(e.config.tools)){let f=(i=(r=e.config.httpOptions)===null||r===void 0?void 0:r.headers)!==null&&i!==void 0?i:{},d=Object.assign({},f);Object.keys(d).length===0&&(d=this.apiClient.getDefaultHeaders()),bw(d),u.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:d})}return u}async initAfcToolsMap(e){var t,r,i;let o=new Map;for(let s of(r=(t=e.config)===null||t===void 0?void 0:t.tools)!==null&&r!==void 0?r:[])if(Io(s)){let u=s,f=await u.tool();for(let d of(i=f.functionDeclarations)!==null&&i!==void 0?i:[]){if(!d.name)throw new Error("Function declaration name is required.");if(o.has(d.name))throw new Error(`Duplicate tool declaration name: ${d.name}`);o.set(d.name,u)}}return o}async processAfcStream(e){var t,r,i;let o=(i=(r=(t=e.config)===null||t===void 0?void 0:t.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls)!==null&&i!==void 0?i:Vv,s=!1,u=0,f=await this.initAfcToolsMap(e);return(function(d,h,m){return Ro(this,arguments,function*(){for(var g,_,v,C,R,I;u<o;){s&&(u++,s=!1);let H=yield De(d.processParamsMaybeAddMcpUsage(m)),G=yield De(d.generateContentStreamInternal(H)),K=[],te=[];try{for(var z=!0,$=(_=void 0,zs(G)),W;W=yield De($.next()),g=W.done,!g;z=!0){C=W.value,z=!1;let T=C;if(yield yield De(T),T.candidates&&(!((R=T.candidates[0])===null||R===void 0)&&R.content)){te.push(T.candidates[0].content);for(let L of(I=T.candidates[0].content.parts)!==null&&I!==void 0?I:[])if(u<o&&L.functionCall){if(!L.functionCall.name)throw new Error("Function call name was not returned by the model.");if(h.has(L.functionCall.name)){let X=yield De(h.get(L.functionCall.name).callTool([L.functionCall]));K.push(...X)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${h.keys()}, mising tool: ${L.functionCall.name}`)}}}}catch(T){_={error:T}}finally{try{!z&&!g&&(v=$.return)&&(yield De(v.call($)))}finally{if(_)throw _.error}}if(K.length>0){s=!0;let T=new pi;T.candidates=[{content:{role:"user",parts:K}}],yield yield De(T);let L=[];L.push(...te),L.push({role:"user",parts:K});let X=en(m.contents).concat(L);m.contents=X}else break}})})(this,f,e)}async generateContentInternal(e){var t,r,i,o;let s,u="",f={};if(this.apiClient.isVertexAI()){let d=qv(this.apiClient,e);return u=ne("{model}:generateContent",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),s.then(h=>{let m=Gv(h),g=new pi;return Object.assign(g,m),g})}else{let d=Lv(this.apiClient,e);return u=ne("{model}:generateContent",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),s.then(h=>{let m=Bv(h),g=new pi;return Object.assign(g,m),g})}}async generateContentStreamInternal(e){var t,r,i,o;let s,u="",f={};if(this.apiClient.isVertexAI()){let d=qv(this.apiClient,e);return u=ne("{model}:streamGenerateContent?alt=sse",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.requestStream({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}),s.then(function(m){return Ro(this,arguments,function*(){var g,_,v,C;try{for(var R=!0,I=zs(m),z;z=yield De(I.next()),g=z.done,!g;R=!0){C=z.value,R=!1;let $=C,W=Gv(yield De($.json()));W.sdkHttpResponse={headers:$.headers};let H=new pi;Object.assign(H,W),yield yield De(H)}}catch($){_={error:$}}finally{try{!R&&!g&&(v=I.return)&&(yield De(v.call(I)))}finally{if(_)throw _.error}}})})}else{let d=Lv(this.apiClient,e);return u=ne("{model}:streamGenerateContent?alt=sse",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.requestStream({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}),s.then(function(m){return Ro(this,arguments,function*(){var g,_,v,C;try{for(var R=!0,I=zs(m),z;z=yield De(I.next()),g=z.done,!g;R=!0){C=z.value,R=!1;let $=C,W=Bv(yield De($.json()));W.sdkHttpResponse={headers:$.headers};let H=new pi;Object.assign(H,W),yield yield De(H)}}catch($){_={error:$}}finally{try{!R&&!g&&(v=I.return)&&(yield De(v.call(I)))}finally{if(_)throw _.error}}})})}}async embedContent(e){var t,r,i,o;let s,u="",f={};if(this.apiClient.isVertexAI()){let d=HD(this.apiClient,e);return u=ne("{model}:predict",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),s.then(h=>{let m=$D(h),g=new pu;return Object.assign(g,m),g})}else{let d=GD(this.apiClient,e);return u=ne("{model}:batchEmbedContents",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),s.then(h=>{let m=VD(h),g=new pu;return Object.assign(g,m),g})}}async generateImagesInternal(e){var t,r,i,o;let s,u="",f={};if(this.apiClient.isVertexAI()){let d=tO(this.apiClient,e);return u=ne("{model}:predict",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),s.then(h=>{let m=rO(h),g=new mu;return Object.assign(g,m),g})}else{let d=eO(this.apiClient,e);return u=ne("{model}:predict",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),s.then(h=>{let m=nO(h),g=new mu;return Object.assign(g,m),g})}}async editImageInternal(e){var t,r;let i,o="",s={};if(this.apiClient.isVertexAI()){let u=FD(this.apiClient,e);return o=ne("{model}:predict",u._url),s=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(d=>{let h=d;return h.sdkHttpResponse={headers:f.headers},h})),i.then(f=>{let d=LD(f),h=new Uh;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,r;let i,o="",s={};if(this.apiClient.isVertexAI()){let u=tU(this.apiClient,e);return o=ne("{model}:predict",u._url),s=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(d=>{let h=d;return h.sdkHttpResponse={headers:f.headers},h})),i.then(f=>{let d=nU(f),h=new Fh;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var t,r;let i,o="",s={};if(this.apiClient.isVertexAI()){let u=UO(this.apiClient,e);return o=ne("{model}:predict",u._url),s=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i.then(f=>{let d=FO(f),h=new Lh;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var t,r;let i,o="",s={};if(this.apiClient.isVertexAI()){let u=VO(this.apiClient,e);return o=ne("{model}:predict",u._url),s=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i.then(f=>{let d=$O(f),h=new qh;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var t,r,i,o;let s,u="",f={};if(this.apiClient.isVertexAI()){let d=SO(this.apiClient,e);return u=ne("{name}",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>ip(h))}else{let d=EO(this.apiClient,e);return u=ne("{name}",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(h=>rp(h))}}async listInternal(e){var t,r,i,o;let s,u="",f={};if(this.apiClient.isVertexAI()){let d=PO(this.apiClient,e);return u=ne("{models_url}",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),s.then(h=>{let m=NO(h),g=new gu;return Object.assign(g,m),g})}else{let d=IO(this.apiClient,e);return u=ne("{models_url}",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),s.then(h=>{let m=xO(h),g=new gu;return Object.assign(g,m),g})}}async update(e){var t,r,i,o;let s,u="",f={};if(this.apiClient.isVertexAI()){let d=jO(this.apiClient,e);return u=ne("{model}",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>ip(h))}else{let d=ZO(this.apiClient,e);return u=ne("{name}",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(h=>rp(h))}}async delete(e){var t,r,i,o;let s,u="",f={};if(this.apiClient.isVertexAI()){let d=MD(this.apiClient,e);return u=ne("{name}",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),s.then(h=>{let m=OD(h),g=new yu;return Object.assign(g,m),g})}else{let d=kD(this.apiClient,e);return u=ne("{name}",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),s.then(h=>{let m=DD(h),g=new yu;return Object.assign(g,m),g})}}async countTokens(e){var t,r,i,o;let s,u="",f={};if(this.apiClient.isVertexAI()){let d=PD(this.apiClient,e);return u=ne("{model}:countTokens",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),s.then(h=>{let m=ND(h),g=new _u;return Object.assign(g,m),g})}else{let d=ID(this.apiClient,e);return u=ne("{model}:countTokens",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),s.then(h=>{let m=xD(h),g=new _u;return Object.assign(g,m),g})}}async computeTokens(e){var t,r;let i,o="",s={};if(this.apiClient.isVertexAI()){let u=TD(this.apiClient,e);return o=ne("{model}:computeTokens",u._url),s=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(d=>{let h=d;return h.sdkHttpResponse={headers:f.headers},h})),i.then(f=>{let d=vD(f),h=new Bh;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var t,r,i,o;let s,u="",f={};if(this.apiClient.isVertexAI()){let d=uO(this.apiClient,e);return u=ne("{model}:predictLongRunning",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>{let m=aO(h),g=new Eu;return Object.assign(g,m),g})}else{let d=lO(this.apiClient,e);return u=ne("{model}:predictLongRunning",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(h=>{let m=sO(h),g=new Eu;return Object.assign(g,m),g})}}};var hp=class extends _n{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){let t=e.operation,r=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){let i=t.name.split("/operations/")[0],o;r&&"httpOptions"in r&&(o=r.httpOptions);let s=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:i,config:{httpOptions:o}});return t._fromAPIResponse({apiResponse:s,_isVertexAI:!0})}else{let i=await this.getVideosOperationInternal({operationName:t.name,config:r});return t._fromAPIResponse({apiResponse:i,_isVertexAI:!1})}}async get(e){let t=e.operation,r=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){let i=t.name.split("/operations/")[0],o;r&&"httpOptions"in r&&(o=r.httpOptions);let s=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:i,config:{httpOptions:o}});return t._fromAPIResponse({apiResponse:s,_isVertexAI:!0})}else{let i=await this.getVideosOperationInternal({operationName:t.name,config:r});return t._fromAPIResponse({apiResponse:i,_isVertexAI:!1})}}async getVideosOperationInternal(e){var t,r,i,o;let s,u="",f={};if(this.apiClient.isVertexAI()){let d=sk(e);return u=ne("{operationName}",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s}else{let d=ok(e);return u=ne("{operationName}",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s}}async fetchPredictVideosOperationInternal(e){var t,r;let i,o="",s={};if(this.apiClient.isVertexAI()){let u=ZN(e);return o=ne("{resourceName}:fetchPredictOperation",u._url),s=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i}else throw new Error("This method is only supported by the Vertex AI.")}};function VU(n){let e={},t=a(n,["data"]);if(t!=null&&l(e,["data"],t),a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let r=a(n,["mimeType"]);return r!=null&&l(e,["mimeType"],r),e}function $U(n){let e={},t=a(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>jU(o))),l(e,["parts"],i)}let r=a(n,["role"]);return r!=null&&l(e,["role"],r),e}function WU(n,e,t){let r={},i=a(e,["expireTime"]);t!==void 0&&i!=null&&l(t,["expireTime"],i);let o=a(e,["newSessionExpireTime"]);t!==void 0&&o!=null&&l(t,["newSessionExpireTime"],o);let s=a(e,["uses"]);t!==void 0&&s!=null&&l(t,["uses"],s);let u=a(e,["liveConnectConstraints"]);t!==void 0&&u!=null&&l(t,["bidiGenerateContentSetup"],ZU(n,u));let f=a(e,["lockAdditionalFields"]);return t!==void 0&&f!=null&&l(t,["fieldMask"],f),r}function zU(n,e){let t={},r=a(e,["config"]);return r!=null&&l(t,["config"],WU(n,r,t)),t}function JU(n){let e={};if(a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=a(n,["fileUri"]);t!=null&&l(e,["fileUri"],t);let r=a(n,["mimeType"]);return r!=null&&l(e,["mimeType"],r),e}function KU(n){let e={},t=a(n,["id"]);t!=null&&l(e,["id"],t);let r=a(n,["args"]);r!=null&&l(e,["args"],r);let i=a(n,["name"]);if(i!=null&&l(e,["name"],i),a(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(a(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function YU(n){let e={};if(a(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=a(n,["enableWidget"]);return t!=null&&l(e,["enableWidget"],t),e}function XU(n){let e={};if(a(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(a(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=a(n,["timeRangeFilter"]);return t!=null&&l(e,["timeRangeFilter"],t),e}function QU(n,e){let t={},r=a(n,["generationConfig"]);e!==void 0&&r!=null&&l(e,["setup","generationConfig"],r);let i=a(n,["responseModalities"]);e!==void 0&&i!=null&&l(e,["setup","generationConfig","responseModalities"],i);let o=a(n,["temperature"]);e!==void 0&&o!=null&&l(e,["setup","generationConfig","temperature"],o);let s=a(n,["topP"]);e!==void 0&&s!=null&&l(e,["setup","generationConfig","topP"],s);let u=a(n,["topK"]);e!==void 0&&u!=null&&l(e,["setup","generationConfig","topK"],u);let f=a(n,["maxOutputTokens"]);e!==void 0&&f!=null&&l(e,["setup","generationConfig","maxOutputTokens"],f);let d=a(n,["mediaResolution"]);e!==void 0&&d!=null&&l(e,["setup","generationConfig","mediaResolution"],d);let h=a(n,["seed"]);e!==void 0&&h!=null&&l(e,["setup","generationConfig","seed"],h);let m=a(n,["speechConfig"]);e!==void 0&&m!=null&&l(e,["setup","generationConfig","speechConfig"],Pp(m));let g=a(n,["thinkingConfig"]);e!==void 0&&g!=null&&l(e,["setup","generationConfig","thinkingConfig"],g);let _=a(n,["enableAffectiveDialog"]);e!==void 0&&_!=null&&l(e,["setup","generationConfig","enableAffectiveDialog"],_);let v=a(n,["systemInstruction"]);e!==void 0&&v!=null&&l(e,["setup","systemInstruction"],$U(ot(v)));let C=a(n,["tools"]);if(e!==void 0&&C!=null){let G=xo(C);Array.isArray(G)&&(G=G.map(K=>tF(Po(K)))),l(e,["setup","tools"],G)}let R=a(n,["sessionResumption"]);e!==void 0&&R!=null&&l(e,["setup","sessionResumption"],eF(R));let I=a(n,["inputAudioTranscription"]);e!==void 0&&I!=null&&l(e,["setup","inputAudioTranscription"],I);let z=a(n,["outputAudioTranscription"]);e!==void 0&&z!=null&&l(e,["setup","outputAudioTranscription"],z);let $=a(n,["realtimeInputConfig"]);e!==void 0&&$!=null&&l(e,["setup","realtimeInputConfig"],$);let W=a(n,["contextWindowCompression"]);e!==void 0&&W!=null&&l(e,["setup","contextWindowCompression"],W);let H=a(n,["proactivity"]);return e!==void 0&&H!=null&&l(e,["setup","proactivity"],H),t}function ZU(n,e){let t={},r=a(e,["model"]);r!=null&&l(t,["setup","model"],Ce(n,r));let i=a(e,["config"]);return i!=null&&l(t,["config"],QU(i,t)),t}function jU(n){let e={},t=a(n,["mediaResolution"]);t!=null&&l(e,["mediaResolution"],t);let r=a(n,["codeExecutionResult"]);r!=null&&l(e,["codeExecutionResult"],r);let i=a(n,["executableCode"]);i!=null&&l(e,["executableCode"],i);let o=a(n,["fileData"]);o!=null&&l(e,["fileData"],JU(o));let s=a(n,["functionCall"]);s!=null&&l(e,["functionCall"],KU(s));let u=a(n,["functionResponse"]);u!=null&&l(e,["functionResponse"],u);let f=a(n,["inlineData"]);f!=null&&l(e,["inlineData"],VU(f));let d=a(n,["text"]);d!=null&&l(e,["text"],d);let h=a(n,["thought"]);h!=null&&l(e,["thought"],h);let m=a(n,["thoughtSignature"]);m!=null&&l(e,["thoughtSignature"],m);let g=a(n,["videoMetadata"]);return g!=null&&l(e,["videoMetadata"],g),e}function eF(n){let e={},t=a(n,["handle"]);if(t!=null&&l(e,["handle"],t),a(n,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function tF(n){let e={},t=a(n,["functionDeclarations"]);if(t!=null){let h=t;Array.isArray(h)&&(h=h.map(m=>m)),l(e,["functionDeclarations"],h)}if(a(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let r=a(n,["googleSearchRetrieval"]);r!=null&&l(e,["googleSearchRetrieval"],r);let i=a(n,["computerUse"]);i!=null&&l(e,["computerUse"],i);let o=a(n,["fileSearch"]);o!=null&&l(e,["fileSearch"],o);let s=a(n,["codeExecution"]);if(s!=null&&l(e,["codeExecution"],s),a(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let u=a(n,["googleMaps"]);u!=null&&l(e,["googleMaps"],YU(u));let f=a(n,["googleSearch"]);f!=null&&l(e,["googleSearch"],XU(f));let d=a(n,["urlContext"]);return d!=null&&l(e,["urlContext"],d),e}function nF(n){let e=[];for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t)){let r=n[t];if(typeof r=="object"&&r!=null&&Object.keys(r).length>0){let i=Object.keys(r).map(o=>`${t}.${o}`);e.push(...i)}else e.push(t)}return e.join(",")}function rF(n,e){let t=null,r=n.bidiGenerateContentSetup;if(typeof r=="object"&&r!==null&&"setup"in r){let o=r.setup;typeof o=="object"&&o!==null?(n.bidiGenerateContentSetup=o,t=o):delete n.bidiGenerateContentSetup}else r!==void 0&&delete n.bidiGenerateContentSetup;let i=n.fieldMask;if(t){let o=nF(t);if(Array.isArray(e==null?void 0:e.lockAdditionalFields)&&(e==null?void 0:e.lockAdditionalFields.length)===0)o?n.fieldMask=o:delete n.fieldMask;else if(e!=null&&e.lockAdditionalFields&&e.lockAdditionalFields.length>0&&i!==null&&Array.isArray(i)&&i.length>0){let s=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"],u=[];i.length>0&&(u=i.map(d=>s.includes(d)?`generationConfig.${d}`:d));let f=[];o&&f.push(o),u.length>0&&f.push(...u),f.length>0?n.fieldMask=f.join(","):delete n.fieldMask}else delete n.fieldMask}else i!==null&&Array.isArray(i)&&i.length>0?n.fieldMask=i.join(","):delete n.fieldMask;return n}var pp=class extends _n{constructor(e){super(),this.apiClient=e}async create(e){var t,r;let i,o="",s={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{let u=zU(this.apiClient,e);o=ne("auth_tokens",u._url),s=u._query,delete u.config,delete u._url,delete u._query;let f=rF(u,e.config);return i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),i.then(d=>d)}}};function iF(n,e){let t={},r=a(n,["force"]);return e!==void 0&&r!=null&&l(e,["_query","force"],r),t}function oF(n){let e={},t=a(n,["name"]);t!=null&&l(e,["_url","name"],t);let r=a(n,["config"]);return r!=null&&iF(r,e),e}function sF(n){let e={},t=a(n,["name"]);return t!=null&&l(e,["_url","name"],t),e}function aF(n,e){let t={},r=a(n,["pageSize"]);e!==void 0&&r!=null&&l(e,["_query","pageSize"],r);let i=a(n,["pageToken"]);return e!==void 0&&i!=null&&l(e,["_query","pageToken"],i),t}function lF(n){let e={},t=a(n,["parent"]);t!=null&&l(e,["_url","parent"],t);let r=a(n,["config"]);return r!=null&&aF(r,e),e}function uF(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);let r=a(n,["nextPageToken"]);r!=null&&l(e,["nextPageToken"],r);let i=a(n,["documents"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(s=>s)),l(e,["documents"],o)}return e}var mp=class extends _n{constructor(e){super(),this.apiClient=e,this.list=async t=>new ar(sr.PAGED_ITEM_DOCUMENTS,r=>this.listInternal({parent:t.parent,config:r.config}),await this.listInternal(t),t)}async get(e){var t,r;let i,o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let u=sF(e);return o=ne("{name}",u._url),s=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i.then(f=>f)}}async delete(e){var t,r;let i="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let s=oF(e);i=ne("{name}",s._url),o=s._query,delete s._url,delete s._query,await this.apiClient.request({path:i,queryParams:o,body:JSON.stringify(s),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(e){var t,r;let i,o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let u=lF(e);return o=ne("{parent}/documents",u._url),s=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i.then(f=>{let d=uF(f),h=new Gh;return Object.assign(h,d),h})}}};var gp=class extends _n{constructor(e,t=new mp(e)){super(),this.apiClient=e,this.documents=t,this.list=async(r={})=>new ar(sr.PAGED_ITEM_FILE_SEARCH_STORES,i=>this.listInternal(i),await this.listInternal(r),r)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var t,r;let i,o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let u=uU(e);return o=ne("fileSearchStores",u._url),s=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i.then(f=>f)}}async get(e){var t,r;let i,o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let u=dU(e);return o=ne("{name}",u._url),s=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i.then(f=>f)}}async delete(e){var t,r;let i="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let s=fU(e);i=ne("{name}",s._url),o=s._query,delete s._url,delete s._query,await this.apiClient.request({path:i,queryParams:o,body:JSON.stringify(s),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(e){var t,r;let i,o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let u=_U(e);return o=ne("fileSearchStores",u._url),s=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i.then(f=>{let d=EU(f),h=new Hh;return Object.assign(h,d),h})}}async uploadToFileSearchStoreInternal(e){var t,r;let i,o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let u=SU(e);return o=ne("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",u._url),s=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i.then(f=>{let d=TU(f),h=new Vh;return Object.assign(h,d),h})}}async importFile(e){var t,r;let i,o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let u=mU(e);return o=ne("{file_search_store_name}:importFile",u._url),s=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i.then(f=>{let d=pU(f),h=new $h;return Object.assign(h,d),h})}}};var Jv="x-goog-api-key",Ws="https://www.googleapis.com/auth/cloud-platform",yp=class{constructor(e){if(e.apiKey!==void 0){this.apiKey=e.apiKey;return}let t=cF(e.googleAuthOptions);this.googleAuth=new Yv.GoogleAuth(t)}async addAuthHeaders(e,t){if(this.apiKey!==void 0){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");this.addKeyHeader(e);return}return this.addGoogleAuthHeaders(e,t)}addKeyHeader(e){if(e.get(Jv)===null){if(this.apiKey===void 0)throw new Error("Trying to set API key header but apiKey is not set");e.append(Jv,this.apiKey)}}async addGoogleAuthHeaders(e,t){if(this.googleAuth===void 0)throw new Error("Trying to set google-auth headers but googleAuth is unset");let r=await this.googleAuth.getRequestHeaders(t);for(let[i,o]of r)e.get(i)===null&&e.append(i,o)}};function cF(n){let e;if(n){if(e=n,e.scopes){if(typeof e.scopes=="string"&&e.scopes!==Ws||Array.isArray(e.scopes)&&e.scopes.indexOf(Ws)<0)throw new Error(`Invalid auth scopes. Scopes must include: ${Ws}`)}else return e.scopes=[Ws],e;return e}else return e={scopes:[Ws]},e}var _p=class{async download(e,t){if(e.downloadPath){let r=await fF(e,t);if(r instanceof gi){let i=(0,Xv.createWriteStream)(e.downloadPath);Zv.Readable.fromWeb(r.responseInternal.body).pipe(i),await(0,jv.finished)(i)}else try{await(0,Qv.writeFile)(e.downloadPath,r,{encoding:"base64"})}catch(i){throw new Error(`Failed to write file to ${e.downloadPath}: ${i}`)}}}};async function fF(n,e){var t,r,i;let o=xp(n.file);if(o!==void 0)return await e.request({path:`files/${o}:download`,httpMethod:"GET",queryParams:{alt:"media"},httpOptions:(t=n.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=n.config)===null||r===void 0?void 0:r.abortSignal});if(aw(n.file)){let s=(i=n.file.video)===null||i===void 0?void 0:i.videoBytes;if(typeof s=="string")return s;throw new Error("Failed to download generated video, Uri or videoBytes not found.")}else if(lw(n.file)){let s=n.file.videoBytes;if(typeof s=="string")return s;throw new Error("Failed to download video, Uri or videoBytes not found.")}else throw new Error("Unsupported file type")}var Ep=class{create(e,t,r){return new Sp(e,t,r)}},Sp=class{constructor(e,t,r){this.url=e,this.headers=t,this.callbacks=r}connect(){this.ws=new Mh.default(this.url,{headers:this.headers}),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}};function dF(n,e){let t={},r=a(n,["name"]);return r!=null&&l(t,["_url","name"],r),t}function hF(n,e){let t={},r=a(n,["name"]);return r!=null&&l(t,["_url","name"],r),t}function pF(n,e){let t={},r=a(n,["sdkHttpResponse"]);return r!=null&&l(t,["sdkHttpResponse"],r),t}function mF(n,e){let t={},r=a(n,["sdkHttpResponse"]);return r!=null&&l(t,["sdkHttpResponse"],r),t}function gF(n,e,t){let r={};if(a(n,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");let i=a(n,["tunedModelDisplayName"]);if(e!==void 0&&i!=null&&l(e,["displayName"],i),a(n,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");let o=a(n,["epochCount"]);e!==void 0&&o!=null&&l(e,["tuningTask","hyperparameters","epochCount"],o);let s=a(n,["learningRateMultiplier"]);if(s!=null&&l(r,["tuningTask","hyperparameters","learningRateMultiplier"],s),a(n,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(a(n,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(a(n,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");let u=a(n,["batchSize"]);e!==void 0&&u!=null&&l(e,["tuningTask","hyperparameters","batchSize"],u);let f=a(n,["learningRate"]);if(e!==void 0&&f!=null&&l(e,["tuningTask","hyperparameters","learningRate"],f),a(n,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(a(n,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");return r}function yF(n,e,t){let r={},i=a(t,["config","method"]);if(i===void 0&&(i="SUPERVISED_FINE_TUNING"),i==="SUPERVISED_FINE_TUNING"){let _=a(n,["validationDataset"]);e!==void 0&&_!=null&&l(e,["supervisedTuningSpec"],Kv(_))}else if(i==="PREFERENCE_TUNING"){let _=a(n,["validationDataset"]);e!==void 0&&_!=null&&l(e,["preferenceOptimizationSpec"],Kv(_))}let o=a(n,["tunedModelDisplayName"]);e!==void 0&&o!=null&&l(e,["tunedModelDisplayName"],o);let s=a(n,["description"]);e!==void 0&&s!=null&&l(e,["description"],s);let u=a(t,["config","method"]);if(u===void 0&&(u="SUPERVISED_FINE_TUNING"),u==="SUPERVISED_FINE_TUNING"){let _=a(n,["epochCount"]);e!==void 0&&_!=null&&l(e,["supervisedTuningSpec","hyperParameters","epochCount"],_)}else if(u==="PREFERENCE_TUNING"){let _=a(n,["epochCount"]);e!==void 0&&_!=null&&l(e,["preferenceOptimizationSpec","hyperParameters","epochCount"],_)}let f=a(t,["config","method"]);if(f===void 0&&(f="SUPERVISED_FINE_TUNING"),f==="SUPERVISED_FINE_TUNING"){let _=a(n,["learningRateMultiplier"]);e!==void 0&&_!=null&&l(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],_)}else if(f==="PREFERENCE_TUNING"){let _=a(n,["learningRateMultiplier"]);e!==void 0&&_!=null&&l(e,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],_)}let d=a(t,["config","method"]);if(d===void 0&&(d="SUPERVISED_FINE_TUNING"),d==="SUPERVISED_FINE_TUNING"){let _=a(n,["exportLastCheckpointOnly"]);e!==void 0&&_!=null&&l(e,["supervisedTuningSpec","exportLastCheckpointOnly"],_)}else if(d==="PREFERENCE_TUNING"){let _=a(n,["exportLastCheckpointOnly"]);e!==void 0&&_!=null&&l(e,["preferenceOptimizationSpec","exportLastCheckpointOnly"],_)}let h=a(t,["config","method"]);if(h===void 0&&(h="SUPERVISED_FINE_TUNING"),h==="SUPERVISED_FINE_TUNING"){let _=a(n,["adapterSize"]);e!==void 0&&_!=null&&l(e,["supervisedTuningSpec","hyperParameters","adapterSize"],_)}else if(h==="PREFERENCE_TUNING"){let _=a(n,["adapterSize"]);e!==void 0&&_!=null&&l(e,["preferenceOptimizationSpec","hyperParameters","adapterSize"],_)}if(a(n,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(a(n,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");let m=a(n,["labels"]);e!==void 0&&m!=null&&l(e,["labels"],m);let g=a(n,["beta"]);return e!==void 0&&g!=null&&l(e,["preferenceOptimizationSpec","hyperParameters","beta"],g),r}function _F(n,e){let t={},r=a(n,["baseModel"]);r!=null&&l(t,["baseModel"],r);let i=a(n,["preTunedModel"]);i!=null&&l(t,["preTunedModel"],i);let o=a(n,["trainingDataset"]);o!=null&&PF(o);let s=a(n,["config"]);return s!=null&&gF(s,t),t}function EF(n,e){let t={},r=a(n,["baseModel"]);r!=null&&l(t,["baseModel"],r);let i=a(n,["preTunedModel"]);i!=null&&l(t,["preTunedModel"],i);let o=a(n,["trainingDataset"]);o!=null&&xF(o,t,e);let s=a(n,["config"]);return s!=null&&yF(s,t,e),t}function SF(n,e){let t={},r=a(n,["name"]);return r!=null&&l(t,["_url","name"],r),t}function TF(n,e){let t={},r=a(n,["name"]);return r!=null&&l(t,["_url","name"],r),t}function vF(n,e,t){let r={},i=a(n,["pageSize"]);e!==void 0&&i!=null&&l(e,["_query","pageSize"],i);let o=a(n,["pageToken"]);e!==void 0&&o!=null&&l(e,["_query","pageToken"],o);let s=a(n,["filter"]);return e!==void 0&&s!=null&&l(e,["_query","filter"],s),r}function wF(n,e,t){let r={},i=a(n,["pageSize"]);e!==void 0&&i!=null&&l(e,["_query","pageSize"],i);let o=a(n,["pageToken"]);e!==void 0&&o!=null&&l(e,["_query","pageToken"],o);let s=a(n,["filter"]);return e!==void 0&&s!=null&&l(e,["_query","filter"],s),r}function CF(n,e){let t={},r=a(n,["config"]);return r!=null&&vF(r,t),t}function AF(n,e){let t={},r=a(n,["config"]);return r!=null&&wF(r,t),t}function bF(n,e){let t={},r=a(n,["sdkHttpResponse"]);r!=null&&l(t,["sdkHttpResponse"],r);let i=a(n,["nextPageToken"]);i!=null&&l(t,["nextPageToken"],i);let o=a(n,["tunedModels"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(u=>Rw(u))),l(t,["tuningJobs"],s)}return t}function RF(n,e){let t={},r=a(n,["sdkHttpResponse"]);r!=null&&l(t,["sdkHttpResponse"],r);let i=a(n,["nextPageToken"]);i!=null&&l(t,["nextPageToken"],i);let o=a(n,["tuningJobs"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(u=>Tp(u))),l(t,["tuningJobs"],s)}return t}function IF(n,e){let t={},r=a(n,["name"]);r!=null&&l(t,["model"],r);let i=a(n,["name"]);return i!=null&&l(t,["endpoint"],i),t}function PF(n,e){let t={};if(a(n,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(a(n,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");let r=a(n,["examples"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(o=>o)),l(t,["examples","examples"],i)}return t}function xF(n,e,t){let r={},i=a(t,["config","method"]);if(i===void 0&&(i="SUPERVISED_FINE_TUNING"),i==="SUPERVISED_FINE_TUNING"){let s=a(n,["gcsUri"]);e!==void 0&&s!=null&&l(e,["supervisedTuningSpec","trainingDatasetUri"],s)}else if(i==="PREFERENCE_TUNING"){let s=a(n,["gcsUri"]);e!==void 0&&s!=null&&l(e,["preferenceOptimizationSpec","trainingDatasetUri"],s)}let o=a(t,["config","method"]);if(o===void 0&&(o="SUPERVISED_FINE_TUNING"),o==="SUPERVISED_FINE_TUNING"){let s=a(n,["vertexDatasetResource"]);e!==void 0&&s!=null&&l(e,["supervisedTuningSpec","trainingDatasetUri"],s)}else if(o==="PREFERENCE_TUNING"){let s=a(n,["vertexDatasetResource"]);e!==void 0&&s!=null&&l(e,["preferenceOptimizationSpec","trainingDatasetUri"],s)}if(a(n,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return r}function Rw(n,e){let t={},r=a(n,["sdkHttpResponse"]);r!=null&&l(t,["sdkHttpResponse"],r);let i=a(n,["name"]);i!=null&&l(t,["name"],i);let o=a(n,["state"]);o!=null&&l(t,["state"],sw(o));let s=a(n,["createTime"]);s!=null&&l(t,["createTime"],s);let u=a(n,["tuningTask","startTime"]);u!=null&&l(t,["startTime"],u);let f=a(n,["tuningTask","completeTime"]);f!=null&&l(t,["endTime"],f);let d=a(n,["updateTime"]);d!=null&&l(t,["updateTime"],d);let h=a(n,["description"]);h!=null&&l(t,["description"],h);let m=a(n,["baseModel"]);m!=null&&l(t,["baseModel"],m);let g=a(n,["_self"]);return g!=null&&l(t,["tunedModel"],IF(g)),t}function Tp(n,e){let t={},r=a(n,["sdkHttpResponse"]);r!=null&&l(t,["sdkHttpResponse"],r);let i=a(n,["name"]);i!=null&&l(t,["name"],i);let o=a(n,["state"]);o!=null&&l(t,["state"],sw(o));let s=a(n,["createTime"]);s!=null&&l(t,["createTime"],s);let u=a(n,["startTime"]);u!=null&&l(t,["startTime"],u);let f=a(n,["endTime"]);f!=null&&l(t,["endTime"],f);let d=a(n,["updateTime"]);d!=null&&l(t,["updateTime"],d);let h=a(n,["error"]);h!=null&&l(t,["error"],h);let m=a(n,["description"]);m!=null&&l(t,["description"],m);let g=a(n,["baseModel"]);g!=null&&l(t,["baseModel"],g);let _=a(n,["tunedModel"]);_!=null&&l(t,["tunedModel"],_);let v=a(n,["preTunedModel"]);v!=null&&l(t,["preTunedModel"],v);let C=a(n,["supervisedTuningSpec"]);C!=null&&l(t,["supervisedTuningSpec"],C);let R=a(n,["preferenceOptimizationSpec"]);R!=null&&l(t,["preferenceOptimizationSpec"],R);let I=a(n,["tuningDataStats"]);I!=null&&l(t,["tuningDataStats"],I);let z=a(n,["encryptionSpec"]);z!=null&&l(t,["encryptionSpec"],z);let $=a(n,["partnerModelTuningSpec"]);$!=null&&l(t,["partnerModelTuningSpec"],$);let W=a(n,["customBaseModel"]);W!=null&&l(t,["customBaseModel"],W);let H=a(n,["experiment"]);H!=null&&l(t,["experiment"],H);let G=a(n,["labels"]);G!=null&&l(t,["labels"],G);let K=a(n,["outputUri"]);K!=null&&l(t,["outputUri"],K);let te=a(n,["pipelineJob"]);te!=null&&l(t,["pipelineJob"],te);let T=a(n,["serviceAccount"]);T!=null&&l(t,["serviceAccount"],T);let L=a(n,["tunedModelDisplayName"]);L!=null&&l(t,["tunedModelDisplayName"],L);let X=a(n,["veoTuningSpec"]);return X!=null&&l(t,["veoTuningSpec"],X),t}function NF(n,e){let t={},r=a(n,["sdkHttpResponse"]);r!=null&&l(t,["sdkHttpResponse"],r);let i=a(n,["name"]);i!=null&&l(t,["name"],i);let o=a(n,["metadata"]);o!=null&&l(t,["metadata"],o);let s=a(n,["done"]);s!=null&&l(t,["done"],s);let u=a(n,["error"]);return u!=null&&l(t,["error"],u),t}function Kv(n,e){let t={},r=a(n,["gcsUri"]);r!=null&&l(t,["validationDatasetUri"],r);let i=a(n,["vertexDatasetResource"]);return i!=null&&l(t,["validationDatasetUri"],i),t}var vp=class extends _n{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new ar(sr.PAGED_ITEM_TUNING_JOBS,r=>this.listInternal(r),await this.listInternal(t),t),this.get=async t=>await this.getInternal(t),this.tune=async t=>{var r;if(this.apiClient.isVertexAI())if(t.baseModel.startsWith("projects/")){let i={tunedModelName:t.baseModel};!((r=t.config)===null||r===void 0)&&r.preTunedModelCheckpointId&&(i.checkpointId=t.config.preTunedModelCheckpointId);let o=Object.assign(Object.assign({},t),{preTunedModel:i});return o.baseModel=void 0,await this.tuneInternal(o)}else{let i=Object.assign({},t);return await this.tuneInternal(i)}else{let i=Object.assign({},t),o=await this.tuneMldevInternal(i),s="";return o.metadata!==void 0&&o.metadata.tunedModel!==void 0?s=o.metadata.tunedModel:o.name!==void 0&&o.name.includes("/operations/")&&(s=o.name.split("/operations/")[0]),{name:s,state:Oh.JOB_STATE_QUEUED}}}}async getInternal(e){var t,r,i,o;let s,u="",f={};if(this.apiClient.isVertexAI()){let d=TF(e);return u=ne("{name}",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),s.then(h=>Tp(h))}else{let d=SF(e);return u=ne("{name}",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),s.then(h=>Rw(h))}}async listInternal(e){var t,r,i,o;let s,u="",f={};if(this.apiClient.isVertexAI()){let d=AF(e);return u=ne("tuningJobs",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),s.then(h=>{let m=RF(h),g=new Su;return Object.assign(g,m),g})}else{let d=CF(e);return u=ne("tunedModels",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),s.then(h=>{let m=bF(h),g=new Su;return Object.assign(g,m),g})}}async cancel(e){var t,r,i,o;let s,u="",f={};if(this.apiClient.isVertexAI()){let d=hF(e);return u=ne("{name}:cancel",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),s.then(h=>{let m=mF(h),g=new Tu;return Object.assign(g,m),g})}else{let d=dF(e);return u=ne("{name}:cancel",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),s.then(h=>{let m=pF(h),g=new Tu;return Object.assign(g,m),g})}}async tuneInternal(e){var t,r;let i,o="",s={};if(this.apiClient.isVertexAI()){let u=EF(e,e);return o=ne("tuningJobs",u._url),s=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(d=>{let h=d;return h.sdkHttpResponse={headers:f.headers},h})),i.then(f=>Tp(f))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,r;let i,o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let u=_F(e);return o=ne("tunedModels",u._url),s=u._query,delete u._url,delete u._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(d=>{let h=d;return h.sdkHttpResponse={headers:f.headers},h})),i.then(f=>NF(f))}}},Iw=1024*1024*8,Pw=3,xw=1e3,Nw=2,Nr="x-goog-upload-status";async function kF(n,e,t){var r;let i=await kw(n,e,t),o=await(i==null?void 0:i.json());if(((r=i==null?void 0:i.headers)===null||r===void 0?void 0:r[Nr])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return o.file}async function MF(n,e,t){var r;let i=await kw(n,e,t),o=await(i==null?void 0:i.json());if(((r=i==null?void 0:i.headers)===null||r===void 0?void 0:r[Nr])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");let s=Ap(o),u=new Au;return Object.assign(u,s),u}async function kw(n,e,t){var r,i;let o=0,s=0,u=new gi(new Response),f="upload";for(o=n.size;s<o;){let d=Math.min(Iw,o-s),h=n.slice(s,s+d);s+d>=o&&(f+=", finalize");let m=0,g=xw;for(;m<Pw&&(u=await t.request({path:"",body:h,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":f,"X-Goog-Upload-Offset":String(s),"Content-Length":String(d)}}}),!(!((r=u==null?void 0:u.headers)===null||r===void 0)&&r[Nr]));)m++,await Mw(g),g=g*Nw;if(s+=d,((i=u==null?void 0:u.headers)===null||i===void 0?void 0:i[Nr])!=="active")break;if(o<=s)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return u}async function DF(n){return{size:n.size,type:n.type}}function Mw(n){return new Promise(e=>setTimeout(e,n))}var wp=class{async stat(e){let t={size:0,type:void 0};if(typeof e=="string"){let r=await Pu.stat(e);return t.size=r.size,t.type=this.inferMimeType(e),t}else return await DF(e)}async upload(e,t,r){return typeof e=="string"?await this.uploadFileFromPath(e,t,r):kF(e,t,r)}async uploadToFileSearchStore(e,t,r){return typeof e=="string"?await this.uploadFileToFileSearchStoreFromPath(e,t,r):MF(e,t,r)}inferMimeType(e){let t=e.slice(e.lastIndexOf(".")+1);return{aac:"audio/aac",abw:"application/x-abiword",arc:"application/x-freearc",avi:"video/x-msvideo",azw:"application/vnd.amazon.ebook",bin:"application/octet-stream",bmp:"image/bmp",bz:"application/x-bzip",bz2:"application/x-bzip2",csh:"application/x-csh",css:"text/css",csv:"text/csv",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",eot:"application/vnd.ms-fontobject",epub:"application/epub+zip",gz:"application/gzip",gif:"image/gif",htm:"text/html",html:"text/html",ico:"image/vnd.microsoft.icon",ics:"text/calendar",jar:"application/java-archive",jpeg:"image/jpeg",jpg:"image/jpeg",js:"text/javascript",json:"application/json",jsonld:"application/ld+json",kml:"application/vnd.google-earth.kml+xml",kmz:"application/vnd.google-earth.kmz+xml",mjs:"text/javascript",mp3:"audio/mpeg",mp4:"video/mp4",mpeg:"video/mpeg",mpkg:"application/vnd.apple.installer+xml",odt:"application/vnd.oasis.opendocument.text",oga:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",opus:"audio/opus",otf:"font/otf",png:"image/png",pdf:"application/pdf",php:"application/x-httpd-php",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",rar:"application/vnd.rar",rtf:"application/rtf",sh:"application/x-sh",svg:"image/svg+xml",swf:"application/x-shockwave-flash",tar:"application/x-tar",tif:"image/tiff",tiff:"image/tiff",ts:"video/mp2t",ttf:"font/ttf",txt:"text/plain",vsd:"application/vnd.visio",wav:"audio/wav",weba:"audio/webm",webm:"video/webm",webp:"image/webp",woff:"font/woff",woff2:"font/woff2",xhtml:"application/xhtml+xml",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xml:"application/xml",xul:"application/vnd.mozilla.xul+xml",zip:"application/zip","3gp":"video/3gpp","3g2":"video/3gpp2","7z":"application/x-7z-compressed"}[t.toLowerCase()]}async uploadFileFromPath(e,t,r){var i;let o=await this.uploadFileFromPathInternal(e,t,r),s=await(o==null?void 0:o.json());if(((i=o==null?void 0:o.headers)===null||i===void 0?void 0:i[Nr])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return s.file}async uploadFileToFileSearchStoreFromPath(e,t,r){var i;let o=await this.uploadFileFromPathInternal(e,t,r),s=await(o==null?void 0:o.json());if(((i=o==null?void 0:o.headers)===null||i===void 0?void 0:i[Nr])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");let u=Ap(s),f=new Au;return Object.assign(f,u),f}async uploadFileFromPathInternal(e,t,r){var i,o;let s=0,u=0,f=new gi(new Response),d="upload",h,m=ew.basename(e);try{if(h=await Pu.open(e,"r"),!h)throw new Error("Failed to open file");for(s=(await h.stat()).size;u<s;){let g=Math.min(Iw,s-u);u+g>=s&&(d+=", finalize");let _=new Uint8Array(g),{bytesRead:v}=await h.read(_,0,g,u);if(v!==g)throw new Error(`Failed to read ${g} bytes from file at offset ${u}. bytes actually read: ${v}`);let C=new Blob([_]),R=0,I=xw;for(;R<Pw&&(f=await r.request({path:"",body:C,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:t,headers:{"X-Goog-Upload-Command":d,"X-Goog-Upload-Offset":String(u),"Content-Length":String(v),"X-Goog-Upload-File-Name":m}}}),!(!((i=f==null?void 0:f.headers)===null||i===void 0)&&i[Nr]));)R++,await Mw(I),I=I*Nw;if(u+=v,((o=f==null?void 0:f.headers)===null||o===void 0?void 0:o[Nr])!=="active")break;if(s<=u)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return f}finally{h&&await h.close()}}};var OF="gl-node/",Iu=class{constructor(e){var t,r,i,o,s,u;if((e.project||e.location)&&e.apiKey)throw new Error("Project/location and API key are mutually exclusive in the client initializer.");this.vertexai=(r=(t=e.vertexai)!==null&&t!==void 0?t:UF("GOOGLE_GENAI_USE_VERTEXAI"))!==null&&r!==void 0?r:!1;let f=LF(),d=mi("GOOGLE_CLOUD_PROJECT"),h=mi("GOOGLE_CLOUD_LOCATION");this.apiKey=(i=e.apiKey)!==null&&i!==void 0?i:f,this.project=(o=e.project)!==null&&o!==void 0?o:d,this.location=(s=e.location)!==null&&s!==void 0?s:h,e.vertexai&&(!((u=e.googleAuthOptions)===null||u===void 0)&&u.credentials&&(console.debug("The user provided Google Cloud credentials will take precedence over the API key from the environment variable."),this.apiKey=void 0),(d||h)&&e.apiKey?(console.debug("The user provided Vertex AI API key will take precedence over the project/location from the environment variables."),this.project=void 0,this.location=void 0):(e.project||e.location)&&f?(console.debug("The user provided project/location will take precedence over the API key from the environment variables."),this.apiKey=void 0):(d||h)&&f&&(console.debug("The project/location from the environment variables will take precedence over the API key from the environment variables."),this.apiKey=void 0),!this.location&&!this.apiKey&&(this.location="global"));let m=XN(e.httpOptions,e.vertexai,mi("GOOGLE_VERTEX_BASE_URL"),mi("GOOGLE_GEMINI_BASE_URL"));m&&(e.httpOptions?e.httpOptions.baseUrl=m:e.httpOptions={baseUrl:m}),this.apiVersion=e.apiVersion,this.httpOptions=e.httpOptions;let g=new yp({apiKey:this.apiKey,googleAuthOptions:e.googleAuthOptions});this.apiClient=new sp({auth:g,project:this.project,location:this.location,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:this.httpOptions,userAgentExtra:OF+process.version,uploader:new wp,downloader:new _p}),this.models=new dp(this.apiClient),this.live=new cp(this.apiClient,g,new Ep),this.batches=new Zh(this.apiClient),this.chats=new ep(this.models,this.apiClient),this.caches=new jh(this.apiClient),this.files=new np(this.apiClient),this.operations=new hp(this.apiClient),this.authTokens=new pp(this.apiClient),this.tunings=new vp(this.apiClient),this.fileSearchStores=new gp(this.apiClient)}};function mi(n){var e,t,r;return(r=(t=(e=process==null?void 0:process.env)===null||e===void 0?void 0:e[n])===null||t===void 0?void 0:t.trim())!==null&&r!==void 0?r:void 0}function UF(n){return FF(mi(n))}function FF(n){return n===void 0?!1:n.toLowerCase()==="true"}function LF(){let n=mi("GOOGLE_API_KEY"),e=mi("GEMINI_API_KEY");return n&&e&&console.warn("Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY."),n||e||void 0}var ko="ai-adapter/providers/geminiProvider",Mu,Dw={lastModel:Be[13],lastImageModel:Be[12],apiKey:""},Du=class n extends Bi{constructor(){super(),this.lastModel=fe.aiAdapterSettings.geminiSettings.lastModel,this.lastImageModel=fe.aiAdapterSettings.geminiSettings.lastImageModel,n.restartSession(),this.checkGemini().then(e=>{ue(ko,"Gemini check success: "+e)})}generateSettings(e,t){new Mo.Setting(e).setName("Gemini").setHeading(),new Mo.Setting(e).setName("Gemini API key").setDesc("Set your gemini API token").addText(r=>r.setValue(fe.aiAdapterSettings.geminiSettings.apiKey!==""?"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022":"").onChange(async i=>{i.contains("\u2022")||(fe.aiAdapterSettings.geminiSettings.apiKey=i,n.restartSession(),this.checkGemini().then(o=>{ue(ko,"Gemini check success: "+o)}),await Ht(t))}))}async queryHandling(e){let t=await Mu.models.generateContent({model:fe.aiAdapterSettings.selectedModel.model,contents:[{role:"user",parts:[{text:e}]}]});return t.text===void 0?"[AI-ERROR] No response from Gemini API":t.text}async queryWithImageHandling(e,t){let r=await Mu.models.generateContent({model:fe.aiAdapterSettings.selectedImageModel.model,contents:[{role:"user",parts:[{text:e},{inlineData:{mimeType:"image/png",data:t}}]}]});return r.text===void 0?"[AI-ERROR] No response from Gemini API":r.text}setLastModel(e){super.setLastModel(e),fe.aiAdapterSettings.geminiSettings.lastModel=e}setLastImageModel(e){super.setLastImageModel(e),fe.aiAdapterSettings.geminiSettings.lastImageModel=e}static restartSession(){Mu=new Iu({apiKey:fe.aiAdapterSettings.geminiSettings.apiKey})}async checkGemini(){var e,t,r;try{let i=!1;for await(let o of await Mu.models.list())if((e=o.supportedActions)!=null&&e.includes("generateContent")){let s=(t=o.displayName)!=null?t:"unknown",u=(r=o.name)!=null?r:"unknown",f={name:s,model:u,imageReady:!0,provider:"gemini"};Be.some(h=>h.model===f.model&&h.imageReady)||(Be.push(f),ue(ko,"Added model: "+f.name),i=!0);let d={name:s,model:u,imageReady:!1,provider:"gemini"};Be.some(h=>h.model===f.model&&!h.imageReady)||(Be.push(d),ue(ko,"Added model: "+d.name),i=!0)}return i&&(ue(ko,"Models updated, notifying settings tab"),Gi()),!0}catch(i){return ue(ko,i),new Mo.Notice("Error connecting to gemini API. Please check your gemini API key."),new Mo.Notice(i.toString()),!1}}};var Ow=require("obsidian");var Uw="ai-adapter/util";function Ou(){switch(ue(Uw,"Initializing provider: "+fe.aiAdapterSettings.provider),fe.aiAdapterSettings.provider){case"ollama":return new an;case"gemini":return new Du}}function Fw(){if(!ft)throw ue(Uw,"Provider not initialized"),new Ow.Notice("Provider not initialized"),new Error("Provider not initialized")}var Lw={provider:"ollama",selectedModel:Be[8],selectedImageModel:Be[0],ollamaSettings:Lc,geminiSettings:Dw};function qw(n,e){new Np.Setting(n).setName("Provider").setDesc("Select the provider to use").addDropdown(t=>t.addOptions(Zm.reduce((r,i)=>(r[i]=i,r),{})).setValue(fe.aiAdapterSettings.provider).onChange(async r=>{var i,o;fe.aiAdapterSettings.provider=r,Pa(Ou()),fe.aiAdapterSettings.selectedModel=(i=ft.lastModel)!=null?i:Be[0],fe.aiAdapterSettings.selectedImageModel=(o=ft.lastImageModel)!=null?o:Be[0],await Ht(e),Gi()})),new Np.Setting(n).setName("Image model").setDesc("Select the image model to use").addDropdown(t=>t.addOptions(Be.filter(r=>r.provider==fe.aiAdapterSettings.provider&&r.imageReady).reduce((r,i)=>(r[i.name]=i.name,r),{})).setValue(fe.aiAdapterSettings.selectedImageModel.name).onChange(async r=>{fe.aiAdapterSettings.selectedImageModel=Be.find(i=>i.name===r),ft.setLastImageModel(fe.aiAdapterSettings.selectedImageModel),await Ht(e)})),ft.generateSettings(n,e)}var qF="settings",kp={debug:!1,prompt:"Describe the image. Just use Keywords. For example: cat, dog, tree. This must be Computer readable. The provided pictures are used in an notebook. Please provide at least 5 Keywords. It will be used to search for the image later.",autoClearCache:!0,aiAdapterSettings:Lw},fe=Object.assign({},kp);async function Bw(n){fe=Object.assign({},kp,await n.loadData())}async function Ht(n){await n.saveData(fe)}var Fu=class extends tn.PluginSettingTab{constructor(e,t){super(e,t),this.plugin=t,ng(rg(()=>{ue(qF,"Models changed, updating settings tab"),this.display()}))}display(){let{containerEl:e}=this;e.empty(),new tn.Setting(e).setName("Clear cache").setDesc("Clear the cache, reanalyzing images could take a while").addButton(t=>t.setButtonText("Clear cache").onClick(async()=>{await Uu(),new tn.Notice("Cache cleared")})),new tn.Setting(e).setName("Debug mode").setDesc("Enable debug mode to see logs in the console").addToggle(t=>t.setValue(fe.debug).onChange(async r=>{fe.debug=r,await Ht(this.plugin)})),new tn.Setting(e).setName("AI configuration").setHeading(),qw(e,this.plugin),new tn.Setting(e).setName("Advanced").setHeading(),new tn.Setting(e).setName("Prompt").setDesc("Set the prompt to use alongside the image").addTextArea(t=>(t.inputEl.rows=5,t.inputEl.cols=50,t.setPlaceholder("Enter the prompt").setValue(fe.prompt).onChange(async r=>{r.length===0&&(r=kp.prompt),fe.prompt=r,await Ht(this.plugin),fe.autoClearCache&&await Uu()}))),new tn.Setting(e).setName("Auto clear cache").setDesc("Clear the cache after changing the model or the prompt to reanalyze images (if toggled on the cache will be cleared)").addToggle(t=>t.setValue(fe.autoClearCache).onChange(async r=>{fe.autoClearCache=r,r&&(await Uu(),new tn.Notice("Cache cleared")),await Ht(this.plugin)}))}};var BF="util";function GF(n){let e=0;for(let r=0;r<n.length;r++)e=n.charCodeAt(r)+((e<<5)-e),e|=0;return`hsl(${(e%360+360)%360}, 70%, 50%)`}function ue(n,e){if(fe.debug){let t=GF(n);console.log(`[AIImageAnalyzer] %c[${n}]`,`color: ${t}; font-weight: bold;`,e)}}function Mr(n){let e=n.path;return e.endsWith(".png")||e.endsWith(".jpg")||e.endsWith(".jpeg")||e.endsWith(".webp")||e.endsWith(".svg")}async function Hw(n){if(n.path.endsWith(".svg")){ue(BF,"Converting SVG to PNG");try{let e=await this.app.vault.adapter.read(n.path);return await new Promise((t,r)=>{let i=document.createElement("canvas");i.width=1e3,i.height=1e3;let o=i.getContext("2d");if(!o){r(new Error("Could not get canvas context"));return}let s=new Image;s.onload=()=>{try{o.drawImage(s,0,0,1e3,1e3);let u=i.toDataURL("image/png");t(u.split(",")[1])}catch(u){r(u)}},s.onerror=u=>{console.error("Error loading SVG image:",u),r(u)},s.src=`data:image/svg+xml;base64,${btoa(e)}`})}catch(e){throw console.error("Error converting SVG to PNG:",e),e}}else return(0,Gw.arrayBufferToBase64)(await app.vault.readBinary(n))}var Js="cache";function Lu(){return`${app.vault.configDir}/plugins/ai-image-analyzer/cache`}function qu(n){let e=(0,Vw.createHash)("md5").update(n.path).digest("hex"),t=`${Lu()}`,r=`${e}.json`;return`${t}/${r}`}async function Do(n){let e=qu(n);return await app.vault.adapter.exists(e)}async function $w(n,e){if(e.length===0)return;let t=qu(n);await this.app.vault.adapter.exists(Lu())||await this.app.vault.adapter.mkdir(Lu());let r={path:n.path,text:e,libVersion:Qm};ue(Js,`Writing cache entry for ${n.path}`),await this.app.vault.adapter.write(t,JSON.stringify(r))}async function Ww(n){try{if(await Do(n)){let e=qu(n),t=await this.app.vault.adapter.read(e),r=JSON.parse(t);return r.text.length===0?(ue(Js,"Cache entry is empty, removing"),await Ks(n),null):(ue(Js,`Read cache entry for ${n.path}`),r)}}catch(e){console.error(e)}return null}async function Ks(n){let e=qu(n);if(await Do(n))return ue(Js,`Removing cache entry for ${n.path}`),await this.app.vault.adapter.remove(e)}async function Uu(){let n=Lu();if(await this.app.vault.adapter.exists(n))return ue(Js,"Clearing cache"),await this.app.vault.adapter.rmdir(n,!0)}var yi=require("obsidian");var HF=require("obsidian");var zw="ai-adapter/api";async function Jw(n,e){Fw();try{let t=await ft.queryWithImageHandling(n,e);return t.length===0?(ue(zw,"Empty response from provider"),Promise.reject("Empty response from provider")):t}catch(t){return ft instanceof an&&an.refreshInstance(),ue(zw,t),Promise.reject(t)}}var st="analyserManager",Kw=new Set,Yw=12e4;async function Mp(n){var e;try{return(e=await ba.add(()=>VF(n)))!=null?e:""}catch(t){return ue(st,t),""}}async function VF(n){let e=n.path;try{return await Rc(Xw(n),Yw)}catch(t){if(ue(st,`analyzeImageHandling failed for ${e}:`),ue(st,t),!Kw.has(e)){Kw.add(e),ft instanceof an&&an.refreshInstance(),an.abortCurrentOllamaRequest(),ue(st,`Retrying image once: ${e}`);try{return await Rc(Xw(n),Yw)}catch(r){throw ue(st,`Retry also failed for ${e}:`),ue(st,r),r}}throw t}}async function Xw(n){if(ue(st,`Analyzing image ${n.name}`),!Mr(n))return Promise.reject("File is not an image");if(await Do(n)){ue(st,"Cache hit");let e=await Ww(n);if(e&&e.text!=="")return ue(st,"Reading from cache"),ue(st,`Image analyzed ${n.name}`),Promise.resolve(e.text);ue(st,"Failed to read cache")}try{let e=await Hw(n),t=await Jw(fe.prompt,e);return ue(st,"Response: "+(t!=null?t:"null")),t?(await $w(n,t),ue(st,`Image analyzed ${n.name}`),Promise.resolve(t)):Promise.reject("Failed to analyze image")}catch(e){return ue(st,e),Promise.reject("Failed to analyze image")}}async function Bu(n){try{let e=new yi.Notice("Analyzing image",0),t=await Mp(n);return e.hide(),t==""?(new yi.Notice("Failed to analyze image"),""):(new yi.Notice("Image analyzed"),t)}catch(e){return ue(st,e),new yi.Notice("Failed to analyze image"),new yi.Notice(e.toString()),""}}async function Dp(n){try{let e=await Bu(n);if(e=="")return;await activeWindow.navigator.clipboard.writeText(e),new yi.Notice("Text copied to clipboard")}catch(e){ue(st,e)}}var Qw="main",Gu=class extends _i.Plugin{constructor(){super(...arguments);this.api={analyzeImage:Mp,canBeAnalyzed:Mr,isInCache:Do}}async onload(){ue(Qw,"loading ai image analyzer plugin"),await Bw(this),Pa(Ou()),this.addCommand({id:"analyze-image-to-clipboard",name:"Analyze image to clipboard",checkCallback:t=>{let r=Op();return r!=null&&Mr(r)?(t||Dp(r),!0):!1}}),this.addCommand({id:"analyze-image",name:"Analyze image",checkCallback:t=>{let r=Op();return r!=null&&Mr(r)?(t||Bu(r),!0):!1}}),this.addCommand({id:"clear-cache-of-active-image",name:"Clear cache of active image",checkCallback:t=>{let r=Op();return r!=null&&Mr(r)?(t||(Ks(r),new _i.Notice("Cache cleared")),!0):!1}}),this.registerEvent(this.app.workspace.on("file-menu",(t,r,i)=>{r instanceof _i.TFile&&Mr(r)&&t.addItem(o=>{o.setTitle("AI analyze image");let s=o.setSubmenu();s.addItem(u=>u.setTitle("Analyze image to clipboard").setIcon("clipboard").onClick(()=>{Dp(r)})),s.addItem(u=>u.setTitle("Analyze image").setIcon("search").onClick(async()=>{await Ks(r),await Bu(r)})),s.addItem(u=>u.setTitle("Clear cache").setIcon("trash").onClick(async()=>{await Ks(r),new _i.Notice("Cache cleared")}))})})),this.addSettingTab(new Fu(this.app,this))}onunload(){ba.clear(),ft.shutdown(),xa&&xa(),ue(Qw,"unloading ai image analyzer plugin")}};function Op(){var n,e;return(e=(n=this.app.workspace.activeEditor)==null?void 0:n.file)!=null?e:this.app.workspace.getActiveFile()}
/*! Bundled license information:

web-streams-polyfill/dist/ponyfill.es2018.js:
  (**
   * @license
   * web-streams-polyfill v3.3.3
   * Copyright 2024 Mattias Buelens, Diwank Singh Tomer and other contributors.
   * This code is released under the MIT license.
   * SPDX-License-Identifier: MIT
   *)

fetch-blob/index.js:
  (*! fetch-blob. MIT License. Jimmy Wrting <https://jimmy.warting.se/opensource> *)

formdata-polyfill/esm.min.js:
  (*! formdata-polyfill. MIT License. Jimmy Wrting <https://jimmy.warting.se/opensource> *)

node-domexception/index.js:
  (*! node-domexception. MIT License. Jimmy Wrting <https://jimmy.warting.se/opensource> *)

safe-buffer/index.js:
  (*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> *)

gtoken/build/cjs/src/index.cjs:
  (*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE *)

@google/genai/dist/node/index.mjs:
@google/genai/dist/node/index.mjs:
@google/genai/dist/node/index.mjs:
@google/genai/dist/node/index.mjs:
@google/genai/dist/node/index.mjs:
  (**
   * @license
   * Copyright 2025 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)
*/

/* nosourcemap */