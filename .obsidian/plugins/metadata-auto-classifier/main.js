/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var $=Object.defineProperty;var ye=Object.getOwnPropertyDescriptor;var Ce=Object.getOwnPropertyNames;var Te=Object.prototype.hasOwnProperty;var Ee=(s,o)=>{for(var e in o)$(s,e,{get:o[e],enumerable:!0})},Pe=(s,o,e,t)=>{if(o&&typeof o=="object"||typeof o=="function")for(let i of Ce(o))!Te.call(s,i)&&i!==e&&$(s,i,{get:()=>o[i],enumerable:!(t=ye(o,i))||t.enumerable});return s};var Se=s=>Pe($({},"__esModule",{value:!0}),s);var Re={};Ee(Re,{default:()=>H});module.exports=Se(Re);var J=require("obsidian");var g={DEFAULT_MAX_TOKENS:32e3,DEFAULT_RELIABILITY_MIN:0,DEFAULT_RELIABILITY_MAX:1,DEFAULT_TEMPERATURE:.7,MIN_RELIABILITY_THRESHOLD:.2,VERIFY_CONNECTION_SYSTEM_PROMPT:"You are a test system. You must respond with valid JSON.",VERIFY_CONNECTION_USER_PROMPT:'Return a JSON object containing {"output": [], "reliability": 0}'},K={name:"OpenAI",apiKey:"",baseUrl:"https://api.openai.com/v1/chat/completions",models:[{id:"gpt-4.1-mini",name:"GPT-4.1 Mini"}],temperature:g.DEFAULT_TEMPERATURE},xe={type:"object",properties:{output:{type:"array",items:{type:"string"},description:"Array of classified tags or categories"},reliability:{type:"number",description:"A number between 0 and 1 indicating confidence in the classification"}},required:["output","reliability"],additionalProperties:!1},j={name:"classify_content",description:"Classify content and return structured metadata",input_schema:{type:"object",properties:{output:{type:"array",items:{type:"string"},description:"Array of classification tags or metadata values"},reliability:{type:"number",minimum:g.DEFAULT_RELIABILITY_MIN,maximum:g.DEFAULT_RELIABILITY_MAX,description:"Confidence score from 0 to 1"}},required:["output","reliability"]}},q={type:"json_schema",json_schema:{name:"metadata_classifier",schema:xe,strict:!0}};var G={response_mime_type:"application/json",response_schema:{type:"object",properties:{output:{type:"array",items:{type:"string"},description:`Pick only from the reference list. Match exactly, including case and slashes.
Valid: ["technology/ai"]
Invalid: ["string"], ["Technology"], ["technology - ai"]`},reliability:{type:"number",description:`Float between 0 and 1. Do not exceed 1. Use lower value if uncertain.
Valid: 0.83
Invalid: 1.23, "high"`}},required:["output","reliability"]}},Y={type:"object",properties:{output:{type:"array",items:{type:"string"},description:"Array of classified tags or categories from the reference list"},reliability:{type:"number",minimum:g.DEFAULT_RELIABILITY_MIN,maximum:g.DEFAULT_RELIABILITY_MAX,description:"Confidence score between 0 and 1"}},required:["output","reliability"],additionalProperties:!1};var f={custom:{name:"Custom Provider",apiKeyUrl:"",apiKeyRequired:!1,modelsList:"",baseUrl:"",temperature:.7,popularModels:[]},openai:{name:"OpenAI",apiKeyUrl:"https://platform.openai.com/api-keys",apiKeyRequired:!0,modelsList:"https://platform.openai.com/docs/models",baseUrl:"https://api.openai.com/v1/chat/completions",temperature:.6,popularModels:[{id:"gpt-4.1",name:"GPT-4.1"},{id:"gpt-4.1-mini",name:"GPT-4.1 Mini"},{id:"gpt-4-turbo",name:"GPT-4 Turbo"},{id:"gpt-3.5-turbo",name:"GPT-3.5 Turbo"}]},anthropic:{name:"Anthropic",apiKeyUrl:"https://console.anthropic.com/settings/keys",apiKeyRequired:!0,modelsList:"https://docs.anthropic.com/en/docs/about-claude/models",baseUrl:"https://api.anthropic.com/v1/messages",temperature:.6,popularModels:[{id:"claude-opus-4-20250514",name:"Claude Opus 4"},{id:"claude-sonnet-4-20250514",name:"Claude Sonnet 4"},{id:"claude-3-7-sonnet-20250219",name:"Claude Sonnet 3.7"}]},gemini:{name:"Gemini",apiKeyUrl:"https://aistudio.google.com/apikey",apiKeyRequired:!0,modelsList:"https://ai.google.dev/gemini-api/docs/models",baseUrl:"https://generativelanguage.googleapis.com/v1beta",temperature:.4,popularModels:[{id:"gemini-2.5-pro",name:"Gemini 2.5 Pro"},{id:"gemini-2.0-flash",name:"Gemini 2.0 Flash"}]},openrouter:{name:"OpenRouter",apiKeyUrl:"https://openrouter.ai/settings/keys",apiKeyRequired:!0,modelsList:"https://openrouter.ai/models",baseUrl:"https://openrouter.ai/api/v1/chat/completions",temperature:.6,popularModels:[{id:"meta-llama/llama-4-maverick:free",name:"Llama 4 Maverick (Free)"},{id:"meta-llama/llama-4-scout:free",name:"Llama 4 Scout (Free)"},{id:"openrouter/auto",name:"Auto (Best for prompt)"}]},ollama:{name:"Ollama",apiKeyUrl:"",apiKeyRequired:!1,modelsList:"https://ollama.com/models",baseUrl:"http://localhost:11434/api/chat",temperature:.7,popularModels:[{id:"llama3.1",name:"Llama 3.1 8B"},{id:"llama3.2",name:"Llama 3.2 3B"},{id:"llama3.3",name:"Llama 3.3 70B"},{id:"qwen2.5:7b",name:"Qwen2.5 7B"}]},deepseek:{name:"DeepSeek",apiKeyUrl:"https://platform.deepseek.com/api_keys",apiKeyRequired:!0,modelsList:"https://api-docs.deepseek.com/quick_start/pricing",baseUrl:"https://api.deepseek.com/v1/chat/completions",temperature:1,popularModels:[{id:"deepseek-chat",name:"DeepSeek-V3"},{id:"deepseek-reasoner",name:"DeepSeek-R1"}]},lmstudio:{name:"LM Studio",apiKeyUrl:"",apiKeyRequired:!1,modelsList:"https://lmstudio.ai/docs/app/api/structured-output",baseUrl:"http://localhost:1234/v1/chat/completions",temperature:.7,popularModels:[{id:"qwen2.5-7b-instruct",name:"Qwen2.5 7B Instruct"},{id:"meta-llama-3.1-8b-instruct",name:"Meta Llama 3.1 8B Instruct"},{id:"ministral-8b-instruct-2410",name:"Ministral 8B Instruct"}]}};var w={OPENAI:f.openai.name,ANTHROPIC:f.anthropic.name,OPENROUTER:f.openrouter.name,GEMINI:f.gemini.name,DEEPSEEK:f.deepseek.name,LMSTUDIO:f.lmstudio.name,OLLAMA:f.ollama.name,CUSTOM:f.custom.name},W=()=>Date.now(),E=()=>Object.values(f),z=s=>{let e=E().find(t=>t.name===s);if(!e)throw new Error(`Provider preset not found: ${s}`);return e};var R=(s,o)=>{try{let e=JSON.parse(s.trim());if(!Array.isArray(e.output)||typeof e.reliability!="number")throw new Error("Invalid response structure: missing output array or reliability number");return{output:e.output,reliability:e.reliability}}catch(e){let t=e instanceof Error?e.message:String(e);throw new Error(`Failed to parse ${o} response: ${t}. Raw content: ${s.substring(0,200)}`)}},b=class{constructor(){this.specs={[w.ANTHROPIC]:{buildHeaders:o=>({"Content-Type":"application/json","x-api-key":o,"anthropic-version":"2023-06-01"}),buildRequestBody:(o,e,t,i)=>({model:t,max_tokens:g.DEFAULT_MAX_TOKENS,system:o,messages:[{role:"user",content:e}],temperature:i,tools:[j],tool_choice:{type:"tool",name:"classify_content"}}),buildUrl:o=>o,parseResponse:o=>{var t;let e=(t=o==null?void 0:o.content)==null?void 0:t[0];return{output:e.input.output,reliability:e.input.reliability}}},[w.GEMINI]:{buildHeaders:()=>({"Content-Type":"application/json"}),buildRequestBody:(o,e,t,i)=>({contents:[{parts:[{text:`${o}

${e}`}]}],generationConfig:{temperature:i,...G}}),buildUrl:(o,e,t)=>`${o}/models/${e}:generateContent?key=${t}`,parseResponse:o=>{var t,i,r,n,a;let e=(a=(n=(r=(i=(t=o==null?void 0:o.candidates)==null?void 0:t[0])==null?void 0:i.content)==null?void 0:r.parts)==null?void 0:n[0])==null?void 0:a.text;if(!e)throw new Error("Gemini response missing content");return R(e,"Gemini")}},[w.OLLAMA]:{buildHeaders:o=>{let e={"Content-Type":"application/json"};return o&&(e.Authorization=`Bearer ${o}`),e},buildRequestBody:(o,e,t,i)=>({model:t,messages:[{role:"system",content:o},{role:"user",content:e}],temperature:i,stream:!1,format:Y}),buildUrl:o=>o,parseResponse:o=>{var t;let e=(t=o==null?void 0:o.message)==null?void 0:t.content;if(!e)throw new Error("Ollama response missing content");return R(e,"Ollama")}},[w.OPENROUTER]:{buildHeaders:o=>({"Content-Type":"application/json",Authorization:`Bearer ${o}`,"X-Title":"Metadata Auto Classifier"}),buildRequestBody:(o,e,t,i)=>({model:t,messages:[{role:"system",content:o},{role:"user",content:e}],temperature:i,response_format:q}),buildUrl:o=>o,parseResponse:o=>{var t,i,r;let e=(r=(i=(t=o==null?void 0:o.choices)==null?void 0:t[0])==null?void 0:i.message)==null?void 0:r.content;if(!e)throw new Error("OpenRouter response missing content");return R(e,"OpenRouter")}}};this.defaultSpec={buildHeaders:o=>({"Content-Type":"application/json",Authorization:`Bearer ${o}`}),buildRequestBody:(o,e,t,i)=>({model:t,messages:[{role:"system",content:o},{role:"user",content:e}],temperature:i,response_format:q}),buildUrl:o=>o,parseResponse:o=>{var t,i,r;let e=(r=(i=(t=o==null?void 0:o.choices)==null?void 0:t[0])==null?void 0:i.message)==null?void 0:r.content;if(!e)throw new Error("API response missing content");return R(e,"API")}}}getSpec(o){return this.specs[o]||this.defaultSpec}buildHeaders(o,e){return this.getSpec(e||"").buildHeaders(o)}async callAPI(o,e,t,i,r){var y;let n=this.getSpec(t.name),a=n.buildHeaders(t.apiKey),p=n.buildRequestBody(o,e,i,(y=t.temperature)!=null?y:r),l=n.buildUrl(t.baseUrl,i,t.apiKey),u=await Q(l,a,p);return this.processApiResponse(u,t.name)}processApiResponse(o,e){return this.getSpec(e||"").parseResponse(o)}};var be=new b,X=()=>be,Z=async(s,o)=>(await X().callAPI(g.VERIFY_CONNECTION_SYSTEM_PROMPT,g.VERIFY_CONNECTION_USER_PROMPT,s,o),!0),ee=async(s,o,e,t)=>await X().callAPI(s,o,e,t),Me=(s,o,e)=>({url:s,method:"POST",headers:o,body:JSON.stringify(e)}),Q=async(s,o,e)=>{let t=Me(s,o,e),i;try{i=await(0,J.requestUrl)(t)}catch(r){throw r instanceof Error?r:new Error(String(r))}if(i.status>=500)throw new Error(`Server error (HTTP ${i.status}) from ${s}: ${i.text}`);if(i.status>=400)throw new Error(`Client error (HTTP ${i.status}) from ${s}: ${i.text}`);return i.json};var fe=require("obsidian");var V=require("obsidian"),m=class{static show(o,e){new V.Notice(o,e)}static error(o){this.show(`\u274C ${o.message}`,5e3),console.error(o)}static success(o){this.show(o,3e3)}static startProgress(o){let e=["\u280B","\u2819","\u2839","\u2838","\u283C","\u2834","\u2826","\u2827","\u2807","\u280F"],t=0,i=()=>`${e[t]} ${o}`,r=new V.Notice(i(),0);return r.interval=window.setInterval(()=>{t=(t+1)%e.length,r.setMessage(i())},100),r}static endProgress(o){o.interval&&clearInterval(o.interval),o.hide()}static async withProgress(o,e,t){let i=o.replace(/\.[^/.]+$/,""),r=this.startProgress(`Tagging ${i} (${e})`);try{return await t()}finally{this.endProgress(r)}}};var te="You are a JSON classification assistant. Respond only with a valid JSON object adhering to the specified schema.",T=`<task>
Classify the following content using the provided reference categories.
</task>

<instructions>
1. Select only from the reference categories listed.
2. Preserve the exact formatting of the reference categories, including brackets.
3. Assign a "reliability" score between 0 and 1 to each selected category, indicating confidence in the classification.
4. Maintain the full hierarchical structure for nested categories. (e.g. category/subcategory)
</instructions>

<plain_example>
{
	"output": ["machine learning", "natural language processing"],
	"reliability": 0.87
}
</plain_example>	
<wikilink_example>
{
	"output": ["[[Large Language Model]]", "[[Prompt Engineering]]"],
	"reliability": 0.92
}
</wikilink_example>
`;function oe(s,o,e,t,i=T){return i+`
	<count instruction>
    Limit your selection between {minCount} and {maxCount} categories, choosing fewer if appropriate.
	</count_instruction>

	<output_format>
	{
	  "output": string[],
	  "reliability": number
	}
	</output_format>

	<reference_categories>
	{reference}
	</reference_categories>

	<classification_context>
	{customQuery}
	</classification_context>

	<content>
	{input}
	</content>
	`.replace("{minCount}",String(s.min)).replace("{maxCount}",String(s.max)).replace("{reference}",e.join(", ")).replace("{input}",o).replace("{customQuery}",t)}var P=require("obsidian"),ie=s=>{let{contentStart:o}=(0,P.getFrontMatterInfo)(s);return s.slice(o)},re=(s,o,e)=>{var i,r;let t=new Set;for(let n of o){let a=e.getFileCache(n);a&&(s==="tags"?(i=(0,P.getAllTags)(a))==null||i.forEach(p=>t.add(p)):(r=(0,P.parseFrontMatterStringArray)(a.frontmatter,s))==null||r.forEach(p=>t.add(p)))}return[...t]};var ne=async(s,o)=>{await s(o.file,e=>{let t=o.linkType==="WikiLink"?o.value.map(n=>`[[${n}]]`):o.value,i=e[o.name]||[],r=o.overwrite?t:[...i,...t];r=[...new Set(r)].filter(Boolean),e[o.name]=r})};var he=require("obsidian");var L={name:"",count:{min:1,max:1},refs:[],overwrite:!1,linkType:"WikiLink",customQuery:""},Ae={id:0,name:"tags",refs:[],count:{min:1,max:5},overwrite:!1,linkType:"Normal",customQuery:""},se={providers:[K],selectedProvider:"",selectedModel:"",frontmatter:[Ae],classificationRule:T};var O=require("obsidian");var ae=require("obsidian");function le(s,o){let{text:e,icon:t,tooltip:i,onClick:r,cta:n,warning:a,disabled:p,className:l}=o;return e&&s.setButtonText(e),t&&s.setIcon(t),i&&s.setTooltip(i),n&&s.setCta(),a&&s.setWarning(),p!==void 0&&s.setDisabled(p),l&&s.buttonEl.addClass(l),s.onClick(r),s}function Fe(s,o){let{icon:e,tooltip:t,onClick:i,disabled:r,className:n}=o;return e&&s.setIcon(e),t&&s.setTooltip(t),r!==void 0&&s.setDisabled(r),n&&s.extraSettingsEl.addClass(n),s.onClick(i),s}function S(s,o){let e=new ae.ButtonComponent(s);return le(e,o)}function pe(s){return o=>le(o,s)}function de(s){return o=>Fe(o,s)}var d=class{constructor(o,e){let{name:t,desc:i,className:r,heading:n,textInput:a,rangeInput:p,dropdown:l,toggle:u,textArea:y,button:h,extraButton:c,buttons:I}=e;this.setting=new O.Setting(o),this.setting.setName(t),i&&this.setting.setDesc(i),n&&this.setting.setHeading(),r&&this.setting.settingEl.addClass(r),a&&this.initTextInput(a),p&&this.initRangeInput(p),l&&this.initDropdown(l),u&&this.initToggle(u),y&&this.initTextArea(y),h&&this.addButton(h),c&&this.addExtraButton(c),I&&I.forEach(C=>{C.text?this.addButton(C):this.addExtraButton(C)})}static create(o,e){new d(o,e)}initTextInput(o){this.setting.addText(e=>{o.placeholder&&e.setPlaceholder(o.placeholder),o.value!==void 0&&e.setValue(o.value),o.disabled&&(e.inputEl.disabled=!0,e.inputEl.classList.add("mod-disabled")),e.onChange(o.onChange)})}initDropdown(o){this.setting.addDropdown(e=>{var t;o.options.forEach(({value:i,display:r})=>{e.addOption(i,r)}),e.setValue((t=o.value)!=null?t:""),e.onChange(o.onChange)})}initToggle(o){this.setting.addToggle(e=>{e.setValue(o.value),e.onChange(o.onChange)})}initTextArea(o){let e=this.setting.settingEl.createDiv({cls:"textarea-container"}),t=new O.TextAreaComponent(e);o.placeholder&&t.setPlaceholder(o.placeholder),o.value!==void 0&&t.setValue(o.value),o.rows&&(t.inputEl.rows=o.rows),t.onChange(o.onChange)}addButton(o){this.setting.addButton(pe(o))}addExtraButton(o){this.setting.addExtraButton(de(o))}initRangeInput(o){let e,t,i=()=>{let r=parseInt((e==null?void 0:e.getValue())||"0",10),n=parseInt((t==null?void 0:t.getValue())||"0",10);!isNaN(r)&&!isNaN(n)&&o.onChange(r,n)};this.setting.addText(r=>{e=r,r.inputEl.type="number",r.inputEl.style.width="80px",o.minPlaceholder&&r.setPlaceholder(o.minPlaceholder),o.minValue!==void 0&&r.setValue(o.minValue.toString()),r.onChange(i)}),this.setting.controlEl.createSpan({text:"~",cls:"range-separator",attr:{style:"margin: 0 8px; color: var(--text-muted);"}}),this.setting.addText(r=>{t=r,r.inputEl.type="number",r.inputEl.style.width="80px",o.maxPlaceholder&&r.setPlaceholder(o.maxPlaceholder),o.maxValue!==void 0&&r.setValue(o.maxValue.toString()),r.onChange(i)})}};var ue=require("obsidian");var me=require("obsidian");var k=class extends me.Modal{constructor(e,t){super(e);this.selectedProvider="";this.modelName="";this.modelId="";this.props=t,t.editTarget?(this.selectedProvider=t.editTarget.provider,this.modelName=t.editTarget.name,this.modelId=t.editTarget.model):t.providers.length>0&&(this.selectedProvider=t.providers[0].name)}onOpen(){let{contentEl:e}=this;e.empty();let t=this.props.editTarget?"Edit Model":"Add Model";e.createEl("h2",{text:t}),this.addProviderSetting(e),this.props.editTarget||this.addPopularModelsSection(e),this.addModelForm(e),this.addButtons(e)}addProviderSetting(e){let t=this.props.providers.map(i=>({value:i.name,display:i.name}));d.create(e,{name:"Provider",desc:"Select the provider for this model.",dropdown:{options:t,value:this.selectedProvider,onChange:i=>{this.selectedProvider=i,this.updatePopularModels()}}})}addPopularModelsSection(e){let t=e.createEl("div",{cls:"popular-models-section"});t.createEl("h3",{text:"Popular models"}),t.createEl("p",{text:"Choose from commonly used models or enter custom model details.",cls:"setting-item-description"}),this.renderPopularModels(t)}renderPopularModels(e){let t=e.querySelector(".popular-models-container");t&&t.remove();let i=null;this.selectedProvider&&(i=E().find(l=>l.name===this.selectedProvider)||null);let r=e.createEl("div",{cls:"popular-models-container"});r.style.display="grid",r.style.gridTemplateColumns="repeat(auto-fit, minmax(200px, 1fr))",r.style.gap="8px",r.style.marginTop="10px",r.style.marginBottom="20px",i&&i.popularModels&&i.popularModels.forEach(p=>{let l=r.createEl("label",{cls:"model-option"});l.style.display="flex",l.style.alignItems="center",l.style.padding="8px 12px",l.style.border="1px solid var(--background-modifier-border)",l.style.borderRadius="4px",l.style.cursor="pointer";let u=l.createEl("input",{type:"radio",attr:{name:"popular-model"}});u.value=p.id,u.style.marginRight="8px",u.addEventListener("change",()=>{u.checked&&(this.modelName=p.name,this.modelId=p.id,this.updateFormInputs(),this.updateRadioSelection())}),l.createEl("span",{text:p.name})});let n=r.createEl("label",{cls:"model-option custom-option"});n.style.display="flex",n.style.alignItems="center",n.style.padding="8px 12px",n.style.border="1px solid var(--background-modifier-border)",n.style.borderRadius="4px",n.style.cursor="pointer";let a=n.createEl("input",{type:"radio",attr:{name:"popular-model"}});a.value="custom",a.style.marginRight="8px",a.checked=!0,a.addEventListener("change",()=>{a.checked&&(this.modelName="",this.modelId="",this.updateFormInputs(),this.updateRadioSelection())}),n.createEl("span",{text:"Custom model"})}updateRadioSelection(){this.contentEl.querySelectorAll(".model-option").forEach(t=>{let i=t.querySelector('input[type="radio"]'),r=t;i&&i.checked?(r.style.backgroundColor="var(--interactive-accent)",r.style.color="var(--text-on-accent)",r.style.borderColor="var(--interactive-accent)"):(r.style.backgroundColor="",r.style.color="",r.style.borderColor="var(--background-modifier-border)")})}addModelForm(e){let t=e.createDiv({cls:"model-form-container"});d.create(t,{name:"Display name",desc:"The name of the model you want to display in the interface.",textInput:{placeholder:"Enter display name",value:this.modelName,onChange:i=>{this.modelName=i}}}),d.create(t,{name:"Model ID",desc:"The identifier of the model from your provider. Typically a short name without spaces.",textInput:{placeholder:"Enter model ID",value:this.modelId,onChange:i=>{this.modelId=i}}})}updateFormInputs(){let e=this.contentEl.querySelector(".model-form-container");if(!e)return;let t=e.querySelector('input[placeholder="Enter display name"]');t&&(t.value=this.modelName);let i=e.querySelector('input[placeholder="Enter model ID"]');i&&(i.value=this.modelId)}addButtons(e){let t=e.createDiv({cls:"button-container"});t.style.display="flex",t.style.justifyContent="flex-end",t.style.gap="8px",t.style.marginTop="20px",S(t,{text:"Cancel",onClick:()=>this.close()}),S(t,{text:"Save",cta:!0,onClick:async()=>{if(this.validateForm()){let i={id:this.modelId,name:this.modelName};this.props.onSave({provider:this.selectedProvider,model:i,isEdit:!!this.props.editTarget,oldModel:this.props.editTarget?{model:this.props.editTarget.model,provider:this.props.editTarget.provider}:void 0}),this.close()}}})}updatePopularModels(){let e=this.contentEl.querySelector(".popular-models-section");e&&this.renderPopularModels(e)}validateForm(){return this.selectedProvider?this.modelId.trim()?this.modelName.trim()?!0:(m.error(new Error("Display name is required")),!1):(m.error(new Error("Model ID is required")),!1):(m.error(new Error("Provider is required")),!1)}onClose(){let{contentEl:e}=this;e.empty()}};var ce=require("obsidian");var N=class extends ce.Modal{constructor(e,t,i){super(e);this.onSave=t,i?this.providerConfig=i:this.providerConfig={name:"Custom Provider",apiKey:"",baseUrl:"",models:[],temperature:.7}}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"Provider Settings"}),this.addPresetSetting(e),this.addProviderForm(e),this.addButtons(e)}addPresetSetting(e){let i=E().map(n=>({value:n.name,display:n.name})),r=this.providerConfig.name||"Custom Provider";d.create(e,{name:"Provider Preset",desc:"Select a predefined provider",dropdown:{options:i,value:r,onChange:n=>{this.loadPresetData(n)}}})}addProviderForm(e){let t=E(),i=t.some(n=>n.name===this.providerConfig.name);d.create(e,{name:"Provider Name",desc:i?"Provider name (from preset)":"Enter a unique name for your provider",textInput:{placeholder:"Enter provider name",value:this.providerConfig.name,disabled:!1,onChange:n=>{this.providerConfig.name=n}}}),d.create(e,{name:"API URL",desc:"The complete API URL including endpoint (e.g., https://api.openai.com/v1/chat/completions)",textInput:{placeholder:"https://api.example.com/v1/chat/completions",value:this.providerConfig.baseUrl,onChange:n=>{this.providerConfig.baseUrl=n}}});let r=t.find(n=>n.name===this.providerConfig.name);if(d.create(e,{name:"API Key",desc:"Your API key for this provider",textInput:{placeholder:"Enter API key",value:this.providerConfig.apiKey,onChange:n=>{this.providerConfig.apiKey=n}}}),r!=null&&r.apiKeyUrl){let n=e.querySelector(".setting-item:last-child .setting-item-description");if(n){let a=document.createElement("a");a.href=r.apiKeyUrl,a.target="_blank",a.style.color="var(--interactive-accent)",a.style.marginLeft="4px",a.textContent="Get your API key here",n.appendChild(a)}}}addButtons(e){let t=e.createDiv({cls:"button-container"});t.style.display="flex",t.style.justifyContent="flex-end",t.style.gap="8px",t.style.marginTop="20px",S(t,{text:"Cancel",onClick:()=>this.close()}),S(t,{text:"Save",cta:!0,onClick:()=>{this.validateForm()&&(this.onSave(this.providerConfig),this.close())}})}loadPresetData(e){let t=z(e);this.providerConfig.name=t.name,this.providerConfig.baseUrl=t.baseUrl,this.providerConfig.temperature=t.temperature,this.updateForm()}updateForm(){let e=this.contentEl.querySelectorAll(".setting-item");for(let i=e.length-1;i>=1;i--)e[i].remove();this.addProviderForm(this.contentEl);let t=this.contentEl.querySelector(".button-container");t&&t.remove(),this.addButtons(this.contentEl)}validateForm(){if(!this.providerConfig.name.trim())return m.error(new Error("[Provider validation] Provider name is required. Please enter a name for your provider.")),!1;if(!this.providerConfig.baseUrl.trim())return m.error(new Error("[Provider validation] API URL is required. Please enter a valid API endpoint URL.")),!1;try{new URL(this.providerConfig.baseUrl)}catch(e){return m.error(new Error("[URL validation] Please enter a valid URL (e.g., https://api.example.com/v1/chat/completions)")),!1}return!0}onClose(){let{contentEl:e}=this;e.empty()}};var M=class{constructor(o,e){this.plugin=o;this.containerEl=e;this.currentProviders=[];this.app=o.app}display(){let{classificationRule:o,providers:e,selectedModel:t}=this.plugin.settings;this.currentProviders=e,this.containerEl.empty(),this.containerEl.createEl("h2",{text:"API Configuration"}),this.addClassificationRule(this.containerEl,o),this.addProviderSection(this.containerEl,e),this.addModelSection(this.containerEl,e,t)}addProviderSection(o,e){let t=o.createEl("div",{cls:"provider-section"});t.createEl("h3",{text:"Providers"}),e.forEach(i=>{d.create(t,{name:i.name,buttons:[{icon:"pencil",text:"Edit",onClick:()=>this.openProviderModal("edit",i)},{icon:"trash",text:"Delete",onClick:async()=>{this.plugin.settings.providers=this.plugin.settings.providers.filter(r=>r.name!==i.name),this.plugin.settings.selectedProvider===i.name&&(this.plugin.settings.selectedProvider="",this.plugin.settings.selectedModel=""),await this.plugin.saveSettings(),this.display()}}]})}),d.create(t,{name:"",button:{text:"+ Add provider",onClick:()=>this.openProviderModal("add")}})}addClassificationRule(o,e){let t=o.createDiv({cls:"custom-prompt-container"});t.style.width="100%",t.style.marginTop="8px",t.style.marginBottom="16px",d.create(t,{name:"Classification Rule",desc:"Customize the prompt template for classification requests",button:{icon:"reset",tooltip:"Reset to default template",onClick:()=>{i.setValue(T),this.plugin.settings.classificationRule=T,this.plugin.saveSettings(),this.display()}}});let i=new ue.TextAreaComponent(t).setPlaceholder(T).setValue(e).onChange(async r=>{this.plugin.settings.classificationRule=r,await this.plugin.saveSettings()});i.inputEl.rows=10,i.inputEl.style.width="100%"}addModelSection(o,e,t){let i=o.createEl("div",{cls:"model-section"});i.createEl("h3",{text:"Models"}),this.addModelSelectionDropdown(i,e,t),this.addModelList(i,e,t),d.create(i,{name:"",button:{text:"+ Add model",onClick:()=>this.openModelModal("add")}})}addModelSelectionDropdown(o,e,t){let i=[];if(e.forEach(a=>{a.models.forEach(p=>{i.push({value:`${a.name}::${p.id}`,display:`${p.name} (${a.name})`})})}),i.length===0){o.createEl("p",{text:"No models configured. Add a model to get started.",cls:"setting-item-description"});return}let r=this.plugin.settings.selectedProvider,n=r&&t?`${r}::${t}`:"";d.create(o,{name:"Selected Model",desc:"Choose the model to use for classification",dropdown:{options:i,value:n,onChange:async a=>{if(a){let[p,l]=a.split("::");this.plugin.settings.selectedProvider=p,this.plugin.settings.selectedModel=l}else this.plugin.settings.selectedProvider="",this.plugin.settings.selectedModel="";await this.plugin.saveSettings()}}})}addModelList(o,e,t){e.forEach(i=>{i.models.forEach(r=>{let n=t===r.id,a={model:r.id,name:r.name,provider:i.name},p=n?`${r.name} \u2713`:r.name;d.create(o,{name:p,desc:i.name,buttons:[{icon:"check-circle",text:"Test",onClick:async()=>{try{await Z(i,r.id)?m.success(`${r.name} connection test successful!`):m.error(new Error(`${r.name} connection test failed!`))}catch(l){m.error(l instanceof Error?l:new Error("Test failed"))}}},{icon:"pencil",text:"Edit",onClick:()=>this.openModelModal("edit",a)},{icon:"trash",text:"Delete",onClick:async()=>{let l=this.plugin.settings.providers.find(u=>u.name===i.name);l&&(l.models=l.models.filter(u=>u.id!==r.id)),this.plugin.settings.selectedModel===r.id&&(this.plugin.settings.selectedProvider="",this.plugin.settings.selectedModel=""),await this.plugin.saveSettings(),this.display()}}]})})})}openProviderModal(o,e){new N(this.app,async i=>{if(o==="add")this.plugin.settings.providers.push(i);else if(o==="edit"&&e){let r=this.plugin.settings.providers.findIndex(n=>n.name===e.name);r!==-1&&(this.plugin.settings.providers[r]=i,this.plugin.settings.selectedProvider===e.name&&(this.plugin.settings.selectedProvider=i.name))}await this.plugin.saveSettings(),this.display()},e).open()}openModelModal(o,e){let t={providers:this.currentProviders,onSave:async r=>{if(r.isEdit&&r.oldModel){let n=this.plugin.settings.providers.find(p=>{var l;return p.name===((l=r.oldModel)==null?void 0:l.provider)});n&&(n.models=n.models.filter(p=>{var l;return p.id!==((l=r.oldModel)==null?void 0:l.model)}));let a=this.plugin.settings.providers.find(p=>p.name===r.provider);a&&a.models.push(r.model),e&&e.model===r.oldModel.model&&(this.plugin.settings.selectedProvider=r.provider,this.plugin.settings.selectedModel=r.model.id)}else{let n=this.plugin.settings.providers.find(a=>a.name===r.provider);n&&n.models.push(r.model)}await this.plugin.saveSettings(),this.display()},editTarget:e};new k(this.app,t).open()}};var v=require("obsidian");var ge=require("obsidian"),_=class extends ge.FuzzySuggestModal{constructor(e,t){super(e);this.onItemSelected=t}getItems(){return this.app.vault.getMarkdownFiles()}getItemText(e){return e.basename}renderSuggestion(e,t){t.createEl("div",{text:e.item.basename}),t.createEl("small",{text:e.item.path})}onChooseItem(e){this.onItemSelected(e),this.close()}};var U=class{constructor(o){this.app=o}openFileSelector(o){new _(this.app,t=>{o(t.basename)}).open()}};var B=class extends v.Modal{constructor(e,t){super(e);this.props=t}onOpen(){let{contentEl:e}=this;this.setTitle(`Edit Setting: ${this.props.frontmatterSetting.name}`),d.create(e,{name:"Name",className:"setting-name",textInput:{placeholder:"Enter name",value:this.props.frontmatterSetting.name,onChange:async i=>{this.props.frontmatterSetting.name=i}}});let t=e.createDiv({cls:"controls-container"});this.props.options.showLinkType&&this.addLinkTypeSetting(t),this.addOverwriteSetting(t),this.addCountSetting(t),this.props.options.showOptions&&this.addOptionsSection(t),this.addCustomQuerySection(t),this.addActionButtons(e)}addLinkTypeSetting(e){d.create(e,{name:"Link Type",className:"control-setting",dropdown:{options:[{value:"WikiLink",display:"WikiLink"},{value:"Normal",display:"Normal"}],value:this.props.frontmatterSetting.linkType||"Normal",onChange:async t=>{this.props.frontmatterSetting.linkType=t}}})}addOverwriteSetting(e){d.create(e,{name:"Overwrite",className:"control-setting",toggle:{value:this.props.frontmatterSetting.overwrite,onChange:async t=>{this.props.frontmatterSetting.overwrite=t}}})}addCountSetting(e){new v.Setting(e).setName("Maximum Count").addSlider(t=>{t.setLimits(1,10,1).setValue(this.props.frontmatterSetting.count.max).setDynamicTooltip().onChange(i=>{this.props.frontmatterSetting.count.min=1,this.props.frontmatterSetting.count.max=i})})}addOptionsSection(e){if(this.props.options.showOptions&&(new v.Setting(e).setName("Available Options").setDesc("Values that the AI can use as suggestions").addButton(t=>{t.setButtonText("Browse Files").setIcon("folder").onClick(()=>{new U(this.app).openFileSelector(r=>{let n=this.props.frontmatterSetting.linkType==="WikiLink"?`[[${r}]]`:r,a=this.props.frontmatterSetting.refs||[];this.props.frontmatterSetting.refs=[...a,n],this.updateOptionsTextarea()})})}),this.props.options.showTextArea)){let t="";this.props.frontmatterSetting.refs&&this.props.frontmatterSetting.refs.length>0&&(t=this.props.frontmatterSetting.refs.join(", ")),this.textAreaComponent=new v.TextAreaComponent(e),this.textAreaComponent.setPlaceholder("Option1, Option2, Option3...").setValue(t).onChange(async i=>{let r=i.split(",").map(n=>n.trim()).filter(Boolean);this.props.frontmatterSetting.refs=r}),this.textAreaComponent.inputEl.rows=4,this.textAreaComponent.inputEl.setCssStyles({width:"100%"})}}updateOptionsTextarea(){if(this.textAreaComponent){let e="";this.props.frontmatterSetting.refs&&this.props.frontmatterSetting.refs.length>0&&(e=this.props.frontmatterSetting.refs.join(", ")),this.textAreaComponent.setValue(e)}}addCustomQuerySection(e){new v.Setting(e).setName("Custom Classification Rules").setDesc("Add custom instructions to provide more context for classification.");let t=new v.TextAreaComponent(e);t.setPlaceholder("Enter specific classification rules or additional context here...").setValue(this.props.frontmatterSetting.customQuery||"").onChange(async i=>{this.props.frontmatterSetting.customQuery=i}),t.inputEl.rows=4,t.inputEl.setCssStyles({width:"100%"})}addActionButtons(e){new v.Setting(e).addButton(t=>t.setButtonText("Cancel").onClick(()=>{this.close()})).addButton(t=>t.setButtonText("Save").setCta().onClick(async()=>{await this.props.onSave(this.props.frontmatterSetting),this.close()}))}onClose(){let{contentEl:e}=this;e.empty()}};var x=class{constructor(o,e){this.plugin=o;this.containerEl=e}createFrontmatterSetting(o,e,t,i=!1){var n,a;let r=[{icon:"pencil",tooltip:"Edit Frontmatter",onClick:()=>t.onEdit(e)}];i&&r.push({icon:"trash",tooltip:"Delete Frontmatter",onClick:()=>t.onDelete(e)}),d.create(o,{name:e.name||"Please enter name",desc:`Type: ${e.linkType}, Max: ${(a=(n=e.count)==null?void 0:n.max)!=null?a:5}, Overwrite: ${e.overwrite}`,buttons:r})}openEditModal(o,e){let t={frontmatterSetting:o,options:this.options,onSave:e};new B(this.plugin.app,t).open()}};var A=class extends x{constructor(){super(...arguments);this.options={showLinkType:!0,showOptions:!0,showTextArea:!0}}display(){let{frontmatter:e}=this.plugin.settings,t=e.filter(i=>i.id!==0);this.containerEl.empty(),t.forEach(i=>{let r={onEdit:n=>this.handleEdit(n),onDelete:n=>this.handleDelete(n)};this.createFrontmatterSetting(this.containerEl,i,r,!0)})}handleEdit(e){this.openEditModal(e,async t=>{this.plugin.registerCommand(t.name,async()=>await this.plugin.processFrontmatter(t.id)),await this.plugin.saveSettings(),this.display()})}async handleDelete(e){confirm(`Are you sure you want to delete "${e.name}" frontmatter?`)&&(this.plugin.settings.frontmatter=this.plugin.settings.frontmatter.filter(i=>i.id!==e.id),await this.plugin.saveSettings(),this.display())}};var F=class extends x{constructor(){super(...arguments);this.options={showLinkType:!1,showOptions:!1,showTextArea:!1}}display(){this.containerEl.empty();let e=this.plugin.settings.frontmatter.find(i=>i.id===0);if(!e)return;let t={onEdit:i=>this.handleEdit(i),onDelete:()=>{}};this.createFrontmatterSetting(this.containerEl,e,t,!1)}handleEdit(e){this.openEditModal(e,async t=>{let i=this.plugin.settings.frontmatter.findIndex(r=>r.id===0);i!==-1&&(this.plugin.settings.frontmatter[i]=t),await this.plugin.saveSettings(),this.display()})}};var Ie=require("obsidian");var D=class extends he.PluginSettingTab{constructor(e){super(e.app,e);this.plugin=e,this.apiContainer=document.createElement("div"),this.tagContainer=document.createElement("div"),this.frontmatterContainer=document.createElement("div"),this.api=new M(e,this.apiContainer),this.tagSetting=new F(e,this.tagContainer),this.frontmatterSetting=new A(e,this.frontmatterContainer)}display(){let{containerEl:e}=this;e.empty(),d.create(e,{name:"Support Auto Classifier",desc:"If you find Auto Classifier valuable, consider supporting its development!",heading:!0,className:"auto-classifier-settings-support",button:{text:"Buy Me a Coffee",cta:!0,onClick:()=>window.open("https://www.buymeacoffee.com/gobeumsu9","_blank")}}),this.apiContainer=e.createDiv({cls:"api-section"}),this.api=new M(this.plugin,this.apiContainer),this.api.display(),e.createEl("h2",{text:"Frontmatters"}),this.tagContainer=e.createDiv({cls:"tag-section"}),this.tagSetting=new F(this.plugin,this.tagContainer),this.tagSetting.display(),this.frontmatterContainer=e.createDiv({cls:"frontmatter-section"}),this.frontmatterSetting=new A(this.plugin,this.frontmatterContainer),this.frontmatterSetting.display();let t=e.createDiv({cls:"add-button-container"});d.create(t,{name:"",button:{text:"+ Add frontmatter",onClick:()=>this.addNewFrontmatter()}})}addNewFrontmatter(){let e={id:W(),...L};this.plugin.settings.frontmatter.push(e),this.plugin.saveSettings(),this.frontmatterSetting.display()}};var H=class extends fe.Plugin{constructor(){super(...arguments);this.processFrontmatterItem=async(e,t,i)=>{let r=t.name.replace(/\.[^/.]+$/,"");(!i.refs||i.refs.length===0)&&(i.refs=re(i.name,this.app.vault.getMarkdownFiles(),this.app.metadataCache),await this.saveSettings());let n=i.refs,a=i.linkType==="WikiLink"?n.map(c=>c.startsWith("[[")&&c.endsWith("]]")?c.slice(2,-2):c):n;if(a.length===0){let c=new Error(`Tagging ${r} (${i.name}) - No reference values found. Please add some reference tags/categories in the plugin settings.`);m.error(c);return}if(!e.apiKey){let c=new Error(`API key not configured for provider ${e.name}. Please check your settings.`);m.error(c);return}if(!this.settings.selectedModel){let c=new Error("No model selected. Please select a model in the plugin settings.");m.error(c);return}let p=await this.app.vault.read(t),l=ie(p),u=this.settings.classificationRule,y=oe(i.count,l,a,i.customQuery,u),h=await m.withProgress(t.name,i.name,()=>ee(te,y,e,this.settings.selectedModel));if(h&&h.reliability>g.MIN_RELIABILITY_THRESHOLD){await ne((C,ve)=>this.app.fileManager.processFrontMatter(C,ve),{file:t,name:i.name,value:h.output,overwrite:i.overwrite,linkType:i.linkType});let I=[`\u2713 ${r} (${i.name})`,`Reliability: ${h.reliability}`,"Added:",...h.output.map(C=>`- ${C}`)].join(`
`);m.success(I)}else if(h){let c=new Error(`Tagging ${r} (${i.name}) - Low reliability (${h.reliability})`);m.error(c)}}}async onload(){await this.loadSettings(),this.setupCommand(),this.addSettingTab(new D(this))}setupCommand(){this.settings.frontmatter.forEach(e=>{this.registerCommand(e.name,async()=>await this.processFrontmatter(e.id))}),this.registerCommand("Fetch all frontmatter using current provider",async()=>await this.processAllFrontmatter())}registerCommand(e,t){this.addCommand({id:`fetch-frontmatter-${e}`,name:`Fetch frontmatter: ${e}`,callback:async()=>await t()})}async processAllFrontmatter(){let e=this.settings.frontmatter.map(t=>t.id);for(let t of e)await this.processFrontmatter(t)}async processFrontmatter(e){let t=this.app.workspace.getActiveFile();if(!t){let n=new Error("No active file.");m.error(n);return}let i=this.getSelectedProvider();if(!i){let n=new Error("No provider selected.");m.error(n);return}let r=this.settings.frontmatter.find(n=>n.id===e);if(!r){let n=new Error(`No setting found for frontmatter ID ${e}.`);m.error(n);return}await this.processFrontmatterItem(i,t,r)}async loadSettings(){this.settings=Object.assign({},se,await this.loadData()),this.settings.frontmatter=this.settings.frontmatter.map(e=>{var t;return{...L,...e,count:(t=e.count)!=null?t:{min:1,max:5}}}),await this.saveSettings()}async saveSettings(){await this.saveData(this.settings)}getSelectedProvider(){let e=this.settings.providers.find(t=>t.name===this.settings.selectedProvider);if(!e)throw new Error("Selected provider not found");return e}};

/* nosourcemap */