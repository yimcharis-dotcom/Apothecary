/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var sc=Object.create;var zs=Object.defineProperty;var nc=Object.getOwnPropertyDescriptor;var ic=Object.getOwnPropertyNames;var oc=Object.getPrototypeOf,ac=Object.prototype.hasOwnProperty;var lc=(s,e)=>{for(var t in e)zs(s,t,{get:e[t],enumerable:!0})},Mo=(s,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of ic(e))!ac.call(s,n)&&n!==t&&zs(s,n,{get:()=>e[n],enumerable:!(r=nc(e,n))||r.enumerable});return s};var cc=(s,e,t)=>(t=s!=null?sc(oc(s)):{},Mo(e||!s||!s.__esModule?zs(t,"default",{value:s,enumerable:!0}):t,s)),dc=s=>Mo(zs({},"__esModule",{value:!0}),s);var Gu={};lc(Gu,{default:()=>ei});module.exports=dc(Gu);var K=require("obsidian");var he=require("obsidian");var Ro={settings:{notice:'Dieses Plugin ist eine Konfigurationszentrale f\xFCr KI-Anbieter. Es macht selbst nichts, aber <a href="https://github.com/pfrankov/obsidian-ai-providers#required-by-plugins">andere Plugins</a> k\xF6nnen es nutzen, um KI-Einstellungen nicht mehrfach konfigurieren zu m\xFCssen.',configuredProviders:"KI-anbieter",addNewProvider:"Neuen anbieter hinzuf\xFCgen",addProvider:"Anbieter hinzuf\xFCgen",providerName:"Anbietername",providerNameDesc:"Geben Sie einen Namen f\xFCr diesen Anbieter ein",providerNamePlaceholder:"Mein anbieter",providerType:"Anbietertyp",providerTypeDesc:"W\xE4hlen Sie den KI-anbietertyp aus",providerUrl:"Anbieter-URL",providerUrlDesc:"Geben Sie die API-Endpunkt-URL ein",providerUrlPlaceholder:"https://...",apiKey:"API-Schl\xFCssel",apiKeyDesc:"Geben Sie Ihren API-Schl\xFCssel ein (falls erforderlich)",apiKeyPlaceholder:"sk-...",defaultModel:"Standardmodell",defaultModelDesc:"W\xE4hlen Sie das Standard-KI-Modell f\xFCr diesen Anbieter",save:"Speichern",cancel:"Abbrechen",options:"Optionen",delete:"L\xF6schen",duplicate:"Duplizieren",deleteConfirmation:'M\xF6chten Sie den Anbieter "{{name}}" wirklich l\xF6schen?',modelsUpdated:"Modellliste aktualisiert",refreshModelsList:"Modellliste aktualisieren",model:"Modell",modelDesc:"W\xE4hlen Sie das KI-Modell f\xFCr diesen Anbieter.",modelTextDesc:"Geben Sie den KI-Modellnamen ein.",modelTextOnlyDesc:"Geben Sie den KI-Modellnamen f\xFCr diesen Anbieter ein.",modelSearchPlaceholder:"Modelle suchen...",loadingModels:"Modelle werden geladen...",noModelsAvailable:"Keine Modelle verf\xFCgbar",noModelMatches:"Keine passenden Modelle",editProvider:"Anbieter bearbeiten",developerSettings:"F\xFCr Entwickler",developerSettingsDesc:"Zus\xE4tzliche Einstellungen f\xFCr Entwicklung und Debugging aktivieren",debugLogging:"Debug-protokollierung",debugLoggingDesc:"Detaillierte Protokollierung in der Konsole aktivieren",useNativeFetch:"Nativen fetch verwenden",useNativeFetchDesc:"Native Fetch API anstelle der Electron-Implementierung verwenden (kann bei CORS-Problemen helfen)"},modals:{confirm:"Best\xE4tigen",cancel:"Abbrechen"},errors:{failedToFetchModels:"Modelle konnten nicht abgerufen werden",failedToExecuteRequest:"Anfrage konnte nicht ausgef\xFChrt werden",failedToEmbed:"Fehler beim Generieren der Einbettungen",missingApiKey:"API-Schl\xFCssel ist erforderlich",missingUrl:"Anbieter-URL ist erforderlich",missingModel:"Modell muss ausgew\xE4hlt werden",pluginMustBeUpdated:"Plugin muss aktualisiert werden",pluginMustBeUpdatedFormatted:"Das Plugin muss aktualisiert werden, um mit dieser Version von AI Providers zu funktionieren",providerNameRequired:"Anbietername ist erforderlich",providerNameExists:'Ein Anbieter mit dem Namen "{{name}}" existiert bereits'}};var ko={settings:{notice:'This plugin is a configuration hub for AI providers. It does nothing by itself, but <a href="https://github.com/pfrankov/obsidian-ai-providers#required-by-plugins">other plugins</a> can use it to avoid duplicated configuration.',configuredProviders:"AI providers",addNewProvider:"Add new provider",addProvider:"Add provider",providerName:"Provider name",providerNameDesc:"Enter a name for this provider",providerNamePlaceholder:"My provider",providerType:"Provider type",providerTypeDesc:"Select the type of AI provider",providerUrl:"Provider URL",providerUrlDesc:"Enter the API endpoint URL",providerUrlPlaceholder:"https://...",apiKey:"API key",apiKeyDesc:"Enter your API key (if required)",apiKeyPlaceholder:"sk-...",defaultModel:"Default model",defaultModelDesc:"Select the default AI model for this provider",save:"Save",cancel:"Cancel",options:"Options",delete:"Delete",duplicate:"Duplicate",deleteConfirmation:'Are you sure you want to delete provider "{{name}}"?',modelsUpdated:"Models list updated",refreshModelsList:"Refresh models list",model:"Model",modelDesc:"Select the AI model for this provider.",modelTextDesc:"Enter the AI model name.",modelTextOnlyDesc:"Enter the AI model name for this provider.",modelSearchPlaceholder:"Search models...",loadingModels:"Loading models...",noModelsAvailable:"No models available",noModelMatches:"No matching models",editProvider:"Edit provider",developerSettings:"For developers",developerSettingsDesc:"Enable additional settings for development and debugging",debugLogging:"Debug Logging",debugLoggingDesc:"Enable debug logging for troubleshooting",useNativeFetch:"Use native Fetch",useNativeFetchDesc:"Use native Fetch API instead of electron-specific implementation (may help with CORS issues)"},modals:{confirm:"Confirm",cancel:"Cancel"},errors:{failedToFetchModels:"Failed to fetch models",failedToExecuteRequest:"Failed to execute request",failedToEmbed:"Failed to generate embeddings",missingApiKey:"API key is required",missingUrl:"Provider URL is required",missingModel:"Model must be selected",pluginMustBeUpdated:"Plugin must be updated",pluginMustBeUpdatedFormatted:"Plugin must be updated to work with this version of AI Providers",providerNameRequired:"Provider name is required",providerNameExists:'A provider with the name "{{name}}" already exists'}};var To={settings:{notice:'Este plugin es un centro de configuraci\xF3n para proveedores de IA. No hace nada por s\xED mismo, pero <a href="https://github.com/pfrankov/obsidian-ai-providers#required-by-plugins">otros plugins</a> pueden usarlo para evitar configuraciones duplicadas.',configuredProviders:"Proveedores de IA",addNewProvider:"A\xF1adir nuevo proveedor",addProvider:"A\xF1adir proveedor",providerName:"Nombre del proveedor",providerNameDesc:"Introduce un nombre para este proveedor",providerNamePlaceholder:"Mi proveedor",providerType:"Tipo de proveedor",providerTypeDesc:"Selecciona el tipo de proveedor de IA",providerUrl:"URL del proveedor",providerUrlDesc:"Introduce la URL del endpoint de la API",providerUrlPlaceholder:"https://...",apiKey:"Clave API",apiKeyDesc:"Introduce tu clave API (si es necesaria)",apiKeyPlaceholder:"sk-...",defaultModel:"Modelo predeterminado",defaultModelDesc:"Selecciona el modelo de IA predeterminado para este proveedor",save:"Guardar",cancel:"Cancelar",options:"Opciones",delete:"Eliminar",duplicate:"Duplicar",deleteConfirmation:'\xBFEst\xE1s seguro de que quieres eliminar el proveedor "{{name}}"?',modelsUpdated:"Lista de modelos actualizada",refreshModelsList:"Actualizar lista de modelos",model:"Modelo",modelDesc:"Selecciona el modelo de IA para este proveedor.",modelTextDesc:"Introduce el nombre del modelo de IA.",modelTextOnlyDesc:"Introduce el nombre del modelo de IA para este proveedor.",modelSearchPlaceholder:"Buscar modelos...",loadingModels:"Cargando modelos...",noModelsAvailable:"No hay modelos disponibles",noModelMatches:"No hay modelos coincidentes",editProvider:"Editar proveedor",developerSettings:"Para desarrolladores",developerSettingsDesc:"Habilitar configuraciones adicionales para desarrollo y depuraci\xF3n",debugLogging:"Registro de depuraci\xF3n",debugLoggingDesc:"Habilitar el registro de depuraci\xF3n para solucionar problemas",useNativeFetch:"Usar Fetch nativo",useNativeFetchDesc:"Usar la API Fetch nativa en lugar de la implementaci\xF3n espec\xEDfica de Electron (puede ayudar con problemas de CORS)"},modals:{confirm:"Confirmar",cancel:"Cancelar"},errors:{failedToFetchModels:"Error al obtener modelos",failedToExecuteRequest:"Error al ejecutar la solicitud",failedToEmbed:"Error al generar incrustaciones (embeddings)",missingApiKey:"Se requiere clave API",missingUrl:"Se requiere URL del proveedor",missingModel:"Se debe seleccionar un modelo",pluginMustBeUpdated:"El plugin debe ser actualizado",pluginMustBeUpdatedFormatted:"El plugin debe ser actualizado para funcionar con esta versi\xF3n de AI Providers",providerNameRequired:"Se requiere el nombre del proveedor",providerNameExists:'Ya existe un proveedor con el nombre "{{name}}"'}};var Oo={settings:{notice:`Ce plugin est un centre de configuration pour les fournisseurs d'IA. Il ne fait rien par lui-m\xEAme, mais <a href="https://github.com/pfrankov/obsidian-ai-providers#required-by-plugins">d'autres plugins</a> peuvent l'utiliser pour \xE9viter une configuration en double.`,configuredProviders:"Fournisseurs d'IA",addNewProvider:"Ajouter un nouveau fournisseur",addProvider:"Ajouter un fournisseur",providerName:"Nom du fournisseur",providerNameDesc:"Entrez un nom pour ce fournisseur",providerNamePlaceholder:"Mon fournisseur",providerType:"Type de fournisseur",providerTypeDesc:"S\xE9lectionnez le type de fournisseur d'IA",providerUrl:"URL du fournisseur",providerUrlDesc:"Entrez l'URL du point de terminaison de l'API",providerUrlPlaceholder:"https://...",apiKey:"Cl\xE9 API",apiKeyDesc:"Entrez votre cl\xE9 API (si requise)",apiKeyPlaceholder:"sk-...",defaultModel:"Mod\xE8le par d\xE9faut",defaultModelDesc:"S\xE9lectionnez le mod\xE8le d'IA par d\xE9faut pour ce fournisseur",save:"Enregistrer",cancel:"Annuler",options:"Options",delete:"Supprimer",duplicate:"Dupliquer",deleteConfirmation:'\xCAtes-vous s\xFBr de vouloir supprimer le fournisseur "{{name}}" ?',modelsUpdated:"Liste des mod\xE8les mise \xE0 jour",refreshModelsList:"Actualiser la liste des mod\xE8les",model:"Mod\xE8le",modelDesc:"S\xE9lectionnez le mod\xE8le d'IA pour ce fournisseur.",modelTextDesc:"Entrez le nom du mod\xE8le d'IA.",modelTextOnlyDesc:"Entrez le nom du mod\xE8le d'IA pour ce fournisseur.",modelSearchPlaceholder:"Rechercher des mod\xE8les...",loadingModels:"Chargement des mod\xE8les...",noModelsAvailable:"Aucun mod\xE8le disponible",noModelMatches:"Aucun mod\xE8le correspondant",editProvider:"Modifier le fournisseur",developerSettings:"Pour les d\xE9veloppeurs",developerSettingsDesc:"Activer des param\xE8tres suppl\xE9mentaires pour le d\xE9veloppement et le d\xE9bogage",debugLogging:"Journalisation de d\xE9bogage",debugLoggingDesc:"Activer la journalisation de d\xE9bogage pour le d\xE9pannage",useNativeFetch:"Utiliser Fetch natif",useNativeFetchDesc:"Utiliser l'API Fetch native au lieu de l'impl\xE9mentation sp\xE9cifique \xE0 Electron (peut aider avec les probl\xE8mes CORS)"},modals:{confirm:"Confirmer",cancel:"Annuler"},errors:{failedToFetchModels:"\xC9chec de la r\xE9cup\xE9ration des mod\xE8les",failedToExecuteRequest:"\xC9chec de l'ex\xE9cution de la requ\xEAte",failedToEmbed:"\xC9chec de la g\xE9n\xE9ration des embeddings",missingApiKey:"La cl\xE9 API est requise",missingUrl:"L'URL du fournisseur est requise",missingModel:"Un mod\xE8le doit \xEAtre s\xE9lectionn\xE9",pluginMustBeUpdated:"Le plugin doit \xEAtre mis \xE0 jour",pluginMustBeUpdatedFormatted:"Le plugin doit \xEAtre mis \xE0 jour pour fonctionner avec cette version de AI Providers",providerNameRequired:"Le nom du fournisseur est requis",providerNameExists:'Un fournisseur portant le nom "{{name}}" existe d\xE9j\xE0'}};var No={settings:{notice:'Questo plugin \xE8 un hub di configurazione per i provider AI. Non fa nulla da solo, ma <a href="https://github.com/pfrankov/obsidian-ai-providers#required-by-plugins">altri plugin</a> possono usarlo per evitare configurazioni duplicate.',configuredProviders:"Provider AI",addNewProvider:"Aggiungi nuovo provider",addProvider:"Aggiungi provider",providerName:"Nome del provider",providerNameDesc:"Inserisci un nome per questo provider",providerNamePlaceholder:"Il mio provider",providerType:"Tipo di provider",providerTypeDesc:"Seleziona il tipo di provider AI",providerUrl:"URL del provider",providerUrlDesc:"Inserisci l'URL dell'endpoint dell'API",providerUrlPlaceholder:"https://...",apiKey:"Chiave API",apiKeyDesc:"Inserisci la tua chiave API (se richiesta)",apiKeyPlaceholder:"sk-...",defaultModel:"Modello predefinito",defaultModelDesc:"Seleziona il modello AI predefinito per questo provider",save:"Salva",cancel:"Annulla",options:"Opzioni",delete:"Elimina",duplicate:"Duplica",deleteConfirmation:'Sei sicuro di voler eliminare il provider "{{name}}"?',modelsUpdated:"Elenco modelli aggiornato",refreshModelsList:"Aggiorna elenco modelli",model:"Modello",modelDesc:"Seleziona il modello AI per questo provider.",modelTextDesc:"Inserisci il nome del modello AI.",modelTextOnlyDesc:"Inserisci il nome del modello AI per questo provider.",modelSearchPlaceholder:"Cerca modelli...",loadingModels:"Caricamento modelli...",noModelsAvailable:"Nessun modello disponibile",noModelMatches:"Nessun modello corrispondente",editProvider:"Modifica provider",developerSettings:"Per sviluppatori",developerSettingsDesc:"Abilita impostazioni aggiuntive per sviluppo e debug",debugLogging:"Logging di debug",debugLoggingDesc:"Abilita il logging di debug per la risoluzione dei problemi",useNativeFetch:"Usa Fetch nativo",useNativeFetchDesc:"Usa l'API Fetch nativa invece dell'implementazione specifica di Electron (pu\xF2 aiutare con problemi CORS)"},modals:{confirm:"Conferma",cancel:"Annulla"},errors:{failedToFetchModels:"Impossibile recuperare i modelli",failedToExecuteRequest:"Impossibile eseguire la richiesta",failedToEmbed:"Impossibile generare embeddings",missingApiKey:"La chiave API \xE8 richiesta",missingUrl:"L'URL del provider \xE8 richiesto",missingModel:"\xC8 necessario selezionare un modello",pluginMustBeUpdated:"Il plugin deve essere aggiornato",pluginMustBeUpdatedFormatted:"Il plugin deve essere aggiornato per funzionare con questa versione di AI Providers",providerNameRequired:"Il nome del provider \xE8 richiesto",providerNameExists:'Esiste gi\xE0 un provider con il nome "{{name}}"'}};var Fo={settings:{notice:'\u3053\u306E\u30D7\u30E9\u30B0\u30A4\u30F3\u306FAI\u30D7\u30ED\u30D0\u30A4\u30C0\u30FC\u306E\u8A2D\u5B9A\u30CF\u30D6\u3067\u3059\u3002\u305D\u308C\u81EA\u4F53\u3067\u306F\u4F55\u3082\u3057\u307E\u305B\u3093\u304C\u3001<a href="https://github.com/pfrankov/obsidian-ai-providers#required-by-plugins">\u4ED6\u306E\u30D7\u30E9\u30B0\u30A4\u30F3</a>\u304C\u3053\u308C\u3092\u4F7F\u7528\u3057\u3066\u91CD\u8907\u3057\u305F\u8A2D\u5B9A\u3092\u907F\u3051\u308B\u3053\u3068\u304C\u3067\u304D\u307E\u3059\u3002',configuredProviders:"AI\u30D7\u30ED\u30D0\u30A4\u30C0\u30FC",addNewProvider:"\u65B0\u898F\u30D7\u30ED\u30D0\u30A4\u30C0\u30FC\u3092\u8FFD\u52A0",addProvider:"\u30D7\u30ED\u30D0\u30A4\u30C0\u30FC\u3092\u8FFD\u52A0",providerName:"\u30D7\u30ED\u30D0\u30A4\u30C0\u30FC\u540D",providerNameDesc:"\u3053\u306E\u30D7\u30ED\u30D0\u30A4\u30C0\u30FC\u306E\u540D\u524D\u3092\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044",providerNamePlaceholder:"My provider",providerType:"\u30D7\u30ED\u30D0\u30A4\u30C0\u30FC\u30BF\u30A4\u30D7",providerTypeDesc:"AI\u30D7\u30ED\u30D0\u30A4\u30C0\u30FC\u306E\u30BF\u30A4\u30D7\u3092\u9078\u629E\u3057\u3066\u304F\u3060\u3055\u3044",providerUrl:"\u30D7\u30ED\u30D0\u30A4\u30C0\u30FCURL",providerUrlDesc:"API\u30A8\u30F3\u30C9\u30DD\u30A4\u30F3\u30C8\u306EURL\u3092\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044",providerUrlPlaceholder:"https://...",apiKey:"API\u30AD\u30FC",apiKeyDesc:"API\u30AD\u30FC\u3092\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044\uFF08\u5FC5\u8981\u306A\u5834\u5408\uFF09",apiKeyPlaceholder:"sk-...",defaultModel:"\u30C7\u30D5\u30A9\u30EB\u30C8\u30E2\u30C7\u30EB",defaultModelDesc:"\u3053\u306E\u30D7\u30ED\u30D0\u30A4\u30C0\u30FC\u306E\u30C7\u30D5\u30A9\u30EB\u30C8AI\u30E2\u30C7\u30EB\u3092\u9078\u629E\u3057\u3066\u304F\u3060\u3055\u3044",save:"\u4FDD\u5B58",cancel:"\u30AD\u30E3\u30F3\u30BB\u30EB",options:"\u30AA\u30D7\u30B7\u30E7\u30F3",delete:"\u524A\u9664",duplicate:"\u8907\u88FD",deleteConfirmation:'\u30D7\u30ED\u30D0\u30A4\u30C0\u30FC "{{name}}" \u3092\u524A\u9664\u3057\u3066\u3082\u3088\u308D\u3057\u3044\u3067\u3059\u304B\uFF1F',modelsUpdated:"\u30E2\u30C7\u30EB\u30EA\u30B9\u30C8\u3092\u66F4\u65B0\u3057\u307E\u3057\u305F",refreshModelsList:"\u30E2\u30C7\u30EB\u30EA\u30B9\u30C8\u3092\u66F4\u65B0",model:"\u30E2\u30C7\u30EB",modelDesc:"\u3053\u306E\u30D7\u30ED\u30D0\u30A4\u30C0\u30FC\u306EAI\u30E2\u30C7\u30EB\u3092\u9078\u629E\u3057\u3066\u304F\u3060\u3055\u3044\u3002",modelTextDesc:"AI\u30E2\u30C7\u30EB\u540D\u3092\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044\u3002",modelTextOnlyDesc:"\u3053\u306E\u30D7\u30ED\u30D0\u30A4\u30C0\u30FC\u306EAI\u30E2\u30C7\u30EB\u540D\u3092\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044\u3002",modelSearchPlaceholder:"\u30E2\u30C7\u30EB\u3092\u691C\u7D22...",loadingModels:"\u30E2\u30C7\u30EB\u3092\u8AAD\u307F\u8FBC\u307F\u4E2D...",noModelsAvailable:"\u5229\u7528\u53EF\u80FD\u306A\u30E2\u30C7\u30EB\u304C\u3042\u308A\u307E\u305B\u3093",noModelMatches:"\u4E00\u81F4\u3059\u308B\u30E2\u30C7\u30EB\u304C\u3042\u308A\u307E\u305B\u3093",editProvider:"\u30D7\u30ED\u30D0\u30A4\u30C0\u30FC\u3092\u7DE8\u96C6",developerSettings:"\u958B\u767A\u8005\u5411\u3051",developerSettingsDesc:"\u958B\u767A\u304A\u3088\u3073\u30C7\u30D0\u30C3\u30B0\u7528\u306E\u8FFD\u52A0\u8A2D\u5B9A\u3092\u6709\u52B9\u306B\u3059\u308B",debugLogging:"\u30C7\u30D0\u30C3\u30B0\u30ED\u30B0",debugLoggingDesc:"\u30C8\u30E9\u30D6\u30EB\u30B7\u30E5\u30FC\u30C6\u30A3\u30F3\u30B0\u7528\u306E\u30C7\u30D0\u30C3\u30B0\u30ED\u30B0\u3092\u6709\u52B9\u306B\u3059\u308B",useNativeFetch:"\u30CD\u30A4\u30C6\u30A3\u30D6Fetch\u3092\u4F7F\u7528",useNativeFetchDesc:"Electron\u56FA\u6709\u306E\u5B9F\u88C5\u306E\u4EE3\u308F\u308A\u306B\u30CD\u30A4\u30C6\u30A3\u30D6Fetch API\u3092\u4F7F\u7528\u3057\u307E\u3059\uFF08CORS\u306E\u554F\u984C\u306B\u5F79\u7ACB\u3064\u5834\u5408\u304C\u3042\u308A\u307E\u3059\uFF09"},modals:{confirm:"\u78BA\u8A8D",cancel:"\u30AD\u30E3\u30F3\u30BB\u30EB"},errors:{failedToFetchModels:"\u30E2\u30C7\u30EB\u306E\u53D6\u5F97\u306B\u5931\u6557\u3057\u307E\u3057\u305F",failedToExecuteRequest:"\u30EA\u30AF\u30A8\u30B9\u30C8\u306E\u5B9F\u884C\u306B\u5931\u6557\u3057\u307E\u3057\u305F",failedToEmbed:"\u57CB\u3081\u8FBC\u307F\uFF08Embedding\uFF09\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F",missingApiKey:"API\u30AD\u30FC\u304C\u5FC5\u8981\u3067\u3059",missingUrl:"\u30D7\u30ED\u30D0\u30A4\u30C0\u30FCURL\u304C\u5FC5\u8981\u3067\u3059",missingModel:"\u30E2\u30C7\u30EB\u3092\u9078\u629E\u3059\u308B\u5FC5\u8981\u304C\u3042\u308A\u307E\u3059",pluginMustBeUpdated:"\u30D7\u30E9\u30B0\u30A4\u30F3\u3092\u66F4\u65B0\u3059\u308B\u5FC5\u8981\u304C\u3042\u308A\u307E\u3059",pluginMustBeUpdatedFormatted:"\u3053\u306E\u30D0\u30FC\u30B8\u30E7\u30F3\u306EAI Providers\u3067\u4F7F\u7528\u3059\u308B\u306B\u306F\u3001\u30D7\u30E9\u30B0\u30A4\u30F3\u3092\u66F4\u65B0\u3059\u308B\u5FC5\u8981\u304C\u3042\u308A\u307E\u3059",providerNameRequired:"\u30D7\u30ED\u30D0\u30A4\u30C0\u30FC\u540D\u306F\u5FC5\u9808\u3067\u3059",providerNameExists:'\u540D\u524D\u304C "{{name}}" \u306E\u30D7\u30ED\u30D0\u30A4\u30C0\u30FC\u306F\u65E2\u306B\u5B58\u5728\u3057\u307E\u3059'}};var Do={settings:{notice:'\uC774 \uD50C\uB7EC\uADF8\uC778\uC740 AI \uACF5\uAE09\uC790\uB97C \uC704\uD55C \uAD6C\uC131 \uD5C8\uBE0C\uC785\uB2C8\uB2E4. \uADF8 \uC790\uCCB4\uB85C\uB294 \uC544\uBB34\uAC83\uB3C4 \uC218\uD589\uD558\uC9C0 \uC54A\uC9C0\uB9CC, <a href="https://github.com/pfrankov/obsidian-ai-providers#required-by-plugins">\uB2E4\uB978 \uD50C\uB7EC\uADF8\uC778</a>\uC774 \uC774\uB97C \uC0AC\uC6A9\uD558\uC5EC \uC911\uBCF5 \uAD6C\uC131\uC744 \uD53C\uD560 \uC218 \uC788\uC2B5\uB2C8\uB2E4.',configuredProviders:"AI \uACF5\uAE09\uC790",addNewProvider:"\uC0C8 \uACF5\uAE09\uC790 \uCD94\uAC00",addProvider:"\uACF5\uAE09\uC790 \uCD94\uAC00",providerName:"\uACF5\uAE09\uC790 \uC774\uB984",providerNameDesc:"\uC774 \uACF5\uAE09\uC790\uC758 \uC774\uB984\uC744 \uC785\uB825\uD558\uC138\uC694",providerNamePlaceholder:"\uB0B4 \uACF5\uAE09\uC790",providerType:"\uACF5\uAE09\uC790 \uC720\uD615",providerTypeDesc:"AI \uACF5\uAE09\uC790 \uC720\uD615\uC744 \uC120\uD0DD\uD558\uC138\uC694",providerUrl:"\uACF5\uAE09\uC790 URL",providerUrlDesc:"API \uC5D4\uB4DC\uD3EC\uC778\uD2B8 URL\uC744 \uC785\uB825\uD558\uC138\uC694",providerUrlPlaceholder:"https://...",apiKey:"API \uD0A4",apiKeyDesc:"API \uD0A4\uB97C \uC785\uB825\uD558\uC138\uC694(\uD544\uC694\uD55C \uACBD\uC6B0)",apiKeyPlaceholder:"sk-...",defaultModel:"\uAE30\uBCF8 \uBAA8\uB378",defaultModelDesc:"\uB098\uC911\uC5D0 \uC0AC\uC6A9\uD560 \uC774 \uACF5\uAE09\uC790\uC758 \uAE30\uBCF8 AI \uBAA8\uB378\uC744 \uC120\uD0DD\uD558\uC138\uC694",save:"\uC800\uC7A5",cancel:"\uCDE8\uC18C",options:"\uC635\uC158",delete:"\uC0AD\uC81C",duplicate:"\uBCF5\uC81C",deleteConfirmation:'"{{name}}" \uACF5\uAE09\uC790\uB97C \uC0AD\uC81C\uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?',modelsUpdated:"\uBAA8\uB378 \uBAA9\uB85D\uC774 \uC5C5\uB370\uC774\uD2B8\uB418\uC5C8\uC2B5\uB2C8\uB2E4",refreshModelsList:"\uBAA8\uB378 \uBAA9\uB85D \uC0C8\uB85C\uACE0\uCE68",model:"\uBAA8\uB378",modelDesc:"\uC774 \uACF5\uAE09\uC790\uC758 AI \uBAA8\uB378\uC744 \uC120\uD0DD\uD558\uC138\uC694.",modelTextDesc:"AI \uBAA8\uB378 \uC774\uB984\uC744 \uC785\uB825\uD558\uC138\uC694.",modelTextOnlyDesc:"\uC774 \uACF5\uAE09\uC790\uC758 AI \uBAA8\uB378 \uC774\uB984\uC744 \uC785\uB825\uD558\uC138\uC694.",modelSearchPlaceholder:"\uBAA8\uB378 \uAC80\uC0C9...",loadingModels:"\uBAA8\uB378 \uB85C\uB529 \uC911...",noModelsAvailable:"\uC0AC\uC6A9 \uAC00\uB2A5\uD55C \uBAA8\uB378 \uC5C6\uC74C",noModelMatches:"\uC77C\uCE58\uD558\uB294 \uBAA8\uB378 \uC5C6\uC74C",editProvider:"\uACF5\uAE09\uC790 \uD3B8\uC9D1",developerSettings:"\uAC1C\uBC1C\uC790\uC6A9",developerSettingsDesc:"\uAC1C\uBC1C \uBC0F \uB514\uBC84\uAE45\uC744 \uC704\uD55C \uCD94\uAC00 \uC124\uC815 \uD65C\uC131\uD654",debugLogging:"\uB514\uBC84\uADF8 \uB85C\uAE45",debugLoggingDesc:"\uBB38\uC81C \uD574\uACB0\uC744 \uC704\uD55C \uB514\uBC84\uADF8 \uB85C\uAE45 \uD65C\uC131\uD654",useNativeFetch:"\uB124\uC774\uD2F0\uBE0C Fetch \uC0AC\uC6A9",useNativeFetchDesc:"Electron \uAD00\uB828 \uAD6C\uD604 \uB300\uC2E0 \uB124\uC774\uD2F0\uBE0C Fetch API \uC0AC\uC6A9(CORS \uBB38\uC81C \uD574\uACB0\uC5D0 \uB3C4\uC6C0 \uB420 \uC218 \uC788\uC74C)"},modals:{confirm:"\uD655\uC778",cancel:"\uCDE8\uC18C"},errors:{failedToFetchModels:"\uBAA8\uB378\uC744 \uAC00\uC838\uC624\uC9C0 \uBABB\uD588\uC2B5\uB2C8\uB2E4",failedToExecuteRequest:"\uC694\uCCAD\uC744 \uC2E4\uD589\uD558\uC9C0 \uBABB\uD588\uC2B5\uB2C8\uB2E4",failedToEmbed:"\uC784\uBCA0\uB529\uC744 \uC0DD\uC131\uD558\uC9C0 \uBABB\uD588\uC2B5\uB2C8\uB2E4",missingApiKey:"API \uD0A4\uAC00 \uD544\uC694\uD569\uB2C8\uB2E4",missingUrl:"\uACF5\uAE09\uC790 URL\uC774 \uD544\uC694\uD569\uB2C8\uB2E4",missingModel:"\uBAA8\uB378\uC744 \uC120\uD0DD\uD574\uC57C \uD569\uB2C8\uB2E4",pluginMustBeUpdated:"\uD50C\uB7EC\uADF8\uC778 \uC5C5\uB370\uC774\uD2B8 \uD544\uC694",pluginMustBeUpdatedFormatted:"\uC774 \uBC84\uC804\uC758 AI Providers\uC640 \uD568\uAED8 \uC0AC\uC6A9\uD558\uB824\uBA74 \uD50C\uB7EC\uADF8\uC778\uC744 \uC5C5\uB370\uC774\uD2B8\uD574\uC57C \uD569\uB2C8\uB2E4",providerNameRequired:"\uACF5\uAE09\uC790 \uC774\uB984\uC774 \uD544\uC694\uD569\uB2C8\uB2E4",providerNameExists:'"{{name}}" \uC774\uB984\uC744 \uAC00\uC9C4 \uACF5\uAE09\uC790\uAC00 \uC774\uBBF8 \uC874\uC7AC\uD569\uB2C8\uB2E4'}};var Lo={settings:{notice:'Deze plug-in is een configuratiehub voor AI-providers. Het doet op zichzelf niets, maar <a href="https://github.com/pfrankov/obsidian-ai-providers#required-by-plugins">andere plug-ins</a> kunnen het gebruiken om dubbele configuratie te voorkomen.',configuredProviders:"AI-providers",addNewProvider:"Nieuwe provider toevoegen",addProvider:"Provider toevoegen",providerName:"Providernaam",providerNameDesc:"Voer een naam in voor deze provider",providerNamePlaceholder:"Mijn provider",providerType:"Providertype",providerTypeDesc:"Selecteer het type AI-provider",providerUrl:"Provider-URL",providerUrlDesc:"Voer de URL van het API-eindpunt in",providerUrlPlaceholder:"https://...",apiKey:"API-sleutel",apiKeyDesc:"Voer uw API-sleutel in (indien vereist)",apiKeyPlaceholder:"sk-...",defaultModel:"Standaardmodel",defaultModelDesc:"Selecteer het standaard AI-model voor deze provider",save:"Opslaan",cancel:"Annuleren",options:"Opties",delete:"Verwijderen",duplicate:"Dupliceren",deleteConfirmation:'Weet u zeker dat u provider "{{name}}" wilt verwijderen?',modelsUpdated:"Modellenlijst bijgewerkt",refreshModelsList:"Modellenlijst vernieuwen",model:"Model",modelDesc:"Selecteer het AI-model voor deze provider.",modelTextDesc:"Voer de naam van het AI-model in.",modelTextOnlyDesc:"Voer de naam van het AI-model in voor deze provider.",modelSearchPlaceholder:"Modellen zoeken...",loadingModels:"Modellen laden...",noModelsAvailable:"Geen modellen beschikbaar",noModelMatches:"Geen overeenkomende modellen",editProvider:"Provider bewerken",developerSettings:"Voor ontwikkelaars",developerSettingsDesc:"Schakel extra instellingen in voor ontwikkeling en debugging",debugLogging:"Foutopsporingslogboek",debugLoggingDesc:"Schakel foutopsporingslogboek in voor probleemoplossing",useNativeFetch:"Gebruik native Fetch",useNativeFetchDesc:"Gebruik native Fetch API in plaats van de Electron-specifieke implementatie (kan helpen bij CORS-problemen)"},modals:{confirm:"Bevestigen",cancel:"Annuleren"},errors:{failedToFetchModels:"Ophalen van modellen mislukt",failedToExecuteRequest:"Uitvoeren van verzoek mislukt",failedToEmbed:"Genereren van embeddings mislukt",missingApiKey:"API-sleutel is vereist",missingUrl:"Provider-URL is vereist",missingModel:"Model moet geselecteerd zijn",pluginMustBeUpdated:"Plug-in moet worden bijgewerkt",pluginMustBeUpdatedFormatted:"Plug-in moet worden bijgewerkt om te werken met deze versie van AI Providers",providerNameRequired:"Providernaam is vereist",providerNameExists:'Er bestaat al een provider met de naam "{{name}}"'}};var Bo={settings:{notice:'Este plugin \xE9 uma central de configura\xE7\xE3o para provedores de IA. Ele n\xE3o faz nada por si s\xF3, mas <a href="https://github.com/pfrankov/obsidian-ai-providers#required-by-plugins">outros plugins</a> podem us\xE1-lo para evitar configura\xE7\xF5es duplicadas.',configuredProviders:"Provedores de IA",addNewProvider:"Adicionar novo provedor",addProvider:"Adicionar provedor",providerName:"Nome do provedor",providerNameDesc:"Digite um nome para este provedor",providerNamePlaceholder:"Meu provedor",providerType:"Tipo de provedor",providerTypeDesc:"Selecione o tipo de provedor de IA",providerUrl:"URL do provedor",providerUrlDesc:"Digite a URL do endpoint da API",providerUrlPlaceholder:"https://...",apiKey:"Chave de API",apiKeyDesc:"Digite sua chave de API (se necess\xE1rio)",apiKeyPlaceholder:"sk-...",defaultModel:"Modelo padr\xE3o",defaultModelDesc:"Selecione o modelo de IA padr\xE3o para este provedor",save:"Salvar",cancel:"Cancelar",options:"Op\xE7\xF5es",delete:"Excluir",duplicate:"Duplicar",deleteConfirmation:'Tem certeza que deseja excluir o provedor "{{name}}"?',modelsUpdated:"Lista de modelos atualizada",refreshModelsList:"Atualizar lista de modelos",model:"Modelo",modelDesc:"Selecione o modelo de IA para este provedor.",modelTextDesc:"Digite o nome do modelo de IA.",modelTextOnlyDesc:"Digite o nome do modelo de IA para este provedor.",modelSearchPlaceholder:"Buscar modelos...",loadingModels:"Carregando modelos...",noModelsAvailable:"Nenhum modelo dispon\xEDvel",noModelMatches:"Nenhum modelo correspondente",editProvider:"Editar provedor",developerSettings:"Para desenvolvedores",developerSettingsDesc:"Habilitar configura\xE7\xF5es adicionais para desenvolvimento e depura\xE7\xE3o",debugLogging:"Registro de depura\xE7\xE3o",debugLoggingDesc:"Habilitar registro de depura\xE7\xE3o para solu\xE7\xE3o de problemas",useNativeFetch:"Usar Fetch nativo",useNativeFetchDesc:"Usar API Fetch nativa em vez da implementa\xE7\xE3o espec\xEDfica do Electron (pode ajudar com problemas de CORS)"},modals:{confirm:"Confirmar",cancel:"Cancelar"},errors:{failedToFetchModels:"Falha ao buscar modelos",failedToExecuteRequest:"Falha ao executar solicita\xE7\xE3o",failedToEmbed:"Falha ao gerar embeddings",missingApiKey:"Chave de API \xE9 obrigat\xF3ria",missingUrl:"URL do provedor \xE9 obrigat\xF3ria",missingModel:"Um modelo deve ser selecionado",pluginMustBeUpdated:"Plugin precisa ser atualizado",pluginMustBeUpdatedFormatted:"O plugin precisa ser atualizado para funcionar com esta vers\xE3o do AI Providers",providerNameRequired:"Nome do provedor \xE9 obrigat\xF3rio",providerNameExists:'J\xE1 existe um provedor com o nome "{{name}}"'}};var Uo={settings:{notice:'\u042D\u0442\u043E\u0442 \u043F\u043B\u0430\u0433\u0438\u043D \u043F\u043E\u043C\u043E\u0433\u0430\u0435\u0442 \u043D\u0430\u0441\u0442\u0440\u0430\u0438\u0432\u0430\u0442\u044C AI-\u043F\u0440\u043E\u0432\u0430\u0439\u0434\u0435\u0440\u044B. \u0421\u0430\u043C \u043F\u043E \u0441\u0435\u0431\u0435 \u043E\u043D \u043D\u0438\u0447\u0435\u0433\u043E \u043D\u0435 \u0434\u0435\u043B\u0430\u0435\u0442, \u043D\u043E \u0441\u043B\u0443\u0436\u0438\u0442 \u043E\u0431\u0449\u0438\u043C \u0445\u0440\u0430\u043D\u0438\u043B\u0438\u0449\u0435\u043C \u043D\u0430\u0441\u0442\u0440\u043E\u0435\u043A, \u043A\u043E\u0442\u043E\u0440\u044B\u043C \u043C\u043E\u0433\u0443\u0442 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u044C\u0441\u044F <a href="https://github.com/pfrankov/obsidian-ai-providers#required-by-plugins">\u0434\u0440\u0443\u0433\u0438\u0435 \u043F\u043B\u0430\u0433\u0438\u043D\u044B</a> \u0432\u043C\u0435\u0441\u0442\u043E \u043F\u043E\u0432\u0442\u043E\u0440\u043D\u043E\u0439 \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438.',configuredProviders:"AI \u043F\u0440\u043E\u0432\u0430\u0439\u0434\u0435\u0440\u044B",addNewProvider:"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u043D\u043E\u0432\u044B\u0439 \u043F\u0440\u043E\u0432\u0430\u0439\u0434\u0435\u0440",addProvider:"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u043F\u0440\u043E\u0432\u0430\u0439\u0434\u0435\u0440",providerName:"\u0418\u043C\u044F \u043F\u0440\u043E\u0432\u0430\u0439\u0434\u0435\u0440\u0430",providerNameDesc:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0438\u043C\u044F \u0434\u043B\u044F \u044D\u0442\u043E\u0433\u043E \u043F\u0440\u043E\u0432\u0430\u0439\u0434\u0435\u0440\u0430",providerNamePlaceholder:"\u041C\u043E\u0439 \u043F\u0440\u043E\u0432\u0430\u0439\u0434\u0435\u0440",providerType:"\u0422\u0438\u043F \u043F\u0440\u043E\u0432\u0430\u0439\u0434\u0435\u0440\u0430",providerTypeDesc:"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0442\u0438\u043F AI-\u043F\u0440\u043E\u0432\u0430\u0439\u0434\u0435\u0440\u0430",providerUrl:"URL \u043F\u0440\u043E\u0432\u0430\u0439\u0434\u0435\u0440\u0430",providerUrlDesc:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 URL \u043A\u043E\u043D\u0435\u0447\u043D\u043E\u0439 \u0442\u043E\u0447\u043A\u0438 API",providerUrlPlaceholder:"https://...",apiKey:"API-\u043A\u043B\u044E\u0447",apiKeyDesc:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0432\u0430\u0448 API \u043A\u043B\u044E\u0447 (\u0435\u0441\u043B\u0438 \u0442\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044F)",apiKeyPlaceholder:"sk-...",defaultModel:"\u041C\u043E\u0434\u0435\u043B\u044C \u043F\u043E \u0443\u043C\u043E\u043B\u0447\u0430\u043D\u0438\u044E",defaultModelDesc:"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u043C\u043E\u0434\u0435\u043B\u044C AI \u043F\u043E \u0443\u043C\u043E\u043B\u0447\u0430\u043D\u0438\u044E \u0434\u043B\u044F \u044D\u0442\u043E\u0433\u043E \u043F\u0440\u043E\u0432\u0430\u0439\u0434\u0435\u0440\u0430",save:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",cancel:"\u041E\u0442\u043C\u0435\u043D\u0430",options:"\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438",delete:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C",duplicate:"\u0414\u0443\u0431\u043B\u0438\u0440\u043E\u0432\u0430\u0442\u044C",deleteConfirmation:'\u0412\u044B \u0443\u0432\u0435\u0440\u0435\u043D\u044B, \u0447\u0442\u043E \u0445\u043E\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043B\u0438\u0442\u044C \u043F\u0440\u043E\u0432\u0430\u0439\u0434\u0435\u0440\u0430 "{{name}}"?',modelsUpdated:"\u0421\u043F\u0438\u0441\u043E\u043A \u043C\u043E\u0434\u0435\u043B\u0435\u0439 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D",refreshModelsList:"\u041E\u0431\u043D\u043E\u0432\u0438\u0442\u044C \u0441\u043F\u0438\u0441\u043E\u043A \u043C\u043E\u0434\u0435\u043B\u0435\u0439",model:"\u041C\u043E\u0434\u0435\u043B\u044C",modelDesc:"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 AI \u043C\u043E\u0434\u0435\u043B\u044C \u0434\u043B\u044F \u044D\u0442\u043E\u0433\u043E \u043F\u0440\u043E\u0432\u0430\u0439\u0434\u0435\u0440\u0430.",modelTextDesc:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 AI \u043C\u043E\u0434\u0435\u043B\u0438.",modelTextOnlyDesc:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 AI \u043C\u043E\u0434\u0435\u043B\u0438 \u0434\u043B\u044F \u044D\u0442\u043E\u0433\u043E \u043F\u0440\u043E\u0432\u0430\u0439\u0434\u0435\u0440\u0430.",modelSearchPlaceholder:"\u041F\u043E\u0438\u0441\u043A \u043C\u043E\u0434\u0435\u043B\u0435\u0439...",loadingModels:"\u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430 \u043C\u043E\u0434\u0435\u043B\u0435\u0439...",noModelsAvailable:"\u041D\u0435\u0442 \u0434\u043E\u0441\u0442\u0443\u043F\u043D\u044B\u0445 \u043C\u043E\u0434\u0435\u043B\u0435\u0439",noModelMatches:"\u041D\u0435\u0442 \u043F\u043E\u0434\u0445\u043E\u0434\u044F\u0449\u0438\u0445 \u043C\u043E\u0434\u0435\u043B\u0435\u0439",editProvider:"\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u043F\u0440\u043E\u0432\u0430\u0439\u0434\u0435\u0440\u0430",developerSettings:"\u0414\u043B\u044F \u0440\u0430\u0437\u0440\u0430\u0431\u043E\u0442\u0447\u0438\u043A\u043E\u0432",developerSettingsDesc:"\u0412\u043A\u043B\u044E\u0447\u0438\u0442\u044C \u0434\u043E\u043F\u043E\u043B\u043D\u0438\u0442\u0435\u043B\u044C\u043D\u044B\u0435 \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 \u0434\u043B\u044F \u0440\u0430\u0437\u0440\u0430\u0431\u043E\u0442\u043A\u0438 \u0438 \u043E\u0442\u043B\u0430\u0434\u043A\u0438",debugLogging:"\u041E\u0442\u043B\u0430\u0434\u043E\u0447\u043D\u043E\u0435 \u043B\u043E\u0433\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u0435",debugLoggingDesc:"\u0412\u043A\u043B\u044E\u0447\u0438\u0442\u044C \u043F\u043E\u0434\u0440\u043E\u0431\u043D\u043E\u0435 \u043B\u043E\u0433\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u0435 \u0432 \u043A\u043E\u043D\u0441\u043E\u043B\u0438",useNativeFetch:"\u0418\u0441\u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u044C \u043D\u0430\u0442\u0438\u0432\u043D\u044B\u0439 Fetch",useNativeFetchDesc:"\u0418\u0441\u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u044C \u043D\u0430\u0442\u0438\u0432\u043D\u044B\u0439 Fetch API \u0432\u043C\u0435\u0441\u0442\u043E \u0440\u0435\u0430\u043B\u0438\u0437\u0430\u0446\u0438\u0438 Electron (\u043C\u043E\u0436\u0435\u0442 \u043F\u043E\u043C\u043E\u0447\u044C \u0441 \u043F\u0440\u043E\u0431\u043B\u0435\u043C\u0430\u043C\u0438 CORS)"},modals:{confirm:"\u041F\u043E\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044C",cancel:"\u041E\u0442\u043C\u0435\u043D\u0430"},errors:{failedToFetchModels:"\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u043F\u043E\u043B\u0443\u0447\u0438\u0442\u044C \u0441\u043F\u0438\u0441\u043E\u043A \u043C\u043E\u0434\u0435\u043B\u0435\u0439",failedToExecuteRequest:"\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0432\u044B\u043F\u043E\u043B\u043D\u0438\u0442\u044C \u0437\u0430\u043F\u0440\u043E\u0441",failedToEmbed:"\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0441\u043E\u0437\u0434\u0430\u0442\u044C \u044D\u043C\u0431\u0435\u0434\u0434\u0438\u043D\u0433\u0438",missingApiKey:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044F API \u043A\u043B\u044E\u0447",missingUrl:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044F URL \u043F\u0440\u043E\u0432\u0430\u0439\u0434\u0435\u0440\u0430",missingModel:"\u041D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u043E \u0432\u044B\u0431\u0440\u0430\u0442\u044C \u043C\u043E\u0434\u0435\u043B\u044C",pluginMustBeUpdated:"\u041F\u043B\u0430\u0433\u0438\u043D \u0442\u0440\u0435\u0431\u0443\u0435\u0442 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u044F",pluginMustBeUpdatedFormatted:"\u0414\u043B\u044F \u0440\u0430\u0431\u043E\u0442\u044B \u0441 \u044D\u0442\u043E\u0439 \u0432\u0435\u0440\u0441\u0438\u0435\u0439 AI Providers \u0442\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044F \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u0435 \u043F\u043B\u0430\u0433\u0438\u043D\u0430",providerNameRequired:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044F \u0438\u043C\u044F \u043F\u0440\u043E\u0432\u0430\u0439\u0434\u0435\u0440\u0430",providerNameExists:'\u041F\u0440\u043E\u0432\u0430\u0439\u0434\u0435\u0440 \u0441 \u0438\u043C\u0435\u043D\u0435\u043C "{{name}}" \u0443\u0436\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442'}};var $o={settings:{notice:'\u6B64\u63D2\u4EF6\u662F AI \u63D0\u4F9B\u5546\u7684\u914D\u7F6E\u4E2D\u5FC3\u3002\u5B83\u672C\u8EAB\u4E0D\u63D0\u4F9B\u4EFB\u4F55\u529F\u80FD\uFF0C\u4F46<a href="https://github.com/pfrankov/obsidian-ai-providers#required-by-plugins">\u5176\u4ED6\u63D2\u4EF6</a>\u53EF\u4EE5\u4F7F\u7528\u5B83\u6765\u907F\u514D\u91CD\u590D\u914D\u7F6E AI \u8BBE\u7F6E\u3002',configuredProviders:"AI \u670D\u52A1\u63D0\u4F9B\u5546",addNewProvider:"\u6DFB\u52A0\u65B0\u7684\u670D\u52A1\u63D0\u4F9B\u5546",addProvider:"\u6DFB\u52A0\u63D0\u4F9B\u5546",providerName:"\u63D0\u4F9B\u5546\u540D\u79F0",providerNameDesc:"\u4E3A\u6B64\u670D\u52A1\u63D0\u4F9B\u5546\u8F93\u5165\u540D\u79F0",providerNamePlaceholder:"\u6211\u7684\u670D\u52A1\u63D0\u4F9B\u5546",providerType:"\u63D0\u4F9B\u5546\u7C7B\u578B",providerTypeDesc:"\u9009\u62E9 AI \u670D\u52A1\u63D0\u4F9B\u5546\u7C7B\u578B",providerUrl:"\u670D\u52A1\u5730\u5740",providerUrlDesc:"\u8F93\u5165 API \u63A5\u53E3\u5730\u5740",providerUrlPlaceholder:"https://...",apiKey:"API \u5BC6\u94A5",apiKeyDesc:"\u8F93\u5165\u60A8\u7684 API \u5BC6\u94A5\uFF08\u5982\u9700\u8981\uFF09",apiKeyPlaceholder:"sk-...",defaultModel:"\u9ED8\u8BA4\u6A21\u578B",defaultModelDesc:"\u9009\u62E9\u6B64\u63D0\u4F9B\u5546\u7684\u9ED8\u8BA4 AI \u6A21\u578B",save:"\u4FDD\u5B58",cancel:"\u53D6\u6D88",options:"\u9009\u9879",delete:"\u5220\u9664",duplicate:"\u590D\u5236",deleteConfirmation:'\u786E\u5B9A\u8981\u5220\u9664\u63D0\u4F9B\u5546"{{name}}"\u5417\uFF1F',modelsUpdated:"\u6A21\u578B\u5217\u8868\u5DF2\u66F4\u65B0",refreshModelsList:"\u5237\u65B0\u6A21\u578B\u5217\u8868",model:"\u6A21\u578B",modelDesc:"\u9009\u62E9\u6B64\u63D0\u4F9B\u5546\u7684 AI \u6A21\u578B\u3002",modelTextDesc:"\u8F93\u5165 AI \u6A21\u578B\u540D\u79F0\u3002",modelTextOnlyDesc:"\u8F93\u5165\u6B64\u63D0\u4F9B\u5546\u7684 AI \u6A21\u578B\u540D\u79F0\u3002",modelSearchPlaceholder:"\u641C\u7D22\u6A21\u578B...",loadingModels:"\u6B63\u5728\u52A0\u8F7D\u6A21\u578B...",noModelsAvailable:"\u6CA1\u6709\u53EF\u7528\u7684\u6A21\u578B",noModelMatches:"\u6CA1\u6709\u5339\u914D\u7684\u6A21\u578B",editProvider:"\u7F16\u8F91\u63D0\u4F9B\u5546",developerSettings:"\u5F00\u53D1\u8005\u9009\u9879",developerSettingsDesc:"\u542F\u7528\u989D\u5916\u7684\u5F00\u53D1\u548C\u8C03\u8BD5\u8BBE\u7F6E",debugLogging:"\u8C03\u8BD5\u65E5\u5FD7",debugLoggingDesc:"\u5728\u63A7\u5236\u53F0\u542F\u7528\u8BE6\u7EC6\u65E5\u5FD7\u8BB0\u5F55",useNativeFetch:"\u4F7F\u7528\u539F\u751F Fetch",useNativeFetchDesc:"\u4F7F\u7528\u539F\u751F Fetch API \u800C\u4E0D\u662F Electron \u7279\u5B9A\u5B9E\u73B0\uFF08\u53EF\u80FD\u6709\u52A9\u4E8E\u89E3\u51B3 CORS \u95EE\u9898\uFF09"},modals:{confirm:"\u786E\u8BA4",cancel:"\u53D6\u6D88"},errors:{failedToFetchModels:"\u83B7\u53D6\u6A21\u578B\u5217\u8868\u5931\u8D25",failedToExecuteRequest:"\u8BF7\u6C42\u6267\u884C\u5931\u8D25",failedToEmbed:"\u751F\u6210\u5D4C\u5165\u5931\u8D25",missingApiKey:"\u9700\u8981\u63D0\u4F9B API \u5BC6\u94A5",missingUrl:"\u9700\u8981\u63D0\u4F9B\u670D\u52A1\u5730\u5740",missingModel:"\u9700\u8981\u9009\u62E9\u6A21\u578B",pluginMustBeUpdated:"\u63D2\u4EF6\u9700\u8981\u66F4\u65B0",pluginMustBeUpdatedFormatted:"\u63D2\u4EF6\u9700\u8981\u66F4\u65B0\u624D\u80FD\u4E0E\u6B64\u7248\u672C\u7684 AI Providers \u4E00\u8D77\u4F7F\u7528",providerNameRequired:"\u9700\u8981\u63D0\u4F9B\u5546\u540D\u79F0",providerNameExists:'\u540D\u4E3A"{{name}}"\u7684\u63D0\u4F9B\u5546\u5DF2\u5B58\u5728'}};var ti=class{constructor(){this.enabled=!1}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}log(e,...t){if(!this.enabled)return;let r=new Date().toISOString(),n=`[AI Providers ${e.toUpperCase()}] ${r}:`;switch(e){case"debug":console.log(n,...t);break;case"info":console.info(n,...t);break;case"warn":console.warn(n,...t);break;case"error":console.error(n,...t);break}}debug(...e){this.log("debug",...e)}info(...e){this.log("info",...e)}warn(...e){this.log("warn",...e)}error(...e){this.log("error",...e)}},b=new ti;var ri={en:ko,ru:Uo,de:Ro,zh:$o,es:To,fr:Oo,it:No,ja:Fo,ko:Do,nl:Lo,pt:Bo},qo=(s,e)=>{let t=s;for(let r of e){if(typeof t!="object"||t===null||!(r in t))return;t=t[r]}return typeof t=="string"?t:void 0},I=class{static t(e,t){let r=window.localStorage.getItem("language")||"en",n=e.split("."),i=ri[r]||ri.en,o=qo(i,n);if(o===void 0&&(b.warn(`Translation missing: ${e}`),o=qo(ri.en,n)),o===void 0)return e;let a=o;return t&&Object.entries(t).forEach(([c,l])=>{a=a.replace(`{{${c}}}`,l)}),a}};var Ws=require("obsidian");var tr=class extends Ws.Modal{constructor(t,r,n,i=()=>{}){super(t);this.message=r;this.onConfirm=n,this.onCancel=i}onOpen(){let{contentEl:t}=this;t.createEl("p",{text:this.message}),new Ws.Setting(t).addButton(r=>r.setButtonText(I.t("modals.confirm")).setWarning().onClick(()=>{this.onConfirm(),this.close()})).addButton(r=>r.setButtonText(I.t("modals.cancel")).onClick(()=>{this.onCancel(),this.close()}))}onClose(){let{contentEl:t}=this;t.empty()}};var H=require("obsidian");var rr={openai:{url:"https://api.openai.com/v1",name:"OpenAI"},ollama:{url:"http://localhost:11434",name:"Ollama"},"ollama-openwebui":{url:"http://localhost:3000/ollama",name:"Ollama (Open WebUI)"},gemini:{url:"https://generativelanguage.googleapis.com/v1beta/openai",name:"Google Gemini"},openrouter:{url:"https://openrouter.ai/api/v1",name:"OpenRouter"},lmstudio:{url:"http://localhost:1234/v1",name:"LM Studio"},groq:{url:"https://api.groq.com/openai/v1",name:"Groq"},ai302:{url:"https://api.302.ai/v1",name:"302.AI",options:{modelsFetching:!1}},anthropic:{url:"https://api.anthropic.com",name:"Anthropic"},mistral:{url:"https://api.mistral.ai/v1",name:"Mistral AI"},together:{url:"https://api.together.xyz/v1",name:"Together AI"},fireworks:{url:"https://api.fireworks.ai/inference/v1",name:"Fireworks AI"},perplexity:{url:"https://api.perplexity.ai",name:"Perplexity AI"},deepseek:{url:"https://api.deepseek.com",name:"DeepSeek"},xai:{url:"https://api.x.ai/v1",name:"xAI (Grok)"},novita:{url:"https://api.novita.ai/openai/v1",name:"Novita AI"},deepinfra:{url:"https://api.deepinfra.com/v1/openai",name:"DeepInfra"},sambanova:{url:"https://api.sambanova.ai/v1",name:"SambaNova"},cerebras:{url:"https://api.cerebras.ai/v1",name:"Cerebras"},zai:{url:"https://api.z.ai/api/paas/v4/",name:"Z.AI"}},si=class extends H.AbstractInputSuggest{constructor(t,r,n){super(t,r);this.matchCache=new Map;this.lastQuery="";this.lastMatches=[];this.minQueryLength=2;this.suppressNextUpdate=!1;this.models=n.models,this.onSelectValue=n.onSelect,this.limit=50,this.onSelect(i=>{this.onSelectValue(i)})}selectSuggestion(t,r){this.suppressNextUpdate=!0,super.selectSuggestion(t,r),this.close()}getSuggestions(t){if(this.suppressNextUpdate)return this.suppressNextUpdate=!1,[];let r=t.trim();if(this.matchCache.clear(),!r)return this.lastQuery="",this.lastMatches=this.models,this.models.slice(0,this.limit);if(r.length<this.minQueryLength){let l=r.toLowerCase(),d=this.models.filter(h=>h.toLowerCase().includes(l)).slice(0,this.limit);return this.lastQuery=r,this.lastMatches=d,d}let i=this.lastQuery.length>=this.minQueryLength&&r.startsWith(this.lastQuery)?this.lastMatches:this.models,o=(0,H.prepareFuzzySearch)(r),a=i.map(l=>{let d=o(l);return d?{model:l,matches:d.matches,score:d.score}:null}).filter(l=>Boolean(l)).sort((l,d)=>d.score-l.score);this.lastQuery=r,this.lastMatches=a.map(l=>l.model);let c=a.slice(0,this.limit);return c.forEach(l=>{this.matchCache.set(l.model,l.matches)}),c.map(l=>l.model)}renderSuggestion(t,r){r.setAttribute("data-testid","model-suggestion"),r.setAttribute("data-value",t);let n=this.matchCache.get(t);if(!n||n.length===0){r.textContent=t;return}let i=[...n].sort(([a],[c])=>a-c),o=0;i.forEach(([a,c])=>{a>o&&r.appendText(t.slice(o,a));let l=r.createSpan("suggestion-highlight");l.textContent=t.slice(a,c),o=c}),o<t.length&&r.appendText(t.slice(o))}},Vs=class extends H.Modal{constructor(t,r,n,i,o=!1){super(t);this.plugin=r;this.provider=n;this.onSave=i;this.isAddingNew=o;this.nameModified=!1;this.urlModified=!1;this.isLoadingModels=!1}hasModelFetching(t){var n;return((n=rr[t].options)==null?void 0:n.modelsFetching)!==!1}getModelDescription(t){return t?I.t("settings.modelTextOnlyDesc"):I.t("settings.modelDesc")}getModelControlState(){let t=this.provider.availableModels||[],r=t.length>0,n=this.isLoadingModels||!r,i=this.isLoadingModels?I.t("settings.loadingModels"):r?I.t("settings.modelSearchPlaceholder"):I.t("settings.noModelsAvailable"),o=this.provider.model||"";return{models:t,currentModel:o,isDisabled:n,placeholder:i}}getDefaultName(t){return rr[t].name}initDefaults(){this.nameModified=!1,this.urlModified=!1,this.provider.url||(this.provider.url=rr[this.provider.type].url),this.isAddingNew&&!this.provider.name&&(this.provider.name=this.getDefaultName(this.provider.type))}createModelSetting(t){var o;let r=!this.hasModelFetching(this.provider.type),n=new H.Setting(t).setName(I.t("settings.model")).setDesc(this.getModelDescription(r));if((o=this.modelSuggest)==null||o.close(),this.modelSuggest=void 0,r)return this.createTextInput(n),this.setupDescription(n,!0),n;let i=this.getModelControlState();return n.controlEl.addClass("ai-providers-model-control"),H.Platform.isMobileApp&&n.controlEl.addClass("ai-providers-model-control--mobile"),H.Platform.isMobileApp?n.addDropdown(a=>{a.selectEl.setAttribute("data-testid","model-select"),a.selectEl.addClass("dropdown"),a.setDisabled(i.isDisabled),a.addOption("",i.placeholder);let c=i.currentModel?[i.currentModel,...i.models]:i.models;return Array.from(new Set(c)).forEach(l=>{a.addOption(l,l)}),a.setValue(i.currentModel),a.onChange(l=>{this.provider.model=l}),a}):this.createComboBox(n,i),this.createRefresh(n),this.setupDescription(n,!1),n}createTextInput(t){t.addText(r=>(r.setValue(this.provider.model||"").onChange(n=>{this.provider.model=n}),r.inputEl.setAttribute("data-testid","model-input"),r))}createComboBox(t,r){let{models:n,currentModel:i,isDisabled:o,placeholder:a}=r,c=t.controlEl.createDiv("ai-providers-model-input"),l=new H.TextComponent(c);l.setPlaceholder(a),l.setValue(i),l.setDisabled(o),l.onChange(d=>{this.provider.model=d,l.inputEl.title=d}),l.inputEl.setAttribute("data-testid","model-combobox-input"),l.inputEl.setAttribute("role","combobox"),l.inputEl.setAttribute("aria-autocomplete","list"),l.inputEl.title=i,!o&&(this.modelSuggest=new si(this.app,l.inputEl,{models:n,onSelect:d=>{this.provider.model=d,l.setValue(d),l.inputEl.title=d}}))}createRefresh(t){t.addButton(r=>{r.setIcon("refresh-cw").setTooltip(I.t("settings.refreshModelsList")),r.buttonEl.addClass("ai-providers-model-refresh"),r.buttonEl.setAttribute("data-testid","refresh-models-button"),this.isLoadingModels&&(r.setDisabled(!0),r.buttonEl.addClass("loading")),r.onClick(async()=>{await this.refreshModels()})})}async refreshModels(){try{this.isLoadingModels=!0,this.display();let t=await this.plugin.aiProviders.fetchModels(this.provider);this.provider.availableModels=t,t.length>0&&(this.provider.model=t[0]||""),new H.Notice(I.t("settings.modelsUpdated"))}catch(t){b.error("Failed to fetch models:",t),new H.Notice(I.t("errors.failedToFetchModels"))}finally{this.isLoadingModels=!1,this.display()}}setupDescription(t,r){let n=t.descEl;n.empty(),n.appendChild((0,H.sanitizeHTMLToDom)(this.getModelDescription(r)))}onOpen(){let{contentEl:t}=this;this.initDefaults(),t.createEl("h2",{text:this.isAddingNew?I.t("settings.addNewProvider"):I.t("settings.editProvider")}).setAttribute("data-testid","provider-form-title"),new H.Setting(t).setName(I.t("settings.providerType")).setDesc(I.t("settings.providerTypeDesc")).addDropdown(r=>{let n=Object.entries(rr).reduce((i,[o,a])=>(i[o]=a.name,i),{});return r.addOptions(n).setValue(this.provider.type).onChange(i=>{this.changeProviderType(i)}),r.selectEl.setAttribute("data-testid","provider-type-dropdown"),r}),new H.Setting(t).setName(I.t("settings.providerName")).setDesc(I.t("settings.providerNameDesc")).addText(r=>(r.setPlaceholder(I.t("settings.providerNamePlaceholder")).setValue(this.provider.name).onChange(n=>{this.provider.name=n,this.nameModified=!0}),r.inputEl.setAttribute("data-field","provider-name"),r)),new H.Setting(t).setName(I.t("settings.providerUrl")).setDesc(I.t("settings.providerUrlDesc")).addText(r=>(r.setPlaceholder(I.t("settings.providerUrlPlaceholder")).setValue(this.provider.url||"").onChange(n=>{this.provider.url=n,this.urlModified=!0}),r.inputEl.setAttribute("data-field","provider-url"),r)),new H.Setting(t).setName(I.t("settings.apiKey")).setDesc(I.t("settings.apiKeyDesc")).addText(r=>(r.setPlaceholder(I.t("settings.apiKeyPlaceholder")).setValue(this.provider.apiKey||"").onChange(n=>{this.provider.apiKey=n}),r.inputEl.type="password",r.inputEl.addEventListener("focus",()=>{r.inputEl.type="text"}),r.inputEl.addEventListener("blur",()=>{r.inputEl.type="password"}),r)),this.createModelSetting(t),new H.Setting(t).addButton(r=>r.setButtonText(I.t("settings.save")).setCta().onClick(async()=>{this.provider.name=this.provider.name.trim(),await this.onSave(this.provider)})).addButton(r=>(r.setButtonText(I.t("settings.cancel")).onClick(()=>{this.close()}),r.buttonEl.setAttribute("data-testid","cancel-button"),r))}onClose(){var r;let{contentEl:t}=this;(r=this.modelSuggest)==null||r.close(),this.modelSuggest=void 0,t.empty()}changeProviderType(t){let r=this.getDefaultName(this.provider.type),n=rr[this.provider.type].url,i=this.hasModelFetching(this.provider.type),o=this.hasModelFetching(t);this.provider.type=t,this.provider.availableModels=void 0,this.provider.model=void 0,this.isAddingNew&&(!this.urlModified||this.provider.url===n)&&(this.provider.url=rr[t].url,this.urlModified=!1),this.isAddingNew&&(!this.nameModified||this.provider.name===r)&&(this.provider.name=this.getDefaultName(t),this.nameModified=!1),i!==o?this.display():this.updateFields()}updateFields(){let t=this.contentEl.querySelector('input[data-field="provider-url"]'),r=this.contentEl.querySelector('input[data-field="provider-name"]');t&&(t.value=this.provider.url||""),r&&(r.value=this.provider.name)}display(){let{contentEl:t}=this;t.empty(),this.onOpen()}};var jo={_version:1,debugLogging:!1,useNativeFetch:!1},Ks=class extends he.PluginSettingTab{constructor(t,r){super(t,r);this.isFormOpen=!1;this.isDeveloperMode=!1;this.plugin=r}openForm(t,r){let n=r||{id:`id-${Date.now().toString()}`,name:"",apiKey:"",url:"",type:"openai",model:""};this.currentModal=new Vs(this.app,this.plugin,n,async i=>{await this.saveProvider(i)},t),this.currentModal.open()}closeForm(){this.isFormOpen=!1,this.currentModal&&(this.currentModal.close(),this.currentModal=void 0),this.display()}validateProvider(t){return!t.name||t.name.trim()===""?{isValid:!1,error:I.t("errors.providerNameRequired")}:(this.plugin.settings.providers||[]).find(i=>i.name.trim()===t.name.trim()&&i.id!==t.id)?{isValid:!1,error:I.t("errors.providerNameExists",{name:t.name})}:{isValid:!0}}async saveProvider(t){let r=this.validateProvider(t);if(!r.isValid){r.error&&new he.Notice(r.error);return}let n=this.plugin.settings.providers||[],i=n.findIndex(o=>o.id===t.id);i!==-1?n[i]=t:n.push(t),this.plugin.settings.providers=n,await this.plugin.saveSettings(),this.closeForm()}async deleteProvider(t){let r=this.plugin.settings.providers||[],n=r.findIndex(i=>i.id===t.id);n!==-1&&(r.splice(n,1),this.plugin.settings.providers=r,await this.plugin.saveSettings(),this.display())}async duplicateProvider(t){let r={...t,id:`id-${Date.now().toString()}`,name:`${t.name} (${I.t("settings.duplicate")})`},n=this.plugin.settings.providers||[];n.push(r),this.plugin.settings.providers=n,await this.plugin.saveSettings(),this.display()}display(){let{containerEl:t}=this;t.empty();let r=t.createDiv("ai-providers-main-interface");r.setAttribute("data-testid","main-interface"),r.createDiv("ai-providers-notice").createDiv("ai-providers-notice-content").appendChild((0,he.sanitizeHTMLToDom)(`${I.t("settings.notice")}`)),new he.Setting(r).setHeading().setName(I.t("settings.configuredProviders")).addButton(a=>{let c=a.setIcon("plus").setTooltip(I.t("settings.addProvider")).onClick(()=>{this.isFormOpen||this.openForm(!0)});return c.buttonEl.setAttribute("aria-label",I.t("settings.addProvider")),c.buttonEl.setAttribute("data-testid","add-provider-button"),c});let o=this.plugin.settings.providers||[];if(o.length>0&&o.forEach(a=>{let c=new he.Setting(r).setName(a.name).setDesc(a.url||""),l=c.nameEl.createSpan("ai-providers-provider-icon");if((0,he.setIcon)(l,`ai-providers-${a.type}`),c.nameEl.prepend(l),a.model){let d=c.settingEl.createDiv("ai-providers-model-pill");d.textContent=a.model,d.setAttribute("data-testid","model-pill"),c.nameEl.after(d)}c.addExtraButton(d=>{d.setIcon("gear").setTooltip(I.t("settings.options")).onClick(()=>{this.isFormOpen||this.openForm(!1,{...a})}),d.extraSettingsEl.setAttribute("data-testid","edit-provider")}).addExtraButton(d=>{d.setIcon("copy").setTooltip(I.t("settings.duplicate")).onClick(async()=>{await this.duplicateProvider(a)}),d.extraSettingsEl.setAttribute("data-testid","duplicate-provider")}).addExtraButton(d=>{d.setIcon("lucide-trash-2").setTooltip(I.t("settings.delete")).onClick(async()=>{new tr(this.app,I.t("settings.deleteConfirmation",{name:a.name}),async()=>{await this.deleteProvider(a)}).open()}),d.extraSettingsEl.setAttribute("data-testid","delete-provider")})}),new he.Setting(r).setHeading().setName(I.t("settings.developerSettings")).setDesc(I.t("settings.developerSettingsDesc")).setClass("ai-providers-developer-settings-toggle").addToggle(a=>a.setValue(this.isDeveloperMode).onChange(c=>{this.isDeveloperMode=c,this.display()})),this.isDeveloperMode){let a=r.createDiv("ai-providers-developer-settings");new he.Setting(a).setName(I.t("settings.debugLogging")).setDesc(I.t("settings.debugLoggingDesc")).addToggle(c=>{var l;return c.setValue((l=this.plugin.settings.debugLogging)!=null?l:!1).onChange(async d=>{this.plugin.settings.debugLogging=d,b.setEnabled(d),await this.plugin.saveSettings()})}),new he.Setting(a).setName(I.t("settings.useNativeFetch")).setDesc(I.t("settings.useNativeFetchDesc")).addToggle(c=>{var l;return c.setValue((l=this.plugin.settings.useNativeFetch)!=null?l:!1).onChange(async d=>{this.plugin.settings.useNativeFetch=d,await this.plugin.saveSettings()})})}}};var Yn=require("obsidian");var Js="RFC3986",Xs={RFC1738:s=>String(s).replace(/%20/g,"+"),RFC3986:s=>String(s)},Ho="RFC1738";var Ac=Array.isArray,ke=(()=>{let s=[];for(let e=0;e<256;++e)s.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return s})();var ni=1024,zo=(s,e,t,r,n)=>{if(s.length===0)return s;let i=s;if(typeof s=="symbol"?i=Symbol.prototype.toString.call(s):typeof s!="string"&&(i=String(s)),t==="iso-8859-1")return escape(i).replace(/%u[0-9a-f]{4}/gi,function(a){return"%26%23"+parseInt(a.slice(2),16)+"%3B"});let o="";for(let a=0;a<i.length;a+=ni){let c=i.length>=ni?i.slice(a,a+ni):i,l=[];for(let d=0;d<c.length;++d){let h=c.charCodeAt(d);if(h===45||h===46||h===95||h===126||h>=48&&h<=57||h>=65&&h<=90||h>=97&&h<=122||n===Ho&&(h===40||h===41)){l[l.length]=c.charAt(d);continue}if(h<128){l[l.length]=ke[h];continue}if(h<2048){l[l.length]=ke[192|h>>6]+ke[128|h&63];continue}if(h<55296||h>=57344){l[l.length]=ke[224|h>>12]+ke[128|h>>6&63]+ke[128|h&63];continue}d+=1,h=65536+((h&1023)<<10|c.charCodeAt(d)&1023),l[l.length]=ke[240|h>>18]+ke[128|h>>12&63]+ke[128|h>>6&63]+ke[128|h&63]}o+=l.join("")}return o};function Wo(s){return!s||typeof s!="object"?!1:!!(s.constructor&&s.constructor.isBuffer&&s.constructor.isBuffer(s))}function ii(s,e){if(Ac(s)){let t=[];for(let r=0;r<s.length;r+=1)t.push(e(s[r]));return t}return e(s)}var xc=Object.prototype.hasOwnProperty,Vo={brackets(s){return String(s)+"[]"},comma:"comma",indices(s,e){return String(s)+"["+e+"]"},repeat(s){return String(s)}},Te=Array.isArray,Pc=Array.prototype.push,Ko=function(s,e){Pc.apply(s,Te(e)?e:[e])},Ic=Date.prototype.toISOString,Q={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:zo,encodeValuesOnly:!1,format:Js,formatter:Xs[Js],indices:!1,serializeDate(s){return Ic.call(s)},skipNulls:!1,strictNullHandling:!1};function Ec(s){return typeof s=="string"||typeof s=="number"||typeof s=="boolean"||typeof s=="symbol"||typeof s=="bigint"}var oi={};function Jo(s,e,t,r,n,i,o,a,c,l,d,h,m,f,g,y,p,C){let v=s,O=C,k=0,P=!1;for(;(O=O.get(oi))!==void 0&&!P;){let R=O.get(s);if(k+=1,typeof R!="undefined"){if(R===k)throw new RangeError("Cyclic object value");P=!0}typeof O.get(oi)=="undefined"&&(k=0)}if(typeof l=="function"?v=l(e,v):v instanceof Date?v=m==null?void 0:m(v):t==="comma"&&Te(v)&&(v=ii(v,function(R){return R instanceof Date?m==null?void 0:m(R):R})),v===null){if(i)return c&&!y?c(e,Q.encoder,p,"key",f):e;v=""}if(Ec(v)||Wo(v)){if(c){let R=y?e:c(e,Q.encoder,p,"key",f);return[(g==null?void 0:g(R))+"="+(g==null?void 0:g(c(v,Q.encoder,p,"value",f)))]}return[(g==null?void 0:g(e))+"="+(g==null?void 0:g(String(v)))]}let D=[];if(typeof v=="undefined")return D;let F;if(t==="comma"&&Te(v))y&&c&&(v=ii(v,c)),F=[{value:v.length>0?v.join(",")||null:void 0}];else if(Te(l))F=l;else{let R=Object.keys(v);F=d?R.sort(d):R}let N=a?String(e).replace(/\./g,"%2E"):String(e),T=r&&Te(v)&&v.length===1?N+"[]":N;if(n&&Te(v)&&v.length===0)return T+"[]";for(let R=0;R<F.length;++R){let U=F[R],L=typeof U=="object"&&typeof U.value!="undefined"?U.value:v[U];if(o&&L===null)continue;let ve=h&&a?U.replace(/\./g,"%2E"):U,je=Te(v)?typeof t=="function"?t(T,ve):T:T+(h?"."+ve:"["+ve+"]");C.set(s,k);let me=new WeakMap;me.set(oi,C),Ko(D,Jo(L,je,t,r,n,i,o,a,t==="comma"&&y&&Te(v)?null:c,l,d,h,m,f,g,y,p,me))}return D}function Sc(s=Q){if(typeof s.allowEmptyArrays!="undefined"&&typeof s.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof s.encodeDotInKeys!="undefined"&&typeof s.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(s.encoder!==null&&typeof s.encoder!="undefined"&&typeof s.encoder!="function")throw new TypeError("Encoder has to be a function.");let e=s.charset||Q.charset;if(typeof s.charset!="undefined"&&s.charset!=="utf-8"&&s.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=Js;if(typeof s.format!="undefined"){if(!xc.call(Xs,s.format))throw new TypeError("Unknown format option provided.");t=s.format}let r=Xs[t],n=Q.filter;(typeof s.filter=="function"||Te(s.filter))&&(n=s.filter);let i;if(s.arrayFormat&&s.arrayFormat in Vo?i=s.arrayFormat:"indices"in s?i=s.indices?"indices":"repeat":i=Q.arrayFormat,"commaRoundTrip"in s&&typeof s.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");let o=typeof s.allowDots=="undefined"?s.encodeDotInKeys?!0:Q.allowDots:!!s.allowDots;return{addQueryPrefix:typeof s.addQueryPrefix=="boolean"?s.addQueryPrefix:Q.addQueryPrefix,allowDots:o,allowEmptyArrays:typeof s.allowEmptyArrays=="boolean"?!!s.allowEmptyArrays:Q.allowEmptyArrays,arrayFormat:i,charset:e,charsetSentinel:typeof s.charsetSentinel=="boolean"?s.charsetSentinel:Q.charsetSentinel,commaRoundTrip:!!s.commaRoundTrip,delimiter:typeof s.delimiter=="undefined"?Q.delimiter:s.delimiter,encode:typeof s.encode=="boolean"?s.encode:Q.encode,encodeDotInKeys:typeof s.encodeDotInKeys=="boolean"?s.encodeDotInKeys:Q.encodeDotInKeys,encoder:typeof s.encoder=="function"?s.encoder:Q.encoder,encodeValuesOnly:typeof s.encodeValuesOnly=="boolean"?s.encodeValuesOnly:Q.encodeValuesOnly,filter:n,format:t,formatter:r,serializeDate:typeof s.serializeDate=="function"?s.serializeDate:Q.serializeDate,skipNulls:typeof s.skipNulls=="boolean"?s.skipNulls:Q.skipNulls,sort:typeof s.sort=="function"?s.sort:null,strictNullHandling:typeof s.strictNullHandling=="boolean"?s.strictNullHandling:Q.strictNullHandling}}function ai(s,e={}){let t=s,r=Sc(e),n,i;typeof r.filter=="function"?(i=r.filter,t=i("",t)):Te(r.filter)&&(i=r.filter,n=i);let o=[];if(typeof t!="object"||t===null)return"";let a=Vo[r.arrayFormat],c=a==="comma"&&r.commaRoundTrip;n||(n=Object.keys(t)),r.sort&&n.sort(r.sort);let l=new WeakMap;for(let m=0;m<n.length;++m){let f=n[m];r.skipNulls&&t[f]===null||Ko(o,Jo(t[f],f,a,c,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,l))}let d=o.join(r.delimiter),h=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?h+="utf8=%26%2310003%3B&":h+="utf8=%E2%9C%93&"),d.length>0?h+d:""}var It="4.73.1";var Xo=!1,Et,li,Mc,Rc,kc,ci,Tc,Gs,di,ui,hi,Qs,fi;function Go(s,e={auto:!1}){if(Xo)throw new Error(`you must \`import 'openai/shims/${s.kind}'\` before importing anything else from openai`);if(Et)throw new Error(`can't \`import 'openai/shims/${s.kind}'\` after \`import 'openai/shims/${Et}'\``);Xo=e.auto,Et=s.kind,li=s.fetch,Mc=s.Request,Rc=s.Response,kc=s.Headers,ci=s.FormData,Tc=s.Blob,Gs=s.File,di=s.ReadableStream,ui=s.getMultipartRequestOptions,hi=s.getDefaultAgent,Qs=s.fileFromPath,fi=s.isFsReadStream}var Ys=class{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}};function Qo({manuallyImported:s}={}){let e=s?"You may need to use polyfills":"Add one of these imports before your first `import \u2026 from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n",t,r,n,i;try{t=fetch,r=Request,n=Response,i=Headers}catch(o){throw new Error(`this environment is missing the following Web Fetch API type: ${o.message}. ${e}`)}return{kind:"web",fetch:t,Request:r,Response:n,Headers:i,FormData:typeof FormData!="undefined"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob!="undefined"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File!="undefined"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream!="undefined"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(o,a)=>({...a,body:new Ys(o)}),getDefaultAgent:o=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:o=>!1}}Et||Go(Qo(),{auto:!0});var E=class extends Error{},J=class extends E{constructor(e,t,r,n){super(`${J.makeMessage(e,t,r)}`),this.status=e,this.headers=n,this.request_id=n==null?void 0:n["x-request-id"];let i=t;this.error=i,this.code=i==null?void 0:i.code,this.param=i==null?void 0:i.param,this.type=i==null?void 0:i.type}static makeMessage(e,t,r){let n=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&n?`${e} ${n}`:e?`${e} status code (no body)`:n||"(no status code or body)"}static generate(e,t,r,n){if(!e)return new rt({message:r,cause:Zs(t)});let i=t==null?void 0:t.error;return e===400?new Qr(e,i,r,n):e===401?new Yr(e,i,r,n):e===403?new Zr(e,i,r,n):e===404?new es(e,i,r,n):e===409?new ts(e,i,r,n):e===422?new rs(e,i,r,n):e===429?new ss(e,i,r,n):e>=500?new ns(e,i,r,n):new J(e,i,r,n)}},te=class extends J{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0),this.status=void 0}},rt=class extends J{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),this.status=void 0,t&&(this.cause=t)}},st=class extends rt{constructor({message:e}={}){super({message:e!=null?e:"Request timed out."})}},Qr=class extends J{constructor(){super(...arguments),this.status=400}},Yr=class extends J{constructor(){super(...arguments),this.status=401}},Zr=class extends J{constructor(){super(...arguments),this.status=403}},es=class extends J{constructor(){super(...arguments),this.status=404}},ts=class extends J{constructor(){super(...arguments),this.status=409}},rs=class extends J{constructor(){super(...arguments),this.status=422}},ss=class extends J{constructor(){super(...arguments),this.status=429}},ns=class extends J{},sr=class extends E{constructor(){super("Could not parse response content as the length limit was reached")}},nr=class extends E{constructor(){super("Could not parse response content as the request was rejected by the content filter")}};var Oe=class{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];let r=Oe.NEWLINE_CHARS.has(t[t.length-1]||""),n=t.split(Oe.NEWLINE_REGEXP);return r&&n.pop(),n.length===1&&!r?(this.buffer.push(n[0]),[]):(this.buffer.length>0&&(n=[this.buffer.join("")+n[0],...n.slice(1)],this.buffer=[]),r||(this.buffer=[n.pop()||""]),n)}decodeText(e){var t;if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer!="undefined"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new E(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder!="undefined"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return(t=this.textDecoder)!=null||(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new E(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new E("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];let e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}};Oe.NEWLINE_CHARS=new Set([`
`,"\r"]);Oe.NEWLINE_REGEXP=/\r\n|[\n\r]/g;var le=class{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let r=!1;async function*n(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let i=!1;try{for await(let o of Fc(e,t))if(!i){if(o.data.startsWith("[DONE]")){i=!0;continue}if(o.event===null){let a;try{a=JSON.parse(o.data)}catch(c){throw console.error("Could not parse message into JSON:",o.data),console.error("From chunk:",o.raw),c}if(a&&a.error)throw new J(void 0,a.error,void 0,void 0);yield a}else{let a;try{a=JSON.parse(o.data)}catch(c){throw console.error("Could not parse message into JSON:",o.data),console.error("From chunk:",o.raw),c}if(o.event=="error")throw new J(void 0,a.error,a.message,void 0);yield{event:o.event,data:a}}}i=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{i||t.abort()}}return new le(n,t)}static fromReadableStream(e,t){let r=!1;async function*n(){let o=new Oe,a=Yo(e);for await(let c of a)for(let l of o.decode(c))yield l;for(let c of o.flush())yield c}async function*i(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let o=!1;try{for await(let a of n())o||a&&(yield JSON.parse(a));o=!0}catch(a){if(a instanceof Error&&a.name==="AbortError")return;throw a}finally{o||t.abort()}}return new le(i,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],t=[],r=this.iterator(),n=i=>({next:()=>{if(i.length===0){let o=r.next();e.push(o),t.push(o)}return i.shift()}});return[new le(()=>n(e),this.controller),new le(()=>n(t),this.controller)]}toReadableStream(){let e=this,t,r=new TextEncoder;return new di({async start(){t=e[Symbol.asyncIterator]()},async pull(n){try{let{value:i,done:o}=await t.next();if(o)return n.close();let a=r.encode(JSON.stringify(i)+`
`);n.enqueue(a)}catch(i){n.error(i)}},async cancel(){var n;await((n=t.return)==null?void 0:n.call(t))}})}};async function*Fc(s,e){if(!s.body)throw e.abort(),new E("Attempted to iterate over a response with no body");let t=new mi,r=new Oe,n=Yo(s.body);for await(let i of Dc(n))for(let o of r.decode(i)){let a=t.decode(o);a&&(yield a)}for(let i of r.flush()){let o=t.decode(i);o&&(yield o)}}async function*Dc(s){let e=new Uint8Array;for await(let t of s){if(t==null)continue;let r=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t,n=new Uint8Array(e.length+r.length);n.set(e),n.set(r,e.length),e=n;let i;for(;(i=Lc(e))!==-1;)yield e.slice(0,i),e=e.slice(i)}e.length>0&&(yield e)}function Lc(s){for(let r=0;r<s.length-2;r++){if(s[r]===10&&s[r+1]===10||s[r]===13&&s[r+1]===13)return r+2;if(s[r]===13&&s[r+1]===10&&r+3<s.length&&s[r+2]===13&&s[r+3]===10)return r+4}return-1}var mi=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,n]=Bc(e,":");return n.startsWith(" ")&&(n=n.substring(1)),t==="event"?this.event=n:t==="data"&&this.data.push(n),null}};function Bc(s,e){let t=s.indexOf(e);return t!==-1?[s.substring(0,t),e,s.substring(t+e.length)]:[s,"",""]}function Yo(s){if(s[Symbol.asyncIterator])return s;let e=s.getReader();return{async next(){try{let t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){let t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}var Zo=s=>s!=null&&typeof s=="object"&&typeof s.url=="string"&&typeof s.blob=="function",ea=s=>s!=null&&typeof s=="object"&&typeof s.name=="string"&&typeof s.lastModified=="number"&&is(s),is=s=>s!=null&&typeof s=="object"&&typeof s.size=="number"&&typeof s.type=="string"&&typeof s.text=="function"&&typeof s.slice=="function"&&typeof s.arrayBuffer=="function",Uc=s=>ea(s)||Zo(s)||fi(s);async function yi(s,e,t){var n,i,o;if(s=await s,ea(s))return s;if(Zo(s)){let a=await s.blob();e||(e=(n=new URL(s.url).pathname.split(/[\\/]/).pop())!=null?n:"unknown_file");let c=is(a)?[await a.arrayBuffer()]:[a];return new Gs(c,e,t)}let r=await $c(s);if(e||(e=(i=jc(s))!=null?i:"unknown_file"),!(t!=null&&t.type)){let a=(o=r[0])==null?void 0:o.type;typeof a=="string"&&(t={...t,type:a})}return new Gs(r,e,t)}async function $c(s){var t;let e=[];if(typeof s=="string"||ArrayBuffer.isView(s)||s instanceof ArrayBuffer)e.push(s);else if(is(s))e.push(await s.arrayBuffer());else if(Hc(s))for await(let r of s)e.push(r);else throw new Error(`Unexpected data type: ${typeof s}; constructor: ${(t=s==null?void 0:s.constructor)==null?void 0:t.name}; props: ${qc(s)}`);return e}function qc(s){return`[${Object.getOwnPropertyNames(s).map(t=>`"${t}"`).join(", ")}]`}function jc(s){var e;return pi(s.name)||pi(s.filename)||((e=pi(s.path))==null?void 0:e.split(/[\\/]/).pop())}var pi=s=>{if(typeof s=="string")return s;if(typeof Buffer!="undefined"&&s instanceof Buffer)return String(s)},Hc=s=>s!=null&&typeof s=="object"&&typeof s[Symbol.asyncIterator]=="function",bi=s=>s&&typeof s=="object"&&s.body&&s[Symbol.toStringTag]==="MultipartBody";var _e=async s=>{let e=await ta(s.body);return ui(e,s)},ta=async s=>{let e=new ci;return await Promise.all(Object.entries(s||{}).map(([t,r])=>gi(e,t,r))),e};var gi=async(s,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")s.append(e,String(t));else if(Uc(t)){let r=await yi(t);s.append(e,r)}else if(Array.isArray(t))await Promise.all(t.map(r=>gi(s,e+"[]",r)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([r,n])=>gi(s,`${e}[${r}]`,n)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var Wc=function(s,e,t,r,n){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?n.call(s,t):n?n.value=t:e.set(s,t),t},Vc=function(s,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(s):r?r.value:e.get(s)},en;async function oa(s){let{response:e}=s;if(s.options.stream)return ir("response",e.status,e.url,e.headers,e.body),s.options.__streamClass?s.options.__streamClass.fromSSEResponse(e,s.controller):le.fromSSEResponse(e,s.controller);if(e.status===204)return null;if(s.options.__binaryResponse)return e;let t=e.headers.get("content-type");if((t==null?void 0:t.includes("application/json"))||(t==null?void 0:t.includes("application/vnd.api+json"))){let i=await e.json();return ir("response",e.status,e.url,e.headers,i),aa(i,e)}let n=await e.text();return ir("response",e.status,e.url,e.headers,n),n}function aa(s,e){return!s||typeof s!="object"||Array.isArray(s)?s:Object.defineProperty(s,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}var or=class extends Promise{constructor(e,t=oa){super(r=>{r(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new or(this.responsePromise,async t=>aa(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}},rn=class{constructor({baseURL:e,maxRetries:t=2,timeout:r=6e5,httpAgent:n,fetch:i}){this.baseURL=e,this.maxRetries=wi("maxRetries",t),this.timeout=wi("timeout",r),this.httpAgent=n,this.fetch=i!=null?i:li}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...Qc(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${td()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(async n=>{let i=n&&is(n==null?void 0:n.body)?new DataView(await n.body.arrayBuffer()):(n==null?void 0:n.body)instanceof DataView?n.body:(n==null?void 0:n.body)instanceof ArrayBuffer?new DataView(n.body):n&&ArrayBuffer.isView(n==null?void 0:n.body)?new DataView(n.body.buffer):n==null?void 0:n.body;return{method:e,path:t,...n,body:i}}))}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer!="undefined")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder!="undefined")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){var y,p,C,v,O,k;let{method:r,path:n,query:i,headers:o={}}=e,a=ArrayBuffer.isView(e.body)||e.__binaryRequest&&typeof e.body=="string"?e.body:bi(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,c=this.calculateContentLength(a),l=this.buildURL(n,i);"timeout"in e&&wi("timeout",e.timeout);let d=(y=e.timeout)!=null?y:this.timeout,h=(C=(p=e.httpAgent)!=null?p:this.httpAgent)!=null?C:hi(l),m=d+1e3;typeof((v=h==null?void 0:h.options)==null?void 0:v.timeout)=="number"&&m>((O=h.options.timeout)!=null?O:0)&&(h.options.timeout=m),this.idempotencyHeader&&r!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),o[this.idempotencyHeader]=e.idempotencyKey);let f=this.buildHeaders({options:e,headers:o,contentLength:c,retryCount:t});return{req:{method:r,...a&&{body:a},headers:f,...h&&{agent:h},signal:(k=e.signal)!=null?k:null},url:l,timeout:d}}buildHeaders({options:e,headers:t,contentLength:r,retryCount:n}){let i={};r&&(i["content-length"]=r);let o=this.defaultHeaders(e);return na(i,o),na(i,t),bi(e.body)&&Et!=="node"&&delete i["content-type"],ia(o,"x-stainless-retry-count")===void 0&&ia(t,"x-stainless-retry-count")===void 0&&(i["x-stainless-retry-count"]=String(n)),this.validateHeaders(i,t),i}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,r,n){return J.generate(e,t,r,n)}request(e,t=null){return new or(this.makeRequest(e,t))}async makeRequest(e,t){var h,m,f;let r=await e,n=(h=r.maxRetries)!=null?h:this.maxRetries;t==null&&(t=n),await this.prepareOptions(r);let{req:i,url:o,timeout:a}=this.buildRequest(r,{retryCount:n-t});if(await this.prepareRequest(i,{url:o,options:r}),ir("request",o,r,i.headers),(m=r.signal)!=null&&m.aborted)throw new te;let c=new AbortController,l=await this.fetchWithTimeout(o,i,a,c).catch(Zs);if(l instanceof Error){if((f=r.signal)!=null&&f.aborted)throw new te;if(t)return this.retryRequest(r,t);throw l.name==="AbortError"?new st:new rt({cause:l})}let d=Kc(l.headers);if(!l.ok){if(t&&this.shouldRetry(l)){let O=`retrying, ${t} attempts remaining`;return ir(`response (error; ${O})`,l.status,o,d),this.retryRequest(r,t,d)}let g=await l.text().catch(O=>Zs(O).message),y=Yc(g),p=y?void 0:g;throw ir(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,l.status,o,d,p),this.makeStatusError(l.status,y,p,d)}return{response:l,options:r,controller:c}}requestAPIList(e,t){let r=this.makeRequest(t,null);return new vi(this,r,e)}buildURL(e,t){let r=ed(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),n=this.defaultQuery();return la(n)||(t={...n,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,r])=>typeof r!="undefined").map(([t,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(t)}=`;throw new E(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,r,n){let{signal:i,...o}=t||{};i&&i.addEventListener("abort",()=>n.abort());let a=setTimeout(()=>n.abort(),r);return this.getRequestClient().fetch.call(void 0,e,{signal:n.signal,...o}).finally(()=>{clearTimeout(a)})}getRequestClient(){return{fetch:this.fetch}}shouldRetry(e){let t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r){var a;let n,i=r==null?void 0:r["retry-after-ms"];if(i){let c=parseFloat(i);Number.isNaN(c)||(n=c)}let o=r==null?void 0:r["retry-after"];if(o&&!n){let c=parseFloat(o);Number.isNaN(c)?n=Date.parse(o)-Date.now():n=c*1e3}if(!(n&&0<=n&&n<60*1e3)){let c=(a=e.maxRetries)!=null?a:this.maxRetries;n=this.calculateDefaultRetryTimeoutMillis(t,c)}return await He(n),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){let i=t-e,o=Math.min(.5*Math.pow(2,i),8),a=1-Math.random()*.25;return o*a*1e3}getUserAgent(){return`${this.constructor.name}/JS ${It}`}},os=class{constructor(e,t,r,n){en.set(this,void 0),Wc(this,en,e,"f"),this.options=n,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){let e=this.nextPageInfo();if(!e)throw new E("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");let t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){let r=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(let[n,i]of r)e.url.searchParams.set(n,i);t.query=void 0,t.path=e.url.toString()}return await Vc(this,en,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(en=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}},vi=class extends or{constructor(e,t,r){super(t,async n=>new r(e,n.response,await oa(n),n.options))}async*[Symbol.asyncIterator](){let e=await this;for await(let t of e)yield t}},Kc=s=>new Proxy(Object.fromEntries(s.entries()),{get(e,t){let r=t.toString();return e[r.toLowerCase()]||e[r]}}),Jc={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},$=s=>typeof s=="object"&&s!==null&&!la(s)&&Object.keys(s).every(e=>ca(Jc,e)),Xc=()=>{var e,t;if(typeof Deno!="undefined"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":It,"X-Stainless-OS":sa(Deno.build.os),"X-Stainless-Arch":ra(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:(t=(e=Deno.version)==null?void 0:e.deno)!=null?t:"unknown"};if(typeof EdgeRuntime!="undefined")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":It,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process!="undefined"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":It,"X-Stainless-OS":sa(process.platform),"X-Stainless-Arch":ra(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};let s=Gc();return s?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":It,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${s.browser}`,"X-Stainless-Runtime-Version":s.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":It,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function Gc(){if(typeof navigator=="undefined"||!navigator)return null;let s=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:t}of s){let r=t.exec(navigator.userAgent);if(r){let n=r[1]||0,i=r[2]||0,o=r[3]||0;return{browser:e,version:`${n}.${i}.${o}`}}}return null}var ra=s=>s==="x32"?"x32":s==="x86_64"||s==="x64"?"x64":s==="arm"?"arm":s==="aarch64"||s==="arm64"?"arm64":s?`other:${s}`:"unknown",sa=s=>(s=s.toLowerCase(),s.includes("ios")?"iOS":s==="android"?"Android":s==="darwin"?"MacOS":s==="win32"?"Windows":s==="freebsd"?"FreeBSD":s==="openbsd"?"OpenBSD":s==="linux"?"Linux":s?`Other:${s}`:"Unknown"),tn,Qc=()=>tn!=null?tn:tn=Xc(),Yc=s=>{try{return JSON.parse(s)}catch(e){return}},Zc=new RegExp("^(?:[a-z]+:)?//","i"),ed=s=>Zc.test(s),He=s=>new Promise(e=>setTimeout(e,s)),wi=(s,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new E(`${s} must be an integer`);if(e<0)throw new E(`${s} must be a positive integer`);return e},Zs=s=>{if(s instanceof Error)return s;if(typeof s=="object"&&s!==null)try{return new Error(JSON.stringify(s))}catch(e){}return new Error(s)};var as=s=>{var e,t,r,n,i,o;if(typeof process!="undefined")return(r=(t=(e=process.env)==null?void 0:e[s])==null?void 0:t.trim())!=null?r:void 0;if(typeof Deno!="undefined")return(o=(i=(n=Deno.env)==null?void 0:n.get)==null?void 0:i.call(n,s))==null?void 0:o.trim()};function la(s){if(!s)return!0;for(let e in s)return!1;return!0}function ca(s,e){return Object.prototype.hasOwnProperty.call(s,e)}function na(s,e){for(let t in e){if(!ca(e,t))continue;let r=t.toLowerCase();if(!r)continue;let n=e[t];n===null?delete s[r]:n!==void 0&&(s[r]=n)}}function ir(s,...e){var t;typeof process!="undefined"&&((t=process==null?void 0:process.env)==null?void 0:t.DEBUG)==="true"&&console.log(`OpenAI:DEBUG:${s}`,...e)}var td=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,s=>{let e=Math.random()*16|0;return(s==="x"?e:e&3|8).toString(16)}),da=()=>typeof window!="undefined"&&typeof window.document!="undefined"&&typeof navigator!="undefined",rd=s=>typeof(s==null?void 0:s.get)=="function";var ia=(s,e)=>{var r;let t=e.toLowerCase();if(rd(s)){let n=((r=e[0])==null?void 0:r.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(i,o,a)=>o+a.toUpperCase());for(let i of[e,t,e.toUpperCase(),n]){let o=s.get(i);if(o)return o}}for(let[n,i]of Object.entries(s))if(n.toLowerCase()===t)return Array.isArray(i)?(i.length<=1||console.warn(`Received ${i.length} entries for the ${e} header, using the first entry.`),i[0]):i};function ls(s){return s!=null&&typeof s=="object"&&!Array.isArray(s)}var sn=class extends os{constructor(e,t,r,n){super(e,t,r,n),this.data=r.data||[],this.object=r.object}getPaginatedItems(){var e;return(e=this.data)!=null?e:[]}nextPageParams(){return null}nextPageInfo(){return null}},z=class extends os{constructor(e,t,r,n){super(e,t,r,n),this.data=r.data||[]}getPaginatedItems(){var e;return(e=this.data)!=null?e:[]}nextPageParams(){let e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;let t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var r;let e=this.getPaginatedItems();if(!e.length)return null;let t=(r=e[e.length-1])==null?void 0:r.id;return t?{params:{after:t}}:null}};var _=class{constructor(e){this._client=e}};var ar=class extends _{create(e,t){var r;return this._client.post("/chat/completions",{body:e,...t,stream:(r=e.stream)!=null?r:!1})}};var nt=class extends _{constructor(){super(...arguments),this.completions=new ar(this._client)}};nt.Completions=ar;var lr=class extends _{create(e,t){return this._client.post("/audio/speech",{body:e,...t,__binaryResponse:!0})}};var cr=class extends _{create(e,t){return this._client.post("/audio/transcriptions",_e({body:e,...t}))}};var dr=class extends _{create(e,t){return this._client.post("/audio/translations",_e({body:e,...t}))}};var Ne=class extends _{constructor(){super(...arguments),this.transcriptions=new cr(this._client),this.translations=new dr(this._client),this.speech=new lr(this._client)}};Ne.Transcriptions=cr;Ne.Translations=dr;Ne.Speech=lr;var it=class extends _{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return $(e)?this.list({},e):this._client.getAPIList("/batches",Ct,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}},Ct=class extends z{};it.BatchesPage=Ct;var Mt=class extends _{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/assistants/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e={},t){return $(e)?this.list({},e):this._client.getAPIList("/assistants",ur,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}},ur=class extends z{};Mt.AssistantsPage=ur;function _i(s){return typeof s.parse=="function"}var ot=s=>(s==null?void 0:s.role)==="assistant",Ai=s=>(s==null?void 0:s.role)==="function",xi=s=>(s==null?void 0:s.role)==="tool";var Se=function(s,e,t,r,n){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?n.call(s,t):n?n.value=t:e.set(s,t),t},W=function(s,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(s):r?r.value:e.get(s)},Pi,nn,on,cs,ds,an,us,ze,hs,ln,cn,hr,ua,fr=class{constructor(){Pi.add(this),this.controller=new AbortController,nn.set(this,void 0),on.set(this,()=>{}),cs.set(this,()=>{}),ds.set(this,void 0),an.set(this,()=>{}),us.set(this,()=>{}),ze.set(this,{}),hs.set(this,!1),ln.set(this,!1),cn.set(this,!1),hr.set(this,!1),Se(this,nn,new Promise((e,t)=>{Se(this,on,e,"f"),Se(this,cs,t,"f")}),"f"),Se(this,ds,new Promise((e,t)=>{Se(this,an,e,"f"),Se(this,us,t,"f")}),"f"),W(this,nn,"f").catch(()=>{}),W(this,ds,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},W(this,Pi,"m",ua).bind(this))},0)}_connected(){this.ended||(W(this,on,"f").call(this),this._emit("connect"))}get ended(){return W(this,hs,"f")}get errored(){return W(this,ln,"f")}get aborted(){return W(this,cn,"f")}abort(){this.controller.abort()}on(e,t){return(W(this,ze,"f")[e]||(W(this,ze,"f")[e]=[])).push({listener:t}),this}off(e,t){let r=W(this,ze,"f")[e];if(!r)return this;let n=r.findIndex(i=>i.listener===t);return n>=0&&r.splice(n,1),this}once(e,t){return(W(this,ze,"f")[e]||(W(this,ze,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{Se(this,hr,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){Se(this,hr,!0,"f"),await W(this,ds,"f")}_emit(e,...t){if(W(this,hs,"f"))return;e==="end"&&(Se(this,hs,!0,"f"),W(this,an,"f").call(this));let r=W(this,ze,"f")[e];if(r&&(W(this,ze,"f")[e]=r.filter(n=>!n.once),r.forEach(({listener:n})=>n(...t))),e==="abort"){let n=t[0];!W(this,hr,"f")&&!(r!=null&&r.length)&&Promise.reject(n),W(this,cs,"f").call(this,n),W(this,us,"f").call(this,n),this._emit("end");return}if(e==="error"){let n=t[0];!W(this,hr,"f")&&!(r!=null&&r.length)&&Promise.reject(n),W(this,cs,"f").call(this,n),W(this,us,"f").call(this,n),this._emit("end")}}_emitFinal(){}};nn=new WeakMap,on=new WeakMap,cs=new WeakMap,ds=new WeakMap,an=new WeakMap,us=new WeakMap,ze=new WeakMap,hs=new WeakMap,ln=new WeakMap,cn=new WeakMap,hr=new WeakMap,Pi=new WeakSet,ua=function(e){if(Se(this,ln,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new te),e instanceof te)return Se(this,cn,!0,"f"),this._emit("abort",e);if(e instanceof E)return this._emit("error",e);if(e instanceof Error){let t=new E(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new E(String(e)))};function Ii(s){return(s==null?void 0:s.$brand)==="auto-parseable-response-format"}function Rt(s){return(s==null?void 0:s.$brand)==="auto-parseable-tool"}function ha(s,e){return!e||!Ei(e)?{...s,choices:s.choices.map(t=>{var r;return{...t,message:{...t.message,parsed:null,tool_calls:(r=t.message.tool_calls)!=null?r:[]}}})}:fs(s,e)}function fs(s,e){let t=s.choices.map(r=>{var n,i;if(r.finish_reason==="length")throw new sr;if(r.finish_reason==="content_filter")throw new nr;return{...r,message:{...r.message,tool_calls:(i=(n=r.message.tool_calls)==null?void 0:n.map(o=>cd(e,o)))!=null?i:[],parsed:r.message.content&&!r.message.refusal?ld(e,r.message.content):null}}});return{...s,choices:t}}function ld(s,e){var t,r;return((t=s.response_format)==null?void 0:t.type)!=="json_schema"?null:((r=s.response_format)==null?void 0:r.type)==="json_schema"?"$parseRaw"in s.response_format?s.response_format.$parseRaw(e):JSON.parse(e):null}function cd(s,e){var r;let t=(r=s.tools)==null?void 0:r.find(n=>{var i;return((i=n.function)==null?void 0:i.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:Rt(t)?t.$parseRaw(e.function.arguments):t!=null&&t.function.strict?JSON.parse(e.function.arguments):null}}}function fa(s,e){var r;if(!s)return!1;let t=(r=s.tools)==null?void 0:r.find(n=>{var i;return((i=n.function)==null?void 0:i.name)===e.function.name});return Rt(t)||(t==null?void 0:t.function.strict)||!1}function Ei(s){var e,t;return Ii(s.response_format)?!0:(t=(e=s.tools)==null?void 0:e.some(r=>Rt(r)||r.type==="function"&&r.function.strict===!0))!=null?t:!1}function ma(s){for(let e of s!=null?s:[]){if(e.type!=="function")throw new E(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new E(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var fe=function(s,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(s):r?r.value:e.get(s)},ae,Si,dn,Ci,Mi,Ri,ga,ki,pa=10,mr=class extends fr{constructor(){super(...arguments),ae.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var r;this._chatCompletions.push(e),this._emit("chatCompletion",e);let t=(r=e.choices[0])==null?void 0:r.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(Ai(e)||xi(e))&&e.content)this._emit("functionCallResult",e.content);else if(ot(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(ot(e)&&e.tool_calls)for(let r of e.tool_calls)r.type==="function"&&this._emit("functionCall",r.function)}}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new E("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),fe(this,ae,"m",Si).call(this)}async finalMessage(){return await this.done(),fe(this,ae,"m",dn).call(this)}async finalFunctionCall(){return await this.done(),fe(this,ae,"m",Ci).call(this)}async finalFunctionCallResult(){return await this.done(),fe(this,ae,"m",Mi).call(this)}async totalUsage(){return await this.done(),fe(this,ae,"m",Ri).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let t=fe(this,ae,"m",dn).call(this);t&&this._emit("finalMessage",t);let r=fe(this,ae,"m",Si).call(this);r&&this._emit("finalContent",r);let n=fe(this,ae,"m",Ci).call(this);n&&this._emit("finalFunctionCall",n);let i=fe(this,ae,"m",Mi).call(this);i!=null&&this._emit("finalFunctionCallResult",i),this._chatCompletions.some(o=>o.usage)&&this._emit("totalUsage",fe(this,ae,"m",Ri).call(this))}async _createChatCompletion(e,t,r){let n=r==null?void 0:r.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),fe(this,ae,"m",ga).call(this,t);let i=await e.chat.completions.create({...t,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(fs(i,t))}async _runChatCompletion(e,t,r){for(let n of t.messages)this._addMessage(n,!1);return await this._createChatCompletion(e,t,r)}async _runFunctions(e,t,r){var m;let n="function",{function_call:i="auto",stream:o,...a}=t,c=typeof i!="string"&&(i==null?void 0:i.name),{maxChatCompletions:l=pa}=r||{},d={};for(let f of t.functions)d[f.name||f.function.name]=f;let h=t.functions.map(f=>({name:f.name||f.function.name,parameters:f.parameters,description:f.description}));for(let f of t.messages)this._addMessage(f,!1);for(let f=0;f<l;++f){let y=(m=(await this._createChatCompletion(e,{...a,function_call:i,functions:h,messages:[...this.messages]},r)).choices[0])==null?void 0:m.message;if(!y)throw new E("missing message in ChatCompletion response");if(!y.function_call)return;let{name:p,arguments:C}=y.function_call,v=d[p];if(v){if(c&&c!==p){let D=`Invalid function_call: ${JSON.stringify(p)}. ${JSON.stringify(c)} requested. Please try again`;this._addMessage({role:n,name:p,content:D});continue}}else{let D=`Invalid function_call: ${JSON.stringify(p)}. Available options are: ${h.map(F=>JSON.stringify(F.name)).join(", ")}. Please try again`;this._addMessage({role:n,name:p,content:D});continue}let O;try{O=_i(v)?await v.parse(C):C}catch(D){this._addMessage({role:n,name:p,content:D instanceof Error?D.message:String(D)});continue}let k=await v.function(O,this),P=fe(this,ae,"m",ki).call(this,k);if(this._addMessage({role:n,name:p,content:P}),c)return}}async _runTools(e,t,r){var f,g,y;let n="tool",{tool_choice:i="auto",stream:o,...a}=t,c=typeof i!="string"&&((f=i==null?void 0:i.function)==null?void 0:f.name),{maxChatCompletions:l=pa}=r||{},d=t.tools.map(p=>{if(Rt(p)){if(!p.$callback)throw new E("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:p.$callback,name:p.function.name,description:p.function.description||"",parameters:p.function.parameters,parse:p.$parseRaw,strict:!0}}}return p}),h={};for(let p of d)p.type==="function"&&(h[p.function.name||p.function.function.name]=p.function);let m="tools"in t?d.map(p=>p.type==="function"?{type:"function",function:{name:p.function.name||p.function.function.name,parameters:p.function.parameters,description:p.function.description,strict:p.function.strict}}:p):void 0;for(let p of t.messages)this._addMessage(p,!1);for(let p=0;p<l;++p){let v=(g=(await this._createChatCompletion(e,{...a,tool_choice:i,tools:m,messages:[...this.messages]},r)).choices[0])==null?void 0:g.message;if(!v)throw new E("missing message in ChatCompletion response");if(!((y=v.tool_calls)!=null&&y.length))return;for(let O of v.tool_calls){if(O.type!=="function")continue;let k=O.id,{name:P,arguments:D}=O.function,F=h[P];if(F){if(c&&c!==P){let U=`Invalid tool_call: ${JSON.stringify(P)}. ${JSON.stringify(c)} requested. Please try again`;this._addMessage({role:n,tool_call_id:k,content:U});continue}}else{let U=`Invalid tool_call: ${JSON.stringify(P)}. Available options are: ${Object.keys(h).map(L=>JSON.stringify(L)).join(", ")}. Please try again`;this._addMessage({role:n,tool_call_id:k,content:U});continue}let N;try{N=_i(F)?await F.parse(D):D}catch(U){let L=U instanceof Error?U.message:String(U);this._addMessage({role:n,tool_call_id:k,content:L});continue}let T=await F.function(N,this),R=fe(this,ae,"m",ki).call(this,T);if(this._addMessage({role:n,tool_call_id:k,content:R}),c)return}}}};ae=new WeakSet,Si=function(){var e;return(e=fe(this,ae,"m",dn).call(this).content)!=null?e:null},dn=function(){var t,r;let e=this.messages.length;for(;e-- >0;){let n=this.messages[e];if(ot(n)){let{function_call:i,...o}=n,a={...o,content:(t=n.content)!=null?t:null,refusal:(r=n.refusal)!=null?r:null};return i&&(a.function_call=i),a}}throw new E("stream ended without producing a ChatCompletionMessage with role=assistant")},Ci=function(){var e,t;for(let r=this.messages.length-1;r>=0;r--){let n=this.messages[r];if(ot(n)&&(n!=null&&n.function_call))return n.function_call;if(ot(n)&&((e=n==null?void 0:n.tool_calls)!=null&&e.length))return(t=n.tool_calls.at(-1))==null?void 0:t.function}},Mi=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(Ai(t)&&t.content!=null||xi(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(r=>{var n;return r.role==="assistant"&&((n=r.tool_calls)==null?void 0:n.some(i=>i.type==="function"&&i.id===t.tool_call_id))}))return t.content}},Ri=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},ga=function(e){if(e.n!=null&&e.n>1)throw new E("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},ki=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};var at=class extends mr{static runFunctions(e,t,r){let n=new at,i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return n._run(()=>n._runFunctions(e,t,i)),n}static runTools(e,t,r){let n=new at,i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run(()=>n._runTools(e,t,i)),n}_addMessage(e,t=!0){super._addMessage(e,t),ot(e)&&e.content&&this._emit("content",e.content)}};var re={STR:1,NUM:2,ARR:4,OBJ:8,NULL:16,BOOL:32,NAN:64,INFINITY:128,MINUS_INFINITY:256,INF:384,SPECIAL:496,ATOM:499,COLLECTION:12,ALL:511},Ti=class extends Error{},Oi=class extends Error{};function dd(s,e=re.ALL){if(typeof s!="string")throw new TypeError(`expecting str, got ${typeof s}`);if(!s.trim())throw new Error(`${s} is empty`);return ud(s.trim(),e)}var ud=(s,e)=>{let t=s.length,r=0,n=m=>{throw new Ti(`${m} at position ${r}`)},i=m=>{throw new Oi(`${m} at position ${r}`)},o=()=>(h(),r>=t&&n("Unexpected end of input"),s[r]==='"'?a():s[r]==="{"?c():s[r]==="["?l():s.substring(r,r+4)==="null"||re.NULL&e&&t-r<4&&"null".startsWith(s.substring(r))?(r+=4,null):s.substring(r,r+4)==="true"||re.BOOL&e&&t-r<4&&"true".startsWith(s.substring(r))?(r+=4,!0):s.substring(r,r+5)==="false"||re.BOOL&e&&t-r<5&&"false".startsWith(s.substring(r))?(r+=5,!1):s.substring(r,r+8)==="Infinity"||re.INFINITY&e&&t-r<8&&"Infinity".startsWith(s.substring(r))?(r+=8,1/0):s.substring(r,r+9)==="-Infinity"||re.MINUS_INFINITY&e&&1<t-r&&t-r<9&&"-Infinity".startsWith(s.substring(r))?(r+=9,-1/0):s.substring(r,r+3)==="NaN"||re.NAN&e&&t-r<3&&"NaN".startsWith(s.substring(r))?(r+=3,NaN):d()),a=()=>{let m=r,f=!1;for(r++;r<t&&(s[r]!=='"'||f&&s[r-1]==="\\");)f=s[r]==="\\"?!f:!1,r++;if(s.charAt(r)=='"')try{return JSON.parse(s.substring(m,++r-Number(f)))}catch(g){i(String(g))}else if(re.STR&e)try{return JSON.parse(s.substring(m,r-Number(f))+'"')}catch(g){return JSON.parse(s.substring(m,s.lastIndexOf("\\"))+'"')}n("Unterminated string literal")},c=()=>{r++,h();let m={};try{for(;s[r]!=="}";){if(h(),r>=t&&re.OBJ&e)return m;let f=a();h(),r++;try{let g=o();Object.defineProperty(m,f,{value:g,writable:!0,enumerable:!0,configurable:!0})}catch(g){if(re.OBJ&e)return m;throw g}h(),s[r]===","&&r++}}catch(f){if(re.OBJ&e)return m;n("Expected '}' at end of object")}return r++,m},l=()=>{r++;let m=[];try{for(;s[r]!=="]";)m.push(o()),h(),s[r]===","&&r++}catch(f){if(re.ARR&e)return m;n("Expected ']' at end of array")}return r++,m},d=()=>{if(r===0){s==="-"&&re.NUM&e&&n("Not sure what '-' is");try{return JSON.parse(s)}catch(f){if(re.NUM&e)try{return s[s.length-1]==="."?JSON.parse(s.substring(0,s.lastIndexOf("."))):JSON.parse(s.substring(0,s.lastIndexOf("e")))}catch(g){}i(String(f))}}let m=r;for(s[r]==="-"&&r++;s[r]&&!",]}".includes(s[r]);)r++;r==t&&!(re.NUM&e)&&n("Unterminated number literal");try{return JSON.parse(s.substring(m,r))}catch(f){s.substring(m,r)==="-"&&re.NUM&e&&n("Not sure what '-' is");try{return JSON.parse(s.substring(m,s.lastIndexOf("e")))}catch(g){i(String(g))}}},h=()=>{for(;r<t&&` 
\r	`.includes(s[r]);)r++};return o()},Ni=s=>dd(s,re.ALL^re.NUM);var pr=function(s,e,t,r,n){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?n.call(s,t):n?n.value=t:e.set(s,t),t},B=function(s,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(s):r?r.value:e.get(s)},Y,We,gr,lt,Fi,un,Di,Li,Bi,hn,Ui,ya,Ve=class extends mr{constructor(e){super(),Y.add(this),We.set(this,void 0),gr.set(this,void 0),lt.set(this,void 0),pr(this,We,e,"f"),pr(this,gr,[],"f")}get currentChatCompletionSnapshot(){return B(this,lt,"f")}static fromReadableStream(e){let t=new Ve(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,r){let n=new Ve(t);return n._run(()=>n._runChatCompletion(e,{...t,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),n}async _createChatCompletion(e,t,r){var o;super._createChatCompletion;let n=r==null?void 0:r.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),B(this,Y,"m",Fi).call(this);let i=await e.chat.completions.create({...t,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(let a of i)B(this,Y,"m",Di).call(this,a);if((o=i.controller.signal)!=null&&o.aborted)throw new te;return this._addChatCompletion(B(this,Y,"m",hn).call(this))}async _fromReadableStream(e,t){var o;let r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),B(this,Y,"m",Fi).call(this),this._connected();let n=le.fromReadableStream(e,this.controller),i;for await(let a of n)i&&i!==a.id&&this._addChatCompletion(B(this,Y,"m",hn).call(this)),B(this,Y,"m",Di).call(this,a),i=a.id;if((o=n.controller.signal)!=null&&o.aborted)throw new te;return this._addChatCompletion(B(this,Y,"m",hn).call(this))}[(We=new WeakMap,gr=new WeakMap,lt=new WeakMap,Y=new WeakSet,Fi=function(){this.ended||pr(this,lt,void 0,"f")},un=function(t){let r=B(this,gr,"f")[t.index];return r||(r={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},B(this,gr,"f")[t.index]=r,r)},Di=function(t){var n,i,o,a,c,l,d,h,m,f,g,y,p,C,v,O,k,P,D,F;if(this.ended)return;let r=B(this,Y,"m",ya).call(this,t);this._emit("chunk",t,r);for(let N of t.choices){let T=r.choices[N.index];N.delta.content!=null&&((n=T.message)==null?void 0:n.role)==="assistant"&&((i=T.message)!=null&&i.content)&&(this._emit("content",N.delta.content,T.message.content),this._emit("content.delta",{delta:N.delta.content,snapshot:T.message.content,parsed:T.message.parsed})),N.delta.refusal!=null&&((o=T.message)==null?void 0:o.role)==="assistant"&&((a=T.message)!=null&&a.refusal)&&this._emit("refusal.delta",{delta:N.delta.refusal,snapshot:T.message.refusal}),((c=N.logprobs)==null?void 0:c.content)!=null&&((l=T.message)==null?void 0:l.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(d=N.logprobs)==null?void 0:d.content,snapshot:(m=(h=T.logprobs)==null?void 0:h.content)!=null?m:[]}),((f=N.logprobs)==null?void 0:f.refusal)!=null&&((g=T.message)==null?void 0:g.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(y=N.logprobs)==null?void 0:y.refusal,snapshot:(C=(p=T.logprobs)==null?void 0:p.refusal)!=null?C:[]});let R=B(this,Y,"m",un).call(this,T);T.finish_reason&&(B(this,Y,"m",Bi).call(this,T),R.current_tool_call_index!=null&&B(this,Y,"m",Li).call(this,T,R.current_tool_call_index));for(let U of(v=N.delta.tool_calls)!=null?v:[])R.current_tool_call_index!==U.index&&(B(this,Y,"m",Bi).call(this,T),R.current_tool_call_index!=null&&B(this,Y,"m",Li).call(this,T,R.current_tool_call_index)),R.current_tool_call_index=U.index;for(let U of(O=N.delta.tool_calls)!=null?O:[]){let L=(k=T.message.tool_calls)==null?void 0:k[U.index];L!=null&&L.type&&((L==null?void 0:L.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(P=L.function)==null?void 0:P.name,index:U.index,arguments:L.function.arguments,parsed_arguments:L.function.parsed_arguments,arguments_delta:(F=(D=U.function)==null?void 0:D.arguments)!=null?F:""}):(L==null||L.type,void 0))}}},Li=function(t,r){var o,a,c;if(B(this,Y,"m",un).call(this,t).done_tool_calls.has(r))return;let i=(o=t.message.tool_calls)==null?void 0:o[r];if(!i)throw new Error("no tool call snapshot");if(!i.type)throw new Error("tool call snapshot missing `type`");if(i.type==="function"){let l=(c=(a=B(this,We,"f"))==null?void 0:a.tools)==null?void 0:c.find(d=>d.type==="function"&&d.function.name===i.function.name);this._emit("tool_calls.function.arguments.done",{name:i.function.name,index:r,arguments:i.function.arguments,parsed_arguments:Rt(l)?l.$parseRaw(i.function.arguments):l!=null&&l.function.strict?JSON.parse(i.function.arguments):null})}else i.type},Bi=function(t){var n,i;let r=B(this,Y,"m",un).call(this,t);if(t.message.content&&!r.content_done){r.content_done=!0;let o=B(this,Y,"m",Ui).call(this);this._emit("content.done",{content:t.message.content,parsed:o?o.$parseRaw(t.message.content):null})}t.message.refusal&&!r.refusal_done&&(r.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),(n=t.logprobs)!=null&&n.content&&!r.logprobs_content_done&&(r.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),(i=t.logprobs)!=null&&i.refusal&&!r.logprobs_refusal_done&&(r.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},hn=function(){if(this.ended)throw new E("stream has ended, this shouldn't happen");let t=B(this,lt,"f");if(!t)throw new E("request ended without sending any chunks");return pr(this,lt,void 0,"f"),pr(this,gr,[],"f"),hd(t,B(this,We,"f"))},Ui=function(){var r;let t=(r=B(this,We,"f"))==null?void 0:r.response_format;return Ii(t)?t:null},ya=function(t){var d,h,m,f,g,y;var r,n,i,o;let a=B(this,lt,"f"),{choices:c,...l}=t;a?Object.assign(a,l):a=pr(this,lt,{...l,choices:[]},"f");for(let{delta:p,finish_reason:C,index:v,logprobs:O=null,...k}of t.choices){let P=a.choices[v];if(P||(P=a.choices[v]={finish_reason:C,index:v,message:{},logprobs:O,...k}),O)if(!P.logprobs)P.logprobs=Object.assign({},O);else{let{content:L,refusal:ve,...je}=O;Object.assign(P.logprobs,je),L&&((d=(r=P.logprobs).content)!=null||(r.content=[]),P.logprobs.content.push(...L)),ve&&((h=(n=P.logprobs).refusal)!=null||(n.refusal=[]),P.logprobs.refusal.push(...ve))}if(C&&(P.finish_reason=C,B(this,We,"f")&&Ei(B(this,We,"f")))){if(C==="length")throw new sr;if(C==="content_filter")throw new nr}if(Object.assign(P,k),!p)continue;let{content:D,refusal:F,function_call:N,role:T,tool_calls:R,...U}=p;if(Object.assign(P.message,U),F&&(P.message.refusal=(P.message.refusal||"")+F),T&&(P.message.role=T),N&&(P.message.function_call?(N.name&&(P.message.function_call.name=N.name),N.arguments&&((m=(i=P.message.function_call).arguments)!=null||(i.arguments=""),P.message.function_call.arguments+=N.arguments)):P.message.function_call=N),D&&(P.message.content=(P.message.content||"")+D,!P.message.refusal&&B(this,Y,"m",Ui).call(this)&&(P.message.parsed=Ni(P.message.content))),R){P.message.tool_calls||(P.message.tool_calls=[]);for(let{index:L,id:ve,type:je,function:me,...rc}of R){let Re=(f=(o=P.message.tool_calls)[L])!=null?f:o[L]={};Object.assign(Re,rc),ve&&(Re.id=ve),je&&(Re.type=je),me&&((y=Re.function)!=null||(Re.function={name:(g=me.name)!=null?g:"",arguments:""})),me!=null&&me.name&&(Re.function.name=me.name),me!=null&&me.arguments&&(Re.function.arguments+=me.arguments,fa(B(this,We,"f"),Re)&&(Re.function.parsed_arguments=Ni(Re.function.arguments)))}}}return a},Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("chunk",n=>{let i=t.shift();i?i.resolve(n):e.push(n)}),this.on("end",()=>{r=!0;for(let n of t)n.resolve(void 0);t.length=0}),this.on("abort",n=>{r=!0;for(let i of t)i.reject(n);t.length=0}),this.on("error",n=>{r=!0;for(let i of t)i.reject(n);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,o)=>t.push({resolve:i,reject:o})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new le(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}};function hd(s,e){let{id:t,choices:r,created:n,model:i,system_fingerprint:o,...a}=s,c={...a,id:t,choices:r.map(({message:l,finish_reason:d,index:h,logprobs:m,...f})=>{var O,k,P;if(!d)throw new E(`missing finish_reason for choice ${h}`);let{content:g=null,function_call:y,tool_calls:p,...C}=l,v=l.role;if(!v)throw new E(`missing role for choice ${h}`);if(y){let{arguments:D,name:F}=y;if(D==null)throw new E(`missing function_call.arguments for choice ${h}`);if(!F)throw new E(`missing function_call.name for choice ${h}`);return{...f,message:{content:g,function_call:{arguments:D,name:F},role:v,refusal:(O=l.refusal)!=null?O:null},finish_reason:d,index:h,logprobs:m}}return p?{...f,index:h,finish_reason:d,logprobs:m,message:{...C,role:v,content:g,refusal:(k=l.refusal)!=null?k:null,tool_calls:p.map((D,F)=>{let{function:N,type:T,id:R,...U}=D,{arguments:L,name:ve,...je}=N||{};if(R==null)throw new E(`missing choices[${h}].tool_calls[${F}].id
${fn(s)}`);if(T==null)throw new E(`missing choices[${h}].tool_calls[${F}].type
${fn(s)}`);if(ve==null)throw new E(`missing choices[${h}].tool_calls[${F}].function.name
${fn(s)}`);if(L==null)throw new E(`missing choices[${h}].tool_calls[${F}].function.arguments
${fn(s)}`);return{...U,id:R,type:T,function:{...je,name:ve,arguments:L}}})}}:{...f,message:{...C,content:g,role:v,refusal:(P=l.refusal)!=null?P:null},finish_reason:d,index:h,logprobs:m}}),created:n,model:i,object:"chat.completion",...o?{system_fingerprint:o}:{}};return ha(c,e)}function fn(s){return JSON.stringify(s)}var Ke=class extends Ve{static fromReadableStream(e){let t=new Ke(null);return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,r){let n=new Ke(null),i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return n._run(()=>n._runFunctions(e,t,i)),n}static runTools(e,t,r){let n=new Ke(t),i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run(()=>n._runTools(e,t,i)),n}};var ms=class extends _{parse(e,t){return ma(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t==null?void 0:t.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(r=>fs(r,e))}runFunctions(e,t){return e.stream?Ke.runFunctions(this._client,e,t):at.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?Ke.runTools(this._client,e,t):at.runTools(this._client,e,t)}stream(e,t){return Ve.createChatCompletion(this._client,e,t)}};var yr=class extends _{constructor(){super(...arguments),this.completions=new ms(this._client)}};(function(s){s.Completions=ms})(yr||(yr={}));var x=function(s,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(s):r?r.value:e.get(s)},pe=function(s,e,t,r,n){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?n.call(s,t):n?n.value=t:e.set(s,t),t},ne,$i,Fe,mn,Ce,Tt,br,kt,yn,ge,pn,gn,ys,ps,gs,ba,wa,va,_a,Aa,xa,Pa,ce=class extends fr{constructor(){super(...arguments),ne.add(this),$i.set(this,[]),Fe.set(this,{}),mn.set(this,{}),Ce.set(this,void 0),Tt.set(this,void 0),br.set(this,void 0),kt.set(this,void 0),yn.set(this,void 0),ge.set(this,void 0),pn.set(this,void 0),gn.set(this,void 0),ys.set(this,void 0)}[($i=new WeakMap,Fe=new WeakMap,mn=new WeakMap,Ce=new WeakMap,Tt=new WeakMap,br=new WeakMap,kt=new WeakMap,yn=new WeakMap,ge=new WeakMap,pn=new WeakMap,gn=new WeakMap,ys=new WeakMap,ne=new WeakSet,Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("event",n=>{let i=t.shift();i?i.resolve(n):e.push(n)}),this.on("end",()=>{r=!0;for(let n of t)n.resolve(void 0);t.length=0}),this.on("abort",n=>{r=!0;for(let i of t)i.reject(n);t.length=0}),this.on("error",n=>{r=!0;for(let i of t)i.reject(n);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,o)=>t.push({resolve:i,reject:o})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let t=new ce;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){var i;let r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();let n=le.fromReadableStream(e,this.controller);for await(let o of n)x(this,ne,"m",ps).call(this,o);if((i=n.controller.signal)!=null&&i.aborted)throw new te;return this._addRun(x(this,ne,"m",gs).call(this))}toReadableStream(){return new le(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,r,n,i){let o=new ce;return o._run(()=>o._runToolAssistantStream(e,t,r,n,{...i,headers:{...i==null?void 0:i.headers,"X-Stainless-Helper-Method":"stream"}})),o}async _createToolAssistantStream(e,t,r,n,i){var l;let o=i==null?void 0:i.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",()=>this.controller.abort()));let a={...n,stream:!0},c=await e.submitToolOutputs(t,r,a,{...i,signal:this.controller.signal});this._connected();for await(let d of c)x(this,ne,"m",ps).call(this,d);if((l=c.controller.signal)!=null&&l.aborted)throw new te;return this._addRun(x(this,ne,"m",gs).call(this))}static createThreadAssistantStream(e,t,r){let n=new ce;return n._run(()=>n._threadAssistantStream(e,t,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),n}static createAssistantStream(e,t,r,n){let i=new ce;return i._run(()=>i._runAssistantStream(e,t,r,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),i}currentEvent(){return x(this,pn,"f")}currentRun(){return x(this,gn,"f")}currentMessageSnapshot(){return x(this,Ce,"f")}currentRunStepSnapshot(){return x(this,ys,"f")}async finalRunSteps(){return await this.done(),Object.values(x(this,Fe,"f"))}async finalMessages(){return await this.done(),Object.values(x(this,mn,"f"))}async finalRun(){if(await this.done(),!x(this,Tt,"f"))throw Error("Final run was not received.");return x(this,Tt,"f")}async _createThreadAssistantStream(e,t,r){var a;let n=r==null?void 0:r.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort()));let i={...t,stream:!0},o=await e.createAndRun(i,{...r,signal:this.controller.signal});this._connected();for await(let c of o)x(this,ne,"m",ps).call(this,c);if((a=o.controller.signal)!=null&&a.aborted)throw new te;return this._addRun(x(this,ne,"m",gs).call(this))}async _createAssistantStream(e,t,r,n){var c;let i=n==null?void 0:n.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));let o={...r,stream:!0},a=await e.create(t,o,{...n,signal:this.controller.signal});this._connected();for await(let l of a)x(this,ne,"m",ps).call(this,l);if((c=a.controller.signal)!=null&&c.aborted)throw new te;return this._addRun(x(this,ne,"m",gs).call(this))}static accumulateDelta(e,t){for(let[r,n]of Object.entries(t)){if(!e.hasOwnProperty(r)){e[r]=n;continue}let i=e[r];if(i==null){e[r]=n;continue}if(r==="index"||r==="type"){e[r]=n;continue}if(typeof i=="string"&&typeof n=="string")i+=n;else if(typeof i=="number"&&typeof n=="number")i+=n;else if(ls(i)&&ls(n))i=this.accumulateDelta(i,n);else if(Array.isArray(i)&&Array.isArray(n)){if(i.every(o=>typeof o=="string"||typeof o=="number")){i.push(...n);continue}for(let o of n){if(!ls(o))throw new Error(`Expected array delta entry to be an object but got: ${o}`);let a=o.index;if(a==null)throw console.error(o),new Error("Expected array delta entry to have an `index` property");if(typeof a!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${a}`);let c=i[a];c==null?i.push(o):i[a]=this.accumulateDelta(c,o)}continue}else throw Error(`Unhandled record type: ${r}, deltaValue: ${n}, accValue: ${i}`);e[r]=i}return e}_addRun(e){return e}async _threadAssistantStream(e,t,r){return await this._createThreadAssistantStream(t,e,r)}async _runAssistantStream(e,t,r,n){return await this._createAssistantStream(t,e,r,n)}async _runToolAssistantStream(e,t,r,n,i){return await this._createToolAssistantStream(r,e,t,n,i)}};ps=function(e){if(!this.ended)switch(pe(this,pn,e,"f"),x(this,ne,"m",va).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":x(this,ne,"m",Pa).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":x(this,ne,"m",wa).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":x(this,ne,"m",ba).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},gs=function(){if(this.ended)throw new E("stream has ended, this shouldn't happen");if(!x(this,Tt,"f"))throw Error("Final run has not been received");return x(this,Tt,"f")},ba=function(e){let[t,r]=x(this,ne,"m",Aa).call(this,e,x(this,Ce,"f"));pe(this,Ce,t,"f"),x(this,mn,"f")[t.id]=t;for(let n of r){let i=t.content[n.index];(i==null?void 0:i.type)=="text"&&this._emit("textCreated",i.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(let n of e.data.delta.content){if(n.type=="text"&&n.text){let i=n.text,o=t.content[n.index];if(o&&o.type=="text")this._emit("textDelta",i,o.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(n.index!=x(this,br,"f")){if(x(this,kt,"f"))switch(x(this,kt,"f").type){case"text":this._emit("textDone",x(this,kt,"f").text,x(this,Ce,"f"));break;case"image_file":this._emit("imageFileDone",x(this,kt,"f").image_file,x(this,Ce,"f"));break}pe(this,br,n.index,"f")}pe(this,kt,t.content[n.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(x(this,br,"f")!==void 0){let n=e.data.content[x(this,br,"f")];if(n)switch(n.type){case"image_file":this._emit("imageFileDone",n.image_file,x(this,Ce,"f"));break;case"text":this._emit("textDone",n.text,x(this,Ce,"f"));break}}x(this,Ce,"f")&&this._emit("messageDone",e.data),pe(this,Ce,void 0,"f")}},wa=function(e){let t=x(this,ne,"m",_a).call(this,e);switch(pe(this,ys,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let r=e.data.delta;if(r.step_details&&r.step_details.type=="tool_calls"&&r.step_details.tool_calls&&t.step_details.type=="tool_calls")for(let i of r.step_details.tool_calls)i.index==x(this,yn,"f")?this._emit("toolCallDelta",i,t.step_details.tool_calls[i.index]):(x(this,ge,"f")&&this._emit("toolCallDone",x(this,ge,"f")),pe(this,yn,i.index,"f"),pe(this,ge,t.step_details.tool_calls[i.index],"f"),x(this,ge,"f")&&this._emit("toolCallCreated",x(this,ge,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":pe(this,ys,void 0,"f"),e.data.step_details.type=="tool_calls"&&x(this,ge,"f")&&(this._emit("toolCallDone",x(this,ge,"f")),pe(this,ge,void 0,"f")),this._emit("runStepDone",e.data,t);break;case"thread.run.step.in_progress":break}},va=function(e){x(this,$i,"f").push(e),this._emit("event",e)},_a=function(e){switch(e.event){case"thread.run.step.created":return x(this,Fe,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=x(this,Fe,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let r=e.data;if(r.delta){let n=ce.accumulateDelta(t,r.delta);x(this,Fe,"f")[e.data.id]=n}return x(this,Fe,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":x(this,Fe,"f")[e.data.id]=e.data;break}if(x(this,Fe,"f")[e.data.id])return x(this,Fe,"f")[e.data.id];throw new Error("No snapshot available")},Aa=function(e,t){let r=[];switch(e.event){case"thread.message.created":return[e.data,r];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let n=e.data;if(n.delta.content)for(let i of n.delta.content)if(i.index in t.content){let o=t.content[i.index];t.content[i.index]=x(this,ne,"m",xa).call(this,i,o)}else t.content[i.index]=i,r.push(i);return[t,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},xa=function(e,t){return ce.accumulateDelta(t,e)},Pa=function(e){switch(pe(this,gn,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":pe(this,Tt,e.data,"f"),x(this,ge,"f")&&(this._emit("toolCallDone",x(this,ge,"f")),pe(this,ge,void 0,"f"));break;case"thread.run.cancelling":break}};var Ot=class extends _{create(e,t,r){return this._client.post(`/threads/${e}/messages`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,t,r,n){return this._client.post(`/threads/${e}/messages/${t}`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e,t={},r){return $(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,wr,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,t,r){return this._client.delete(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}},wr=class extends z{};Ot.MessagesPage=wr;var Nt=class extends _{retrieve(e,t,r,n={},i){return $(n)?this.retrieve(e,t,r,{},n):this._client.get(`/threads/${e}/runs/${t}/steps/${r}`,{query:n,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}list(e,t,r={},n){return $(r)?this.list(e,t,{},r):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,vr,{query:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}},vr=class extends z{};Nt.RunStepsPage=vr;var Je=class extends _{constructor(){super(...arguments),this.steps=new Nt(this._client)}create(e,t,r){var o;let{include:n,...i}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:n},body:i,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers},stream:(o=t.stream)!=null?o:!1})}retrieve(e,t,r){return this._client.get(`/threads/${e}/runs/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,t,r,n){return this._client.post(`/threads/${e}/runs/${t}`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e,t={},r){return $(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,_r,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}cancel(e,t,r){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){let n=await this.create(e,t,r);return await this.poll(e,n.id,r)}createAndStream(e,t,r){return ce.createAssistantStream(e,this._client.beta.threads.runs,t,r)}async poll(e,t,r){let n={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(n["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){let{data:i,response:o}=await this.retrieve(e,t,{...r,headers:{...r==null?void 0:r.headers,...n}}).withResponse();switch(i.status){case"queued":case"in_progress":case"cancelling":let a=5e3;if(r!=null&&r.pollIntervalMs)a=r.pollIntervalMs;else{let c=o.headers.get("openai-poll-after-ms");if(c){let l=parseInt(c);isNaN(l)||(a=l)}}await He(a);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return i}}}stream(e,t,r){return ce.createAssistantStream(e,this._client.beta.threads.runs,t,r)}submitToolOutputs(e,t,r,n){var i;return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers},stream:(i=r.stream)!=null?i:!1})}async submitToolOutputsAndPoll(e,t,r,n){let i=await this.submitToolOutputs(e,t,r,n);return await this.poll(e,i.id,n)}submitToolOutputsStream(e,t,r,n){return ce.createToolAssistantStream(e,t,this._client.beta.threads.runs,r,n)}},_r=class extends z{};Je.RunsPage=_r;Je.Steps=Nt;Je.RunStepsPage=vr;var De=class extends _{constructor(){super(...arguments),this.runs=new Je(this._client),this.messages=new Ot(this._client)}create(e={},t){return $(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/threads/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}createAndRun(e,t){var r;return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers},stream:(r=e.stream)!=null?r:!1})}async createAndRunPoll(e,t){let r=await this.createAndRun(e,t);return await this.runs.poll(r.thread_id,r.id,t)}createAndRunStream(e,t){return ce.createThreadAssistantStream(e,this._client.beta.threads,t)}};De.Runs=Je;De.RunsPage=_r;De.Messages=Ot;De.MessagesPage=wr;var Ia=async s=>{let e=await Promise.allSettled(s),t=e.filter(n=>n.status==="rejected");if(t.length){for(let n of t)console.error(n.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}let r=[];for(let n of e)n.status==="fulfilled"&&r.push(n.value);return r};var Ft=class extends _{create(e,t,r){return this._client.post(`/vector_stores/${e}/files`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/vector_stores/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e,t={},r){return $(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,ct,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,t,r){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){let n=await this.create(e,t,r);return await this.poll(e,n.id,r)}async poll(e,t,r){let n={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(n["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){let i=await this.retrieve(e,t,{...r,headers:n}).withResponse(),o=i.data;switch(o.status){case"in_progress":let a=5e3;if(r!=null&&r.pollIntervalMs)a=r.pollIntervalMs;else{let c=i.response.headers.get("openai-poll-after-ms");if(c){let l=parseInt(c);isNaN(l)||(a=l)}}await He(a);break;case"failed":case"completed":return o}}}async upload(e,t,r){let n=await this._client.files.create({file:t,purpose:"assistants"},r);return this.create(e,{file_id:n.id},r)}async uploadAndPoll(e,t,r){let n=await this.upload(e,t,r);return await this.poll(e,n.id,r)}},ct=class extends z{};Ft.VectorStoreFilesPage=ct;var Ar=class extends _{create(e,t,r){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}cancel(e,t,r){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){let n=await this.create(e,t);return await this.poll(e,n.id,r)}listFiles(e,t,r={},n){return $(r)?this.listFiles(e,t,{},r):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,ct,{query:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async poll(e,t,r){let n={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(n["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){let{data:i,response:o}=await this.retrieve(e,t,{...r,headers:n}).withResponse();switch(i.status){case"in_progress":let a=5e3;if(r!=null&&r.pollIntervalMs)a=r.pollIntervalMs;else{let c=o.headers.get("openai-poll-after-ms");if(c){let l=parseInt(c);isNaN(l)||(a=l)}}await He(a);break;case"failed":case"cancelled":case"completed":return i}}}async uploadAndPoll(e,{files:t,fileIds:r=[]},n){var m;if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let i=(m=n==null?void 0:n.maxConcurrency)!=null?m:5,o=Math.min(i,t.length),a=this._client,c=t.values(),l=[...r];async function d(f){for(let g of f){let y=await a.files.create({file:g,purpose:"assistants"},n);l.push(y.id)}}let h=Array(o).fill(c).map(d);return await Ia(h),await this.createAndPoll(e,{file_ids:l})}};var Le=class extends _{constructor(){super(...arguments),this.files=new Ft(this._client),this.fileBatches=new Ar(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/vector_stores/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e={},t){return $(e)?this.list({},e):this._client.getAPIList("/vector_stores",xr,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}},xr=class extends z{};Le.VectorStoresPage=xr;Le.Files=Ft;Le.VectorStoreFilesPage=ct;Le.FileBatches=Ar;var Ae=class extends _{constructor(){super(...arguments),this.vectorStores=new Le(this._client),this.chat=new yr(this._client),this.assistants=new Mt(this._client),this.threads=new De(this._client)}};Ae.VectorStores=Le;Ae.VectorStoresPage=xr;Ae.Assistants=Mt;Ae.AssistantsPage=ur;Ae.Threads=De;var Dt=class extends _{create(e,t){var r;return this._client.post("/completions",{body:e,...t,stream:(r=e.stream)!=null?r:!1})}};var Lt=class extends _{create(e,t){return this._client.post("/embeddings",{body:e,...t})}};var dt=class extends _{create(e,t){return this._client.post("/files",_e({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return $(e)?this.list({},e):this._client.getAPIList("/files",Bt,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/json",...t==null?void 0:t.headers}})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:r=30*60*1e3}={}){let n=new Set(["processed","error","deleted"]),i=Date.now(),o=await this.retrieve(e);for(;!o.status||!n.has(o.status);)if(await He(t),o=await this.retrieve(e),Date.now()-i>r)throw new st({message:`Giving up on waiting for file ${e} to finish processing after ${r} milliseconds.`});return o}},Bt=class extends z{};dt.FileObjectsPage=Bt;var Ut=class extends _{list(e,t={},r){return $(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,Pr,{query:t,...r})}},Pr=class extends z{};Ut.FineTuningJobCheckpointsPage=Pr;var Be=class extends _{constructor(){super(...arguments),this.checkpoints=new Ut(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return $(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",Ir,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},r){return $(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,Er,{query:t,...r})}},Ir=class extends z{},Er=class extends z{};Be.FineTuningJobsPage=Ir;Be.FineTuningJobEventsPage=Er;Be.Checkpoints=Ut;Be.FineTuningJobCheckpointsPage=Pr;var Ue=class extends _{constructor(){super(...arguments),this.jobs=new Be(this._client)}};Ue.Jobs=Be;Ue.FineTuningJobsPage=Ir;Ue.FineTuningJobEventsPage=Er;var $t=class extends _{createVariation(e,t){return this._client.post("/images/variations",_e({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",_e({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}};var ut=class extends _{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",qt,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}},qt=class extends sn{};ut.ModelsPage=qt;var jt=class extends _{create(e,t){return this._client.post("/moderations",{body:e,...t})}};var Sr=class extends _{create(e,t,r){return this._client.post(`/uploads/${e}/parts`,_e({body:t,...r}))}};var ht=class extends _{constructor(){super(...arguments),this.parts=new Sr(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,r){return this._client.post(`/uploads/${e}/complete`,{body:t,...r})}};ht.Parts=Sr;var Ea,M=class extends rn{constructor({baseURL:e=as("OPENAI_BASE_URL"),apiKey:t=as("OPENAI_API_KEY"),organization:r=(o=>(o=as("OPENAI_ORG_ID"))!=null?o:null)(),project:n=(a=>(a=as("OPENAI_PROJECT_ID"))!=null?a:null)(),...i}={}){var l;if(t===void 0)throw new E("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");let c={apiKey:t,organization:r,project:n,...i,baseURL:e||"https://api.openai.com/v1"};if(!c.dangerouslyAllowBrowser&&da())throw new E(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:c.baseURL,timeout:(l=c.timeout)!=null?l:6e5,httpAgent:c.httpAgent,maxRetries:c.maxRetries,fetch:c.fetch}),this.completions=new Dt(this),this.chat=new nt(this),this.embeddings=new Lt(this),this.files=new dt(this),this.images=new $t(this),this.audio=new Ne(this),this.moderations=new jt(this),this.models=new ut(this),this.fineTuning=new Ue(this),this.beta=new Ae(this),this.batches=new it(this),this.uploads=new ht(this),this._options=c,this.apiKey=t,this.organization=r,this.project=n}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return ai(e,{arrayFormat:"brackets"})}};Ea=M;M.OpenAI=Ea;M.DEFAULT_TIMEOUT=6e5;M.OpenAIError=E;M.APIError=J;M.APIConnectionError=rt;M.APIConnectionTimeoutError=st;M.APIUserAbortError=te;M.NotFoundError=es;M.ConflictError=ts;M.RateLimitError=ss;M.BadRequestError=Qr;M.AuthenticationError=Yr;M.InternalServerError=ns;M.PermissionDeniedError=Zr;M.UnprocessableEntityError=rs;M.toFile=yi;M.fileFromPath=Qs;M.Completions=Dt;M.Chat=nt;M.Embeddings=Lt;M.Files=dt;M.FileObjectsPage=Bt;M.Images=$t;M.Audio=Ne;M.Moderations=jt;M.Models=ut;M.ModelsPage=qt;M.FineTuning=Ue;M.Beta=Ae;M.Batches=it;M.BatchesPage=Ct;M.Uploads=ht;var Sa=M;var Ca=require("electron"),qi=require("obsidian");function bn(s){if(!s)return{};if(typeof Headers!="undefined"&&s instanceof Headers){let e={};return s.forEach((t,r)=>{e[r]=t}),e}if(Array.isArray(s)){let e={};for(let[t,r]of s)e[t]=r;return e}return{...s}}async function Ma(s,e={}){var i;let t=bn(e.headers);delete t["content-length"];let r={};this&&"controller"in this&&(r.controller=this.controller);let n=e.signal||((i=r.controller)==null?void 0:i.signal);return b.debug("electronFetch request:",{url:s,method:e.method||"GET",headers:t,hasBody:!!e.body,platform:qi.Platform.isMobileApp?"mobile":"desktop"}),qi.Platform.isMobileApp?(b.debug("Using native fetch (mobile platform)"),fetch(s,{...e,signal:n})):new Promise((o,a)=>{let c=()=>{l.removeAllListeners(),b.debug("Request cleanup completed")},l=Ca.remote.net.request({url:s,method:e.method||"GET"});if(Object.entries(t).forEach(([d,h])=>{l.setHeader(d,h)}),n!=null&&n.aborted){b.debug("Request aborted before start"),l.abort(),a(new Error("Aborted"));return}n==null||n.addEventListener("abort",()=>{b.debug("Request aborted by controller"),c(),l.abort(),a(new Error("Aborted"))}),l.on("response",d=>{if(n!=null&&n.aborted){b.debug("Request aborted during response");return}b.debug("Response received:",{status:d.statusCode,headers:d.headers});let{readable:h,writable:m}=new TransformStream({transform(y,p){p.enqueue(new Uint8Array(y))}}),f=m.getWriter(),g={status:d.statusCode||200,headers:d.headers};o(new Response(h,g)),d.on("data",async y=>{try{await f.ready,await f.write(y),b.debug("Chunk received:",{size:y.length,text:y.toString("utf-8")})}catch(p){b.error("Error writing chunk:",p),c(),f.abort(p)}}),d.on("end",async()=>{try{await f.ready,await f.close(),b.debug("Response stream completed")}catch(y){b.error("Error closing writer:",y)}finally{c()}}),d.on("error",y=>{b.error("Response error:",y),c(),f.abort(y),a(y)})}),l.on("error",d=>{b.error("Request error:",d),c(),a(d)}),e.body&&l.write(e.body),l.end(),b.debug("Request sent")})}var Ra=require("obsidian");var xe=async(s,e={})=>{let t=bn(e.headers);delete t["content-length"],b.debug("obsidianFetch request:",{url:s,method:e.method||"GET",headers:t,hasBody:!!e.body});let r={url:s,method:e.method||"GET",headers:t};e.body&&(r.body=e.body,b.debug("Request body prepared:",r.body));try{b.debug("Sending request via requestUrl");let n=await(0,Ra.requestUrl)(r);b.debug("Response received:",{status:n.status,headers:n.headers,contentLength:n.text.length});let i={status:n.status,headers:n.headers};return new Response(n.text,i)}catch(n){throw b.error("Request failed:",n,{headers:t}),n}};var ka=require("obsidian");var Ed=["cors policy","cors error","blocked by cors","cross-origin","access-control-allow-origin","access-control-allow-methods","access-control-allow-headers","preflight request","connection error","network error","failed to fetch","typeerror: failed to fetch","net::err_failed","fetch error","cors"],ft=class{constructor(e){this.settings=e;this.corsBlockedProviders=new Set}getProviderKey(e){return`${e.url||"unknown"}:${e.type}`}isMobilePlatform(){return ka.Platform.isMobileApp}shouldUseNativeFetch(){var e;return(e=this.settings.useNativeFetch)!=null?e:!1}getFetch(e){let t=e.name;return this.isBlocked(e)?(b.debug("Using obsidianFetch for CORS-blocked provider (API):",t),xe):this.isMobilePlatform()?(b.debug("Using obsidianFetch for mobile platform (API):",t),xe):this.shouldUseNativeFetch()?(b.debug("Using native fetch for provider (API):",t),globalThis.fetch):(b.debug("Using obsidianFetch for provider (API):",t),xe)}getStreamingFetch(e){let t=e.name;return this.isBlocked(e)?(b.debug("Using obsidianFetch for CORS-blocked provider (streaming):",t),xe):this.isMobilePlatform()?(b.debug("Using obsidianFetch for mobile platform (streaming):",t),xe):this.shouldUseNativeFetch()?(b.debug("Using native fetch for provider (streaming):",t),globalThis.fetch):(b.debug("Using electronFetch for provider (streaming):",t),Ma)}isCorsError(e){if(!e)return!1;let t=(e.message||"").toLowerCase(),r=(e.name||"").toLowerCase();b.debug("Checking CORS error:",{message:e.message,name:e.name});let n=this.matchesCorsPattern(t,r);return b.debug("CORS error detection result:",{isCors:n}),n}matchesCorsPattern(e,t){return Ed.some(r=>e.includes(r)||t.includes(r))}async execute(e,t){if(b.debug("Starting execute operation for provider:",e.name),this.isBlocked(e))return b.debug("Provider already CORS-blocked, using obsidianFetch directly"),t(xe);let r=this.getStreamingFetch(e);try{let n=await t(r);return b.debug("Execute operation completed successfully"),n}catch(n){if(this.isCorsError(n))return b.debug("CORS error detected in execute, retrying with obsidianFetch"),this.markBlocked(e),t(xe);throw n}}async request(e,t){if(b.debug("Starting request operation for provider:",e.name),this.isBlocked(e))return b.debug("Provider already CORS-blocked, using obsidianFetch directly"),t(xe);let r=this.getFetch(e);try{let n=await t(r);return b.debug("Request operation completed successfully"),n}catch(n){if(this.isCorsError(n))return b.debug("CORS error detected in request, retrying with obsidianFetch"),this.markBlocked(e),t(xe);throw n}}getBlockedProviderCount(){return this.corsBlockedProviders.size}isBlocked(e){let t=this.getProviderKey(e);return this.corsBlockedProviders.has(t)}markBlocked(e){let t=this.getProviderKey(e);this.corsBlockedProviders.add(t),b.debug("Provider marked as CORS blocked:",{key:t,provider:e.name})}clear(){this.corsBlockedProviders.clear(),b.debug("All CORS blocked providers cleared")}};var G=class{constructor(e){this.settings=e;this.fetchSelector=new ft(e)}ensureNotAborted(e){if(e!=null&&e.signal.aborted)throw new Error("Aborted")}buildContentParts(e){return e.map(t=>t.type==="text"?{type:"text",text:t.text}:{type:"image_url",image_url:{url:t.image_url.url}})}mapMessageToOpenAIMessage(e){return typeof e.content=="string"?{role:e.role==="assistant"||e.role==="system"?e.role:"user",content:e.content}:{role:"user",content:this.buildContentParts(e.content)}}buildPromptContentParts(e,t){let r=[{type:"text",text:e}];return t==null||t.forEach(n=>{r.push({type:"image_url",image_url:{url:n}})}),r}buildOpenAIMessages(e){var t;if("messages"in e&&e.messages)return e.messages.map(r=>this.mapMessageToOpenAIMessage(r));if("prompt"in e){let r=[];e.systemPrompt&&r.push({role:"system",content:e.systemPrompt});let n=(t=e.images)!=null&&t.length?this.buildPromptContentParts(e.prompt,e.images):e.prompt;return r.push({role:"user",content:n}),r}throw new Error("Either messages or prompt must be provided")}async streamChatResponse(e,t,r){var o;let n="",i=!1;for await(let a of e){this.ensureNotAborted(t);let c=(o=a.choices[0])==null?void 0:o.delta,l=this.buildStreamingAppend(c,i);i=l.isInThinkBlock,l.appendText.length>0&&(n+=l.appendText,r==null||r(l.appendText,n))}return i&&(n+="</think>",r==null||r("</think>",n)),n}buildStreamingAppend(e,t){let r="",n="";typeof(e==null?void 0:e.content)=="string"&&(r=e.content),typeof(e==null?void 0:e.reasoning)=="string"&&(n=e.reasoning);let i="";return n!==""&&(t||(i+="<think>",t=!0),i+=n),r!==""&&(t&&(i+="</think>",t=!1),i+=r),{appendText:i,isInThinkBlock:t}}getClient(e,t){return new Sa({baseURL:e.url||(e.type==="openai"?void 0:"http://localhost:1234/v1"),apiKey:e.apiKey||"placeholder-key",dangerouslyAllowBrowser:!0,fetch:t,defaultHeaders:{"x-stainless-arch":null,"x-stainless-lang":null,"x-stainless-os":null,"x-stainless-package-version":null,"x-stainless-retry-count":null,"x-stainless-runtime":null,"x-stainless-runtime-version":null,"x-stainless-timeout":null}})}async fetchModels({provider:e,abortController:t}){this.ensureNotAborted(t);let r=await this.fetchSelector.request(e,async n=>(this.ensureNotAborted(t),(await this.getClient(e,n).models.list()).data.map(a=>a.id)));return this.ensureNotAborted(t),r}async embed(e){var d,h;let t=e,r=(d=e.input)!=null?d:t.text;if(!r)throw new Error("Either input or text parameter must be provided");let n=e.abortController;if(n!=null&&n.signal.aborted)throw new Error("Aborted");let i=Array.isArray(r)?r:[r],o=[],a=2048,c=[];for(let m=0;m<i.length;m+=a)c.push(i.slice(m,m+a));let l=[];for(let m of c){this.ensureNotAborted(n);let f=async y=>{let C=await this.getClient(e.provider,y).embeddings.create({model:e.provider.model||"",input:m},{signal:n==null?void 0:n.signal});return b.debug("Embed response:",C),C.data.map(v=>v.embedding)},g=await this.fetchSelector.request(e.provider,f);o.push(...g),l.push(...m),(h=e.onProgress)==null||h.call(e,[...l]),this.ensureNotAborted(n)}return o}async executeOpenAIGeneration({params:e,openai:t,onProgress:r,abortController:n}){let i=this.buildOpenAIMessages(e);b.debug("Sending chat request to OpenAI");let o=await t.chat.completions.create({model:e.provider.model||"",messages:i,stream:!0,...e.options},{signal:n==null?void 0:n.signal});return this.streamChatResponse(o,n,r)}async execute(e){var n,i,o,a;b.debug("Starting execute process with params:",{model:e.provider.model,messagesCount:((n=e.messages)==null?void 0:n.length)||0,promptLength:((i=e.prompt)==null?void 0:i.length)||0,systemPromptLength:((o=e.systemPrompt)==null?void 0:o.length)||0,hasImages:!!((a=e.images)!=null&&a.length)});let{abortController:t,onProgress:r}=e;this.ensureNotAborted(t);try{return await this.fetchSelector.execute(e.provider,async c=>{let l=this.getClient(e.provider,c);return this.executeOpenAIGeneration({params:e,openai:l,onProgress:(d,h)=>{r==null||r(d,h),this.ensureNotAborted(t)},abortController:t})})}catch(c){let l=c;if(l.message==="Aborted")return Promise.reject(l);throw l}}};var ie=typeof globalThis!="undefined"&&globalThis||typeof self!="undefined"&&self||typeof global!="undefined"&&global||{},de={searchParams:"URLSearchParams"in ie,iterable:"Symbol"in ie&&"iterator"in Symbol,blob:"FileReader"in ie&&"Blob"in ie&&function(){try{return new Blob,!0}catch(s){return!1}}(),formData:"FormData"in ie,arrayBuffer:"ArrayBuffer"in ie};function Sd(s){return s&&DataView.prototype.isPrototypeOf(s)}de.arrayBuffer&&(Ta=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],Na=ArrayBuffer.isView||function(s){return s&&Ta.indexOf(Object.prototype.toString.call(s))>-1});var Ta,Na;function Cr(s){if(typeof s!="string"&&(s=String(s)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(s)||s==="")throw new TypeError('Invalid character in header field name: "'+s+'"');return s.toLowerCase()}function Hi(s){return typeof s!="string"&&(s=String(s)),s}function zi(s){var e={next:function(){var t=s.shift();return{done:t===void 0,value:t}}};return de.iterable&&(e[Symbol.iterator]=function(){return e}),e}function Z(s){this.map={},s instanceof Z?s.forEach(function(e,t){this.append(t,e)},this):Array.isArray(s)?s.forEach(function(e){if(e.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+e.length);this.append(e[0],e[1])},this):s&&Object.getOwnPropertyNames(s).forEach(function(e){this.append(e,s[e])},this)}Z.prototype.append=function(s,e){s=Cr(s),e=Hi(e);var t=this.map[s];this.map[s]=t?t+", "+e:e};Z.prototype.delete=function(s){delete this.map[Cr(s)]};Z.prototype.get=function(s){return s=Cr(s),this.has(s)?this.map[s]:null};Z.prototype.has=function(s){return this.map.hasOwnProperty(Cr(s))};Z.prototype.set=function(s,e){this.map[Cr(s)]=Hi(e)};Z.prototype.forEach=function(s,e){for(var t in this.map)this.map.hasOwnProperty(t)&&s.call(e,this.map[t],t,this)};Z.prototype.keys=function(){var s=[];return this.forEach(function(e,t){s.push(t)}),zi(s)};Z.prototype.values=function(){var s=[];return this.forEach(function(e){s.push(e)}),zi(s)};Z.prototype.entries=function(){var s=[];return this.forEach(function(e,t){s.push([t,e])}),zi(s)};de.iterable&&(Z.prototype[Symbol.iterator]=Z.prototype.entries);function ji(s){if(!s._noBody){if(s.bodyUsed)return Promise.reject(new TypeError("Already read"));s.bodyUsed=!0}}function Fa(s){return new Promise(function(e,t){s.onload=function(){e(s.result)},s.onerror=function(){t(s.error)}})}function Cd(s){var e=new FileReader,t=Fa(e);return e.readAsArrayBuffer(s),t}function Md(s){var e=new FileReader,t=Fa(e),r=/charset=([A-Za-z0-9_-]+)/.exec(s.type),n=r?r[1]:"utf-8";return e.readAsText(s,n),t}function Rd(s){for(var e=new Uint8Array(s),t=new Array(e.length),r=0;r<e.length;r++)t[r]=String.fromCharCode(e[r]);return t.join("")}function Oa(s){if(s.slice)return s.slice(0);var e=new Uint8Array(s.byteLength);return e.set(new Uint8Array(s)),e.buffer}function Da(){return this.bodyUsed=!1,this._initBody=function(s){this.bodyUsed=this.bodyUsed,this._bodyInit=s,s?typeof s=="string"?this._bodyText=s:de.blob&&Blob.prototype.isPrototypeOf(s)?this._bodyBlob=s:de.formData&&FormData.prototype.isPrototypeOf(s)?this._bodyFormData=s:de.searchParams&&URLSearchParams.prototype.isPrototypeOf(s)?this._bodyText=s.toString():de.arrayBuffer&&de.blob&&Sd(s)?(this._bodyArrayBuffer=Oa(s.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):de.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(s)||Na(s))?this._bodyArrayBuffer=Oa(s):this._bodyText=s=Object.prototype.toString.call(s):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof s=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):de.searchParams&&URLSearchParams.prototype.isPrototypeOf(s)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},de.blob&&(this.blob=function(){var s=ji(this);if(s)return s;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var s=ji(this);return s||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(de.blob)return this.blob().then(Cd);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var s=ji(this);if(s)return s;if(this._bodyBlob)return Md(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(Rd(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},de.formData&&(this.formData=function(){return this.text().then(Od)}),this.json=function(){return this.text().then(JSON.parse)},this}var kd=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function Td(s){var e=s.toUpperCase();return kd.indexOf(e)>-1?e:s}function zt(s,e){if(!(this instanceof zt))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');e=e||{};var t=e.body;if(s instanceof zt){if(s.bodyUsed)throw new TypeError("Already read");this.url=s.url,this.credentials=s.credentials,e.headers||(this.headers=new Z(s.headers)),this.method=s.method,this.mode=s.mode,this.signal=s.signal,!t&&s._bodyInit!=null&&(t=s._bodyInit,s.bodyUsed=!0)}else this.url=String(s);if(this.credentials=e.credentials||this.credentials||"same-origin",(e.headers||!this.headers)&&(this.headers=new Z(e.headers)),this.method=Td(e.method||this.method||"GET"),this.mode=e.mode||this.mode||null,this.signal=e.signal||this.signal||function(){if("AbortController"in ie){var i=new AbortController;return i.signal}}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&t)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(t),(this.method==="GET"||this.method==="HEAD")&&(e.cache==="no-store"||e.cache==="no-cache")){var r=/([?&])_=[^&]*/;if(r.test(this.url))this.url=this.url.replace(r,"$1_="+new Date().getTime());else{var n=/\?/;this.url+=(n.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}zt.prototype.clone=function(){return new zt(this,{body:this._bodyInit})};function Od(s){var e=new FormData;return s.trim().split("&").forEach(function(t){if(t){var r=t.split("="),n=r.shift().replace(/\+/g," "),i=r.join("=").replace(/\+/g," ");e.append(decodeURIComponent(n),decodeURIComponent(i))}}),e}function Nd(s){var e=new Z,t=s.replace(/\r?\n[\t ]+/g," ");return t.split("\r").map(function(r){return r.indexOf(`
`)===0?r.substr(1,r.length):r}).forEach(function(r){var n=r.split(":"),i=n.shift().trim();if(i){var o=n.join(":").trim();try{e.append(i,o)}catch(a){console.warn("Response "+a.message)}}}),e}Da.call(zt.prototype);function $e(s,e){if(!(this instanceof $e))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(e||(e={}),this.type="default",this.status=e.status===void 0?200:e.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=e.statusText===void 0?"":""+e.statusText,this.headers=new Z(e.headers),this.url=e.url||"",this._initBody(s)}Da.call($e.prototype);$e.prototype.clone=function(){return new $e(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new Z(this.headers),url:this.url})};$e.error=function(){var s=new $e(null,{status:200,statusText:""});return s.ok=!1,s.status=0,s.type="error",s};var Fd=[301,302,303,307,308];$e.redirect=function(s,e){if(Fd.indexOf(e)===-1)throw new RangeError("Invalid status code");return new $e(null,{status:e,headers:{location:s}})};var Ht=ie.DOMException;try{new Ht}catch(s){Ht=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack},Ht.prototype=Object.create(Error.prototype),Ht.prototype.constructor=Ht}function La(s,e){return new Promise(function(t,r){var n=new zt(s,e);if(n.signal&&n.signal.aborted)return r(new Ht("Aborted","AbortError"));var i=new XMLHttpRequest;function o(){i.abort()}i.onload=function(){var l={statusText:i.statusText,headers:Nd(i.getAllResponseHeaders()||"")};n.url.indexOf("file://")===0&&(i.status<200||i.status>599)?l.status=200:l.status=i.status,l.url="responseURL"in i?i.responseURL:l.headers.get("X-Request-URL");var d="response"in i?i.response:i.responseText;setTimeout(function(){t(new $e(d,l))},0)},i.onerror=function(){setTimeout(function(){r(new TypeError("Network request failed"))},0)},i.ontimeout=function(){setTimeout(function(){r(new TypeError("Network request timed out"))},0)},i.onabort=function(){setTimeout(function(){r(new Ht("Aborted","AbortError"))},0)};function a(l){try{return l===""&&ie.location.href?ie.location.href:l}catch(d){return l}}if(i.open(n.method,a(n.url),!0),n.credentials==="include"?i.withCredentials=!0:n.credentials==="omit"&&(i.withCredentials=!1),"responseType"in i&&(de.blob?i.responseType="blob":de.arrayBuffer&&(i.responseType="arraybuffer")),e&&typeof e.headers=="object"&&!(e.headers instanceof Z||ie.Headers&&e.headers instanceof ie.Headers)){var c=[];Object.getOwnPropertyNames(e.headers).forEach(function(l){c.push(Cr(l)),i.setRequestHeader(l,Hi(e.headers[l]))}),n.headers.forEach(function(l,d){c.indexOf(d)===-1&&i.setRequestHeader(d,l)})}else n.headers.forEach(function(l,d){i.setRequestHeader(d,l)});n.signal&&(n.signal.addEventListener("abort",o),i.onreadystatechange=function(){i.readyState===4&&n.signal.removeEventListener("abort",o)}),i.send(typeof n._bodyInit=="undefined"?null:n._bodyInit)})}La.polyfill=!0;ie.fetch||(ie.fetch=La,ie.Headers=Z,ie.Request=zt,ie.Response=$e);var Dd="0.5.10",Ld=Object.defineProperty,Bd=(s,e,t)=>e in s?Ld(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Wi=(s,e,t)=>(Bd(s,typeof e!="symbol"?e+"":e,t),t),bs=class extends Error{constructor(e,t){super(e),this.error=e,this.status_code=t,this.name="ResponseError",Error.captureStackTrace&&Error.captureStackTrace(this,bs)}},Ki=class{constructor(e,t,r){Wi(this,"abortController"),Wi(this,"itr"),Wi(this,"doneCallback"),this.abortController=e,this.itr=t,this.doneCallback=r}abort(){this.abortController.abort()}async*[Symbol.asyncIterator](){for await(let e of this.itr){if("error"in e)throw new Error(e.error);if(yield e,e.done||e.status==="success"){this.doneCallback();return}}throw new Error("Did not receive done or success response in stream.")}},wn=async s=>{var r;if(s.ok)return;let e=`Error ${s.status}: ${s.statusText}`,t=null;if((r=s.headers.get("content-type"))!=null&&r.includes("application/json"))try{t=await s.json(),e=t.error||e}catch(n){console.log("Failed to parse error response as JSON")}else try{console.log("Getting text from response"),e=await s.text()||e}catch(n){console.log("Failed to get text from error response")}throw new bs(e,s.status)};function Ud(){return typeof window!="undefined"&&window.navigator?`${window.navigator.platform.toLowerCase()} Browser/${navigator.userAgent};`:typeof process!="undefined"?`${process.arch} ${process.platform} Node.js/${process.version}`:""}var vn=async(s,e,t={})=>{let r={"Content-Type":"application/json",Accept:"application/json","User-Agent":`ollama-js/${Dd} (${Ud()})`};t.headers||(t.headers={});let n=Object.fromEntries(Object.entries(t.headers).filter(([i])=>!Object.keys(r).some(o=>o.toLowerCase()===i.toLowerCase())));return t.headers={...r,...n},s(e,t)},Ba=async(s,e,t)=>{let r=await vn(s,e,{headers:t==null?void 0:t.headers});return await wn(r),r},Ua=async(s,e)=>{let t=await vn(s,e,{method:"HEAD"});return await wn(t),t},mt=async(s,e,t,r)=>{let i=(a=>a!==null&&typeof a=="object"&&!Array.isArray(a))(t)?JSON.stringify(t):t,o=await vn(s,e,{method:"POST",body:i,signal:r==null?void 0:r.signal,headers:r==null?void 0:r.headers});return await wn(o),o},$d=async(s,e,t,r)=>{let n=await vn(s,e,{method:"DELETE",body:JSON.stringify(t),headers:r==null?void 0:r.headers});return await wn(n),n},qd=async function*(s){var n;let e=new TextDecoder("utf-8"),t="",r=s.getReader();for(;;){let{done:i,value:o}=await r.read();if(i)break;t+=e.decode(o);let a=t.split(`
`);t=(n=a.pop())!=null?n:"";for(let c of a)try{yield JSON.parse(c)}catch(l){console.warn("invalid json: ",c)}}for(let i of t.split(`
`).filter(o=>o!==""))try{yield JSON.parse(i)}catch(o){console.warn("invalid json: ",i)}},jd=s=>{if(!s)return"http://127.0.0.1:11434";let e=s.includes("://");s.startsWith(":")&&(s=`http://127.0.0.1${s}`,e=!0),e||(s=`http://${s}`);let t=new URL(s),r=t.port;r||(e?r=t.protocol==="https:"?"443":"80":r="11434");let n=`${t.protocol}//${t.hostname}:${r}${t.pathname}`;return n.endsWith("/")&&(n=n.slice(0,-1)),n},Hd=Object.defineProperty,zd=(s,e,t)=>e in s?Hd(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Vi=(s,e,t)=>(zd(s,typeof e!="symbol"?e+"":e,t),t),Ji=class{constructor(e){var t,r;Vi(this,"config"),Vi(this,"fetch"),Vi(this,"ongoingStreamedRequests",[]),this.config={host:"",headers:e==null?void 0:e.headers},e!=null&&e.proxy||(this.config.host=jd((t=e==null?void 0:e.host)!=null?t:"http://127.0.0.1:11434")),this.fetch=(r=e==null?void 0:e.fetch)!=null?r:fetch}abort(){for(let e of this.ongoingStreamedRequests)e.abort();this.ongoingStreamedRequests.length=0}async processStreamableRequest(e,t){var i;t.stream=(i=t.stream)!=null?i:!1;let r=`${this.config.host}/api/${e}`;if(t.stream){let o=new AbortController,a=await mt(this.fetch,r,t,{signal:o.signal,headers:this.config.headers});if(!a.body)throw new Error("Missing body");let c=qd(a.body),l=new Ki(o,c,()=>{let d=this.ongoingStreamedRequests.indexOf(l);d>-1&&this.ongoingStreamedRequests.splice(d,1)});return this.ongoingStreamedRequests.push(l),l}return await(await mt(this.fetch,r,t,{headers:this.config.headers})).json()}async encodeImage(e){if(typeof e!="string"){let t=new Uint8Array(e),r="",n=t.byteLength;for(let i=0;i<n;i++)r+=String.fromCharCode(t[i]);return btoa(r)}return e}async generate(e){return e.images&&(e.images=await Promise.all(e.images.map(this.encodeImage.bind(this)))),this.processStreamableRequest("generate",e)}async chat(e){if(e.messages)for(let t of e.messages)t.images&&(t.images=await Promise.all(t.images.map(this.encodeImage.bind(this))));return this.processStreamableRequest("chat",e)}async create(e){return this.processStreamableRequest("create",{name:e.model,stream:e.stream,modelfile:e.modelfile,quantize:e.quantize})}async pull(e){return this.processStreamableRequest("pull",{name:e.model,stream:e.stream,insecure:e.insecure})}async push(e){return this.processStreamableRequest("push",{name:e.model,stream:e.stream,insecure:e.insecure})}async delete(e){return await $d(this.fetch,`${this.config.host}/api/delete`,{name:e.model},{headers:this.config.headers}),{status:"success"}}async copy(e){return await mt(this.fetch,`${this.config.host}/api/copy`,{...e},{headers:this.config.headers}),{status:"success"}}async list(){return await(await Ba(this.fetch,`${this.config.host}/api/tags`,{headers:this.config.headers})).json()}async show(e){return await(await mt(this.fetch,`${this.config.host}/api/show`,{...e},{headers:this.config.headers})).json()}async embed(e){return await(await mt(this.fetch,`${this.config.host}/api/embed`,{...e},{headers:this.config.headers})).json()}async embeddings(e){return await(await mt(this.fetch,`${this.config.host}/api/embeddings`,{...e},{headers:this.config.headers})).json()}async ps(){return await(await Ba(this.fetch,`${this.config.host}/api/ps`,{headers:this.config.headers})).json()}},Cg=new Ji;var pt=cc(require("fs"),1),Wt=require("path"),$a=require("crypto"),qa=require("os");var ws=class extends Ji{async encodeImage(e){if(typeof e!="string")return Buffer.from(e).toString("base64");try{if(pt.default.existsSync(e)){let t=await pt.promises.readFile((0,Wt.resolve)(e));return Buffer.from(t).toString("base64")}}catch(t){}return e}async parseModelfile(e,t=process.cwd()){let r=[],n=e.split(`
`);for(let i of n){let[o,a]=i.split(" ",2);if(["FROM","ADAPTER"].includes(o.toUpperCase())){let c=this.resolvePath(a.trim(),t);await this.fileExists(c)?r.push(`${o} @${await this.createBlob(c)}`):r.push(`${o} ${a}`)}else r.push(i)}return r.join(`
`)}resolvePath(e,t){return e.startsWith("~")?(0,Wt.join)((0,qa.homedir)(),e.slice(1)):(0,Wt.resolve)(t,e)}async fileExists(e){try{return await pt.promises.access(e),!0}catch(t){return!1}}async createBlob(e){if(typeof ReadableStream=="undefined")throw new Error("Streaming uploads are not supported in this environment.");let t=(0,pt.createReadStream)(e),n=`sha256:${await new Promise((i,o)=>{let a=(0,$a.createHash)("sha256");t.on("data",c=>a.update(c)),t.on("end",()=>i(a.digest("hex"))),t.on("error",o)})}`;try{await Ua(this.fetch,`${this.config.host}/api/blobs/${n}`)}catch(i){if(i instanceof Error&&i.message.includes("404")){let o=new ReadableStream({start(a){t.on("data",c=>{a.enqueue(c)}),t.on("end",()=>{a.close()}),t.on("error",c=>{a.error(c)})}});await mt(this.fetch,`${this.config.host}/api/blobs/${n}`,o)}else throw i}return n}async create(e){let t="";if(e.path)t=await pt.promises.readFile(e.path,{encoding:"utf8"}),t=await this.parseModelfile(t,(0,Wt.dirname)(e.path));else if(e.modelfile)t=await this.parseModelfile(e.modelfile);else throw new Error("Must provide either path or modelfile to create a model");return e.modelfile=t,e.stream?super.create(e):super.create(e)}},Tg=new ws;var Wd=2.5,ja=2048,Vd=2048,Kd=1.2,vs=class{constructor(e){this.settings=e;this.modelInfoCache=new Map,this.fetchSelector=new ft(e)}ensureNotAborted(e){if(e!=null&&e.signal.aborted)throw new Error("Aborted")}getClient(e,t){let r={host:e.url,fetch:t};return e.apiKey&&(r.headers=r.headers||{},r.headers.Authorization=`Bearer ${e.apiKey}`),new ws(r)}getDefaultModelInfo(){return{contextLength:0,lastContextLength:ja}}async getCachedModelInfo(e,t){let r=`${e.url}_${t}`,n=this.modelInfoCache.get(r);if(n)return n;let i=this.getClient(e,this.settings.useNativeFetch?fetch:xe);try{let o=e.type==="ollama-openwebui"?{name:t}:{model:t},a=await i.show(o),c=this.getDefaultModelInfo(),l=Object.entries(a.model_info).find(([d,h])=>(d.endsWith(".context_length")||d==="num_ctx")&&typeof h=="number"&&h>0);return l&&typeof l[1]=="number"&&(c.contextLength=l[1]),this.modelInfoCache.set(r,c),c}catch(o){return b.error("Failed to fetch model info:",o),this.getDefaultModelInfo()}}setModelInfoLastContextLength(e,t,r){let n=`${e.url}_${t}`,i=this.modelInfoCache.get(n);i&&this.modelInfoCache.set(n,{...i,lastContextLength:r||i.lastContextLength})}async fetchModels({provider:e,abortController:t}){this.ensureNotAborted(t);let r=async i=>{this.ensureNotAborted(t);let o=this.getClient(e,i);return t==null||t.signal.addEventListener("abort",()=>{o.abort()}),(await o.list()).models.map(c=>c.name)},n=await this.fetchSelector.request(e,r);return this.ensureNotAborted(t),n}optimizeContext({inputLength:e,lastContextLength:t,defaultContextLength:r,limit:n}){let i=Math.ceil(e/Wd);if(i<=t)return{num_ctx:t>r?t:void 0,shouldUpdate:!1};let o=Math.min(Math.ceil(Math.max(i,r)*Kd),n),a=o>t;return{num_ctx:o,shouldUpdate:a}}applyContextOptimization({provider:e,modelName:t,inputLength:r,modelInfo:n,defaultContextLength:i}){let{num_ctx:o,shouldUpdate:a}=this.optimizeContext({inputLength:r,lastContextLength:n.lastContextLength||i,defaultContextLength:i,limit:n.contextLength||i});return a&&this.setModelInfoLastContextLength(e,t,o),o}normalizeImages(e){return e.map(t=>t.replace(/^data:image\/(.*?);base64,/,""))}applyImagesToChatMessages(e,t){if(t.length===0)return;let r=e.map(i=>i.role).lastIndexOf("user"),n=r!==-1?r:e.length-1;if(n>=0){e[n]={...e[n],images:t};return}e.push({role:"user",content:"",images:t})}async streamOllamaResponse({response:e,provider:t,modelName:r,onProgress:n,abortController:i}){var a,c;let o="";for await(let l of e){this.ensureNotAborted(i);let d=(a=l.message)==null?void 0:a.content;d&&(o+=d,n==null||n(d,o)),l.done&&typeof l.total_duration=="number"&&l.total_duration>0&&this.setModelInfoLastContextLength(t,r,(c=l.context)==null?void 0:c.length)}return o}prepareChatMessages(e){var n;let t=[],r=[];if("messages"in e&&e.messages)e.messages.forEach(i=>{var o;if(typeof i.content=="string")t.push({role:i.role,content:i.content});else{let a=i.content.filter(c=>c.type==="text").map(c=>c.text).join(`
`);i.content.filter(c=>c.type==="image_url").forEach(c=>{var l;(l=c.image_url)!=null&&l.url&&r.push(c.image_url.url)}),t.push({role:i.role,content:a})}(o=i.images)!=null&&o.length&&r.push(...i.images)});else if("prompt"in e)e.systemPrompt&&t.push({role:"system",content:e.systemPrompt}),t.push({role:"user",content:e.prompt}),(n=e.images)!=null&&n.length&&r.push(...e.images);else throw new Error("Either messages or prompt must be provided");return{chatMessages:t,extractedImages:r}}async executeOllamaGeneration({params:e,ollama:t,onProgress:r,abortController:n}){let i=e.provider.model||"",a=await this.getCachedModelInfo(e.provider,i).catch(f=>(b.error("Failed to get model info:",f),null))||this.getDefaultModelInfo(),{chatMessages:c,extractedImages:l}=this.prepareChatMessages(e),d=this.normalizeImages(l),h=e.options?{...e.options}:{};if(d.length===0){let f=c.reduce((y,p)=>y+p.content.length,0),g=this.applyContextOptimization({provider:e.provider,modelName:i,inputLength:f,modelInfo:a,defaultContextLength:ja});g&&(h.num_ctx=g)}this.applyImagesToChatMessages(c,d),b.debug("Sending chat request to Ollama");let m=await t.chat({model:i,messages:c,stream:!0,options:h});return this.streamOllamaResponse({response:m,provider:e.provider,modelName:i,onProgress:r,abortController:n})}async embed(e){var d;let t=e,r=(d=e.input)!=null?d:t.text;if(!r)throw new Error("Either input or text parameter must be provided");let n=e.abortController;this.ensureNotAborted(n);let i=e.provider.model||"",o=await this.getCachedModelInfo(e.provider,i),a=Array.isArray(r)?Math.max(...r.map(h=>h.length)):r.length,c=this.applyContextOptimization({provider:e.provider,modelName:i,inputLength:a,modelInfo:o,defaultContextLength:Vd}),l=async h=>{var p;let m=this.getClient(e.provider,h);if(n==null||n.signal.addEventListener("abort",()=>{m.abort()}),n!=null&&n.signal.aborted)throw m.abort(),new Error("Aborted");let f=Array.isArray(r)?r:[r],g=[],y=[];for(let C of f){this.ensureNotAborted(n);let v=await m.embed({model:i,input:C,options:{num_ctx:c}});g.push(v.embeddings[0]),b.debug("Embed response:",v),y.push(C),(p=e.onProgress)==null||p.call(e,[...y]),this.ensureNotAborted(n)}return g};return this.fetchSelector.request(e.provider,l)}async execute(e){let{abortController:t,onProgress:r}=e;this.ensureNotAborted(t);try{return await this.fetchSelector.execute(e.provider,async n=>{let i=this.getClient(e.provider,n);return t==null||t.signal.addEventListener("abort",()=>{i.abort()}),this.ensureNotAborted(t),this.executeOllamaGeneration({params:e,ollama:i,onProgress:(o,a)=>{r==null||r(o,a),this.ensureNotAborted(t)},abortController:t})})}catch(n){let i=n;if(i.message==="Aborted")return Promise.reject(i);throw i}}};var Qi=(s,e)=>e.some(t=>s instanceof t),Ha,za;function Jd(){return Ha||(Ha=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Xd(){return za||(za=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var Yi=new WeakMap,Xi=new WeakMap,_n=new WeakMap;function Gd(s){let e=new Promise((t,r)=>{let n=()=>{s.removeEventListener("success",i),s.removeEventListener("error",o)},i=()=>{t(Vt(s.result)),n()},o=()=>{r(s.error),n()};s.addEventListener("success",i),s.addEventListener("error",o)});return _n.set(e,s),e}function Qd(s){if(Yi.has(s))return;let e=new Promise((t,r)=>{let n=()=>{s.removeEventListener("complete",i),s.removeEventListener("error",o),s.removeEventListener("abort",o)},i=()=>{t(),n()},o=()=>{r(s.error||new DOMException("AbortError","AbortError")),n()};s.addEventListener("complete",i),s.addEventListener("error",o),s.addEventListener("abort",o)});Yi.set(s,e)}var Zi={get(s,e,t){if(s instanceof IDBTransaction){if(e==="done")return Yi.get(s);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Vt(s[e])},set(s,e,t){return s[e]=t,!0},has(s,e){return s instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in s}};function Ja(s){Zi=s(Zi)}function Yd(s){return Xd().includes(s)?function(...e){return s.apply(eo(this),e),Vt(this.request)}:function(...e){return Vt(s.apply(eo(this),e))}}function Zd(s){return typeof s=="function"?Yd(s):(s instanceof IDBTransaction&&Qd(s),Qi(s,Jd())?new Proxy(s,Zi):s)}function Vt(s){if(s instanceof IDBRequest)return Gd(s);if(Xi.has(s))return Xi.get(s);let e=Zd(s);return e!==s&&(Xi.set(s,e),_n.set(e,s)),e}var eo=s=>_n.get(s);function Xa(s,e,{blocked:t,upgrade:r,blocking:n,terminated:i}={}){let o=indexedDB.open(s,e),a=Vt(o);return r&&o.addEventListener("upgradeneeded",c=>{r(Vt(o.result),c.oldVersion,c.newVersion,Vt(o.transaction),c)}),t&&o.addEventListener("blocked",c=>t(c.oldVersion,c.newVersion,c)),a.then(c=>{i&&c.addEventListener("close",()=>i()),n&&c.addEventListener("versionchange",l=>n(l.oldVersion,l.newVersion,l))}).catch(()=>{}),a}var eu=["get","getKey","getAll","getAllKeys","count"],tu=["put","add","delete","clear"],Gi=new Map;function Wa(s,e){if(!(s instanceof IDBDatabase&&!(e in s)&&typeof e=="string"))return;if(Gi.get(e))return Gi.get(e);let t=e.replace(/FromIndex$/,""),r=e!==t,n=tu.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(n||eu.includes(t)))return;let i=async function(o,...a){let c=this.transaction(o,n?"readwrite":"readonly"),l=c.store;return r&&(l=l.index(a.shift())),(await Promise.all([l[t](...a),n&&c.done]))[0]};return Gi.set(e,i),i}Ja(s=>({...s,get:(e,t,r)=>Wa(e,t)||s.get(e,t,r),has:(e,t)=>!!Wa(e,t)||s.has(e,t)}));var ru=["continue","continuePrimaryKey","advance"],Va={},to=new WeakMap,Ga=new WeakMap,su={get(s,e){if(!ru.includes(e))return s[e];let t=Va[e];return t||(t=Va[e]=function(...r){to.set(this,Ga.get(this)[e](...r))}),t}};async function*nu(...s){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...s)),!e)return;e=e;let t=new Proxy(e,su);for(Ga.set(t,e),_n.set(t,eo(e));e;)yield t,e=await(to.get(t)||e.continue()),to.delete(t)}function Ka(s,e){return e===Symbol.asyncIterator&&Qi(s,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&Qi(s,[IDBIndex,IDBObjectStore])}Ja(s=>({...s,get(e,t,r){return Ka(e,t)?nu:s.get(e,t,r)},has(e,t){return Ka(e,t)||s.has(e,t)}}));async function iu(s,e=16){if(!(crypto!=null&&crypto.subtle))throw new Error("crypto.subtle is not available. This environment does not support secure hashing.");try{let r=new TextEncoder().encode(s),n=await crypto.subtle.digest("SHA-256",r);return Array.from(new Uint8Array(n)).map(a=>a.toString(16).padStart(2,"0")).join("").substring(0,e)}catch(t){throw new Error(`Failed to generate secure hash: ${t instanceof Error?t.message:"Unknown error"}`)}}var Qa=s=>iu(s,16);var gt=class{constructor(){this.db=null;this.vaultId="";this.dbName=""}static getInstance(){return gt.instance||(gt.instance=new gt),gt.instance}async init(e){try{if(this.db&&this.vaultId!==e&&await this.close(),this.db&&this.vaultId===e)return;this.vaultId=e;let t=await Qa("ai-providers-plugin");this.dbName=`aiProviders_${t}_${this.vaultId}`,this.db=await Xa(this.dbName,1,{upgrade(r){r.createObjectStore("embeddings")}})}catch(t){console.error("Failed to initialize embeddings cache database:",t),this.db=null}}async getEmbeddings(e){if(this.db)try{return await this.db.get("embeddings",e)}catch(t){console.error("Error getting embeddings from cache:",t);return}}async setEmbeddings(e,t){if(this.db)try{await this.db.put("embeddings",t,e)}catch(r){console.error("Error setting embeddings in cache:",r)}}async clearEmbeddings(){if(this.db)try{await this.db.clear("embeddings")}catch(e){console.error("Error clearing embeddings cache:",e)}}async close(){this.db&&(this.db.close(),this.db=null)}isInitialized(){return this.db!==null}},Kt=gt.getInstance();var An=class{constructor(e){this.embedFunction=e}async embedWithCache(e){var a;if(!e.chunks)return this.embedFunction(e);let t=e.abortController;if(t!=null&&t.signal.aborted)throw new Error("Aborted");let r=await this.generateCacheKey(e),{chunks:n}=e,i=await this.loadCachedChunks(e,r),o=n.filter(c=>!i.has(c));if(o.length>0){if(t!=null&&t.signal.aborted)throw new Error("Aborted");await this.embedAndCacheChunks(e,o,i,r)}return(a=e.onProgress)==null||a.call(e,n),n.map(c=>{let l=i.get(c);if(!l)throw new Error("Missing embedding for chunk");return l})}async embedAndCacheChunks(e,t,r,n){let i=e.abortController;if(i!=null&&i.signal.aborted)throw new Error("Aborted");let o=await this.embedFunction({...e,input:t});t.forEach((a,c)=>r.set(a,o[c])),await this.saveCachedChunks(n,e.provider,r)}async loadCachedChunks(e,t){let r=await Kt.getEmbeddings(t).catch(n=>(b.error("Error reading from embeddings cache:",n),null));return(r==null?void 0:r.providerId)===e.provider.id&&(r==null?void 0:r.providerModel)===e.provider.model?new Map(r.chunks.map(n=>[n.content,n.embedding])):new Map}async saveCachedChunks(e,t,r){if(!t.model)return;let n=Array.from(r,([i,o])=>({content:i,embedding:o}));await Kt.setEmbeddings(e,{providerId:t.id,providerModel:t.model,chunks:n}).catch(i=>{b.error("Error writing to embeddings cache:",i)})}async generateCacheKey(e){return`embed:${e.provider.id}:${e.provider.model}`}};var _s=1e3;function Ya(s){return b.debug("Preprocessing content",{contentLength:s.length}),s.replace(/^---\n[\s\S]*?\n---\n/,"").replace(/```[\s\S]*?```/g,"").replace(/^(#+)\s*$\n/gm,"").replace(/^(#+)\s*(?!$)[^\n]+\n(?=\s*(?:\1#|\s*$)(?!\s*\S))/gm,"").replace(/\n{3,}/g,`

`).replace(/[ \t]+$/gm,"").replace(/\n+$/,"")}function Za(s){return s.length<_s?[s.trim()]:(b.debug("Splitting content",{contentLength:s.length}),s.split(/^---$/m).flatMap(t=>ou(t.trim())).flatMap(t=>au(t)).map(t=>t.trim()).filter(t=>t.length>0))}function ou(s){let e=/^(#{1,6})\s+(.+)$/gm,t=[],r=0,n="",i;for(;(i=e.exec(s))!==null;)r<i.index&&t.push(n+s.slice(r,i.index).trim()),n=i[0]+`
`,r=e.lastIndex;return r<s.length&&t.push(n+s.slice(r).trim()),t.filter(o=>o.length>0)}function au(s){let t=s.split(`
`).reduce(lu,{chunks:[],currentChunk:"",inList:!1,lastNonListText:""}),r=t.currentChunk?[...t.chunks,t.currentChunk.trim()]:t.chunks.map(i=>i.trim()),n=[];for(let i=0;i<r.length;i++){let o=r[i];if(/^#{1,6}\s+.+$/.test(o.trim())&&o.trim().split(`
`).length===1&&i<r.length-1){let c=r[i+1];n.push(o+`

`+c),i++}else n.push(o)}return n}function lu(s,e){let t=/^(\s*[-*+]|\s*\d+\.)/.test(e);return/^(#{1,6}\s|[*_]{2}).+/.test(e)?cu(s,e):t?du(s,e):s.inList&&!e.trim()?{...s,currentChunk:s.currentChunk+`
`+e}:uu(s,e)}function cu(s,e){let{chunks:t,currentChunk:r}=s;return{chunks:r?[...t,r.trim()]:t,currentChunk:e,inList:!1,lastNonListText:e}}function du(s,e){let{chunks:t,currentChunk:r,inList:n,lastNonListText:i}=s;return!n&&r.length+e.length<=_s?{...s,currentChunk:r+`
`+e,inList:!0}:n?{...s,currentChunk:r+`
`+e}:{chunks:r?[...t,r.trim()]:t,currentChunk:i+`
`+e,inList:!0,lastNonListText:i}}function uu(s,e){let{chunks:t,currentChunk:r,lastNonListText:n}=s;if(e.length>_s){let o=e,a=[...t];for(r&&a.push(r.trim());o.length>0;){let c=hu(o,_s);a.push(o.slice(0,c).trim()),o=o.slice(c).trim()}return{chunks:a,currentChunk:"",inList:!1,lastNonListText:e}}let i=r+(r?`
`:"")+e;return i.length>_s?{chunks:[...t,r.trim()],currentChunk:e,inList:!1,lastNonListText:e.trim()?e:n}:{...s,currentChunk:i,inList:!1,lastNonListText:e.trim()?e:n}}function hu(s,e){if(s.length<=e)return s.length;let t=e;for(;t>0&&!/\s/.test(s[t]);)t--;return t>0?t:e}function w(s,e,t,r,n){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?n.call(s,t):n?n.value=t:e.set(s,t),t}function u(s,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(s):r?r.value:e.get(s)}var ro=function(){let{crypto:s}=globalThis;if(s!=null&&s.randomUUID)return ro=s.randomUUID.bind(s),s.randomUUID();let e=new Uint8Array(1),t=s?()=>s.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,r=>(+r^t()&15>>+r/4).toString(16))};function Xe(s){return typeof s=="object"&&s!==null&&("name"in s&&s.name==="AbortError"||"message"in s&&String(s.message).includes("FetchRequestCanceledException"))}var As=s=>{if(s instanceof Error)return s;if(typeof s=="object"&&s!==null){try{if(Object.prototype.toString.call(s)==="[object Error]"){let e=new Error(s.message,s.cause?{cause:s.cause}:{});return s.stack&&(e.stack=s.stack),s.cause&&!e.cause&&(e.cause=s.cause),s.name&&(e.name=s.name),e}}catch(e){}try{return new Error(JSON.stringify(s))}catch(e){}}return new Error(s)};var A=class extends Error{},X=class extends A{constructor(e,t,r,n){super(`${X.makeMessage(e,t,r)}`),this.status=e,this.headers=n,this.requestID=n==null?void 0:n.get("request-id"),this.error=t}static makeMessage(e,t,r){let n=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&n?`${e} ${n}`:e?`${e} status code (no body)`:n||"(no status code or body)"}static generate(e,t,r,n){if(!e||!n)return new yt({message:r,cause:As(t)});let i=t;return e===400?new Rr(e,i,r,n):e===401?new kr(e,i,r,n):e===403?new Tr(e,i,r,n):e===404?new Or(e,i,r,n):e===409?new Nr(e,i,r,n):e===422?new Fr(e,i,r,n):e===429?new Dr(e,i,r,n):e>=500?new Lr(e,i,r,n):new X(e,i,r,n)}},oe=class extends X{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},yt=class extends X{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},Mr=class extends yt{constructor({message:e}={}){super({message:e!=null?e:"Request timed out."})}},Rr=class extends X{},kr=class extends X{},Tr=class extends X{},Or=class extends X{},Nr=class extends X{},Fr=class extends X{},Dr=class extends X{},Lr=class extends X{};var mu=/^[a-z][a-z0-9+.-]*:/i,el=s=>mu.test(s),so=s=>(so=Array.isArray,so(s)),no=so;function xn(s){return typeof s!="object"?{}:s!=null?s:{}}function tl(s){if(!s)return!0;for(let e in s)return!1;return!0}function rl(s,e){return Object.prototype.hasOwnProperty.call(s,e)}var sl=(s,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new A(`${s} must be an integer`);if(e<0)throw new A(`${s} must be a positive integer`);return e};var Pn=s=>{try{return JSON.parse(s)}catch(e){return}};var nl=s=>new Promise(e=>setTimeout(e,s));var bt="0.71.0";var al=()=>typeof window!="undefined"&&typeof window.document!="undefined"&&typeof navigator!="undefined";function pu(){return typeof Deno!="undefined"&&Deno.build!=null?"deno":typeof EdgeRuntime!="undefined"?"edge":Object.prototype.toString.call(typeof globalThis.process!="undefined"?globalThis.process:0)==="[object process]"?"node":"unknown"}var gu=()=>{var t,r,n,i,o;let s=pu();if(s==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":bt,"X-Stainless-OS":ol(Deno.build.os),"X-Stainless-Arch":il(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:(r=(t=Deno.version)==null?void 0:t.deno)!=null?r:"unknown"};if(typeof EdgeRuntime!="undefined")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":bt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(s==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":bt,"X-Stainless-OS":ol((n=globalThis.process.platform)!=null?n:"unknown"),"X-Stainless-Arch":il((i=globalThis.process.arch)!=null?i:"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":(o=globalThis.process.version)!=null?o:"unknown"};let e=yu();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":bt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":bt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function yu(){if(typeof navigator=="undefined"||!navigator)return null;let s=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:t}of s){let r=t.exec(navigator.userAgent);if(r){let n=r[1]||0,i=r[2]||0,o=r[3]||0;return{browser:e,version:`${n}.${i}.${o}`}}}return null}var il=s=>s==="x32"?"x32":s==="x86_64"||s==="x64"?"x64":s==="arm"?"arm":s==="aarch64"||s==="arm64"?"arm64":s?`other:${s}`:"unknown",ol=s=>(s=s.toLowerCase(),s.includes("ios")?"iOS":s==="android"?"Android":s==="darwin"?"MacOS":s==="win32"?"Windows":s==="freebsd"?"FreeBSD":s==="openbsd"?"OpenBSD":s==="linux"?"Linux":s?`Other:${s}`:"Unknown"),In,ll=()=>In!=null?In:In=gu();function cl(){if(typeof fetch!="undefined")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new Anthropic({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function io(...s){let e=globalThis.ReadableStream;if(typeof e=="undefined")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...s)}function En(s){let e=Symbol.asyncIterator in s?s[Symbol.asyncIterator]():s[Symbol.iterator]();return io({start(){},async pull(t){let{done:r,value:n}=await e.next();r?t.close():t.enqueue(n)},async cancel(){var t;await((t=e.return)==null?void 0:t.call(e))}})}function xs(s){if(s[Symbol.asyncIterator])return s;let e=s.getReader();return{async next(){try{let t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){let t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function dl(s){var r,n;if(s===null||typeof s!="object")return;if(s[Symbol.asyncIterator]){await((n=(r=s[Symbol.asyncIterator]()).return)==null?void 0:n.call(r));return}let e=s.getReader(),t=e.cancel();e.releaseLock(),await t}var ul=({headers:s,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)});function hl(s){let e=0;for(let n of s)e+=n.length;let t=new Uint8Array(e),r=0;for(let n of s)t.set(n,r),r+=n.length;return t}var Sn;function Ps(s){let e;return(Sn!=null?Sn:(e=new globalThis.TextEncoder,Sn=e.encode.bind(e)))(s)}var Cn;function oo(s){let e;return(Cn!=null?Cn:(e=new globalThis.TextDecoder,Cn=e.decode.bind(e)))(s)}var ye,be,Ge=class{constructor(){ye.set(this,void 0),be.set(this,void 0),w(this,ye,new Uint8Array,"f"),w(this,be,null,"f")}decode(e){if(e==null)return[];let t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?Ps(e):e;w(this,ye,hl([u(this,ye,"f"),t]),"f");let r=[],n;for(;(n=vu(u(this,ye,"f"),u(this,be,"f")))!=null;){if(n.carriage&&u(this,be,"f")==null){w(this,be,n.index,"f");continue}if(u(this,be,"f")!=null&&(n.index!==u(this,be,"f")+1||n.carriage)){r.push(oo(u(this,ye,"f").subarray(0,u(this,be,"f")-1))),w(this,ye,u(this,ye,"f").subarray(u(this,be,"f")),"f"),w(this,be,null,"f");continue}let i=u(this,be,"f")!==null?n.preceding-1:n.preceding,o=oo(u(this,ye,"f").subarray(0,i));r.push(o),w(this,ye,u(this,ye,"f").subarray(n.index),"f"),w(this,be,null,"f")}return r}flush(){return u(this,ye,"f").length?this.decode(`
`):[]}};ye=new WeakMap,be=new WeakMap;Ge.NEWLINE_CHARS=new Set([`
`,"\r"]);Ge.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function vu(s,e){for(let n=e!=null?e:0;n<s.length;n++){if(s[n]===10)return{preceding:n,index:n+1,carriage:!1};if(s[n]===13)return{preceding:n,index:n+1,carriage:!0}}return null}function fl(s){for(let r=0;r<s.length-1;r++){if(s[r]===10&&s[r+1]===10||s[r]===13&&s[r+1]===13)return r+2;if(s[r]===13&&s[r+1]===10&&r+3<s.length&&s[r+2]===13&&s[r+3]===10)return r+4}return-1}var Rn={off:0,error:200,warn:300,info:400,debug:500},ao=(s,e,t)=>{if(s){if(rl(Rn,s))return s;se(t).warn(`${e} was set to ${JSON.stringify(s)}, expected one of ${JSON.stringify(Object.keys(Rn))}`)}};function Is(){}function Mn(s,e,t){return!e||Rn[s]>Rn[t]?Is:e[s].bind(e)}var _u={error:Is,warn:Is,info:Is,debug:Is},ml=new WeakMap;function se(s){var i;let e=s.logger,t=(i=s.logLevel)!=null?i:"off";if(!e)return _u;let r=ml.get(e);if(r&&r[0]===t)return r[1];let n={error:Mn("error",e,t),warn:Mn("warn",e,t),info:Mn("info",e,t),debug:Mn("debug",e,t)};return ml.set(e,[t,n]),n}var Qe=s=>(s.options&&(s.options={...s.options},delete s.options.headers),s.headers&&(s.headers=Object.fromEntries((s.headers instanceof Headers?[...s.headers]:Object.entries(s.headers)).map(([e,t])=>[e,e.toLowerCase()==="x-api-key"||e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":t]))),"retryOfRequestLogID"in s&&(s.retryOfRequestLogID&&(s.retryOf=s.retryOfRequestLogID),delete s.retryOfRequestLogID),s);var Es,ue=class{constructor(e,t,r){this.iterator=e,Es.set(this,void 0),this.controller=t,w(this,Es,r,"f")}static fromSSEResponse(e,t,r){let n=!1,i=r?se(r):console;async function*o(){var c;if(n)throw new A("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let a=!1;try{for await(let l of Au(e,t)){if(l.event==="completion")try{yield JSON.parse(l.data)}catch(d){throw i.error("Could not parse message into JSON:",l.data),i.error("From chunk:",l.raw),d}if(l.event==="message_start"||l.event==="message_delta"||l.event==="message_stop"||l.event==="content_block_start"||l.event==="content_block_delta"||l.event==="content_block_stop")try{yield JSON.parse(l.data)}catch(d){throw i.error("Could not parse message into JSON:",l.data),i.error("From chunk:",l.raw),d}if(l.event!=="ping"&&l.event==="error")throw new X(void 0,(c=Pn(l.data))!=null?c:l.data,void 0,e.headers)}a=!0}catch(l){if(Xe(l))return;throw l}finally{a||t.abort()}}return new ue(o,t,r)}static fromReadableStream(e,t,r){let n=!1;async function*i(){let a=new Ge,c=xs(e);for await(let l of c)for(let d of a.decode(l))yield d;for(let l of a.flush())yield l}async function*o(){if(n)throw new A("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let a=!1;try{for await(let c of i())a||c&&(yield JSON.parse(c));a=!0}catch(c){if(Xe(c))return;throw c}finally{a||t.abort()}}return new ue(o,t,r)}[(Es=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){let e=[],t=[],r=this.iterator(),n=i=>({next:()=>{if(i.length===0){let o=r.next();e.push(o),t.push(o)}return i.shift()}});return[new ue(()=>n(e),this.controller,u(this,Es,"f")),new ue(()=>n(t),this.controller,u(this,Es,"f"))]}toReadableStream(){let e=this,t;return io({async start(){t=e[Symbol.asyncIterator]()},async pull(r){try{let{value:n,done:i}=await t.next();if(i)return r.close();let o=Ps(JSON.stringify(n)+`
`);r.enqueue(o)}catch(n){r.error(n)}},async cancel(){var r;await((r=t.return)==null?void 0:r.call(t))}})}};async function*Au(s,e){if(!s.body)throw e.abort(),typeof globalThis.navigator!="undefined"&&globalThis.navigator.product==="ReactNative"?new A("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new A("Attempted to iterate over a response with no body");let t=new lo,r=new Ge,n=xs(s.body);for await(let i of xu(n))for(let o of r.decode(i)){let a=t.decode(o);a&&(yield a)}for(let i of r.flush()){let o=t.decode(i);o&&(yield o)}}async function*xu(s){let e=new Uint8Array;for await(let t of s){if(t==null)continue;let r=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?Ps(t):t,n=new Uint8Array(e.length+r.length);n.set(e),n.set(r,e.length),e=n;let i;for(;(i=fl(e))!==-1;)yield e.slice(0,i),e=e.slice(i)}e.length>0&&(yield e)}var lo=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,n]=Pu(e,":");return n.startsWith(" ")&&(n=n.substring(1)),t==="event"?this.event=n:t==="data"&&this.data.push(n),null}};function Pu(s,e){let t=s.indexOf(e);return t!==-1?[s.substring(0,t),e,s.substring(t+e.length)]:[s,"",""]}async function kn(s,e){let{response:t,requestLogID:r,retryOfRequestLogID:n,startTime:i}=e,o=await(async()=>{var h;if(e.options.stream)return se(s).debug("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller):ue.fromSSEResponse(t,e.controller);if(t.status===204)return null;if(e.options.__binaryResponse)return t;let a=t.headers.get("content-type"),c=(h=a==null?void 0:a.split(";")[0])==null?void 0:h.trim();if((c==null?void 0:c.includes("application/json"))||(c==null?void 0:c.endsWith("+json"))){let m=await t.json();return co(m,t)}return await t.text()})();return se(s).debug(`[${r}] response parsed`,Qe({retryOfRequestLogID:n,url:t.url,status:t.status,body:o,durationMs:Date.now()-i})),o}function co(s,e){return!s||typeof s!="object"||Array.isArray(s)?s:Object.defineProperty(s,"_request_id",{value:e.headers.get("request-id"),enumerable:!1})}var Ss,Ye=class extends Promise{constructor(e,t,r=kn){super(n=>{n(null)}),this.responsePromise=t,this.parseResponse=r,Ss.set(this,void 0),w(this,Ss,e,"f")}_thenUnwrap(e){return new Ye(u(this,Ss,"f"),this.responsePromise,async(t,r)=>co(e(await this.parseResponse(t,r),r),r.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(u(this,Ss,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}};Ss=new WeakMap;var Tn,On=class{constructor(e,t,r,n){Tn.set(this,void 0),w(this,Tn,e,"f"),this.options=n,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageRequestOptions()!=null:!1}async getNextPage(){let e=this.nextPageRequestOptions();if(!e)throw new A("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await u(this,Tn,"f").requestAPIList(this.constructor,e)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Tn=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}},Cs=class extends Ye{constructor(e,t,r){super(e,t,async(n,i)=>new r(n,i.response,await kn(n,i),i.options))}async*[Symbol.asyncIterator](){let e=await this;for await(let t of e)yield t}},Pe=class extends On{constructor(e,t,r,n){super(e,t,r,n),this.data=r.data||[],this.has_more=r.has_more||!1,this.first_id=r.first_id||null,this.last_id=r.last_id||null}getPaginatedItems(){var e;return(e=this.data)!=null?e:[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){var t;if((t=this.options.query)!=null&&t.before_id){let r=this.first_id;return r?{...this.options,query:{...xn(this.options.query),before_id:r}}:null}let e=this.last_id;return e?{...this.options,query:{...xn(this.options.query),after_id:e}}:null}};var Br=class extends On{constructor(e,t,r,n){super(e,t,r,n),this.data=r.data||[],this.has_more=r.has_more||!1,this.next_page=r.next_page||null}getPaginatedItems(){var e;return(e=this.data)!=null?e:[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){let e=this.next_page;return e?{...this.options,query:{...xn(this.options.query),page:e}}:null}};var ho=()=>{var s;if(typeof File=="undefined"){let{process:e}=globalThis,t=typeof((s=e==null?void 0:e.versions)==null?void 0:s.node)=="string"&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function Jt(s,e,t){return ho(),new File(s,e!=null?e:"unknown_file",t)}function Ms(s){return(typeof s=="object"&&s!==null&&("name"in s&&s.name&&String(s.name)||"url"in s&&s.url&&String(s.url)||"filename"in s&&s.filename&&String(s.filename)||"path"in s&&s.path&&String(s.path))||"").split(/[\\/]/).pop()||void 0}var fo=s=>s!=null&&typeof s=="object"&&typeof s[Symbol.asyncIterator]=="function";var Ur=async(s,e)=>({...s,body:await Su(s.body,e)}),pl=new WeakMap;function Eu(s){let e=typeof s=="function"?s:s.fetch,t=pl.get(e);if(t)return t;let r=(async()=>{try{let n="Response"in e?e.Response:(await e("data:,")).constructor,i=new FormData;return i.toString()!==await new n(i).text()}catch(n){return!0}})();return pl.set(e,r),r}var Su=async(s,e)=>{if(!await Eu(e))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");let t=new FormData;return await Promise.all(Object.entries(s||{}).map(([r,n])=>uo(t,r,n))),t},Cu=s=>s instanceof Blob&&"name"in s;var uo=async(s,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")s.append(e,String(t));else if(t instanceof Response){let r={},n=t.headers.get("Content-Type");n&&(r={type:n}),s.append(e,Jt([await t.blob()],Ms(t),r))}else if(fo(t))s.append(e,Jt([await new Response(En(t)).blob()],Ms(t)));else if(Cu(t))s.append(e,Jt([t],Ms(t),{type:t.type}));else if(Array.isArray(t))await Promise.all(t.map(r=>uo(s,e+"[]",r)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([r,n])=>uo(s,`${e}[${r}]`,n)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var gl=s=>s!=null&&typeof s=="object"&&typeof s.size=="number"&&typeof s.type=="string"&&typeof s.text=="function"&&typeof s.slice=="function"&&typeof s.arrayBuffer=="function",Mu=s=>s!=null&&typeof s=="object"&&typeof s.name=="string"&&typeof s.lastModified=="number"&&gl(s),Ru=s=>s!=null&&typeof s=="object"&&typeof s.url=="string"&&typeof s.blob=="function";async function Nn(s,e,t){if(ho(),s=await s,e||(e=Ms(s)),Mu(s))return s instanceof File&&e==null&&t==null?s:Jt([await s.arrayBuffer()],e!=null?e:s.name,{type:s.type,lastModified:s.lastModified,...t});if(Ru(s)){let n=await s.blob();return e||(e=new URL(s.url).pathname.split(/[\\/]/).pop()),Jt(await mo(n),e,t)}let r=await mo(s);if(!(t!=null&&t.type)){let n=r.find(i=>typeof i=="object"&&"type"in i&&i.type);typeof n=="string"&&(t={...t,type:n})}return Jt(r,e,t)}async function mo(s){var t;let e=[];if(typeof s=="string"||ArrayBuffer.isView(s)||s instanceof ArrayBuffer)e.push(s);else if(gl(s))e.push(s instanceof Blob?s:await s.arrayBuffer());else if(fo(s))for await(let r of s)e.push(...await mo(r));else{let r=(t=s==null?void 0:s.constructor)==null?void 0:t.name;throw new Error(`Unexpected data type: ${typeof s}${r?`; constructor: ${r}`:""}${ku(s)}`)}return e}function ku(s){return typeof s!="object"||s===null?"":`; props: [${Object.getOwnPropertyNames(s).map(t=>`"${t}"`).join(", ")}]`}var q=class{constructor(e){this._client=e}};var yl=Symbol.for("brand.privateNullableHeaders");function*Ou(s){if(!s)return;if(yl in s){let{values:r,nulls:n}=s;yield*r.entries();for(let i of n)yield[i,null];return}let e=!1,t;s instanceof Headers?t=s.entries():no(s)?t=s:(e=!0,t=Object.entries(s!=null?s:{}));for(let r of t){let n=r[0];if(typeof n!="string")throw new TypeError("expected header name to be a string");let i=no(r[1])?r[1]:[r[1]],o=!1;for(let a of i)a!==void 0&&(e&&!o&&(o=!0,yield[n,null]),yield[n,a])}}var S=s=>{let e=new Headers,t=new Set;for(let r of s){let n=new Set;for(let[i,o]of Ou(r)){let a=i.toLowerCase();n.has(a)||(e.delete(i),n.add(a)),o===null?(e.delete(i),t.add(a)):(e.append(i,o),t.delete(a))}}return{[yl]:!0,values:e,nulls:t}};function wl(s){return s.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}var bl=Object.freeze(Object.create(null)),Nu=(s=wl)=>function(t,...r){if(t.length===1)return t[0];let n=!1,i=[],o=t.reduce((d,h,m)=>{var y,p,C;/[?#]/.test(h)&&(n=!0);let f=r[m],g=(n?encodeURIComponent:s)(""+f);return m!==r.length&&(f==null||typeof f=="object"&&f.toString===((C=Object.getPrototypeOf((p=Object.getPrototypeOf((y=f.hasOwnProperty)!=null?y:bl))!=null?p:bl))==null?void 0:C.toString))&&(g=f+"",i.push({start:d.length+h.length,length:g.length,error:`Value of type ${Object.prototype.toString.call(f).slice(8,-1)} is not a valid path parameter`})),d+h+(m===r.length?"":g)},""),a=o.split(/[?#]/,1)[0],c=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi,l;for(;(l=c.exec(a))!==null;)i.push({start:l.index,length:l[0].length,error:`Value "${l[0]}" can't be safely passed as a path parameter`});if(i.sort((d,h)=>d.start-h.start),i.length>0){let d=0,h=i.reduce((m,f)=>{let g=" ".repeat(f.start-d),y="^".repeat(f.length);return d=f.start+f.length,m+g+y},"");throw new A(`Path parameters result in path with invalid segments:
${i.map(m=>m.error).join(`
`)}
${o}
${h}`)}return o},j=Nu(wl);var $r=class extends q{list(e={},t){let{betas:r,...n}=e!=null?e:{};return this._client.getAPIList("/v1/files",Pe,{query:n,...t,headers:S([{"anthropic-beta":[...r!=null?r:[],"files-api-2025-04-14"].toString()},t==null?void 0:t.headers])})}delete(e,t={},r){let{betas:n}=t!=null?t:{};return this._client.delete(j`/v1/files/${e}`,{...r,headers:S([{"anthropic-beta":[...n!=null?n:[],"files-api-2025-04-14"].toString()},r==null?void 0:r.headers])})}download(e,t={},r){let{betas:n}=t!=null?t:{};return this._client.get(j`/v1/files/${e}/content`,{...r,headers:S([{"anthropic-beta":[...n!=null?n:[],"files-api-2025-04-14"].toString(),Accept:"application/binary"},r==null?void 0:r.headers]),__binaryResponse:!0})}retrieveMetadata(e,t={},r){let{betas:n}=t!=null?t:{};return this._client.get(j`/v1/files/${e}`,{...r,headers:S([{"anthropic-beta":[...n!=null?n:[],"files-api-2025-04-14"].toString()},r==null?void 0:r.headers])})}upload(e,t){let{betas:r,...n}=e;return this._client.post("/v1/files",Ur({body:n,...t,headers:S([{"anthropic-beta":[...r!=null?r:[],"files-api-2025-04-14"].toString()},t==null?void 0:t.headers])},this._client))}};var qr=class extends q{retrieve(e,t={},r){let{betas:n}=t!=null?t:{};return this._client.get(j`/v1/models/${e}?beta=true`,{...r,headers:S([{...(n==null?void 0:n.toString())!=null?{"anthropic-beta":n==null?void 0:n.toString()}:void 0},r==null?void 0:r.headers])})}list(e={},t){let{betas:r,...n}=e!=null?e:{};return this._client.getAPIList("/v1/models?beta=true",Pe,{query:n,...t,headers:S([{...(r==null?void 0:r.toString())!=null?{"anthropic-beta":r==null?void 0:r.toString()}:void 0},t==null?void 0:t.headers])})}};var Fn={"claude-opus-4-20250514":8192,"claude-opus-4-0":8192,"claude-4-opus-20250514":8192,"anthropic.claude-opus-4-20250514-v1:0":8192,"claude-opus-4@20250514":8192,"claude-opus-4-1-20250805":8192,"anthropic.claude-opus-4-1-20250805-v1:0":8192,"claude-opus-4-1@20250805":8192};function po(s,e){var t;return!e||!("parse"in((t=e.output_format)!=null?t:{}))?{...s,content:s.content.map(r=>r.type==="text"?{...r,parsed:null}:r),parsed_output:null}:go(s,e)}function go(s,e){let t=null,r=s.content.map(n=>{if(n.type==="text"){let i=Lu(e,n.text);return t===null&&(t=i),{...n,parsed:i}}return n});return{...s,content:r,parsed_output:t}}function Lu(s,e){var t;if(((t=s.output_format)==null?void 0:t.type)!=="json_schema")return null;try{return"parse"in s.output_format?s.output_format.parse(e):JSON.parse(e)}catch(r){throw new A(`Failed to parse structured output: ${r}`)}}var Bu=s=>{let e=0,t=[];for(;e<s.length;){let r=s[e];if(r==="\\"){e++;continue}if(r==="{"){t.push({type:"brace",value:"{"}),e++;continue}if(r==="}"){t.push({type:"brace",value:"}"}),e++;continue}if(r==="["){t.push({type:"paren",value:"["}),e++;continue}if(r==="]"){t.push({type:"paren",value:"]"}),e++;continue}if(r===":"){t.push({type:"separator",value:":"}),e++;continue}if(r===","){t.push({type:"delimiter",value:","}),e++;continue}if(r==='"'){let a="",c=!1;for(r=s[++e];r!=='"';){if(e===s.length){c=!0;break}if(r==="\\"){if(e++,e===s.length){c=!0;break}a+=r+s[e],r=s[++e]}else a+=r,r=s[++e]}r=s[++e],c||t.push({type:"string",value:a});continue}if(r&&/\s/.test(r)){e++;continue}let i=/[0-9]/;if(r&&i.test(r)||r==="-"||r==="."){let a="";for(r==="-"&&(a+=r,r=s[++e]);r&&i.test(r)||r===".";)a+=r,r=s[++e];t.push({type:"number",value:a});continue}let o=/[a-z]/i;if(r&&o.test(r)){let a="";for(;r&&o.test(r)&&e!==s.length;)a+=r,r=s[++e];if(a=="true"||a=="false"||a==="null")t.push({type:"name",value:a});else{e++;continue}continue}e++}return t},jr=s=>{if(s.length===0)return s;let e=s[s.length-1];switch(e.type){case"separator":return s=s.slice(0,s.length-1),jr(s);break;case"number":let t=e.value[e.value.length-1];if(t==="."||t==="-")return s=s.slice(0,s.length-1),jr(s);case"string":let r=s[s.length-2];if((r==null?void 0:r.type)==="delimiter")return s=s.slice(0,s.length-1),jr(s);if((r==null?void 0:r.type)==="brace"&&r.value==="{")return s=s.slice(0,s.length-1),jr(s);break;case"delimiter":return s=s.slice(0,s.length-1),jr(s);break}return s},Uu=s=>{let e=[];return s.map(t=>{t.type==="brace"&&(t.value==="{"?e.push("}"):e.splice(e.lastIndexOf("}"),1)),t.type==="paren"&&(t.value==="["?e.push("]"):e.splice(e.lastIndexOf("]"),1))}),e.length>0&&e.reverse().map(t=>{t==="}"?s.push({type:"brace",value:"}"}):t==="]"&&s.push({type:"paren",value:"]"})}),s},$u=s=>{let e="";return s.map(t=>{switch(t.type){case"string":e+='"'+t.value+'"';break;default:e+=t.value;break}}),e},Dn=s=>JSON.parse($u(Uu(jr(Bu(s)))));var Ie,wt,Hr,Rs,Ln,ks,Ts,Bn,Os,Ze,Ns,Un,$n,zr,qn,jn,yo,vl,Hn,bo,wo,vo,_l,Al="__json_buf";function xl(s){return s.type==="tool_use"||s.type==="server_tool_use"||s.type==="mcp_tool_use"}var Xt=class{constructor(e){Ie.add(this),this.messages=[],this.receivedMessages=[],wt.set(this,void 0),Hr.set(this,null),this.controller=new AbortController,Rs.set(this,void 0),Ln.set(this,()=>{}),ks.set(this,()=>{}),Ts.set(this,void 0),Bn.set(this,()=>{}),Os.set(this,()=>{}),Ze.set(this,{}),Ns.set(this,!1),Un.set(this,!1),$n.set(this,!1),zr.set(this,!1),qn.set(this,void 0),jn.set(this,void 0),Hn.set(this,t=>{if(w(this,Un,!0,"f"),Xe(t)&&(t=new oe),t instanceof oe)return w(this,$n,!0,"f"),this._emit("abort",t);if(t instanceof A)return this._emit("error",t);if(t instanceof Error){let r=new A(t.message);return r.cause=t,this._emit("error",r)}return this._emit("error",new A(String(t)))}),w(this,Rs,new Promise((t,r)=>{w(this,Ln,t,"f"),w(this,ks,r,"f")}),"f"),w(this,Ts,new Promise((t,r)=>{w(this,Bn,t,"f"),w(this,Os,r,"f")}),"f"),u(this,Rs,"f").catch(()=>{}),u(this,Ts,"f").catch(()=>{}),w(this,Hr,e,"f")}get response(){return u(this,qn,"f")}get request_id(){return u(this,jn,"f")}async withResponse(){let e=await u(this,Rs,"f");if(!e)throw new Error("Could not resolve a `Response` object");return{data:this,response:e,request_id:e.headers.get("request-id")}}static fromReadableStream(e){let t=new Xt(null);return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,r){let n=new Xt(t);for(let i of t.messages)n._addMessageParam(i);return w(n,Hr,{...t,stream:!0},"f"),n._run(()=>n._createMessage(e,{...t,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),n}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},u(this,Hn,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,r){var o;let n=r==null?void 0:r.signal,i;n&&(n.aborted&&this.controller.abort(),i=this.controller.abort.bind(this.controller),n.addEventListener("abort",i));try{u(this,Ie,"m",bo).call(this);let{response:a,data:c}=await e.create({...t,stream:!0},{...r,signal:this.controller.signal}).withResponse();this._connected(a);for await(let l of c)u(this,Ie,"m",wo).call(this,l);if((o=c.controller.signal)!=null&&o.aborted)throw new oe;u(this,Ie,"m",vo).call(this)}finally{n&&i&&n.removeEventListener("abort",i)}}_connected(e){this.ended||(w(this,qn,e,"f"),w(this,jn,e==null?void 0:e.headers.get("request-id"),"f"),u(this,Ln,"f").call(this,e),this._emit("connect"))}get ended(){return u(this,Ns,"f")}get errored(){return u(this,Un,"f")}get aborted(){return u(this,$n,"f")}abort(){this.controller.abort()}on(e,t){return(u(this,Ze,"f")[e]||(u(this,Ze,"f")[e]=[])).push({listener:t}),this}off(e,t){let r=u(this,Ze,"f")[e];if(!r)return this;let n=r.findIndex(i=>i.listener===t);return n>=0&&r.splice(n,1),this}once(e,t){return(u(this,Ze,"f")[e]||(u(this,Ze,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{w(this,zr,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){w(this,zr,!0,"f"),await u(this,Ts,"f")}get currentMessage(){return u(this,wt,"f")}async finalMessage(){return await this.done(),u(this,Ie,"m",yo).call(this)}async finalText(){return await this.done(),u(this,Ie,"m",vl).call(this)}_emit(e,...t){if(u(this,Ns,"f"))return;e==="end"&&(w(this,Ns,!0,"f"),u(this,Bn,"f").call(this));let r=u(this,Ze,"f")[e];if(r&&(u(this,Ze,"f")[e]=r.filter(n=>!n.once),r.forEach(({listener:n})=>n(...t))),e==="abort"){let n=t[0];!u(this,zr,"f")&&!(r!=null&&r.length)&&Promise.reject(n),u(this,ks,"f").call(this,n),u(this,Os,"f").call(this,n),this._emit("end");return}if(e==="error"){let n=t[0];!u(this,zr,"f")&&!(r!=null&&r.length)&&Promise.reject(n),u(this,ks,"f").call(this,n),u(this,Os,"f").call(this,n),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",u(this,Ie,"m",yo).call(this))}async _fromReadableStream(e,t){var i;let r=t==null?void 0:t.signal,n;r&&(r.aborted&&this.controller.abort(),n=this.controller.abort.bind(this.controller),r.addEventListener("abort",n));try{u(this,Ie,"m",bo).call(this),this._connected(null);let o=ue.fromReadableStream(e,this.controller);for await(let a of o)u(this,Ie,"m",wo).call(this,a);if((i=o.controller.signal)!=null&&i.aborted)throw new oe;u(this,Ie,"m",vo).call(this)}finally{r&&n&&r.removeEventListener("abort",n)}}[(wt=new WeakMap,Hr=new WeakMap,Rs=new WeakMap,Ln=new WeakMap,ks=new WeakMap,Ts=new WeakMap,Bn=new WeakMap,Os=new WeakMap,Ze=new WeakMap,Ns=new WeakMap,Un=new WeakMap,$n=new WeakMap,zr=new WeakMap,qn=new WeakMap,jn=new WeakMap,Hn=new WeakMap,Ie=new WeakSet,yo=function(){if(this.receivedMessages.length===0)throw new A("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},vl=function(){if(this.receivedMessages.length===0)throw new A("stream ended without producing a Message with role=assistant");let t=this.receivedMessages.at(-1).content.filter(r=>r.type==="text").map(r=>r.text);if(t.length===0)throw new A("stream ended without producing a content block with type=text");return t.join(" ")},bo=function(){this.ended||w(this,wt,void 0,"f")},wo=function(t){var n;if(this.ended)return;let r=u(this,Ie,"m",_l).call(this,t);switch(this._emit("streamEvent",t,r),t.type){case"content_block_delta":{let i=r.content.at(-1);switch(t.delta.type){case"text_delta":{i.type==="text"&&this._emit("text",t.delta.text,i.text||"");break}case"citations_delta":{i.type==="text"&&this._emit("citation",t.delta.citation,(n=i.citations)!=null?n:[]);break}case"input_json_delta":{xl(i)&&i.input&&this._emit("inputJson",t.delta.partial_json,i.input);break}case"thinking_delta":{i.type==="thinking"&&this._emit("thinking",t.delta.thinking,i.thinking);break}case"signature_delta":{i.type==="thinking"&&this._emit("signature",i.signature);break}default:t.delta}break}case"message_stop":{this._addMessageParam(r),this._addMessage(po(r,u(this,Hr,"f")),!0);break}case"content_block_stop":{this._emit("contentBlock",r.content.at(-1));break}case"message_start":{w(this,wt,r,"f");break}case"content_block_start":case"message_delta":break}},vo=function(){if(this.ended)throw new A("stream has ended, this shouldn't happen");let t=u(this,wt,"f");if(!t)throw new A("request ended without sending any chunks");return w(this,wt,void 0,"f"),po(t,u(this,Hr,"f"))},_l=function(t){var n;let r=u(this,wt,"f");if(t.type==="message_start"){if(r)throw new A(`Unexpected event order, got ${t.type} before receiving "message_stop"`);return t.message}if(!r)throw new A(`Unexpected event order, got ${t.type} before "message_start"`);switch(t.type){case"message_stop":return r;case"message_delta":return r.container=t.delta.container,r.stop_reason=t.delta.stop_reason,r.stop_sequence=t.delta.stop_sequence,r.usage.output_tokens=t.usage.output_tokens,r.context_management=t.context_management,t.usage.input_tokens!=null&&(r.usage.input_tokens=t.usage.input_tokens),t.usage.cache_creation_input_tokens!=null&&(r.usage.cache_creation_input_tokens=t.usage.cache_creation_input_tokens),t.usage.cache_read_input_tokens!=null&&(r.usage.cache_read_input_tokens=t.usage.cache_read_input_tokens),t.usage.server_tool_use!=null&&(r.usage.server_tool_use=t.usage.server_tool_use),r;case"content_block_start":return r.content.push(t.content_block),r;case"content_block_delta":{let i=r.content.at(t.index);switch(t.delta.type){case"text_delta":{(i==null?void 0:i.type)==="text"&&(r.content[t.index]={...i,text:(i.text||"")+t.delta.text});break}case"citations_delta":{(i==null?void 0:i.type)==="text"&&(r.content[t.index]={...i,citations:[...(n=i.citations)!=null?n:[],t.delta.citation]});break}case"input_json_delta":{if(i&&xl(i)){let o=i[Al]||"";o+=t.delta.partial_json;let a={...i};if(Object.defineProperty(a,Al,{value:o,enumerable:!1,writable:!0}),o)try{a.input=Dn(o)}catch(c){let l=new A(`Unable to parse tool parameter JSON from model. Please retry your request or adjust your prompt. Error: ${c}. JSON: ${o}`);u(this,Hn,"f").call(this,l)}r.content[t.index]=a}break}case"thinking_delta":{(i==null?void 0:i.type)==="thinking"&&(r.content[t.index]={...i,thinking:i.thinking+t.delta.thinking});break}case"signature_delta":{(i==null?void 0:i.type)==="thinking"&&(r.content[t.index]={...i,signature:t.delta.signature});break}default:t.delta}return r}case"content_block_stop":return r}},Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("streamEvent",n=>{let i=t.shift();i?i.resolve(n):e.push(n)}),this.on("end",()=>{r=!0;for(let n of t)n.resolve(void 0);t.length=0}),this.on("abort",n=>{r=!0;for(let i of t)i.reject(n);t.length=0}),this.on("error",n=>{r=!0;for(let i of t)i.reject(n);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,o)=>t.push({resolve:i,reject:o})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new ue(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}};var Pl=`You have been working on the task described above but have not yet completed it. Write a continuation summary that will allow you (or another instance of yourself) to resume work efficiently in a future context window where the conversation history will be replaced with this summary. Your summary should be structured, concise, and actionable. Include:
1. Task Overview
The user's core request and success criteria
Any clarifications or constraints they specified
2. Current State
What has been completed so far
Files created, modified, or analyzed (with paths if relevant)
Key outputs or artifacts produced
3. Important Discoveries
Technical constraints or requirements uncovered
Decisions made and their rationale
Errors encountered and how they were resolved
What approaches were tried that didn't work (and why)
4. Next Steps
Specific actions needed to complete the task
Any blockers or open questions to resolve
Priority order if multiple steps remain
5. Context to Preserve
User preferences or style requirements
Domain-specific details that aren't obvious
Any promises made to the user
Be concise but complete\u2014err on the side of including information that would prevent duplicate work or repeated mistakes. Write in a way that enables immediate resumption of the task.
Wrap your summary in <summary></summary> tags.`;var Fs,Wr,Gt,ee,Ds,we,et,vt,Ls,Il,_o;function El(){let s,e;return{promise:new Promise((r,n)=>{s=r,e=n}),resolve:s,reject:e}}var Vr=class{constructor(e,t,r){Fs.add(this),this.client=e,Wr.set(this,!1),Gt.set(this,!1),ee.set(this,void 0),Ds.set(this,void 0),we.set(this,void 0),et.set(this,void 0),vt.set(this,void 0),Ls.set(this,0),w(this,ee,{params:{...t,messages:structuredClone(t.messages)}},"f"),w(this,Ds,{...r,headers:S([{"x-stainless-helper":"BetaToolRunner"},r==null?void 0:r.headers])},"f"),w(this,vt,El(),"f")}async*[(Wr=new WeakMap,Gt=new WeakMap,ee=new WeakMap,Ds=new WeakMap,we=new WeakMap,et=new WeakMap,vt=new WeakMap,Ls=new WeakMap,Fs=new WeakSet,Il=async function(){var l,d,h,m,f,g;let t=u(this,ee,"f").params.compactionControl;if(!t||!t.enabled)return!1;let r=0;if(u(this,we,"f")!==void 0)try{let y=await u(this,we,"f");r=y.usage.input_tokens+((l=y.usage.cache_creation_input_tokens)!=null?l:0)+((d=y.usage.cache_read_input_tokens)!=null?d:0)+y.usage.output_tokens}catch(y){return!1}let n=(h=t.contextTokenThreshold)!=null?h:1e5;if(r<n)return!1;let i=(m=t.model)!=null?m:u(this,ee,"f").params.model,o=(f=t.summaryPrompt)!=null?f:Pl,a=u(this,ee,"f").params.messages;if(a[a.length-1].role==="assistant"){let y=a[a.length-1];if(Array.isArray(y.content)){let p=y.content.filter(C=>C.type!=="tool_use");p.length===0?a.pop():y.content=p}}let c=await this.client.beta.messages.create({model:i,messages:[...a,{role:"user",content:[{type:"text",text:o}]}],max_tokens:u(this,ee,"f").params.max_tokens},{headers:{"x-stainless-helper":"compaction"}});if(((g=c.content[0])==null?void 0:g.type)!=="text")throw new A("Expected text response for compaction");return u(this,ee,"f").params.messages=[{role:"user",content:c.content}],!0},Symbol.asyncIterator)](){var e;if(u(this,Wr,"f"))throw new A("Cannot iterate over a consumed stream");w(this,Wr,!0,"f"),w(this,Gt,!0,"f"),w(this,et,void 0,"f");try{for(;;){let t;try{if(u(this,ee,"f").params.max_iterations&&u(this,Ls,"f")>=u(this,ee,"f").params.max_iterations)break;w(this,Gt,!1,"f"),w(this,et,void 0,"f"),w(this,Ls,(e=u(this,Ls,"f"),e++,e),"f"),w(this,we,void 0,"f");let{max_iterations:r,compactionControl:n,...i}=u(this,ee,"f").params;if(i.stream?(t=this.client.beta.messages.stream({...i},u(this,Ds,"f")),w(this,we,t.finalMessage(),"f"),u(this,we,"f").catch(()=>{}),yield t):(w(this,we,this.client.beta.messages.create({...i,stream:!1},u(this,Ds,"f")),"f"),yield u(this,we,"f")),!await u(this,Fs,"m",Il).call(this)){if(!u(this,Gt,"f")){let{role:c,content:l}=await u(this,we,"f");u(this,ee,"f").params.messages.push({role:c,content:l})}let a=await u(this,Fs,"m",_o).call(this,u(this,ee,"f").params.messages.at(-1));if(a)u(this,ee,"f").params.messages.push(a);else if(!u(this,Gt,"f"))break}}finally{t&&t.abort()}}if(!u(this,we,"f"))throw new A("ToolRunner concluded without a message from the server");u(this,vt,"f").resolve(await u(this,we,"f"))}catch(t){throw w(this,Wr,!1,"f"),u(this,vt,"f").promise.catch(()=>{}),u(this,vt,"f").reject(t),w(this,vt,El(),"f"),t}}setMessagesParams(e){typeof e=="function"?u(this,ee,"f").params=e(u(this,ee,"f").params):u(this,ee,"f").params=e,w(this,Gt,!0,"f"),w(this,et,void 0,"f")}async generateToolResponse(){var t;let e=(t=await u(this,we,"f"))!=null?t:this.params.messages.at(-1);return e?u(this,Fs,"m",_o).call(this,e):null}done(){return u(this,vt,"f").promise}async runUntilDone(){if(!u(this,Wr,"f"))for await(let e of this);return this.done()}get params(){return u(this,ee,"f").params}pushMessages(...e){this.setMessagesParams(t=>({...t,messages:[...t.messages,...e]}))}then(e,t){return this.runUntilDone().then(e,t)}};_o=async function(e){return u(this,et,"f")!==void 0?u(this,et,"f"):(w(this,et,ju(u(this,ee,"f").params,e),"f"),u(this,et,"f"))};async function ju(s,e=s.messages.at(-1)){if(!e||e.role!=="assistant"||!e.content||typeof e.content=="string")return null;let t=e.content.filter(n=>n.type==="tool_use");return t.length===0?null:{role:"user",content:await Promise.all(t.map(async n=>{let i=s.tools.find(o=>("name"in o?o.name:o.mcp_server_name)===n.name);if(!i||!("run"in i))return{type:"tool_result",tool_use_id:n.id,content:`Error: Tool '${n.name}' not found`,is_error:!0};try{let o=n.input;"parse"in i&&i.parse&&(o=i.parse(o));let a=await i.run(o);return{type:"tool_result",tool_use_id:n.id,content:a}}catch(o){return{type:"tool_result",tool_use_id:n.id,content:`Error: ${o instanceof Error?o.message:String(o)}`,is_error:!0}}}))}}var _t=class{constructor(e,t){this.iterator=e,this.controller=t}async*decoder(){let e=new Ge;for await(let t of this.iterator)for(let r of e.decode(t))yield JSON.parse(r);for(let t of e.flush())yield JSON.parse(t)}[Symbol.asyncIterator](){return this.decoder()}static fromResponse(e,t){if(!e.body)throw t.abort(),typeof globalThis.navigator!="undefined"&&globalThis.navigator.product==="ReactNative"?new A("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new A("Attempted to iterate over a response with no body");return new _t(xs(e.body),t)}};var Kr=class extends q{create(e,t){let{betas:r,...n}=e;return this._client.post("/v1/messages/batches?beta=true",{body:n,...t,headers:S([{"anthropic-beta":[...r!=null?r:[],"message-batches-2024-09-24"].toString()},t==null?void 0:t.headers])})}retrieve(e,t={},r){let{betas:n}=t!=null?t:{};return this._client.get(j`/v1/messages/batches/${e}?beta=true`,{...r,headers:S([{"anthropic-beta":[...n!=null?n:[],"message-batches-2024-09-24"].toString()},r==null?void 0:r.headers])})}list(e={},t){let{betas:r,...n}=e!=null?e:{};return this._client.getAPIList("/v1/messages/batches?beta=true",Pe,{query:n,...t,headers:S([{"anthropic-beta":[...r!=null?r:[],"message-batches-2024-09-24"].toString()},t==null?void 0:t.headers])})}delete(e,t={},r){let{betas:n}=t!=null?t:{};return this._client.delete(j`/v1/messages/batches/${e}?beta=true`,{...r,headers:S([{"anthropic-beta":[...n!=null?n:[],"message-batches-2024-09-24"].toString()},r==null?void 0:r.headers])})}cancel(e,t={},r){let{betas:n}=t!=null?t:{};return this._client.post(j`/v1/messages/batches/${e}/cancel?beta=true`,{...r,headers:S([{"anthropic-beta":[...n!=null?n:[],"message-batches-2024-09-24"].toString()},r==null?void 0:r.headers])})}async results(e,t={},r){let n=await this.retrieve(e);if(!n.results_url)throw new A(`No batch \`results_url\`; Has it finished processing? ${n.processing_status} - ${n.id}`);let{betas:i}=t!=null?t:{};return this._client.get(n.results_url,{...r,headers:S([{"anthropic-beta":[...i!=null?i:[],"message-batches-2024-09-24"].toString(),Accept:"application/binary"},r==null?void 0:r.headers]),stream:!0,__binaryResponse:!0})._thenUnwrap((o,a)=>_t.fromResponse(a.response,a.controller))}};var Sl={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-3-opus-20240229":"January 5th, 2026","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025","claude-3-7-sonnet-latest":"February 19th, 2026","claude-3-7-sonnet-20250219":"February 19th, 2026"},At=class extends q{constructor(){super(...arguments),this.batches=new Kr(this._client)}create(e,t){var o,a;let{betas:r,...n}=e;n.model in Sl&&console.warn(`The model '${n.model}' is deprecated and will reach end-of-life on ${Sl[n.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`);let i=this._client._options.timeout;if(!n.stream&&i==null){let c=(o=Fn[n.model])!=null?o:void 0;i=this._client.calculateNonstreamingTimeout(n.max_tokens,c)}return this._client.post("/v1/messages?beta=true",{body:n,timeout:i!=null?i:6e5,...t,headers:S([{...(r==null?void 0:r.toString())!=null?{"anthropic-beta":r==null?void 0:r.toString()}:void 0},t==null?void 0:t.headers]),stream:(a=e.stream)!=null?a:!1})}parse(e,t){var r;return t={...t,headers:S([{"anthropic-beta":[...(r=e.betas)!=null?r:[],"structured-outputs-2025-11-13"].toString()},t==null?void 0:t.headers])},this.create(e,t).then(n=>go(n,e))}stream(e,t){return Xt.createMessage(this,e,t)}countTokens(e,t){let{betas:r,...n}=e;return this._client.post("/v1/messages/count_tokens?beta=true",{body:n,...t,headers:S([{"anthropic-beta":[...r!=null?r:[],"token-counting-2024-11-01"].toString()},t==null?void 0:t.headers])})}toolRunner(e,t){return new Vr(this._client,e,t)}};At.Batches=Kr;At.BetaToolRunner=Vr;var Jr=class extends q{create(e,t={},r){let{betas:n,...i}=t!=null?t:{};return this._client.post(j`/v1/skills/${e}/versions?beta=true`,Ur({body:i,...r,headers:S([{"anthropic-beta":[...n!=null?n:[],"skills-2025-10-02"].toString()},r==null?void 0:r.headers])},this._client))}retrieve(e,t,r){let{skill_id:n,betas:i}=t;return this._client.get(j`/v1/skills/${n}/versions/${e}?beta=true`,{...r,headers:S([{"anthropic-beta":[...i!=null?i:[],"skills-2025-10-02"].toString()},r==null?void 0:r.headers])})}list(e,t={},r){let{betas:n,...i}=t!=null?t:{};return this._client.getAPIList(j`/v1/skills/${e}/versions?beta=true`,Br,{query:i,...r,headers:S([{"anthropic-beta":[...n!=null?n:[],"skills-2025-10-02"].toString()},r==null?void 0:r.headers])})}delete(e,t,r){let{skill_id:n,betas:i}=t;return this._client.delete(j`/v1/skills/${n}/versions/${e}?beta=true`,{...r,headers:S([{"anthropic-beta":[...i!=null?i:[],"skills-2025-10-02"].toString()},r==null?void 0:r.headers])})}};var Qt=class extends q{constructor(){super(...arguments),this.versions=new Jr(this._client)}create(e={},t){let{betas:r,...n}=e!=null?e:{};return this._client.post("/v1/skills?beta=true",Ur({body:n,...t,headers:S([{"anthropic-beta":[...r!=null?r:[],"skills-2025-10-02"].toString()},t==null?void 0:t.headers])},this._client))}retrieve(e,t={},r){let{betas:n}=t!=null?t:{};return this._client.get(j`/v1/skills/${e}?beta=true`,{...r,headers:S([{"anthropic-beta":[...n!=null?n:[],"skills-2025-10-02"].toString()},r==null?void 0:r.headers])})}list(e={},t){let{betas:r,...n}=e!=null?e:{};return this._client.getAPIList("/v1/skills?beta=true",Br,{query:n,...t,headers:S([{"anthropic-beta":[...r!=null?r:[],"skills-2025-10-02"].toString()},t==null?void 0:t.headers])})}delete(e,t={},r){let{betas:n}=t!=null?t:{};return this._client.delete(j`/v1/skills/${e}?beta=true`,{...r,headers:S([{"anthropic-beta":[...n!=null?n:[],"skills-2025-10-02"].toString()},r==null?void 0:r.headers])})}};Qt.Versions=Jr;var Me=class extends q{constructor(){super(...arguments),this.models=new qr(this._client),this.messages=new At(this._client),this.files=new $r(this._client),this.skills=new Qt(this._client)}};Me.Models=qr;Me.Messages=At;Me.Files=$r;Me.Skills=Qt;var Yt=class extends q{create(e,t){var i,o;let{betas:r,...n}=e;return this._client.post("/v1/complete",{body:n,timeout:(i=this._client._options.timeout)!=null?i:6e5,...t,headers:S([{...(r==null?void 0:r.toString())!=null?{"anthropic-beta":r==null?void 0:r.toString()}:void 0},t==null?void 0:t.headers]),stream:(o=e.stream)!=null?o:!1})}};var Ee,xt,Bs,zn,Us,$s,Wn,qs,tt,js,Vn,Kn,Xr,Jn,Xn,Ao,Cl,xo,Po,Io,Eo,Ml,Rl="__json_buf";function kl(s){return s.type==="tool_use"||s.type==="server_tool_use"}var Zt=class{constructor(){Ee.add(this),this.messages=[],this.receivedMessages=[],xt.set(this,void 0),this.controller=new AbortController,Bs.set(this,void 0),zn.set(this,()=>{}),Us.set(this,()=>{}),$s.set(this,void 0),Wn.set(this,()=>{}),qs.set(this,()=>{}),tt.set(this,{}),js.set(this,!1),Vn.set(this,!1),Kn.set(this,!1),Xr.set(this,!1),Jn.set(this,void 0),Xn.set(this,void 0),xo.set(this,e=>{if(w(this,Vn,!0,"f"),Xe(e)&&(e=new oe),e instanceof oe)return w(this,Kn,!0,"f"),this._emit("abort",e);if(e instanceof A)return this._emit("error",e);if(e instanceof Error){let t=new A(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new A(String(e)))}),w(this,Bs,new Promise((e,t)=>{w(this,zn,e,"f"),w(this,Us,t,"f")}),"f"),w(this,$s,new Promise((e,t)=>{w(this,Wn,e,"f"),w(this,qs,t,"f")}),"f"),u(this,Bs,"f").catch(()=>{}),u(this,$s,"f").catch(()=>{})}get response(){return u(this,Jn,"f")}get request_id(){return u(this,Xn,"f")}async withResponse(){let e=await u(this,Bs,"f");if(!e)throw new Error("Could not resolve a `Response` object");return{data:this,response:e,request_id:e.headers.get("request-id")}}static fromReadableStream(e){let t=new Zt;return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,r){let n=new Zt;for(let i of t.messages)n._addMessageParam(i);return n._run(()=>n._createMessage(e,{...t,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),n}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},u(this,xo,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,r){var o;let n=r==null?void 0:r.signal,i;n&&(n.aborted&&this.controller.abort(),i=this.controller.abort.bind(this.controller),n.addEventListener("abort",i));try{u(this,Ee,"m",Po).call(this);let{response:a,data:c}=await e.create({...t,stream:!0},{...r,signal:this.controller.signal}).withResponse();this._connected(a);for await(let l of c)u(this,Ee,"m",Io).call(this,l);if((o=c.controller.signal)!=null&&o.aborted)throw new oe;u(this,Ee,"m",Eo).call(this)}finally{n&&i&&n.removeEventListener("abort",i)}}_connected(e){this.ended||(w(this,Jn,e,"f"),w(this,Xn,e==null?void 0:e.headers.get("request-id"),"f"),u(this,zn,"f").call(this,e),this._emit("connect"))}get ended(){return u(this,js,"f")}get errored(){return u(this,Vn,"f")}get aborted(){return u(this,Kn,"f")}abort(){this.controller.abort()}on(e,t){return(u(this,tt,"f")[e]||(u(this,tt,"f")[e]=[])).push({listener:t}),this}off(e,t){let r=u(this,tt,"f")[e];if(!r)return this;let n=r.findIndex(i=>i.listener===t);return n>=0&&r.splice(n,1),this}once(e,t){return(u(this,tt,"f")[e]||(u(this,tt,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{w(this,Xr,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){w(this,Xr,!0,"f"),await u(this,$s,"f")}get currentMessage(){return u(this,xt,"f")}async finalMessage(){return await this.done(),u(this,Ee,"m",Ao).call(this)}async finalText(){return await this.done(),u(this,Ee,"m",Cl).call(this)}_emit(e,...t){if(u(this,js,"f"))return;e==="end"&&(w(this,js,!0,"f"),u(this,Wn,"f").call(this));let r=u(this,tt,"f")[e];if(r&&(u(this,tt,"f")[e]=r.filter(n=>!n.once),r.forEach(({listener:n})=>n(...t))),e==="abort"){let n=t[0];!u(this,Xr,"f")&&!(r!=null&&r.length)&&Promise.reject(n),u(this,Us,"f").call(this,n),u(this,qs,"f").call(this,n),this._emit("end");return}if(e==="error"){let n=t[0];!u(this,Xr,"f")&&!(r!=null&&r.length)&&Promise.reject(n),u(this,Us,"f").call(this,n),u(this,qs,"f").call(this,n),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",u(this,Ee,"m",Ao).call(this))}async _fromReadableStream(e,t){var i;let r=t==null?void 0:t.signal,n;r&&(r.aborted&&this.controller.abort(),n=this.controller.abort.bind(this.controller),r.addEventListener("abort",n));try{u(this,Ee,"m",Po).call(this),this._connected(null);let o=ue.fromReadableStream(e,this.controller);for await(let a of o)u(this,Ee,"m",Io).call(this,a);if((i=o.controller.signal)!=null&&i.aborted)throw new oe;u(this,Ee,"m",Eo).call(this)}finally{r&&n&&r.removeEventListener("abort",n)}}[(xt=new WeakMap,Bs=new WeakMap,zn=new WeakMap,Us=new WeakMap,$s=new WeakMap,Wn=new WeakMap,qs=new WeakMap,tt=new WeakMap,js=new WeakMap,Vn=new WeakMap,Kn=new WeakMap,Xr=new WeakMap,Jn=new WeakMap,Xn=new WeakMap,xo=new WeakMap,Ee=new WeakSet,Ao=function(){if(this.receivedMessages.length===0)throw new A("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},Cl=function(){if(this.receivedMessages.length===0)throw new A("stream ended without producing a Message with role=assistant");let t=this.receivedMessages.at(-1).content.filter(r=>r.type==="text").map(r=>r.text);if(t.length===0)throw new A("stream ended without producing a content block with type=text");return t.join(" ")},Po=function(){this.ended||w(this,xt,void 0,"f")},Io=function(t){var n;if(this.ended)return;let r=u(this,Ee,"m",Ml).call(this,t);switch(this._emit("streamEvent",t,r),t.type){case"content_block_delta":{let i=r.content.at(-1);switch(t.delta.type){case"text_delta":{i.type==="text"&&this._emit("text",t.delta.text,i.text||"");break}case"citations_delta":{i.type==="text"&&this._emit("citation",t.delta.citation,(n=i.citations)!=null?n:[]);break}case"input_json_delta":{kl(i)&&i.input&&this._emit("inputJson",t.delta.partial_json,i.input);break}case"thinking_delta":{i.type==="thinking"&&this._emit("thinking",t.delta.thinking,i.thinking);break}case"signature_delta":{i.type==="thinking"&&this._emit("signature",i.signature);break}default:t.delta}break}case"message_stop":{this._addMessageParam(r),this._addMessage(r,!0);break}case"content_block_stop":{this._emit("contentBlock",r.content.at(-1));break}case"message_start":{w(this,xt,r,"f");break}case"content_block_start":case"message_delta":break}},Eo=function(){if(this.ended)throw new A("stream has ended, this shouldn't happen");let t=u(this,xt,"f");if(!t)throw new A("request ended without sending any chunks");return w(this,xt,void 0,"f"),t},Ml=function(t){var n;let r=u(this,xt,"f");if(t.type==="message_start"){if(r)throw new A(`Unexpected event order, got ${t.type} before receiving "message_stop"`);return t.message}if(!r)throw new A(`Unexpected event order, got ${t.type} before "message_start"`);switch(t.type){case"message_stop":return r;case"message_delta":return r.stop_reason=t.delta.stop_reason,r.stop_sequence=t.delta.stop_sequence,r.usage.output_tokens=t.usage.output_tokens,t.usage.input_tokens!=null&&(r.usage.input_tokens=t.usage.input_tokens),t.usage.cache_creation_input_tokens!=null&&(r.usage.cache_creation_input_tokens=t.usage.cache_creation_input_tokens),t.usage.cache_read_input_tokens!=null&&(r.usage.cache_read_input_tokens=t.usage.cache_read_input_tokens),t.usage.server_tool_use!=null&&(r.usage.server_tool_use=t.usage.server_tool_use),r;case"content_block_start":return r.content.push({...t.content_block}),r;case"content_block_delta":{let i=r.content.at(t.index);switch(t.delta.type){case"text_delta":{(i==null?void 0:i.type)==="text"&&(r.content[t.index]={...i,text:(i.text||"")+t.delta.text});break}case"citations_delta":{(i==null?void 0:i.type)==="text"&&(r.content[t.index]={...i,citations:[...(n=i.citations)!=null?n:[],t.delta.citation]});break}case"input_json_delta":{if(i&&kl(i)){let o=i[Rl]||"";o+=t.delta.partial_json;let a={...i};Object.defineProperty(a,Rl,{value:o,enumerable:!1,writable:!0}),o&&(a.input=Dn(o)),r.content[t.index]=a}break}case"thinking_delta":{(i==null?void 0:i.type)==="thinking"&&(r.content[t.index]={...i,thinking:i.thinking+t.delta.thinking});break}case"signature_delta":{(i==null?void 0:i.type)==="thinking"&&(r.content[t.index]={...i,signature:t.delta.signature});break}default:t.delta}return r}case"content_block_stop":return r}},Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("streamEvent",n=>{let i=t.shift();i?i.resolve(n):e.push(n)}),this.on("end",()=>{r=!0;for(let n of t)n.resolve(void 0);t.length=0}),this.on("abort",n=>{r=!0;for(let i of t)i.reject(n);t.length=0}),this.on("error",n=>{r=!0;for(let i of t)i.reject(n);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,o)=>t.push({resolve:i,reject:o})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new ue(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}};var Gr=class extends q{create(e,t){return this._client.post("/v1/messages/batches",{body:e,...t})}retrieve(e,t){return this._client.get(j`/v1/messages/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/v1/messages/batches",Pe,{query:e,...t})}delete(e,t){return this._client.delete(j`/v1/messages/batches/${e}`,t)}cancel(e,t){return this._client.post(j`/v1/messages/batches/${e}/cancel`,t)}async results(e,t){let r=await this.retrieve(e);if(!r.results_url)throw new A(`No batch \`results_url\`; Has it finished processing? ${r.processing_status} - ${r.id}`);return this._client.get(r.results_url,{...t,headers:S([{Accept:"application/binary"},t==null?void 0:t.headers]),stream:!0,__binaryResponse:!0})._thenUnwrap((n,i)=>_t.fromResponse(i.response,i.controller))}};var Pt=class extends q{constructor(){super(...arguments),this.batches=new Gr(this._client)}create(e,t){var n,i;e.model in Tl&&console.warn(`The model '${e.model}' is deprecated and will reach end-of-life on ${Tl[e.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`);let r=this._client._options.timeout;if(!e.stream&&r==null){let o=(n=Fn[e.model])!=null?n:void 0;r=this._client.calculateNonstreamingTimeout(e.max_tokens,o)}return this._client.post("/v1/messages",{body:e,timeout:r!=null?r:6e5,...t,stream:(i=e.stream)!=null?i:!1})}stream(e,t){return Zt.createMessage(this,e,t)}countTokens(e,t){return this._client.post("/v1/messages/count_tokens",{body:e,...t})}},Tl={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-3-opus-20240229":"January 5th, 2026","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025","claude-3-7-sonnet-latest":"February 19th, 2026","claude-3-7-sonnet-20250219":"February 19th, 2026"};Pt.Batches=Gr;var er=class extends q{retrieve(e,t={},r){let{betas:n}=t!=null?t:{};return this._client.get(j`/v1/models/${e}`,{...r,headers:S([{...(n==null?void 0:n.toString())!=null?{"anthropic-beta":n==null?void 0:n.toString()}:void 0},r==null?void 0:r.headers])})}list(e={},t){let{betas:r,...n}=e!=null?e:{};return this._client.getAPIList("/v1/models",Pe,{query:n,...t,headers:S([{...(r==null?void 0:r.toString())!=null?{"anthropic-beta":r==null?void 0:r.toString()}:void 0},t==null?void 0:t.headers])})}};var Hs=s=>{var e,t,r,n,i,o;if(typeof globalThis.process!="undefined")return(r=(t=(e=globalThis.process.env)==null?void 0:e[s])==null?void 0:t.trim())!=null?r:void 0;if(typeof globalThis.Deno!="undefined")return(o=(i=(n=globalThis.Deno.env)==null?void 0:n.get)==null?void 0:i.call(n,s))==null?void 0:o.trim()};var So,Co,Gn,Ol,Nl="\\n\\nHuman:",Fl="\\n\\nAssistant:",V=class{constructor({baseURL:e=Hs("ANTHROPIC_BASE_URL"),apiKey:t=(i=>(i=Hs("ANTHROPIC_API_KEY"))!=null?i:null)(),authToken:r=(o=>(o=Hs("ANTHROPIC_AUTH_TOKEN"))!=null?o:null)(),...n}={}){var l,d,h,m,f,g;So.add(this),Gn.set(this,void 0);let a={apiKey:t,authToken:r,...n,baseURL:e||"https://api.anthropic.com"};if(!a.dangerouslyAllowBrowser&&al())throw new A(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new Anthropic({ apiKey, dangerouslyAllowBrowser: true });
`);this.baseURL=a.baseURL,this.timeout=(l=a.timeout)!=null?l:Co.DEFAULT_TIMEOUT,this.logger=(d=a.logger)!=null?d:console;let c="warn";this.logLevel=c,this.logLevel=(m=(h=ao(a.logLevel,"ClientOptions.logLevel",this))!=null?h:ao(Hs("ANTHROPIC_LOG"),"process.env['ANTHROPIC_LOG']",this))!=null?m:c,this.fetchOptions=a.fetchOptions,this.maxRetries=(f=a.maxRetries)!=null?f:2,this.fetch=(g=a.fetch)!=null?g:cl(),w(this,Gn,ul,"f"),this._options=a,this.apiKey=typeof t=="string"?t:null,this.authToken=r}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,authToken:this.authToken,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){if(!(e.get("x-api-key")||e.get("authorization"))&&!(this.apiKey&&e.get("x-api-key"))&&!t.has("x-api-key")&&!(this.authToken&&e.get("authorization"))&&!t.has("authorization"))throw new Error('Could not resolve authentication method. Expected either apiKey or authToken to be set. Or for one of the "X-Api-Key" or "Authorization" headers to be explicitly omitted')}async authHeaders(e){return S([await this.apiKeyAuth(e),await this.bearerAuth(e)])}async apiKeyAuth(e){if(this.apiKey!=null)return S([{"X-Api-Key":this.apiKey}])}async bearerAuth(e){if(this.authToken!=null)return S([{Authorization:`Bearer ${this.authToken}`}])}stringifyQuery(e){return Object.entries(e).filter(([t,r])=>typeof r!="undefined").map(([t,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(t)}=`;throw new A(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${bt}`}defaultIdempotencyKey(){return`stainless-node-retry-${ro()}`}makeStatusError(e,t,r,n){return X.generate(e,t,r,n)}buildURL(e,t,r){let n=!u(this,So,"m",Ol).call(this)&&r||this.baseURL,i=el(e)?new URL(e):new URL(n+(n.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),o=this.defaultQuery();return tl(o)||(t={...o,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(i.search=this.stringifyQuery(t)),i.toString()}_calculateNonstreamingTimeout(e){if(3600*e/128e3>600)throw new A("Streaming is required for operations that may take longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-typescript#streaming-responses for more details");return 600*1e3}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(n=>({method:e,path:t,...n})))}request(e,t=null){return new Ye(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,r){var C,v,O;let n=await e,i=(C=n.maxRetries)!=null?C:this.maxRetries;t==null&&(t=i),await this.prepareOptions(n);let{req:o,url:a,timeout:c}=await this.buildRequest(n,{retryCount:i-t});await this.prepareRequest(o,{url:a,options:n});let l="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),d=r===void 0?"":`, retryOf: ${r}`,h=Date.now();if(se(this).debug(`[${l}] sending request`,Qe({retryOfRequestLogID:r,method:n.method,url:a,options:n,headers:o.headers})),(v=n.signal)!=null&&v.aborted)throw new oe;let m=new AbortController,f=await this.fetchWithTimeout(a,o,c,m).catch(As),g=Date.now();if(f instanceof globalThis.Error){let k=`retrying, ${t} attempts remaining`;if((O=n.signal)!=null&&O.aborted)throw new oe;let P=Xe(f)||/timed? ?out/i.test(String(f)+("cause"in f?String(f.cause):""));if(t)return se(this).info(`[${l}] connection ${P?"timed out":"failed"} - ${k}`),se(this).debug(`[${l}] connection ${P?"timed out":"failed"} (${k})`,Qe({retryOfRequestLogID:r,url:a,durationMs:g-h,message:f.message})),this.retryRequest(n,t,r!=null?r:l);throw se(this).info(`[${l}] connection ${P?"timed out":"failed"} - error; no more retries left`),se(this).debug(`[${l}] connection ${P?"timed out":"failed"} (error; no more retries left)`,Qe({retryOfRequestLogID:r,url:a,durationMs:g-h,message:f.message})),P?new Mr:new yt({cause:f})}let y=[...f.headers.entries()].filter(([k])=>k==="request-id").map(([k,P])=>", "+k+": "+JSON.stringify(P)).join(""),p=`[${l}${d}${y}] ${o.method} ${a} ${f.ok?"succeeded":"failed"} with status ${f.status} in ${g-h}ms`;if(!f.ok){let k=await this.shouldRetry(f);if(t&&k){let R=`retrying, ${t} attempts remaining`;return await dl(f.body),se(this).info(`${p} - ${R}`),se(this).debug(`[${l}] response error (${R})`,Qe({retryOfRequestLogID:r,url:f.url,status:f.status,headers:f.headers,durationMs:g-h})),this.retryRequest(n,t,r!=null?r:l,f.headers)}let P=k?"error; no more retries left":"error; not retryable";se(this).info(`${p} - ${P}`);let D=await f.text().catch(R=>As(R).message),F=Pn(D),N=F?void 0:D;throw se(this).debug(`[${l}] response error (${P})`,Qe({retryOfRequestLogID:r,url:f.url,status:f.status,headers:f.headers,message:N,durationMs:Date.now()-h})),this.makeStatusError(f.status,F,N,f.headers)}return se(this).info(p),se(this).debug(`[${l}] response start`,Qe({retryOfRequestLogID:r,url:f.url,status:f.status,headers:f.headers,durationMs:g-h})),{response:f,options:n,controller:m,requestLogID:l,retryOfRequestLogID:r,startTime:h}}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}requestAPIList(e,t){let r=this.makeRequest(t,null,void 0);return new Cs(this,r,e)}async fetchWithTimeout(e,t,r,n){let{signal:i,method:o,...a}=t||{};i&&i.addEventListener("abort",()=>n.abort());let c=setTimeout(()=>n.abort(),r),l=globalThis.ReadableStream&&a.body instanceof globalThis.ReadableStream||typeof a.body=="object"&&a.body!==null&&Symbol.asyncIterator in a.body,d={signal:n.signal,...l?{duplex:"half"}:{},method:"GET",...a};o&&(d.method=o.toUpperCase());try{return await this.fetch.call(void 0,e,d)}finally{clearTimeout(c)}}async shouldRetry(e){let t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r,n){var c;let i,o=n==null?void 0:n.get("retry-after-ms");if(o){let l=parseFloat(o);Number.isNaN(l)||(i=l)}let a=n==null?void 0:n.get("retry-after");if(a&&!i){let l=parseFloat(a);Number.isNaN(l)?i=Date.parse(a)-Date.now():i=l*1e3}if(!(i&&0<=i&&i<60*1e3)){let l=(c=e.maxRetries)!=null?c:this.maxRetries;i=this.calculateDefaultRetryTimeoutMillis(t,l)}return await nl(i),this.makeRequest(e,t-1,r)}calculateDefaultRetryTimeoutMillis(e,t){let i=t-e,o=Math.min(.5*Math.pow(2,i),8),a=1-Math.random()*.25;return o*a*1e3}calculateNonstreamingTimeout(e,t){if(36e5*e/128e3>6e5||t!=null&&e>t)throw new A("Streaming is required for operations that may take longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-typescript#long-requests for more details");return 6e5}async buildRequest(e,{retryCount:t=0}={}){var f,g,y;let r={...e},{method:n,path:i,query:o,defaultBaseURL:a}=r,c=this.buildURL(i,o,a);"timeout"in r&&sl("timeout",r.timeout),r.timeout=(f=r.timeout)!=null?f:this.timeout;let{bodyHeaders:l,body:d}=this.buildBody({options:r}),h=await this.buildHeaders({options:e,method:n,bodyHeaders:l,retryCount:t});return{req:{method:n,headers:h,...r.signal&&{signal:r.signal},...globalThis.ReadableStream&&d instanceof globalThis.ReadableStream&&{duplex:"half"},...d&&{body:d},...(g=this.fetchOptions)!=null?g:{},...(y=r.fetchOptions)!=null?y:{}},url:c,timeout:r.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:r,retryCount:n}){let i={};this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=e.idempotencyKey);let o=S([i,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(n),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...ll(),...this._options.dangerouslyAllowBrowser?{"anthropic-dangerous-direct-browser-access":"true"}:void 0,"anthropic-version":"2023-06-01"},await this.authHeaders(e),this._options.defaultHeaders,r,e.headers]);return this.validateHeaders(o),o.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let r=S([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&r.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:En(e)}:u(this,Gn,"f").call(this,{body:e,headers:r})}};Co=V,Gn=new WeakMap,So=new WeakSet,Ol=function(){return this.baseURL!=="https://api.anthropic.com"};V.Anthropic=Co;V.HUMAN_PROMPT=Nl;V.AI_PROMPT=Fl;V.DEFAULT_TIMEOUT=6e5;V.AnthropicError=A;V.APIError=X;V.APIConnectionError=yt;V.APIConnectionTimeoutError=Mr;V.APIUserAbortError=oe;V.NotFoundError=Or;V.ConflictError=Nr;V.RateLimitError=Dr;V.BadRequestError=Rr;V.AuthenticationError=kr;V.InternalServerError=Lr;V.PermissionDeniedError=Tr;V.UnprocessableEntityError=Fr;V.toFile=Nn;var qe=class extends V{constructor(){super(...arguments),this.completions=new Yt(this),this.messages=new Pt(this),this.models=new er(this),this.beta=new Me(this)}};qe.Completions=Yt;qe.Messages=Pt;qe.Models=er;qe.Beta=Me;var Xu=1024,Qn=class{constructor(e){this.settings=e;this.fetchSelector=new ft(e)}ensureNotAborted(e){if(e!=null&&e.signal.aborted)throw new Error("Aborted")}isSupportedMediaType(e){return e==="image/jpeg"||e==="image/png"||e==="image/gif"||e==="image/webp"}getClient(e,t){return new qe({apiKey:e.apiKey||"placeholder-key",baseURL:e.url||"https://api.anthropic.com",dangerouslyAllowBrowser:!0,fetch:t})}mapOptions(e){var r,n;let t={max_tokens:(r=e==null?void 0:e.max_tokens)!=null?r:Xu};return(e==null?void 0:e.temperature)!==void 0&&(t.temperature=e.temperature),(e==null?void 0:e.top_p)!==void 0&&(t.top_p=e.top_p),(n=e==null?void 0:e.stop)!=null&&n.length&&(t.stop_sequences=e.stop),t}convertImage(e){let t=e.match(/^data:(image\/[a-zA-Z0-9.+-]+);base64,(.+)$/);if(!t)return b.warn("Anthropic only supports base64-encoded image data URLs. Skipping image."),null;let r=t[1];if(!this.isSupportedMediaType(r))return b.warn("Anthropic only supports jpeg, png, gif or webp images. Skipping image."),null;let n=r,i=t[2];return{type:"image",source:{type:"base64",media_type:n,data:i}}}normalizeContent(e,t){let r=[];return typeof e=="string"?r.push({type:"text",text:e}):e.forEach(n=>{if(n.type==="text")r.push({type:"text",text:n.text});else if(n.type==="image_url"){let i=this.convertImage(n.image_url.url);i&&r.push(i)}}),t==null||t.forEach(n=>{let i=this.convertImage(n);i&&r.push(i)}),r.length?r:[{type:"text",text:""}]}toAnthropicContent(e){return e.length===1&&e[0].type==="text"?e[0].text:e}buildPayload(e){let t=[],r=[];if("messages"in e&&e.messages)e.messages.forEach(n=>{let i=this.normalizeContent(n.content,n.images);if(n.role==="system"){let o=i.filter(a=>a.type==="text").map(a=>a.text).join(`
`).trim();o&&t.push(o);return}r.push({role:n.role==="assistant"?"assistant":"user",content:this.toAnthropicContent(i)})});else if("prompt"in e){let n=this.normalizeContent(e.prompt||"",e.images);e.systemPrompt&&t.push(e.systemPrompt),r.push({role:"user",content:this.toAnthropicContent(n)})}else throw new Error("Either messages or prompt must be provided");if(!r.length)throw new Error("At least one message is required for generation");return{system:t.length?t.join(`

`):void 0,messages:r}}extractTextFromEvent(e){if(e.type==="content_block_delta"){let t=e.delta;if(typeof t.text=="string")return t.text}return null}async fetchModels({provider:e,abortController:t}){this.ensureNotAborted(t);let r=await this.fetchSelector.request(e,async n=>{this.ensureNotAborted(t);let i=this.getClient(e,n),o=[];for await(let a of i.models.list())this.ensureNotAborted(t),a!=null&&a.id&&o.push(a.id);return o});return this.ensureNotAborted(t),r}async embed(e){throw new Error("Embeddings are not supported for Anthropic providers")}async executeAnthropicGeneration(e,t,r,n){let{messages:i,system:o}=this.buildPayload(e),a=this.mapOptions(e.options);b.debug("Sending chat request to Anthropic");let c=await t.messages.create({...a,model:e.provider.model||"",messages:i,system:o,stream:!0},{signal:n==null?void 0:n.signal}),l="",d=c;for await(let h of d){this.ensureNotAborted(n);let m=this.extractTextFromEvent(h);m&&(l+=m,r&&r(m,l))}return l}async execute(e){let{abortController:t,onProgress:r}=e;this.ensureNotAborted(t);try{return await this.fetchSelector.execute(e.provider,async n=>{let i=this.getClient(e.provider,n);return this.executeAnthropicGeneration(e,i,(o,a)=>{r&&r(o,a),this.ensureNotAborted(t)},t)})}catch(n){if(n.message==="Aborted")return Promise.reject(n);throw n}}};var Zn=class{constructor(e,t){this.providers=[];this.version=3;this.plugin=t,this.providers=t.settings.providers||[],this.app=e,this.handlers={openai:new G(t.settings),openrouter:new G(t.settings),ollama:new vs(t.settings),"ollama-openwebui":new vs(t.settings),gemini:new G(t.settings),lmstudio:new G(t.settings),groq:new G(t.settings),ai302:new G(t.settings),anthropic:new Qn(t.settings),mistral:new G(t.settings),together:new G(t.settings),fireworks:new G(t.settings),perplexity:new G(t.settings),deepseek:new G(t.settings),xai:new G(t.settings),novita:new G(t.settings),deepinfra:new G(t.settings),sambanova:new G(t.settings),cerebras:new G(t.settings),zai:new G(t.settings)},this.cachedEmbeddingsService=new An(this.embedForce.bind(this))}async initEmbeddingsCache(){try{let e=this.app.appId||"default";await Kt.init(e)}catch(e){b.error("Failed to initialize embeddings cache:",e)}}getHandler(e){return this.handlers[e]}async embedForce(e){let t=this.getHandler(e.provider.type);if(!t)throw new Error(`Handler not found for provider type: ${e.provider.type}`);return t.embed(e)}async embed(e){try{if(!e.input)throw new Error("Input is required for embedding");let t=e.abortController;if(t!=null&&t.signal.aborted)throw new Error("Aborted");let r=Array.isArray(e.input)?e.input:[e.input],n={...e,input:r,chunks:r};return this.cachedEmbeddingsService.embedWithCache(n)}catch(t){let r=t instanceof Error?t.message:I.t("errors.failedToEmbed");throw new Yn.Notice(r),t}}async fetchModels(e){try{let t="provider"in e?e.provider:e,r="abortController"in e?e.abortController:void 0;if(r!=null&&r.signal.aborted)throw new Error("Aborted");let n=this.getHandler(t.type);if(!n||!n.fetchModels)throw new Error(`Handler not found or does not support fetchModels for provider type: ${t.type}`);return n.fetchModels({provider:t,abortController:r})}catch(t){let r=t instanceof Error?t.message:I.t("errors.failedToFetchModels");throw new Yn.Notice(r),t}}async execute(e){let t=this.getHandler(e.provider.type);if(!t)throw new Error(`Handler not found for provider type: ${e.provider.type}`);let r=e,n=Boolean(r.onProgress),i=Boolean(r.abortController);if(!(!n&&!i))return await t.execute(e);let a=new AbortController,c={data:[],end:[],error:[]};return t.execute({...e,abortController:a,onProgress:(d,h)=>{c.data.forEach(m=>m(d,h))}}).then(d=>{c.end.forEach(h=>h(d))}).catch(d=>{let h=d instanceof Error?d:new Error(String(d));c.error.forEach(m=>m(h))}),{onData(d){c.data.push(d)},onEnd(d){c.end.push(d)},onError(d){c.error.push(d)},abort:()=>{a.abort()}}}async migrateProvider(e){let t=["type","apiKey","url","model"];this.plugin.settings.providers=this.plugin.settings.providers||[];let r=this.plugin.settings.providers.find(n=>t.every(i=>n[i]===e[i]));return r?Promise.resolve(r):new Promise(n=>{new tr(this.app,`Migrate provider ${e.name}?`,async()=>{var i;(i=this.plugin.settings.providers)==null||i.push(e),await this.plugin.saveSettings(),n(e)},()=>{n(!1)}).open()})}checkCompatibility(e){if(e>this.version)throw new Yn.Notice(I.t("errors.pluginMustBeUpdatedFormatted")),new Error(I.t("errors.pluginMustBeUpdated"))}async retrieve(e){var m,f;let t=e.abortController;if(t!=null&&t.signal.aborted)throw new Error("Aborted");if(!e.query)return[];if(!e.documents||e.documents.length===0)return[];if(!this.getHandler(e.embeddingProvider.type))throw new Error(`Handler not found for provider type: ${e.embeddingProvider.type}`);let{chunks:n,totalChunks:i,documentChunkCounts:o}=this.processDocuments(e.documents);if(n.length===0)return[];let a=e.documents.length;(m=e.onProgress)==null||m.call(e,{totalDocuments:a,totalChunks:i,processedDocuments:[],processedChunks:[],processingType:"embedding"});let[c,l]=await Promise.all([this.embed({provider:e.embeddingProvider,input:e.query,abortController:e.abortController}),this.embed({provider:e.embeddingProvider,input:n.map(g=>g.content),abortController:e.abortController,onProgress:g=>{var v;if(t!=null&&t.signal.aborted)return;let y=g.length,p=n.slice(0,y),C=this.getProcessedDocs(p,o,e.documents);(v=e.onProgress)==null||v.call(e,{totalDocuments:a,totalChunks:i,processedDocuments:C,processedChunks:p,processingType:"embedding"})}})]).catch(g=>{var y,p;throw(p=(y=e.abortController)==null?void 0:y.signal)!=null&&p.aborted?new Error("Aborted"):g}),d=this.l2Normalize(c[0]),h=l.map(g=>this.l2Normalize(g));return(f=e.onProgress)==null||f.call(e,{totalDocuments:a,totalChunks:i,processedDocuments:this.getProcessedDocs(n,o,e.documents),processedChunks:n,processingType:"embedding"}),this.rankChunks(d,n,h)}processDocuments(e){var n;let t=[],r={};for(let i of e){let o=Ya(i.content),a=Za(o),c=((n=i.meta)==null?void 0:n.id)||i.content;r[c]=0;for(let l of a)l.trim().length>0&&(t.push({content:l.trim(),document:i}),r[c]++)}return{chunks:t,totalChunks:t.length,documentChunkCounts:r}}getProcessedDocs(e,t,r){var o,a;let n={};for(let c of e){let l=((o=c.document.meta)==null?void 0:o.id)||c.document.content;n[l]=(n[l]||0)+1}let i=[];for(let c of r){let l=((a=c.meta)==null?void 0:a.id)||c.content;t[l]>0&&n[l]===t[l]&&i.push(c)}return i}rankChunks(e,t,r){let n=r.map(i=>this.dotProduct(e,i));return t.map((i,o)=>({document:i.document,score:n[o],content:i.content})).sort((i,o)=>o.score-i.score)}dotProduct(e,t){return e.reduce((r,n,i)=>r+n*t[i],0)}l2Normalize(e){let t=Math.sqrt(e.reduce((r,n)=>r+n*n,0))||1;return e.map(r=>r/t)}async cleanup(){try{Kt.isInitialized()&&await Kt.close()}catch(e){b.error("Error during cleanup:",e)}}};var Dl='<g transform="translate(0,0) scale(4.1667)"><path d="M21.55 10.004a5.416 5.416 0 00-.478-4.501c-1.217-2.09-3.662-3.166-6.05-2.66A5.59 5.59 0 0010.831 1C8.39.995 6.224 2.546 5.473 4.838A5.553 5.553 0 001.76 7.496a5.487 5.487 0 00.691 6.5 5.416 5.416 0 00.477 4.502c1.217 2.09 3.662 3.165 6.05 2.66A5.586 5.586 0 0013.168 23c2.443.006 4.61-1.546 5.361-3.84a5.553 5.553 0 003.715-2.66 5.488 5.488 0 00-.693-6.497v.001zm-8.381 11.558a4.199 4.199 0 01-2.675-.954c.034-.018.093-.05.132-.074l4.44-2.53a.71.71 0 00.364-.623v-6.176l1.877 1.069c.02.01.033.029.036.05v5.115c-.003 2.274-1.87 4.118-4.174 4.123zM4.192 17.78a4.059 4.059 0 01-.498-2.763c.032.02.09.055.131.078l4.44 2.53c.225.13.504.13.73 0l5.42-3.088v2.138a.068.068 0 01-.027.057L9.9 19.288c-1.999 1.136-4.552.46-5.707-1.51h-.001zM3.023 8.216A4.15 4.15 0 015.198 6.41l-.002.151v5.06a.711.711 0 00.364.624l5.42 3.087-1.876 1.07a.067.067 0 01-.063.005l-4.489-2.559c-1.995-1.14-2.679-3.658-1.53-5.63h.001zm15.417 3.54l-5.42-3.088L14.896 7.6a.067.067 0 01.063-.006l4.489 2.557c1.998 1.14 2.683 3.662 1.529 5.633a4.163 4.163 0 01-2.174 1.807V12.38a.71.71 0 00-.363-.623zm1.867-2.773a6.04 6.04 0 00-.132-.078l-4.44-2.53a.731.731 0 00-.729 0l-5.42 3.088V7.325a.068.068 0 01.027-.057L14.1 4.713c2-1.137 4.555-.46 5.707 1.513.487.833.664 1.809.499 2.757h.001zm-11.741 3.81l-1.877-1.068a.065.065 0 01-.036-.051V6.559c.001-2.277 1.873-4.122 4.181-4.12.976 0 1.92.338 2.671.954-.034.018-.092.05-.131.073l-4.44 2.53a.71.71 0 00-.365.623l-.003 6.173v.002zm1.02-2.168L12 9.25l2.414 1.375v2.75L12 14.75l-2.415-1.375v-2.75z"></path></g>',Ll='<g transform="translate(0,0) scale(4.1667)"><path d="M16.804 1.957l7.22 4.105v.087L16.73 10.21l.017-2.117-.821-.03c-1.059-.028-1.611.002-2.268.11-1.064.175-2.038.577-3.147 1.352L8.345 11.03c-.284.195-.495.336-.68.455l-.515.322-.397.234.385.23.53.338c.476.314 1.17.796 2.701 1.866 1.11.775 2.083 1.177 3.147 1.352l.3.045c.694.091 1.375.094 2.825.033l.022-2.159 7.22 4.105v.087L16.589 22l.014-1.862-.635.022c-1.386.042-2.137.002-3.138-.162-1.694-.28-3.26-.926-4.881-2.059l-2.158-1.5a21.997 21.997 0 00-.755-.498l-.467-.28a55.927 55.927 0 00-.76-.43C2.908 14.73.563 14.116 0 14.116V9.888l.14.004c.564-.007 2.91-.622 3.809-1.124l1.016-.58.438-.274c.428-.28 1.072-.726 2.686-1.853 1.621-1.133 3.186-1.78 4.881-2.059 1.152-.19 1.974-.213 3.814-.138l.02-1.907z"></path></g>',Bl='<g transform="translate(0,0) scale(4.1667)"><path d="M12.036 2c-3.853-.035-7 3-7.036 6.781-.035 3.782 3.055 6.872 6.908 6.907h2.42v-2.566h-2.292c-2.407.028-4.38-1.866-4.408-4.23-.029-2.362 1.901-4.298 4.308-4.326h.1c2.407 0 4.358 1.915 4.365 4.278v6.305c0 2.342-1.944 4.25-4.323 4.279a4.375 4.375 0 01-3.033-1.252l-1.851 1.818A7 7 0 0012.029 22h.092c3.803-.056 6.858-3.083 6.879-6.816v-6.5C18.907 4.963 15.817 2 12.036 2z"></path></g>',Ul='<g transform="translate(0,0) scale(4.1667)"><path d="M2.84 2a1.273 1.273 0 100 2.547h14.107a1.273 1.273 0 100-2.547H2.84zM7.935 5.33a1.273 1.273 0 000 2.548H22.04a1.274 1.274 0 000-2.547H7.935zM3.624 9.935c0-.704.57-1.274 1.274-1.274h14.106a1.274 1.274 0 010 2.547H4.898c-.703 0-1.274-.57-1.274-1.273zM1.273 12.188a1.273 1.273 0 100 2.547H15.38a1.274 1.274 0 000-2.547H1.273zM3.624 16.792c0-.704.57-1.274 1.274-1.274h14.106a1.273 1.273 0 110 2.547H4.898c-.703 0-1.274-.57-1.274-1.273zM13.029 18.849a1.273 1.273 0 100 2.547h9.698a1.273 1.273 0 100-2.547h-9.698z" fill-opacity=".3"></path><path d="M2.84 2a1.273 1.273 0 100 2.547h10.287a1.274 1.274 0 000-2.547H2.84zM7.935 5.33a1.273 1.273 0 000 2.548H18.22a1.274 1.274 0 000-2.547H7.935zM3.624 9.935c0-.704.57-1.274 1.274-1.274h10.286a1.273 1.273 0 010 2.547H4.898c-.703 0-1.274-.57-1.274-1.273zM1.273 12.188a1.273 1.273 0 100 2.547H11.56a1.274 1.274 0 000-2.547H1.273zM3.624 16.792c0-.704.57-1.274 1.274-1.274h10.286a1.273 1.273 0 110 2.547H4.898c-.703 0-1.274-.57-1.274-1.273zM13.029 18.849a1.273 1.273 0 100 2.547h5.78a1.273 1.273 0 100-2.547h-5.78z"></path></g>',$l='<g transform="translate(0,0) scale(4.1667)"><path d="M12 24A14.304 14.304 0 000 12 14.304 14.304 0 0012 0a14.305 14.305 0 0012 12 14.305 14.305 0 00-12 12"></path></g>',ql='<g transform="translate(0,0) scale(4.1667)"><path d="M7.905 1.09c.216.085.411.225.588.41.295.306.544.744.734 1.263.191.522.315 1.1.362 1.68a5.054 5.054 0 012.049-.636l.051-.004c.87-.07 1.73.087 2.48.474.101.053.2.11.297.17.05-.569.172-1.134.36-1.644.19-.52.439-.957.733-1.264a1.67 1.67 0 01.589-.41c.257-.1.53-.118.796-.042.401.114.745.368 1.016.737.248.337.434.769.561 1.287.23.934.27 2.163.115 3.645l.053.04.026.019c.757.576 1.284 1.397 1.563 2.35.435 1.487.216 3.155-.534 4.088l-.018.021.002.003c.417.762.67 1.567.724 2.4l.002.03c.064 1.065-.2 2.137-.814 3.19l-.007.01.01.024c.472 1.157.62 2.322.438 3.486l-.006.039a.651.651 0 01-.747.536.648.648 0 01-.54-.742c.167-1.033.01-2.069-.48-3.123a.643.643 0 01.04-.617l.004-.006c.604-.924.854-1.83.8-2.72-.046-.779-.325-1.544-.8-2.273a.644.644 0 01.18-.886l.009-.006c.243-.159.467-.565.58-1.12a4.229 4.229 0 00-.095-1.974c-.205-.7-.58-1.284-1.105-1.683-.595-.454-1.383-.673-2.38-.61a.653.653 0 01-.632-.371c-.314-.665-.772-1.141-1.343-1.436a3.288 3.288 0 00-1.772-.332c-1.245.099-2.343.801-2.67 1.686a.652.652 0 01-.61.425c-1.067.002-1.893.252-2.497.703-.522.39-.878.935-1.066 1.588a4.07 4.07 0 00-.068 1.886c.112.558.331 1.02.582 1.269l.008.007c.212.207.257.53.109.785-.36.622-.629 1.549-.673 2.44-.05 1.018.186 1.902.719 2.536l.016.019a.643.643 0 01.095.69c-.576 1.236-.753 2.252-.562 3.052a.652.652 0 01-1.269.298c-.243-1.018-.078-2.184.473-3.498l.014-.035-.008-.012a4.339 4.339 0 01-.598-1.309l-.005-.019a5.764 5.764 0 01-.177-1.785c.044-.91.278-1.842.622-2.59l.012-.026-.002-.002c-.293-.418-.51-.953-.63-1.545l-.005-.024a5.352 5.352 0 01.093-2.49c.262-.915.777-1.701 1.536-2.269.06-.045.123-.09.186-.132-.159-1.493-.119-2.73.112-3.67.127-.518.314-.95.562-1.287.27-.368.614-.622 1.015-.737.266-.076.54-.059.797.042zm4.116 9.09c.936 0 1.8.313 2.446.855.63.527 1.005 1.235 1.005 1.94 0 .888-.406 1.58-1.133 2.022-.62.375-1.451.557-2.403.557-1.009 0-1.871-.259-2.493-.734-.617-.47-.963-1.13-.963-1.845 0-.707.398-1.417 1.056-1.946.668-.537 1.55-.849 2.485-.849zm0 .896a3.07 3.07 0 00-1.916.65c-.461.37-.722.835-.722 1.25 0 .428.21.829.61 1.134.455.347 1.124.548 1.943.548.799 0 1.473-.147 1.932-.426.463-.28.7-.686.7-1.257 0-.423-.246-.89-.683-1.256-.484-.405-1.14-.643-1.864-.643zm.662 1.21l.004.004c.12.151.095.37-.056.49l-.292.23v.446a.375.375 0 01-.376.373.375.375 0 01-.376-.373v-.46l-.271-.218a.347.347 0 01-.052-.49.353.353 0 01.494-.051l.215.172.22-.174a.353.353 0 01.49.051zm-5.04-1.919c.478 0 .867.39.867.871a.87.87 0 01-.868.871.87.87 0 01-.867-.87.87.87 0 01.867-.872zm8.706 0c.48 0 .868.39.868.871a.87.87 0 01-.868.871.87.87 0 01-.867-.87.87.87 0 01.867-.872zM7.44 2.3l-.003.002a.659.659 0 00-.285.238l-.005.006c-.138.189-.258.467-.348.832-.17.692-.216 1.631-.124 2.782.43-.128.899-.208 1.404-.237l.01-.001.019-.034c.046-.082.095-.161.148-.239.123-.771.022-1.692-.253-2.444-.134-.364-.297-.65-.453-.813a.628.628 0 00-.107-.09L7.44 2.3zm9.174.04l-.002.001a.628.628 0 00-.107.09c-.156.163-.32.45-.453.814-.29.794-.387 1.776-.23 2.572l.058.097.008.014h.03a5.184 5.184 0 011.466.212c.086-1.124.038-2.043-.128-2.722-.09-.365-.21-.643-.349-.832l-.004-.006a.659.659 0 00-.285-.239h-.004z"></path></g>',jl='<g transform="translate(0,0) scale(4.1667)"><path d="M17.7 12C17.7 7.03 13.74 3 8.85 3C3.96 3 0 7.03 0 12C0 16.97 3.96 21 8.85 21C13.73 21 17.7 16.97 17.7 12ZM14.06 12C14.06 14.93 11.73 17.3 8.85 17.3C5.97 17.3 3.64 14.93 3.64 12C3.64 9.07 5.97 6.7 8.85 6.7C11.73 6.7 14.06 9.07 14.06 12ZM24 3H20.61V21H24V3Z"/></g>',Hl='<g transform="translate(0,0) scale(4.1667)"><path d="M19.04 4.818a10.171 10.171 0 014.21 8.25c0 5.623-4.55 10.182-10.163 10.182a10.142 10.142 0 01-8.129-4.07 10.102 10.102 0 005.956 1.934c5.613 0 10.163-4.56 10.163-10.182 0-2.295-.759-4.411-2.037-6.114z" fill-opacity=".5"></path><path d="M10.887 5.2c1.156 0 2.097.944 2.097 2.1 0 .354-.09.7-.258 1.006a.591.591 0 00.233.797c.215.117.47.084.647-.062.375-.232.811-.338 1.251-.305a2.098 2.098 0 011.931 2.248 2.097 2.097 0 01-2.244 1.939 2.082 2.082 0 01-1.246-.533c-.019-.024-.036-.047-.056-.07a.617.617 0 00-.111-.102 2.113 2.113 0 01-.137-.173.58.58 0 10-.947.675c.118.167.247.323.39.462.22.291.36.637.405 1.005a2.08 2.08 0 01-.425 1.546 2.088 2.088 0 01-1.398.792 2.094 2.094 0 01-2.335-1.827 2.083 2.083 0 01.263-1.304v.005a3.273 3.273 0 001.216-2.546c0-.92-.383-1.745-.993-2.34l-.03-.055A2.101 2.101 0 0110.887 5.2z"></path><path d="M6.901 8.752a2.1 2.1 0 010 4.201 2.097 2.097 0 01-2.091-2.1c0-1.159.937-2.101 2.091-2.101z"></path><path clip-rule="evenodd" d="M10.914.75c5.613 0 10.163 4.559 10.163 10.182s-4.55 10.182-10.163 10.182S.75 16.555.75 10.932C.75 5.308 5.301.75 10.914.75zm-.021 3.283A3.27 3.27 0 007.65 7.671a3.27 3.27 0 00-4.006 3.182c0 1.8 1.464 3.262 3.262 3.262.211 0 .417-.016.618-.055-.03.258-.028.516.005.78a3.25 3.25 0 001.23 2.178 3.234 3.234 0 002.407.665 3.236 3.236 0 002.173-1.234c.535-.689.77-1.545.663-2.41 0-.006-.005-.013-.005-.02.151.033.309.055.466.066a3.228 3.228 0 002.365-.781 3.27 3.27 0 00-1.884-5.734 3.31 3.31 0 00-.81.04 3.266 3.266 0 00-3.241-3.577z"></path></g>',zl='<g transform="translate(0,0) scale(4.1667)"><path d="M19.75 19.61l-2.23-4.9h-6.9l-2.23 4.9H5.66l7.9-17.22h2.02l7.9 17.22h-3.73zm-3.38-7.24l-2.23-4.9-2.23 4.9h4.46z"></path></g>',Wl='<g transform="translate(0,0) scale(4.1667)"><path clip-rule="evenodd" d="M3.428 3.4h3.429v3.428h3.429v3.429h-.002 3.431V6.828h3.427V3.4h3.43v13.714H24v3.429H13.714v-3.428h-3.428v-3.429h-3.43v3.428h3.43v3.429H0v-3.429h3.428V3.4zm10.286 13.715h3.428v-3.429h-3.427v3.429z"></path></g>',Vl='<g transform="translate(0,0) scale(4.1667)"><path d="M17.385 11.23a4.615 4.615 0 100-9.23 4.615 4.615 0 000 9.23zm0 10.77a4.615 4.615 0 100-9.23 4.615 4.615 0 000 9.23zm-10.77 0a4.615 4.615 0 100-9.23 4.615 4.615 0 000 9.23z" opacity=".2"></path><circle cx="6.615" cy="6.615" r="4.615"></circle></g>',Kl='<g transform="translate(0,0) scale(4.1667)"><path clip-rule="evenodd" d="M14.8 5l-2.801 6.795L9.195 5H7.397l3.072 7.428a1.64 1.64 0 003.038.002L16.598 5H14.8zm1.196 10.352l5.124-5.244-.699-1.669-5.596 5.739a1.664 1.664 0 00-.343 1.807 1.642 1.642 0 001.516 1.012L16 17l8-.02-.699-1.669-7.303.041h-.002zM2.88 10.104l.699-1.669 5.596 5.739c.468.479.603 1.189.343 1.807a1.643 1.643 0 01-1.516 1.012l-8-.018-.002.002.699-1.669 7.303.042-5.122-5.246z"></path></g>',Jl='<g transform="translate(0,0) scale(4.1667)"><path d="M19.785 0v7.272H22.5V17.62h-2.935V24l-7.037-6.194v6.145h-1.091v-6.152L4.392 24v-6.465H1.5V7.188h2.884V0l7.053 6.494V.19h1.09v6.49L19.786 0zm-7.257 9.044v7.319l5.946 5.234V14.44l-5.946-5.397zm-1.099-.08l-5.946 5.398v7.235l5.946-5.234V8.965zm8.136 7.58h1.844V8.349H13.46l6.105 5.54v2.655zm-8.982-8.28H2.59v8.195h1.8v-2.576l6.192-5.62zM5.475 2.476v4.71h5.115l-5.115-4.71zm13.219 0l-5.115 4.71h5.115v-4.71z"></path></g>',Xl='<g transform="translate(0,0) scale(4.1667)"><path d="M23.748 4.482c-.254-.124-.364.113-.512.234-.051.039-.094.09-.137.136-.372.397-.806.657-1.373.626-.829-.046-1.537.214-2.163.848-.133-.782-.575-1.248-1.247-1.548-.352-.156-.708-.311-.955-.65-.172-.241-.219-.51-.305-.774-.055-.16-.11-.323-.293-.35-.2-.031-.278.136-.356.276-.313.572-.434 1.202-.422 1.84.027 1.436.633 2.58 1.838 3.393.137.093.172.187.129.323-.082.28-.18.552-.266.833-.055.179-.137.217-.329.14a5.526 5.526 0 01-1.736-1.18c-.857-.828-1.631-1.742-2.597-2.458a11.365 11.365 0 00-.689-.471c-.985-.957.13-1.743.388-1.836.27-.098.093-.432-.779-.428-.872.004-1.67.295-2.687.684a3.055 3.055 0 01-.465.137 9.597 9.597 0 00-2.883-.102c-1.885.21-3.39 1.102-4.497 2.623C.082 8.606-.231 10.684.152 12.85c.403 2.284 1.569 4.175 3.36 5.653 1.858 1.533 3.997 2.284 6.438 2.14 1.482-.085 3.133-.284 4.994-1.86.47.234.962.327 1.78.397.63.059 1.236-.03 1.705-.128.735-.156.684-.837.419-.961-2.155-1.004-1.682-.595-2.113-.926 1.096-1.296 2.746-2.642 3.392-7.003.05-.347.007-.565 0-.845-.004-.17.035-.237.23-.256a4.173 4.173 0 001.545-.475c1.396-.763 1.96-2.015 2.093-3.517.02-.23-.004-.467-.247-.588zM11.581 18c-2.089-1.642-3.102-2.183-3.52-2.16-.392.024-.321.471-.235.763.09.288.207.486.371.739.114.167.192.416-.113.603-.673.416-1.842-.14-1.897-.167-1.361-.802-2.5-1.86-3.301-3.307-.774-1.393-1.224-2.887-1.298-4.482-.02-.386.093-.522.477-.592a4.696 4.696 0 011.529-.039c2.132.312 3.946 1.265 5.468 2.774.868.86 1.525 1.887 2.202 2.891.72 1.066 1.494 2.082 2.48 2.914.348.292.625.514.891.677-.802.09-2.14.11-3.054-.614zm1-6.44a.306.306 0 01.415-.287.302.302 0 01.2.288.306.306 0 01-.31.307.303.303 0 01-.304-.308zm3.11 1.596c-.2.081-.399.151-.59.16a1.245 1.245 0 01-.798-.254c-.274-.23-.47-.358-.552-.758a1.73 1.73 0 01.016-.588c.07-.327-.008-.537-.239-.727-.187-.156-.426-.199-.688-.199a.559.559 0 01-.254-.078c-.11-.054-.2-.19-.114-.358.028-.054.16-.186.192-.21.356-.202.767-.136 1.146.016.352.144.618.408 1.001.782.391.451.462.576.685.914.176.265.336.537.445.848.067.195-.019.354-.25.452z"></path></g>',Gl='<g transform="translate(0,0) scale(4.1667)"><path d="M6.469 8.776L16.512 23h-4.464L2.005 8.776H6.47zm-.004 7.9l2.233 3.164L6.467 23H2l4.465-6.324zM22 2.582V23h-3.659V7.764L22 2.582zM22 1l-9.952 14.095-2.233-3.163L17.533 1H22z"></path></g>',Ql='<g transform="translate(0,0) scale(4.1667)"><path clip-rule="evenodd" d="M9.167 4.17v5.665L0 19.003h9.167v-5.666l5.666 5.666H24L9.167 4.17z"></path></g>',Yl='<g transform="translate(0,0) scale(4.1667)"><path d="M3.294 7.821A2.297 2.297 0 011 5.527a2.297 2.297 0 012.294-2.295A2.297 2.297 0 015.59 5.527 2.297 2.297 0 013.294 7.82zm0-3.688a1.396 1.396 0 000 2.79 1.396 1.396 0 000-2.79zM3.294 14.293A2.297 2.297 0 011 11.998a2.297 2.297 0 012.294-2.294 2.297 2.297 0 012.295 2.294 2.297 2.297 0 01-2.295 2.295zm0-3.688a1.395 1.395 0 000 2.788 1.395 1.395 0 100-2.788zM3.294 20.761A2.297 2.297 0 011 18.467a2.297 2.297 0 012.294-2.295 2.297 2.297 0 012.295 2.295 2.297 2.297 0 01-2.295 2.294zm0-3.688a1.396 1.396 0 000 2.79 1.396 1.396 0 000-2.79zM20.738 7.821a2.297 2.297 0 01-2.295-2.294 2.297 2.297 0 012.294-2.295 2.297 2.297 0 012.295 2.295 2.297 2.297 0 01-2.294 2.294zm0-3.688a1.396 1.396 0 101.395 1.395c0-.77-.626-1.395-1.395-1.395zM20.738 14.293a2.297 2.297 0 01-2.295-2.295 2.297 2.297 0 012.294-2.294 2.297 2.297 0 012.295 2.294 2.297 2.297 0 01-2.294 2.295zm0-3.688c-.769 0-1.395.625-1.395 1.393a1.396 1.396 0 002.79 0c0-.77-.626-1.393-1.395-1.393zM20.738 20.761a2.297 2.297 0 01-2.295-2.294 2.297 2.297 0 012.294-2.295 2.297 2.297 0 012.295 2.295 2.297 2.297 0 01-2.294 2.294zm0-3.688a1.396 1.396 0 101.395 1.395c0-.77-.626-1.395-1.395-1.395zM12.016 11.057a2.297 2.297 0 01-2.294-2.294 2.297 2.297 0 012.294-2.295 2.297 2.297 0 012.295 2.295 2.297 2.297 0 01-2.295 2.294zm0-3.688a1.396 1.396 0 101.395 1.395c0-.77-.625-1.395-1.395-1.395zM12.017 4.589a2.297 2.297 0 01-2.295-2.295A2.297 2.297 0 0112.017 0a2.297 2.297 0 012.294 2.294 2.297 2.297 0 01-2.294 2.295zm0-3.688a1.396 1.396 0 101.395 1.395c0-.77-.626-1.395-1.395-1.395zM12.017 17.529a2.297 2.297 0 01-2.295-2.295 2.297 2.297 0 012.295-2.294 2.297 2.297 0 012.294 2.294 2.297 2.297 0 01-2.294 2.295zm0-3.688a1.396 1.396 0 101.395 1.395c0-.77-.626-1.395-1.395-1.395zM12.016 24a2.297 2.297 0 01-2.294-2.295 2.297 2.297 0 012.294-2.294 2.297 2.297 0 012.295 2.294A2.297 2.297 0 0112.016 24zm0-3.688a1.396 1.396 0 101.395 1.395c0-.77-.625-1.395-1.395-1.395z"></path><path d="M8.363 8.222a.742.742 0 01-.277-.053l-1.494-.596a.75.75 0 11.557-1.392l1.493.595a.75.75 0 01-.278 1.446h-.001zM8.363 14.566a.743.743 0 01-.277-.053l-1.494-.595a.75.75 0 11.557-1.393l1.493.596a.75.75 0 01-.278 1.445h-.001zM17.124 11.397a.741.741 0 01-.277-.054l-1.493-.595a.75.75 0 11.555-1.392l1.493.595a.75.75 0 01-.278 1.446zM17.124 5.05a.744.744 0 01-.277-.054L15.354 4.4a.75.75 0 01.555-1.392l1.493.596a.75.75 0 01-.278 1.445zM17.124 17.739a.743.743 0 01-.277-.053l-1.494-.596a.75.75 0 11.556-1.392l1.493.596a.75.75 0 01-.278 1.445zM6.91 17.966a.75.75 0 01-.279-1.445l1.494-.595a.749.749 0 11.556 1.392l-1.493.595a.743.743 0 01-.277.053H6.91zM6.91 11.66a.75.75 0 01-.279-1.446l1.494-.595a.75.75 0 01.556 1.392l-1.493.595a.743.743 0 01-.277.053H6.91zM6.91 5.033a.75.75 0 01-.279-1.446l1.494-.595a.75.75 0 01.556 1.392l-1.493.596a.744.744 0 01-.277.053H6.91zM8.363 21.364a.743.743 0 01-.277-.053l-1.494-.596a.75.75 0 01.555-1.392l1.494.595a.75.75 0 01-.278 1.446zM15.63 8.223a.75.75 0 01-.278-1.447l1.494-.595a.75.75 0 01.556 1.393l-1.494.595a.744.744 0 01-.276.054h-.002zM15.63 14.567a.75.75 0 01-.278-1.446l1.494-.596a.75.75 0 01.556 1.394l-1.494.595a.743.743 0 01-.276.053h-.002zM15.63 21.363a.749.749 0 01-.278-1.445l1.494-.595a.75.75 0 11.555 1.392l-1.494.595a.741.741 0 01-.277.053z"></path></g>',Zl='<g transform="translate(0,0) scale(4.1667)"><path d="M23 23h-1.223V8.028c0-3.118-2.568-5.806-5.744-5.806H8.027c-3.176 0-5.744 2.565-5.744 5.686 0 3.119 2.568 5.684 5.744 5.684h.794c1.346 0 2.445 1.1 2.445 2.444 0 1.346-1.1 2.446-2.445 2.446H1v-1.223h7.761c.671 0 1.223-.551 1.223-1.16 0-.67-.552-1.16-1.223-1.16h-.794C4.177 14.872 1 11.756 1 7.909 1 4.058 4.176 1 8.027 1h8.066C19.88 1 23 4.239 23 8.028V23z"></path><path d="M8.884 12.672c1.71.06 3.361 1.588 3.361 3.422 0 1.833-1.528 3.421-3.421 3.421H1v1.223h7.761c2.568 0 4.705-2.077 4.705-4.644 0-.672-.123-1.283-.43-1.894-.245-.551-.67-1.1-1.099-1.528-.489-.429-1.039-.734-1.65-.977-.525-.175-1.048-.193-1.594-.212-.218-.008-.441-.016-.669-.034-.428 0-1.406-.245-1.956-.61a3.369 3.369 0 01-1.223-1.406c-.183-.489-.305-.977-.305-1.528A3.417 3.417 0 017.96 4.482h8.066c1.895 0 3.422 1.65 3.422 3.483v15.032h1.223V8.027c0-2.568-2.077-4.768-4.645-4.768h-8c-2.568 0-4.705 2.077-4.705 4.646 0 .67.123 1.282.43 1.894a4.45 4.45 0 001.099 1.528c.429.428 1.039.734 1.588.976.306.123.611.183.976.246.857.06 1.406.123 1.466.123h.003z"></path><path d="M1 23h7.761v-.003c3.85 0 7.03-3.116 7.09-7.026 0-3.79-3.117-6.906-6.967-6.906H8.09c-.672 0-1.222-.552-1.222-1.16 0-.608.487-1.16 1.159-1.16h8.069c.608 0 1.159.611 1.159 1.283v14.97h1.223V8.024c0-1.345-1.1-2.505-2.445-2.505H7.967a2.451 2.451 0 00-2.445 2.445 2.45 2.45 0 002.445 2.445h.794c3.176 0 5.744 2.568 5.744 5.684s-2.568 5.684-5.744 5.684H1V23z"></path></g>',ec='<g transform="translate(0,0) scale(4.1667)"><path clip-rule="evenodd" d="M14.121 2.701a9.299 9.299 0 000 18.598V22.7c-5.91 0-10.7-4.791-10.7-10.701S8.21 1.299 14.12 1.299V2.7zm4.752 3.677A7.353 7.353 0 109.42 17.643l-.901 1.074a8.754 8.754 0 01-1.08-12.334 8.755 8.755 0 0112.335-1.08l-.901 1.075zm-2.255.844a5.407 5.407 0 00-5.048 9.563l-.656 1.24a6.81 6.81 0 016.358-12.043l-.654 1.24zM14.12 8.539a3.46 3.46 0 100 6.922v1.402a4.863 4.863 0 010-9.726v1.402z"></path><path d="M15.407 10.836a2.24 2.24 0 00-.51-.409 1.084 1.084 0 00-.544-.152c-.255 0-.483.047-.684.14a1.58 1.58 0 00-.84.912c-.074.203-.11.416-.11.631 0 .218.036.43.11.631a1.594 1.594 0 00.84.913c.2.093.43.14.684.14.216 0 .417-.046.602-.135.188-.09.35-.225.475-.392l.928 1.006c-.14.14-.3.261-.482.363a3.367 3.367 0 01-1.083.38c-.17.026-.317.04-.44.04a3.315 3.315 0 01-1.182-.21 2.825 2.825 0 01-.961-.597 2.816 2.816 0 01-.644-.929 2.987 2.987 0 01-.238-1.21c0-.444.08-.847.238-1.21.15-.35.368-.666.643-.929.278-.261.605-.464.962-.596a3.315 3.315 0 011.182-.21c.355 0 .712.068 1.072.204.361.138.685.36.944.649l-.962.97z"></path></g>',tc='<g transform="translate(0,0) scale(4.1667)"><path d="M12.105 2L9.927 4.953H.653L2.83 2h9.276zM23.254 19.048L21.078 22h-9.242l2.174-2.952h9.244zM24 2L9.264 22H0L14.736 2H24z"></path></g>';var ei=class extends K.Plugin{async onload(){await this.loadSettings(),(0,K.addIcon)("ai-providers-openai",Dl),(0,K.addIcon)("ai-providers-ollama",ql),(0,K.addIcon)("ai-providers-ollama-openwebui",jl),(0,K.addIcon)("ai-providers-gemini",$l),(0,K.addIcon)("ai-providers-openrouter",Ll),(0,K.addIcon)("ai-providers-lmstudio",Ul),(0,K.addIcon)("ai-providers-groq",Bl),(0,K.addIcon)("ai-providers-ai302",Hl),(0,K.addIcon)("ai-providers-anthropic",zl),(0,K.addIcon)("ai-providers-mistral",Wl),(0,K.addIcon)("ai-providers-together",Vl),(0,K.addIcon)("ai-providers-fireworks",Kl),(0,K.addIcon)("ai-providers-perplexity",Jl),(0,K.addIcon)("ai-providers-deepseek",Xl),(0,K.addIcon)("ai-providers-xai",Gl),(0,K.addIcon)("ai-providers-novita",Ql),(0,K.addIcon)("ai-providers-deepinfra",Yl),(0,K.addIcon)("ai-providers-sambanova",Zl),(0,K.addIcon)("ai-providers-cerebras",ec),(0,K.addIcon)("ai-providers-zai",tc);let t=new Ks(this.app,this);this.exposeAIProviders(),this.app.workspace.onLayoutReady(async()=>{await this.aiProviders.initEmbeddingsCache()}),this.app.workspace.trigger("ai-providers-ready"),this.addSettingTab(t)}async onunload(){this.aiProviders&&await this.aiProviders.cleanup();let t=this.app;delete t.aiProviders}async loadSettings(){var t;this.settings=Object.assign({},jo,await this.loadData()),b.setEnabled((t=this.settings.debugLogging)!=null?t:!1)}async saveSettings(){await this.saveData(this.settings),this.exposeAIProviders()}exposeAIProviders(){this.aiProviders&&this.aiProviders.cleanup().catch(r=>{console.error("Error during aiProviders cleanup:",r)}),this.aiProviders=new Zn(this.app,this);let t=this.app;t.aiProviders=this.aiProviders,this.app.workspace.layoutReady&&this.aiProviders.initEmbeddingsCache().catch(r=>{console.error("Error reinitializing embeddings cache:",r)})}};

/* nosourcemap */